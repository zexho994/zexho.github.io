<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="keywords" content="Zexho ä¸ªäººåšå®¢">
<meta name="description" content="èŠå…°ç”Ÿäºå¹½è°·ï¼Œä¸å› æ— äººè€Œä¸èŠ³">
<meta name="theme-color" content="#000">
<title>ç»™å­¦å¼Ÿä»¬åˆ†æ WireShark | Zexho&#39; blog</title>
<link rel="shortcut icon" href="/favicon.ico?v=1649404093671">
<link rel="stylesheet" href="/styles/main.css">
<link rel="stylesheet" href="/media/css/gemini.css">

<link rel="stylesheet" href="/media/fonts/font-awesome.css">
<link
  href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rosario:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
  rel="stylesheet" type="text/css">

<link href="/media/hljs/styles/androidstudio.css"
  rel="stylesheet">

<script src="/media/hljs/highlight.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.ui.min.js"></script>

<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>



  <meta name="description" content="ç»™å­¦å¼Ÿä»¬åˆ†æ WireShark" />
  <meta name="keywords" content="çŸ¥è¯†åˆ†äº«" />
</head>

<body>
  <div class="head-top-line"></div>
  <div class="header-box">
    
<div class="gemini">
  <header class="header  ">
    <div class="blog-header box-shadow-wrapper bg-color " id="header">
      <div class="nav-toggle" id="nav_toggle">
        <div class="toggle-box">
          <div class="line line-top"></div>
          <div class="line line-center"></div>
          <div class="line line-bottom"></div>
        </div>
      </div>
      <div class="site-meta">       
        <div class="site-title">
          
            <a href="/" class="brand">
              <span>Zexho&#39; blog</span>
            </a>  
          
        </div>
        
          <p class="subtitle">Blog &amp; Life</p>
        
      </div>
      <nav class="site-nav" id="site_nav">
        <ul id="nav_ul">
          
            
            
            <li class="nav-item ">
              
              
                <a href="https://zexho994.github.io/blog.zexho.life/" target="_self">
                  <i class="fa fa-globe"></i> é¦–é¡µ
                </a>
              
            </li>
          
            
            
            <li class="nav-item ">
              
              
                <a href="/archives/" target="_self">
                  <i class="fa fa-archive"></i> æ—¶é—´çº¿
                </a>
              
            </li>
          
            
            
            <li class="nav-item ">
              
              
                <a href="/tags/" target="_self">
                  <i class="fa fa-tags"></i> æ ‡ç­¾é›†
                </a>
              
            </li>
          
          
        </ul>
      </nav>
    </div>
  </header>
</div>

<script type="text/javascript"> 
 
  let showNav = true;

  let navToggle = document.querySelector('#nav_toggle'),
  siteNav = document.querySelector('#site_nav');
  
  function navClick() {
    let sideBar = document.querySelector('.sidebar');
    let navUl = document.querySelector('#nav_ul');
    navToggle.classList.toggle('nav-toggle-active');
    siteNav.classList.toggle('nav-menu-active');
    if (siteNav.classList.contains('nav-menu-active')) {
      siteNav.style = "height: " + (navUl.children.length * 42) +"px !important";
    } else {
      siteNav.style = "";
    }
  }

  navToggle.addEventListener('click',navClick);  
</script>
  </div>
  <div class="main-continer">
    
    <div
      class="section-layout gemini ">
      <div class="section-layout-wrapper">
        

<div class="sidebar">
  
    <div class="sidebar-box box-shadow-wrapper bg-color right-motion" id="sidebar">
      
        <div class="post-list-sidebar">
          <div class="sidebar-title">
            <span id="tocSideBar" class="sidebar-title-item sidebar-title-active">æ–‡ç« ç›®å½•</span>
            <span id="metaSideBar" class="sidebar-title-item">ç«™ç‚¹æ¦‚è§ˆ</span>
          </div>
        </div>
      
      <div class="sidebar-body gemini" id="sidebar_body">
        
          
            <div class="post-side-meta" id="post_side_meta">
              
<div class="sidebar-wrapper box-shadow-wrapper bg-color">
  <div class="sidebar-item">
    <img class="site-author-image right-motion" src="/images/avatar.png"/>
    <p class="site-author-name">Zexho</p>
    
    <div class="site-description right-motion">
      
        <p id="binft">èŠå…°ç”Ÿäºå¹½è°·ï¼Œä¸å› æ— äººè€Œä¸èŠ³</p>
      
    </div>
    
  </div>
  <div class="sidebar-item side-item-stat right-motion">
    <div class="sidebar-item-box">
      <a href="/archives/">
        
        <span class="site-item-stat-count">28</span>
        <span class="site-item-stat-name">æ–‡ç« </span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="">
        <span class="site-item-stat-count">13</span>
        <span class="site-item-stat-name">åˆ†ç±»</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="/tags/">
        <span class="site-item-stat-count">13</span>
        <span class="site-item-stat-name">æ ‡ç­¾</span>
      </a>
    </div>
  </div>
  
    
      <div class="sidebar-item">
        <span class="site-item-rss">
            <i class="fa fa-rss"></i>
            <a href="https://zexho994.github.io/blog.zexho.life/atom.xml" target="_blank">RSS</a>
        </span>
      </div>
    
  
  
    <div class="sidebar-item sidebar-item-social">
      <div class="social-item">
        
          
            <a href="http://github.com/zexho994">
              <i class="fa fa-github-alt" title="Github"></i>
            </a>
          
        
        
          
            <a class="social-img" href="#">
              <img src="/media/images/custom-array-imgSocials-1649214709535-socialImg.jpg" />
              <i class="fa fa-wechat" title="å¾®ä¿¡" ></i>
            </a>
          
        
      </div>
    </div>
  

  


</div>
            </div>
            <div class="post-toc sidebar-body-active" id="post_toc" style="opacity: 1;">
              <div class="toc-box right-motion">
  <div class="toc-wrapper auto-number auto"
    id="toc_wrapper">
    <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#1-wireshark%E7%9A%84%E7%94%A8%E9%80%94">1. WireSharkçš„ç”¨é€”</a>
<ul>
<li><a href="#%E7%94%A8%E9%80%94%E4%B8%80-%E5%AD%A6%E4%B9%A0%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86%E6%8F%90%E4%BE%9B%E5%AE%9E%E9%99%85%E6%93%8D%E4%BD%9C">ç”¨é€”ä¸€ï¼š å­¦ä¹ ç½‘ç»œçŸ¥è¯†ï¼Œæä¾›å®é™…æ“ä½œ</a></li>
<li><a href="#%E7%94%A8%E9%80%94%E4%BA%8C-%E8%8E%B7%E5%8F%96%E7%BD%91%E7%BB%9C%E8%B5%84%E6%BA%90%E4%BF%A1%E6%81%AF">ç”¨é€”äºŒï¼š è·å–ç½‘ç»œèµ„æºä¿¡æ¯</a></li>
<li><a href="#%E7%94%A8%E9%80%94%E4%B8%89%E8%BF%9B%E8%A1%8C%E7%BD%91%E7%BB%9C%E7%8A%B6%E5%86%B5%E5%88%86%E6%9E%90">ç”¨é€”ä¸‰ï¼šè¿›è¡Œç½‘ç»œçŠ¶å†µåˆ†æ</a></li>
</ul>
</li>
<li><a href="#2-%E6%8A%93%E5%8C%85%E5%89%8D%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">2. æŠ“åŒ…å‰çš„å‡†å¤‡å·¥ä½œ</a>
<ul>
<li><a href="#1-%E4%BF%AE%E6%94%B9%E7%9D%80%E8%89%B2%E8%A7%84%E5%88%99">1. ä¿®æ”¹ç€è‰²è§„åˆ™</a>
<ul>
<li><a href="#1-%E6%89%93%E5%BC%80%E8%A7%86%E5%9B%BE%E9%80%89%E9%A1%B9%E6%89%BE%E5%88%B0%E7%9D%80%E8%89%B2%E8%A7%84%E5%88%99%E5%B0%B1%E5%83%8F">1ï¼‰ï¼š æ‰“å¼€è§†å›¾é€‰é¡¹ï¼Œæ‰¾åˆ°ç€è‰²è§„åˆ™ï¼Œå°±åƒ</a></li>
<li><a href="#2-%E4%BF%AE%E6%94%B9%E8%83%8C%E6%99%AF%E9%85%8D%E8%89%B2">2ï¼‰ï¼š ä¿®æ”¹èƒŒæ™¯é…è‰²</a></li>
</ul>
</li>
<li><a href="#2-%E5%8F%AA%E6%8A%93%E5%8C%85%E5%A4%B4">2. åªæŠ“åŒ…å¤´</a></li>
<li><a href="#3-%E8%AE%A4%E8%AF%86%E4%B8%8B%E5%88%86%E5%B1%82">3. è®¤è¯†ä¸‹åˆ†å±‚</a></li>
<li><a href="#4-%E6%95%B0%E6%8D%AE%E8%BF%87%E6%BB%A4%E6%8A%80%E5%B7%A7">4. æ•°æ®è¿‡æ»¤æŠ€å·§</a>
<ul>
<li><a href="#1%E5%8D%8F%E8%AE%AE%E8%BF%87%E6%BB%A4">1ï¼‰åè®®è¿‡æ»¤</a></li>
<li><a href="#2-%E7%AB%AF%E5%8F%A3%E8%BF%87%E6%BB%A4">2ï¼‰ ç«¯å£è¿‡æ»¤</a></li>
<li><a href="#3ip%E8%BF%87%E6%BB%A4">3ï¼‰Ipè¿‡æ»¤</a></li>
<li><a href="#4%E6%A0%87%E8%AF%86%E7%AC%A6%E8%BF%87%E6%BB%A4">4ï¼‰æ ‡è¯†ç¬¦è¿‡æ»¤</a></li>
<li><a href="#5%E9%95%BF%E5%BA%A6%E8%BF%87%E6%BB%A4">5ï¼‰é•¿åº¦è¿‡æ»¤</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
</div>

<script>

  let lastTop = 0, lList = [], hList = [], postBody, lastIndex = -1;
  let active = 'active-show', activeClass = 'active-current';
  let tocWrapper = document.querySelector('#toc_wrapper');
  let tocContent = tocWrapper.children[0];
  let autoNumber = tocWrapper && tocWrapper.classList.contains('auto-number');

  function addTocNumber(elem, deep) {
    if (!elem) {
      return;
    }
    let prop = elem.__proto__;

    if (prop === HTMLUListElement.prototype) {
      for (let i = 0; i < elem.children.length; i++) {
        addTocNumber(elem.children[i], deep + (i + 1) + '.');
      }
    } else if (prop === HTMLLIElement.prototype) {
      // ä¿å­˜liå…ƒç´ 
      if (elem.children[0].__proto__ === HTMLAnchorElement.prototype) {
        lList.push(elem);
      }
      for (let i = 0; i < elem.children.length; i++) {
        let cur = elem.children[i];
        if (cur.__proto__ === HTMLAnchorElement.prototype) {
          if (autoNumber) {
            cur.text = deep + ' ' + cur.text;
          }
        } else if (cur.__proto__ === HTMLUListElement.prototype) {
          addTocNumber(cur, deep);
        }
      }
    }
  }

  function removeParentActiveClass() {
    let parents = tocContent.querySelectorAll('.' + active)
    parents.forEach(function (elem) {
      elem.classList.remove(active);
    });
  }

  function addActiveClass(index) {
    if (index >= 0 && index < hList.length) {
      lList[index].classList.add(activeClass);
    }
  }

  function removeActiveClass(index) {
    if (index >= 0 && index < hList.length) {
      lList[index].classList.remove(activeClass);
    }
  }

  function addActiveLiElemment(elem, parent) {
    if (!elem || elem === parent) {
      return;
    } else {
      if (elem.__proto__ === HTMLLIElement.prototype) {
        elem.classList.add(active);
      }
      addActiveLiElemment(elem.parentElement, parent);
    }
  }

  function showToc() {
    if (tocWrapper) {
      postBody = document.querySelector('#post_body');
      for (let i = 0; i < postBody.children.length; i++) {
        if (postBody.children[i].__proto__ === HTMLHeadingElement.prototype) {
          hList.push(postBody.children[i]);
        }
      }
      if (tocWrapper.classList.contains('compress')) {
        tocContent.classList.add('closed');
      } else if (tocWrapper.classList.contains('no_compress')) {
        tocContent.classList.add('expanded');
      } else {
        if (hList.length > 10) {
          active = 'active-hidden'
          tocContent.classList.add('closed');
        } else {
          tocContent.classList.add('expanded');
        }
      }
    }
  }

  (function () {
    // å¤„ç†ä¸æ˜¯ä»#ä¸€çº§æ ‡é¢˜å¼€å§‹ç›®å½•
    if (tocContent.children.length === 1 && tocContent.children[0].__proto__ === HTMLLIElement.prototype) {
      let con = tocContent.children[0].children[0];
      tocContent.innerHTML = con.innerHTML;
    }
    let markdownItTOC = document.querySelector('.markdownIt-TOC');
    let innerHeight = window.innerHeight;
    markdownItTOC.style = `max-height: ${innerHeight - 80 > 0 ? innerHeight - 80 : innerHeight}px`
    addTocNumber(tocContent, '');
  })();

  document.addEventListener('scroll', function (e) {
    if (lList.length <= 0) {
      return;
    }
    let scrollTop = document.scrollingElement.scrollTop + 10;
    let dir;

    if (lastTop - scrollTop > 0) {
      dir = 'up';
    } else {
      dir = 'down';
    }

    lastTop = scrollTop;
    if (scrollTop <= 0) {
      if (lastIndex >= 0 && lastIndex < hList.length) {
        lList[lastIndex].classList.remove(activeClass);
      }
      return;
    }

    let current = 0, hasFind = false;
    for (let i = 0; i < hList.length; i++) {
      if (hList[i].offsetTop > scrollTop) {
        current = i;
        hasFind = true;
        break;
      }
    }
    if (!hasFind && scrollTop > lList[lList.length - 1].offsetTop) {
      current = hList.length - 1;
    } else {
      current--;
    }
    if (dir === 'down') {
      if (current > lastIndex) {
        addActiveClass(current);
        removeActiveClass(lastIndex)
        lastIndex = current;
        removeParentActiveClass();
        lList[current] && addActiveLiElemment(lList[current].parentElement, tocContent);
      }
    } else {
      if (current < lastIndex) {
        addActiveClass(current);
        removeActiveClass(lastIndex);
        lastIndex = current;
        removeParentActiveClass();
        lList[current] && addActiveLiElemment(lList[current].parentElement, tocContent);
      }
    }
  });


  window.addEventListener('load', function () {
    showToc();
    document.querySelector('#sidebar').style = 'display: block;';
    tocWrapper.classList.add('toc-active');
    setTimeout(function () {
      if ("createEvent" in document) {
        let evt = document.createEvent("HTMLEvents");
        evt.initEvent("scroll", false, true);
        document.dispatchEvent(evt);
      }
      else {
        document.fireEvent("scroll");
      }
    }, 500)
  })

</script>
            </div>
          
        
      </div>
    </div>
  
</div>
<script>
  const SIDEBAR_TITLE_ACTIVE = 'sidebar-title-active';
  const SIDEBAR_BODY_ACTIVE = 'sidebar-body-active';
  const SLIDE_UP_IN = 'slide-up-in';

  let sidebar = document.querySelector('#sidebar'),
  tocSideBar = document.querySelector('#tocSideBar'),
  metaSideBar = document.querySelector('#metaSideBar'),
  postToc = document.querySelector('#post_toc'),
  postSiteMeta = document.querySelector('#post_side_meta'),
  sidebarTitle = document.querySelector('.sidebar-title'),
  sidebarBody = document.querySelector('#sidebar_body');

  tocSideBar && tocSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  metaSideBar && metaSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  function toggleSidebar(e) {
    let currentTitle = document.querySelector("."+SIDEBAR_TITLE_ACTIVE);
    if (currentTitle == e.srcElement) {
      return ;
    }
    let current, showElement, hideElement;
    if (e.srcElement == metaSideBar) {
      showElement = postSiteMeta;
      hideElement = postToc;
    } else if (e.srcElement == tocSideBar){
      showElement = postToc;
      hideElement = postSiteMeta;
    }
    currentTitle.classList.remove(SIDEBAR_TITLE_ACTIVE);
    e.srcElement.classList.add(SIDEBAR_TITLE_ACTIVE);

    window.Velocity(hideElement, 'stop');
    window.Velocity(hideElement, 'transition.slideUpOut', {
      display: 'none',
      duration: 200,
      complete: function () {
        window.Velocity(showElement, 'transition.slideDownIn', {
          duration: 200
        });
      }
    })
    hideElement.classList.remove(SIDEBAR_BODY_ACTIVE);
    showElement.classList.add(SIDEBAR_BODY_ACTIVE);
  }

  postToc && postToc.addEventListener('transitionend', function() {
    this.classList.remove(SLIDE_UP_IN);
  });

  if (sidebarBody) {
    if (sidebarBody.classList.contains('pisces') || sidebarBody.classList.contains('gemini')) {
      let hasFix = false;
      let scrollEl = document.querySelector('.main-continer');
      let limitTop = document.querySelector('#nav_ul').children.length * 42 + 162;
      window.addEventListener('scroll', function(e) {
        if (document.scrollingElement.scrollTop >= limitTop) {
          if (!hasFix) {
            sidebar.classList.add('sidebar-fixed');
            hasFix = true;
          }
        } else {
          if (hasFix) {
            sidebar.classList.remove('sidebar-fixed');
            hasFix = false;
          }
        }
      });
    }
  }
  
</script>
        <div class="section-box box-shadow-wrapper">
          <div class="section bg-color post post-page">
            <header class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="https://zexho994.github.io/blog.zexho.life/post/gei-xue-di-men-fen-xi-wireshark/">
      ç»™å­¦å¼Ÿä»¬åˆ†æ WireShark
    </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span>å‘å¸ƒäº</span>
      <span>2019-05-11 05:59:02</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-folder-o"></i>
      <span class="pc-show">åˆ†ç±»äº</span>
      
      
      <a href="https://zexho994.github.io/blog.zexho.life/tag/Yh19JUBym/">
        <span>çŸ¥è¯†åˆ†äº«</span>
      </a>
      
      
    </span>
    <span class="post-meta-divider">|</span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span>4åˆ†é’Ÿ</span>
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span>939<span class="pc-show">å­—æ•°</span></span>
    </span>
    
    
    
    <span id="/blog.zexho.life/post/gei-xue-di-men-fen-xi-wireshark/" data-flag-title="ç»™å­¦å¼Ÿä»¬åˆ†æ WireShark" class="meta-item pc-show leancloud_visitors">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-eye"></i>
      <span>æµè§ˆé‡ï¼š<span class="leancloud-visitors-count"></span></span>
    </span>
    
  </div>
</header>
            <div class="post-body next-md-body" id="post_body">
              <blockquote>
<p>å‰ä¸€é˜µå­è¦ç»™å®éªŒå®¤çš„å­¦å¼Ÿä»¬æŠ€æœ¯åˆ†äº«ï¼Œå½“æ—¶æ”¶åˆ°å»ºè®®ç»™ä»–ä»¬æ™®åŠä¸€äº›è®¡ç®—æœºç½‘ç»œçš„çŸ¥è¯†ï¼Œå¯æ˜¯å…³<br>
æœ‰ç†è®ºçŸ¥è¯†è®²è¯¾è‚¯å®šä¸å¤Ÿå¸å¼•äººï¼Œäºæ˜¯ä¾¿ä¸€è¾¹å­¦ä¹ Wiresharkä¸€è¾¹åšPPTä¸€è¾¹å†™è®²ç¨¿ã€‚å¿™ç¢Œäº†ä¸¤ä¸ªæ˜ŸæœŸåï¼Œåˆ†äº«ä¼šåè¿˜æ˜¯å¾—åˆ°äº†ä¸é”™çš„çš„è¯„ä»·ğŸ˜ï¼Œæˆ‘ä¹Ÿåœ¨åšå®¢ä¸­æ€»ç»“ä¸‹ä¸€äº›ä½¿ç”¨æŠ€å·§ï¼Œå†…å®¹ä¸»è¦é¢å‘æ–°æ‰‹</p>
</blockquote>
<!-- more -->
<h2 id="1-wiresharkçš„ç”¨é€”">1. WireSharkçš„ç”¨é€”</h2>
<h3 id="ç”¨é€”ä¸€-å­¦ä¹ ç½‘ç»œçŸ¥è¯†æä¾›å®é™…æ“ä½œ">ç”¨é€”ä¸€ï¼š å­¦ä¹ ç½‘ç»œçŸ¥è¯†ï¼Œæä¾›å®é™…æ“ä½œ</h3>
<p>åœ¨æˆ‘å¤§äºŒå­¦ä¹ è®¡ç®—æœºç½‘ç»œçš„æ—¶å€™ï¼Œè€å¸ˆä¸Šè¯¾åªè´Ÿè´£ä¹¦æœ¬çš„è®²è§£ï¼Œå¯¼è‡´æˆ‘äº§ç”Ÿäº†è®¡ç®—æœºç½‘ç»œå¾ˆæ— èŠçš„é”™è§‰ï¼Œæ‰€ä»¥é‚£æ—¶å€™ä¹Ÿæ²¡å¤ªè®¤çœŸçš„å­¦ä¹ è¿™é—¨è¯¾ç¨‹ã€‚ä½†æ˜¯åæ¥å½“æˆ‘è‡ªå·±è¾¹æŠ“åŒ…è¾¹æ¸©ä¹ è®¡ç½‘çŸ¥è¯†çš„æ—¶å€™ï¼Œæ‰å‘ç°æ˜¯å¦‚æ­¤çš„æœ‰è¶£ã€‚è€Œåœ¨æŠ“åŒ…å·¥å…·ä¸­ï¼Œæˆ‘ä½¿ç”¨è¿‡å°èŠ±ç“¶ï¼ˆcharlesï¼‰å’Œå°é²¨é±¼ï¼ˆwiresharkï¼‰ï¼Œæˆ‘æ¨èå°é²¨é±¼ã€‚</p>
<blockquote>
<p>è¿˜æœ‰ä¸€æ¬¾æ¯”è¾ƒæµè¡Œï¼Œå«fiddlerï¼Œå› ä¸ºæœ¬äººä½¿ç”¨macï¼Œfiddleræœªæ¨å‡ºmacç‰ˆï¼Œæ‰€ä»¥æœªæ¥è§¦è¿‡å®ƒ</p>
</blockquote>
<h3 id="ç”¨é€”äºŒ-è·å–ç½‘ç»œèµ„æºä¿¡æ¯">ç”¨é€”äºŒï¼š è·å–ç½‘ç»œèµ„æºä¿¡æ¯</h3>
<p>é€šä¿—ç‚¹è®²å°±æ˜¯æŠ“åŒ…ï¼Œwiresharkå¯ä»¥æŠ“çš„è¯·æ±‚ç±»å‹éå¸¸å¤šï¼Œæ–°æ‰‹å¸¸è§çš„åƒhttpã€httpsï¼ˆéœ€è¦ä¸‹è½½è¡¥ä¸ï¼‰ã€tcpã€udpã€arpç­‰ç­‰éƒ½å¯ä»¥ã€‚</p>
<h3 id="ç”¨é€”ä¸‰è¿›è¡Œç½‘ç»œçŠ¶å†µåˆ†æ">ç”¨é€”ä¸‰ï¼šè¿›è¡Œç½‘ç»œçŠ¶å†µåˆ†æ</h3>
<p>æ¯”å¦‚ç½‘ç»œæ•…éšœæ’æŸ¥ï¼Œå› ä¸ºæœ¬äººä¹Ÿæ²¡åˆ©ç”¨wiresharkåˆ†æè¿‡ï¼Œæ‰€ä»¥å°±ä¸è¯¯å¯¼å¤§å®¶äº†ï¼Œä¸è¿‡æˆ‘æ¨èä¸€æœ¬ä¹¦ï¼Œä¹Ÿæ˜¯æˆ‘å­¦ä¹ wiresharkçš„ä¸€æœ¬ä¹¦ã€‚<br>
<img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b034e550e178ea~tplv-t2oaga2asx-image.image" alt="" loading="lazy"><br>
ä½œè€…çš„é£æ ¼çœŸçš„å¾ˆé£è¶£ï¼Œè¯»èµ·æ¥å°±åƒå°è¯´ä¸€æ ·ï¼ŒæŒ‡ä¸å®šå“ªä¸ªåœ°æ–¹å°±ä¼šå·å·å†’å‡ºä¸€æ®µç¬‘è¯ã€‚</p>
<h2 id="2-æŠ“åŒ…å‰çš„å‡†å¤‡å·¥ä½œ">2. æŠ“åŒ…å‰çš„å‡†å¤‡å·¥ä½œ</h2>
<h3 id="1-ä¿®æ”¹ç€è‰²è§„åˆ™">1. ä¿®æ”¹ç€è‰²è§„åˆ™</h3>
<p>æˆ‘ä»¬ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„é€‚åˆï¼Œæ˜¾ç¤ºçš„ç•Œé¢å¯èƒ½åƒè¿™æ ·<br>
<img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/14/16f04764d3d10a9f~tplv-t2oaga2asx-image.image" alt="" loading="lazy"><br>
ä¸€ç‰‡ç™½çš„ï¼Œå¯¹äºæˆ‘ä»¬å¿«é€Ÿåˆ†è¾¨ä¸åŒè¯·æ±‚ç±»å‹æ˜¯æœ‰å¦¨ç¢çš„ï¼Œæ‰€ä»¥ç®€å•æ“ä½œä¸‹ï¼š</p>
<h4 id="1-æ‰“å¼€è§†å›¾é€‰é¡¹æ‰¾åˆ°ç€è‰²è§„åˆ™å°±åƒ">1ï¼‰ï¼š æ‰“å¼€è§†å›¾é€‰é¡¹ï¼Œæ‰¾åˆ°ç€è‰²è§„åˆ™ï¼Œå°±åƒ</h4>
<figure data-type="image" tabindex="1"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b03844f45a802a~tplv-t2oaga2asx-image.image" alt="" loading="lazy"></figure>
<h4 id="2-ä¿®æ”¹èƒŒæ™¯é…è‰²">2ï¼‰ï¼š ä¿®æ”¹èƒŒæ™¯é…è‰²</h4>
<p>æˆ‘ä»¬æ ¹æ®è‡ªå·±çš„é¢œè‰²åå¥½ï¼Œè®¾ç½®ä¸åŒçš„é…è‰²ï¼ˆæƒ³è¦æ­é…å‡ºä¸€å¥—å…»çœ¼çš„é…è‰²çœŸçš„æ˜¯ä¸€ä»¶è´¹åŠ›çš„äº‹ï¼‰ï¼Œæˆ‘è¿™é‡Œä¸»è¦ä¿®æ”¹<strong>SYNæŠ¥æ–‡</strong>ï¼ˆ<strong>ç»¿è‰²</strong>ï¼‰å’Œ<strong>FINæŠ¥æ–‡</strong>ï¼ˆ<strong>ç°è‰²</strong>ï¼‰ï¼Œé…å®Œåï¼Œå°±å¯ä»¥å‘ç°ç•Œé¢äººæ€§åŒ–è®¸å¤šï¼Œè¿™ä¸‹ä¸€çœ¼å°±å¯ä»¥çŸ¥é“tcpæ¡æ‰‹å’ŒæŒ¥æ‰‹çš„è¯·æ±‚å•¦ï½</p>
<figure data-type="image" tabindex="2"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b03873fb04efdf~tplv-t2oaga2asx-image.image" alt="" loading="lazy"></figure>
<h3 id="2-åªæŠ“åŒ…å¤´">2. åªæŠ“åŒ…å¤´</h3>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸€ä¸ªæ•°æ®å¸§æ˜¯ç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆï¼Œå¯¹äºæˆ‘ä»¬æ‰€è¦è·å–çš„æ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿåªè¦å‰é¢éƒ¨åˆ†å³å¯ã€‚å•å‡»èœå•æ ä¸Šçš„Capture--&gt;Optionsï¼Œç„¶ååœ¨å¼¹å‡ºçš„çª—å£ä¸Šå®šä¹‰â€œLimit each packet toâ€çš„å€¼å³å¯ã€‚ä¸€èˆ¬å¯ä»¥è®¾ç½®ä¸€ä¸ªåå¤§ä¸€ç‚¹çš„æ•°å­—ï¼š80å­—èŠ‚ï¼Œè¿™æ ·å°±å¯ä»¥åªæŠ“å‰80å­—èŠ‚äº†ã€‚è¿™æ ·çš„è¯ï¼ŒTCPå±‚ã€ç½‘ç»œå±‚å’Œæ•°æ®é“¾è·¯å±‚çš„ä¿¡æ¯éƒ½å¯ä»¥åŒ…æ‹¬åœ¨å†…äº†ã€‚æˆ‘æ¨èè®¾ç½®200å­—èŠ‚ï¼Œè¿™æ ·å¯ä»¥è·å–åˆ°httpã€tcpã€ç½‘ç»œå±‚åè®®çš„æ•°æ®äº†ã€‚</p>
<!--![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b038b192f25302~tplv-t2oaga2asx-image.image)-->
<h3 id="3-è®¤è¯†ä¸‹åˆ†å±‚">3. è®¤è¯†ä¸‹åˆ†å±‚</h3>
<figure data-type="image" tabindex="3"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/14/16f047976a357b7f~tplv-t2oaga2asx-image.image" alt="" loading="lazy"></figure>
<p>æ³¨æ„ï¼šåœ¨è¿™é‡Œç½‘ç»œå±‚å¯¹åº”Ipv4ï¼Œä¼ è¾“å±‚å¯¹åº”tcpï¼Œåº”ç”¨å±‚å¯¹åº”httpã€‚å¦‚æœæ˜¯udpï¼Œé•¿è¿™æ ·â¬‡</p>
<figure data-type="image" tabindex="4"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b0397dc455cff5~tplv-t2oaga2asx-image.image" alt="" loading="lazy"></figure>
<h3 id="4-æ•°æ®è¿‡æ»¤æŠ€å·§">4. æ•°æ®è¿‡æ»¤æŠ€å·§</h3>
<p>è¿™ä¹Ÿæ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªå°æŠ€å·§ï¼Œä¼šä½¿ç”¨è¿‡æ»¤å™¨çš„è¯å¯¹äºå¿«é€Ÿå®šä½è¿˜æ˜¯æœ‰å¾ˆå¤§å¸®åŠ©çš„ï¼Œæˆ‘è¿™é‡Œåˆ—å‡ºä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„æŠ€å·§ï¼Œä¸€é€šåˆ™ç™¾é€šã€‚</p>
<h4 id="1åè®®è¿‡æ»¤">1ï¼‰åè®®è¿‡æ»¤</h4>
<figure data-type="image" tabindex="5"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039b2a5642e35~tplv-t2oaga2asx-image.image" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="6"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039b40ea70225~tplv-t2oaga2asx-image.image" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="7"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039b515b268f2~tplv-t2oaga2asx-image.image" alt="" loading="lazy"></figure>
<h4 id="2-ç«¯å£è¿‡æ»¤">2ï¼‰ ç«¯å£è¿‡æ»¤</h4>
<figure data-type="image" tabindex="8"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039b9b618a472~tplv-t2oaga2asx-image.image" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="9"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039bab4fddc54~tplv-t2oaga2asx-image.image" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="10"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039bbc3d5152a~tplv-t2oaga2asx-image.image" alt="" loading="lazy"></figure>
<h4 id="3ipè¿‡æ»¤">3ï¼‰Ipè¿‡æ»¤</h4>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039c72b129565~tplv-t2oaga2asx-image.image" alt="" loading="lazy"><br>
<img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039c8a6e3c3ec~tplv-t2oaga2asx-image.image" alt="" loading="lazy"><br>
<img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039c9eb316c96~tplv-t2oaga2asx-image.image" alt="" loading="lazy"><br>
<img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039d555376068~tplv-t2oaga2asx-image.image" alt="" loading="lazy"></p>
<h4 id="4æ ‡è¯†ç¬¦è¿‡æ»¤">4ï¼‰æ ‡è¯†ç¬¦è¿‡æ»¤</h4>
<figure data-type="image" tabindex="11"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039db9dd136f4~tplv-t2oaga2asx-image.image" alt="" loading="lazy"></figure>
<h4 id="5é•¿åº¦è¿‡æ»¤">5ï¼‰é•¿åº¦è¿‡æ»¤</h4>
<figure data-type="image" tabindex="12"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039df7abb24f7~tplv-t2oaga2asx-image.image" alt="" loading="lazy"></figure>
<p>å…ˆåˆ†äº«åˆ°è¿™é‡Œï¼Œè¿™å‡ å¤©åœ¨å¿™ç€å†™å¾®ä¿¡å°ç¨‹åºï¼Œè¿‡å‡ å¤©é€šè¿‡wiresharkåˆ†æä¸‹tcp3æ¬¡æ¡æ‰‹å’Œ4æ¬¡æŒ¥æ‰‹æ¥å®æˆ˜æ“ä½œä¸‹ï½ å¦‚æœå“ªé‡Œæœ‰é”™è¯¯ï¼Œè¿˜æ³è¯·å¤§å®¶æŒ‡å‡ºã€‚</p>

            </div>
            <div class="post-footer">
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong>æœ¬æ–‡ä½œè€…ï¼š</strong>
      Zexho
    </li>
    <li class="post-copyright-link">
      <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
      <a href="https://zexho994.github.io/blog.zexho.life/post/gei-xue-di-men-fen-xi-wireshark/" title="ç»™å­¦å¼Ÿä»¬åˆ†æ WireShark">https://zexho994.github.io/blog.zexho.life/post/gei-xue-di-men-fen-xi-wireshark/</a>
    </li>
    <li class="post-copyright-license">
      <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>
      æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
    </li>
  </ul>
  <div class="tags">
    
      <a href="https://zexho994.github.io/blog.zexho.life/tag/Yh19JUBym/"># çŸ¥è¯†åˆ†äº«</a>
    
  </div>
  <div class="nav">
    <div class="nav-prev">
      
        <i class="fa fa-chevron-left"></i>
        <a class="nav-pc-next" title="SpringBoot è·¨åŸŸ Jsonp å’Œ Cors" href="https://zexho994.github.io/blog.zexho.life/post/wNJouB2lg/">SpringBoot è·¨åŸŸ Jsonp å’Œ Cors</a class="nav-pc-next">
        <a class="nav-mobile-prev" title="SpringBoot è·¨åŸŸ Jsonp å’Œ Cors" href="https://zexho994.github.io/blog.zexho.life/post/wNJouB2lg/">ä¸Šä¸€ç¯‡</a>
      
    </div>
    <div class="nav-next">
      
        <a class="nav-pc-next" title="å¾®ä¿¡å°ç¨‹åºï¼šé¢„è§ˆé¡µå®ç°ä¸åå°é€šä¿¡" href="https://zexho994.github.io/blog.zexho.life/post/hwe1uEAHe/">å¾®ä¿¡å°ç¨‹åºï¼šé¢„è§ˆé¡µå®ç°ä¸åå°é€šä¿¡</a>
        <a class="nav-mobile-next" title="å¾®ä¿¡å°ç¨‹åºï¼šé¢„è§ˆé¡µå®ç°ä¸åå°é€šä¿¡" href="https://zexho994.github.io/blog.zexho.life/post/hwe1uEAHe/">ä¸‹ä¸€ç¯‡</a>
        <i class="fa fa-chevron-right"></i>
      
    </div>
  </div>
</div>
            
  

          </div>
        </div>
      </div>
    </div>
    <div class="footer-box">
  <footer class="footer">
    <div class="copyright">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | Â© 2019-2020 Theme By <a href="https://github.com/hsxyhao/gridea-theme-next" target="_blank">HsxyHao</a>
    </div>
    <div class="poweredby">
      Life & Coding
    </div>
  </footer>
  
  
  <div class="gemini back-to-top" id="back_to_top">
    <i class="fa fa-arrow-up"></i>
    
    <span class="scrollpercent">
      <span id="back_to_top_text">0</span>%
    </span>
    
  </div>
  
  
    
<link rel="stylesheet" href="/media/live2d/css/live2d.css" />
<div class="box-scale">
  <div id="landlord" style="left: 5px;bottom: px;"
    data-key="">
    <canvas id="live2d" width="500" height="560" class="live2d"></canvas>
    

      <div class="message" style="opacity:0"></div>
      <div class="live_talk_input_body">
        <div class="live_talk_input_name_body">
          <input name="name" type="text" class="live_talk_name white_input" id="AIuserName" autocomplete="off"
            placeholder="ä½ çš„åå­—" />
        </div>
        <div class="live_talk_input_text_body">
          <input name="talk" type="text" class="live_talk_talk white_input" id="AIuserText" autocomplete="off"
            placeholder="è¦å’Œæˆ‘èŠä»€ä¹ˆå‘€ï¼Ÿ" />
          <button type="button" class="live_talk_send_btn" id="talk_send">å‘é€</button>
        </div>
      </div>
      <input name="live_talk" id="live_talk" value="1" type="hidden" />
      <div class="live_ico_box">
        <div class="live_ico_item type_info" id="showInfoBtn"></div>
        <div class="live_ico_item type_talk" id="showTalkBtn"></div>
        
        <div class="live_ico_item type_youdu" id="youduButton"></div>
        <div class="live_ico_item type_quit" id="hideButton"></div>
        <input name="live_statu_val" id="live_statu_val" value="0" type="hidden" />
        <audio src="" style="display:none;" id="live2d_bgm" data-bgm="0" preload="none"></audio>
        <input id="duType" value="douqilai" type="hidden">
        
      </div>
    
  </div>
</div>
<div id="open_live2d">å¬å”¤çœ‹æ¿å¨˜</div>
<script src="https://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script>
  var message_Path = 'https://cdn.jsdelivr.net/gh/hsxyhao/live2d.github.io@master/';
  let landlord = document.querySelector('#landlord');
  var apiKey = landlord.dataset.key;
</script>
<script type="text/javascript" src="/media/live2d/js/live2d.js"></script>
<script>
	var home_Path = document.location.protocol + '//' + window.document.location.hostname + ":" + window.document.location.port + '/';
	var userAgent = window.navigator.userAgent.toLowerCase();
	var norunAI = ["android", "iphone", "ipod", "ipad", "windows phone", "mqqbrowser", "msie", "trident/7.0"];
	var norunFlag = false;

	for (var i = 0; i < norunAI.length; i++) {
		if (userAgent.indexOf(norunAI[i]) > -1) {
			norunFlag = true;
			break;
		}
	}

	if (!window.WebGLRenderingContext) {
		norunFlag = true;
	}

	if (!norunFlag) {
		var hitFlag = false;
		var AIFadeFlag = false;
		var liveTlakTimer = null;
		var sleepTimer_ = null;
		var AITalkFlag = false;
		var talkNum = 0;
		(function () {
			function renderTip(template, context) {
				var tokenReg = /(\\)?\{([^\{\}\\]+)(\\)?\}/g;
				return template.replace(tokenReg, function (word, slash1, token, slash2) {
					if (slash1 || slash2) {
						return word.replace('\\', '');
					}
					var variables = token.replace(/\s/g, '').split('.');
					var currentObject = context;
					var i, length, variable;
					for (i = 0, length = variables.length; i < length; ++i) {
						variable = variables[i];
						currentObject = currentObject[variable];
						if (currentObject === undefined || currentObject === null) return '';
					}
					return currentObject;
				});
			}

			String.prototype.renderTip = function (context) {
				return renderTip(this, context);
			};

			var re = /x/;
			re.toString = function () {
				showMessage('å“ˆå“ˆï¼Œä½ æ‰“å¼€äº†æ§åˆ¶å°ï¼Œæ˜¯æƒ³è¦çœ‹çœ‹æˆ‘çš„ç§˜å¯†å—ï¼Ÿ', 5000);
				return '';
			};

			$(document).on('copy', function () {
				showMessage('ä½ éƒ½å¤åˆ¶äº†äº›ä»€ä¹ˆå‘€ï¼Œè½¬è½½è¦è®°å¾—åŠ ä¸Šå‡ºå¤„å“¦~~', 5000);
			});

			function initTips() {
				$.ajax({
					cache: true,
					url: message_Path + 'message.json',
					dataType: "json",
					success: function (result) {
						$.each(result.mouseover, function (index, tips) {
							$(tips.selector).mouseover(function () {
								var text = tips.text;
								if (Array.isArray(tips.text)) text = tips.text[Math.floor(Math.random() * tips.text.length + 1) - 1];
								text = text.renderTip({ text: $(this).text() });
								showMessage(text, 3000);
								talkValTimer();
								clearInterval(liveTlakTimer);
								liveTlakTimer = null;
							});
							$(tips.selector).mouseout(function () {
								showHitokoto();
								if (liveTlakTimer == null) {
									liveTlakTimer = window.setInterval(function () {
										showHitokoto();
									}, 15000);
								};
							});
						});
						$.each(result.click, function (index, tips) {
							$(tips.selector).click(function () {
								if (hitFlag) {
									return false
								}
								hitFlag = true;
								setTimeout(function () {
									hitFlag = false;
								}, 8000);
								var text = tips.text;
								if (Array.isArray(tips.text)) text = tips.text[Math.floor(Math.random() * tips.text.length + 1) - 1];
								text = text.renderTip({ text: $(this).text() });
								showMessage(text, 3000);
							});
							clearInterval(liveTlakTimer);
							liveTlakTimer = null;
							if (liveTlakTimer == null) {
								liveTlakTimer = window.setInterval(function () {
									showHitokoto();
								}, 15000);
							};
						});
					}
				});
			}
			initTips();

			var text;
			if (document.referrer !== '') {
				var referrer = document.createElement('a');
				referrer.href = document.referrer;
				text = 'å—¨ï¼æ¥è‡ª <span style="color:#0099cc;">' + referrer.hostname + '</span> çš„æœ‹å‹ï¼';
				var domain = referrer.hostname.split('.')[1];
				if (domain == 'baidu') {
					text = 'å—¨ï¼ æ¥è‡ª ç™¾åº¦æœç´¢ çš„æœ‹å‹ï¼<br>æ¬¢è¿è®¿é—®<span style="color:#0099cc;">ã€Œ ' + document.title.split(' - ')[0] + ' ã€</span>';
				} else if (domain == 'so') {
					text = 'å—¨ï¼ æ¥è‡ª 360æœç´¢ çš„æœ‹å‹ï¼<br>æ¬¢è¿è®¿é—®<span style="color:#0099cc;">ã€Œ ' + document.title.split(' - ')[0] + ' ã€</span>';
				} else if (domain == 'google') {
					text = 'å—¨ï¼ æ¥è‡ª è°·æ­Œæœç´¢ çš„æœ‹å‹ï¼<br>æ¬¢è¿è®¿é—®<span style="color:#0099cc;">ã€Œ ' + document.title.split(' - ')[0] + ' ã€</span>';
				}
			} else {
				if (window.location.href == home_Path) { //ä¸»é¡µURLåˆ¤æ–­ï¼Œéœ€è¦æ–œæ ç»“å°¾
					var now = (new Date()).getHours();
					if (now > 23 || now <= 5) {
						text = 'ä½ æ˜¯å¤œçŒ«å­å‘€ï¼Ÿè¿™ä¹ˆæ™šè¿˜ä¸ç¡è§‰ï¼Œæ˜å¤©èµ·çš„æ¥å˜›ï¼Ÿ';
					} else if (now > 5 && now <= 7) {
						text = 'æ—©ä¸Šå¥½ï¼ä¸€æ—¥ä¹‹è®¡åœ¨äºæ™¨ï¼Œç¾å¥½çš„ä¸€å¤©å°±è¦å¼€å§‹äº†ï¼';
					} else if (now > 7 && now <= 11) {
						text = 'ä¸Šåˆå¥½ï¼å·¥ä½œé¡ºåˆ©å˜›ï¼Œä¸è¦ä¹…åï¼Œå¤šèµ·æ¥èµ°åŠ¨èµ°åŠ¨å“¦ï¼';
					} else if (now > 11 && now <= 14) {
						text = 'ä¸­åˆäº†ï¼Œå·¥ä½œäº†ä¸€ä¸ªä¸Šåˆï¼Œç°åœ¨æ˜¯åˆé¤æ—¶é—´ï¼';
					} else if (now > 14 && now <= 17) {
						text = 'åˆåå¾ˆå®¹æ˜“çŠ¯å›°å‘¢ï¼Œä»Šå¤©çš„è¿åŠ¨ç›®æ ‡å®Œæˆäº†å—ï¼Ÿ';
					} else if (now > 17 && now <= 19) {
						text = 'å‚æ™šäº†ï¼çª—å¤–å¤•é˜³çš„æ™¯è‰²å¾ˆç¾ä¸½å‘¢ï¼Œæœ€ç¾ä¸è¿‡å¤•é˜³çº¢~~';
					} else if (now > 19 && now <= 21) {
						text = 'æ™šä¸Šå¥½ï¼Œä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ';
					} else if (now > 21 && now <= 23) {
						text = 'å·²ç»è¿™ä¹ˆæ™šäº†å‘€ï¼Œæ—©ç‚¹ä¼‘æ¯å§ï¼Œæ™šå®‰~~';
					} else {
						text = 'å—¨~ å¿«æ¥é€—æˆ‘ç©å§ï¼';
					}
				} else {
					text = 'æ¬¢è¿é˜…è¯»<span style="color:#0099cc;">ã€Œ ' + document.title.split(' - ')[0] + ' ã€</span>';
				}
			}
			showMessage(text, 12000);
		})();

		liveTlakTimer = setInterval(function () {
			showHitokoto();
		}, 15000);

		function showHitokoto() {
			if (sessionStorage.getItem("Sleepy") !== "1") {
				if (!AITalkFlag) {
					$.getJSON('https://v1.hitokoto.cn/', function (result) {
						talkValTimer();
						showMessage(result.hitokoto, 0);
					});
				}
			} else {
				hideMessage(0);
				if (sleepTimer_ == null) {
					sleepTimer_ = setInterval(function () {
						checkSleep();
					}, 200);
				}
			}
		}

		function checkSleep() {
			var sleepStatu = sessionStorage.getItem("Sleepy");
			if (sleepStatu !== '1') {
				talkValTimer();
				showMessage('ä½ å›æ¥å•¦~', 0);
				clearInterval(sleepTimer_);
				sleepTimer_ = null;
			}
		}

		function showMessage(text, timeout) {
			if (Array.isArray(text)) text = text[Math.floor(Math.random() * text.length + 1) - 1];
			$('.message').stop();
			$('.message').html(text);
			$('.message').fadeTo(200, 1);
			//if (timeout === null) timeout = 5000;
			//hideMessage(timeout);
		}
		function talkValTimer() {
			$('#live_talk').val('1');
		}

		function hideMessage(timeout) {
			//$('.message').stop().css('opacity',1);
			if (timeout === null) timeout = 5000;
			$('.message').delay(timeout).fadeTo(200, 0);
		}

		function initLive2d() {
			$('#hideButton').on('click', function () {
				if (AIFadeFlag) {
					return false;
				} else {
					AIFadeFlag = true;
					localStorage.setItem("live2dhidden", "0");
					$('#landlord').fadeOut(200);
					$('#open_live2d').delay(200).fadeIn(200);
					setTimeout(function () {
						AIFadeFlag = false;
					}, 300);
				}
			});
			$('#open_live2d').on('click', function () {
				if (AIFadeFlag) {
					return false;
				} else {
					AIFadeFlag = true;
					localStorage.setItem("live2dhidden", "1");
					$('#open_live2d').fadeOut(200);
					$('#landlord').delay(200).fadeIn(200);
					setTimeout(function () {
						AIFadeFlag = false;
					}, 300);
				}
			});
			$('#youduButton').on('click', function () {
				if ($('#youduButton').hasClass('doudong')) {
					var typeIs = $('#youduButton').attr('data-type');
					$('#youduButton').removeClass('doudong');
					$('body').removeClass(typeIs);
					$('#youduButton').attr('data-type', '');
				} else {
					var duType = $('#duType').val();
					var duArr = duType.split(",");
					var dataType = duArr[Math.floor(Math.random() * duArr.length)];

					$('#youduButton').addClass('doudong');
					$('#youduButton').attr('data-type', dataType);
					$('body').addClass(dataType);
				}
			});
			if (apiKey) {
				$('#showInfoBtn').on('click', function () {
					var live_statu = $('#live_statu_val').val();
					if (live_statu == "0") {
						return
					} else {
						$('#live_statu_val').val("0");
						$('.live_talk_input_body').fadeOut(500);
						AITalkFlag = false;
						showHitokoto();
						$('#showTalkBtn').show();
						$('#showInfoBtn').hide();
					}
				});
				$('#showTalkBtn').on('click', function () {
					var live_statu = $('#live_statu_val').val();
					if (live_statu == "1") {
						return
					} else {
						$('#live_statu_val').val("1");
						$('.live_talk_input_body').fadeIn(500);
						AITalkFlag = true;
						$('#showTalkBtn').hide();
						$('#showInfoBtn').show();

					}
				});
				$('#talk_send').on('click', function () {
					var info_ = $('#AIuserText').val();
					var userid_ = $('#AIuserName').val();
					if (info_ == "") {
						showMessage('å†™ç‚¹ä»€ä¹ˆå§ï¼', 0);
						return;
					}
					if (userid_ == "") {
						showMessage('èŠä¹‹å‰è¯·å‘Šè¯‰æˆ‘ä½ çš„åå­—å§ï¼', 0);
						return;
					}
					showMessage('æ€è€ƒä¸­~', 0);
					let protocol = window.location.protocol.indexOf("s") > 0 ? "https" : "http";
					$.ajax({
						type: "get",
						url: `${protocol}://www.tuling123.com/openapi/api?key=${apiKey}&info=${info_}`,
						dataType: "json",
						success: function (res) {
							talkValTimer();
							showMessage(res.text, 0);
							$('#AIuserText').val("");
							sessionStorage.setItem("live2duser", userid_);
						},
						error: function (e) {
							talkValTimer();
							showMessage('ä¼¼ä¹æœ‰ä»€ä¹ˆé”™è¯¯ï¼Œè¯·å’Œç«™é•¿è”ç³»ï¼', 0);
						}
					});
				});
			} else {
				$('#showInfoBtn').hide();
				$('#showTalkBtn').hide();
			}
			//è·å–éŸ³ä¹ä¿¡æ¯åˆå§‹åŒ–
			var bgmListInfo = $('input[name=live2dBGM]');
			if (bgmListInfo.length == 0) {
				$('#musicButton').hide();
			} else {
				var bgmPlayNow = parseInt($('#live2d_bgm').attr('data-bgm'));
				var bgmPlayTime = 0;
				var live2dBGM_Num = sessionStorage.getItem("live2dBGM_Num");
				var live2dBGM_PlayTime = sessionStorage.getItem("live2dBGM_PlayTime");
				if (live2dBGM_Num) {
					if (live2dBGM_Num <= $('input[name=live2dBGM]').length - 1) {
						bgmPlayNow = parseInt(live2dBGM_Num);
					}
				}
				if (live2dBGM_PlayTime) {
					bgmPlayTime = parseInt(live2dBGM_PlayTime);
				}
				var live2dBGMSrc = bgmListInfo.eq(bgmPlayNow).val();
				$('#live2d_bgm').attr('data-bgm', bgmPlayNow);
				$('#live2d_bgm').attr('src', live2dBGMSrc);
				$('#live2d_bgm')[0].currentTime = bgmPlayTime;
				$('#live2d_bgm')[0].volume = 0.5;
				var live2dBGM_IsPlay = sessionStorage.getItem("live2dBGM_IsPlay");
				var live2dBGM_WindowClose = sessionStorage.getItem("live2dBGM_WindowClose");
				if (live2dBGM_IsPlay == '0' && live2dBGM_WindowClose == '0') {
					$('#live2d_bgm')[0].play();
					$('#musicButton').addClass('play');
				}
				sessionStorage.setItem("live2dBGM_WindowClose", '1');
				$('#musicButton').on('click', function () {
					if ($('#musicButton').hasClass('play')) {
						$('#live2d_bgm')[0].pause();
						$('#musicButton').removeClass('play');
						sessionStorage.setItem("live2dBGM_IsPlay", '1');
					} else {
						$('#live2d_bgm')[0].play();
						$('#musicButton').addClass('play');
						sessionStorage.setItem("live2dBGM_IsPlay", '0');
					}
				});
				window.onbeforeunload = function () {
					sessionStorage.setItem("live2dBGM_WindowClose", '0');
					if ($('#musicButton').hasClass('play')) {
						sessionStorage.setItem("live2dBGM_IsPlay", '0');
					}
				}
				document.getElementById('live2d_bgm').addEventListener("timeupdate", function () {
					var live2dBgmPlayTimeNow = document.getElementById('live2d_bgm').currentTime;
					sessionStorage.setItem("live2dBGM_PlayTime", live2dBgmPlayTimeNow);
				});
				document.getElementById('live2d_bgm').addEventListener("ended", function () {
					var listNow = parseInt($('#live2d_bgm').attr('data-bgm'));
					listNow++;
					if (listNow > $('input[name=live2dBGM]').length - 1) {
						listNow = 0;
					}
					var listNewSrc = $('input[name=live2dBGM]').eq(listNow).val();
					sessionStorage.setItem("live2dBGM_Num", listNow);
					$('#live2d_bgm').attr('src', listNewSrc);
					$('#live2d_bgm')[0].play();
					$('#live2d_bgm').attr('data-bgm', listNow);
				});
				document.getElementById('live2d_bgm').addEventListener("error", function () {
					$('#live2d_bgm')[0].pause();
					$('#musicButton').removeClass('play');
					showMessage('éŸ³ä¹ä¼¼ä¹åŠ è½½ä¸å‡ºæ¥äº†å‘¢ï¼', 0);
				});
			}
			//è·å–ç”¨æˆ·å
			var live2dUser = sessionStorage.getItem("live2duser");
			if (live2dUser !== null) {
				$('#AIuserName').val(live2dUser);
			}
			//è·å–ä½ç½®
			var landL = sessionStorage.getItem("historywidth");
			var landB = sessionStorage.getItem("historyheight");
			if (landL == null || landB == null) {
				landL = '5px'
				landB = '0px'
			}
			$('#landlord').css('left', landL + 'px');
			$('#landlord').css('bottom', landB + 'px');
			//ç§»åŠ¨
			function getEvent() {
				return window.event || arguments.callee.caller.arguments[0];
			}
			var smcc = document.getElementById("landlord");
			var moveX = 0;
			var moveY = 0;
			var moveBottom = 0;
			var moveLeft = 0;
			var moveable = false;
			var docMouseMoveEvent = document.onmousemove;
			var docMouseUpEvent = document.onmouseup;
			smcc.onmousedown = function () {
				var ent = getEvent();
				moveable = true;
				moveX = ent.clientX;
				moveY = ent.clientY;
				var obj = smcc;
				moveBottom = parseInt(obj.style.bottom);
				moveLeft = parseInt(obj.style.left);
				if (isFirefox = navigator.userAgent.indexOf("Firefox") > 0) {
					window.getSelection().removeAllRanges();
				}
				document.onmousemove = function () {
					if (moveable) {
						var ent = getEvent();
						var x = moveLeft + ent.clientX - moveX;
						var y = moveBottom + (moveY - ent.clientY);
						obj.style.left = x + "px";
						obj.style.bottom = y + "px";
					}
				};
				document.onmouseup = function () {
					if (moveable) {
						var historywidth = obj.style.left;
						var historyheight = obj.style.bottom;
						historywidth = historywidth.replace('px', '');
						historyheight = historyheight.replace('px', '');
						sessionStorage.setItem("historywidth", historywidth);
						sessionStorage.setItem("historyheight", historyheight);
						document.onmousemove = docMouseMoveEvent;
						document.onmouseup = docMouseUpEvent;
						moveable = false;
						moveX = 0;
						moveY = 0;
						moveBottom = 0;
						moveLeft = 0;
					}
				};
			};
		}
		$(document).ready(function () {
			var AIimgSrc = [];
			let chooseLive2d = 'rem'
			if (chooseLive2d === 'histoire') {
				AIimgSrc.push(message_Path + "model/histoire/histoire.1024/texture_00.png");
				AIimgSrc.push(message_Path + "model/histoire/histoire.1024/texture_01.png");
				AIimgSrc.push(message_Path + "model/histoire/histoire.1024/texture_02.png");
				AIimgSrc.push(message_Path + "model/histoire/histoire.1024/texture_03.png");
			} else if (chooseLive2d === 'rem') {
				AIimgSrc.push(message_Path + "model/rem/remu2048/texture_00.png");
			} else if (chooseLive2d === 'Aoba') {
				AIimgSrc.push(message_Path + "model/Aoba/textures/texture_00.png");
			} else if (chooseLive2d === 'hijiki') {
				AIimgSrc.push(message_Path + "model/hijiki/moc/hijiki.2048/texture_00.png");
			} else if (chooseLive2d === 'tororo') {
				AIimgSrc.push(message_Path + "model/tororo/moc/tororo.2048/texture_00.png");
			}
			var images = [];
			var imgLength = AIimgSrc.length;
			var loadingNum = 0;
			for (var i = 0; i < imgLength; i++) {
				images[i] = new Image();
				images[i].src = AIimgSrc[i];
				images[i].onload = function () {
					loadingNum++;
					if (loadingNum === imgLength) {
						var live2dhidden = localStorage.getItem("live2dhidden");
						if (live2dhidden === "0") {
							setTimeout(function () {
								$('#open_live2d').fadeIn(200);
							}, 1300);
						} else {
							setTimeout(function () {
								$('#landlord').fadeIn(200);
							}, 1300);
						}
						let model = '';
						if (chooseLive2d === 'histoire') {
							model = message_Path + "model/histoire/model.json";
						} else if (chooseLive2d === 'rem') {
							model = message_Path + "model/rem/model.json";
						} else if (chooseLive2d === 'Aoba') {
							model = message_Path + "model/Aoba/model.json";
						} else if (chooseLive2d === 'hijiki') {
							model = message_Path + "model/hijiki/hijiki.model.json";
						} else if (chooseLive2d === 'tororo') {
							model = message_Path + "model/tororo/tororo.model.json";
						}
						setTimeout(function () {
							loadlive2d("live2d", model);
						}, 1000);
						initLive2d();
						images = null;
					}
				}
			}
		});
	}
</script>
  
  
</div>
<script>

  let sideBarOpen = 'sidebar-open';
  let body = document.body;
  let back2Top = document.querySelector('#back_to_top'),
  back2TopText = document.querySelector('#back_to_top_text'),
  drawerBox = document.querySelector('#drawer_box'),
  rightSideBar = document.querySelector('.sidebar'),
  viewport = document.querySelector('body');

  function scrollAnimation(currentY, targetY) {
   
    let needScrollTop = targetY - currentY
    let _currentY = currentY
    setTimeout(() => {
      const dist = Math.ceil(needScrollTop / 10)
      _currentY += dist
      window.scrollTo(_currentY, currentY)
      if (needScrollTop > 10 || needScrollTop < -10) {
        scrollAnimation(_currentY, targetY)
      } else {
        window.scrollTo(_currentY, targetY)
      }
    }, 1)
  }

  back2Top.addEventListener("click", function(e) {
    scrollAnimation(document.scrollingElement.scrollTop, 0);
    e.stopPropagation();
    return false;
  });
  
  window.addEventListener('scroll', function(e) {
    let percent = document.scrollingElement.scrollTop / (document.scrollingElement.scrollHeight - document.scrollingElement.clientHeight) * 100;
    if (percent > 1 && !back2Top.classList.contains('back-top-active')) {
      back2Top.classList.add('back-top-active');
    }
    if (percent == 0) {
      back2Top.classList.remove('back-top-active');
    }
    if (back2TopText) {
      back2TopText.textContent = Math.floor(percent);
    }
  });

  
  let hasCacu = false;
  window.onresize = function() {
    if (window.width > 991) {
      calcuHeight();
    } else {
      hasCacu = false;
    }
  }

  function calcuHeight() {
    // åŠ¨æ€è°ƒæ•´ç«™ç‚¹æ¦‚è§ˆé«˜åº¦
    if (!hasCacu && back2Top.classList.contains('pisces') || back2Top.classList.contains('gemini')) {
      let sideBar = document.querySelector('.sidebar');
      let navUl = document.querySelector('#site_nav');
      sideBar.style = 'margin-top:' + (navUl.offsetHeight + navUl.offsetTop + 15) + 'px;';
      hasCacu = true;
    }
  }
  calcuHeight();
  
  let open = false, MOTION_TIME = 300, RIGHT_MOVE_DIS = '320px';

  if (drawerBox) {
    let rightMotions = document.querySelectorAll('.right-motion');
    let right = drawerBox.classList.contains('right');

    let transitionDir = right ? "transition.slideRightIn" : "transition.slideLeftIn";

    let openProp, closeProp;
    if (right) {
      openProp = {
        paddingRight: RIGHT_MOVE_DIS 
      };
      closeProp = {
        paddingRight: '0px'
      };
    } else {
      openProp = {
        paddingLeft: RIGHT_MOVE_DIS 
      };
      closeProp = {
        paddingLeft: '0px'
      };
    }

    drawerBox.onclick = function() {
      open = !open;
      window.Velocity(rightSideBar, 'stop');
      window.Velocity(viewport, 'stop');
      window.Velocity(rightMotions, 'stop');
      if (open) {
        window.Velocity(rightSideBar, {
          width: RIGHT_MOVE_DIS
        }, {
          duration: MOTION_TIME,
          begin: function() {
            window.Velocity(rightMotions, transitionDir,{ });
          }
        })
        window.Velocity(viewport, openProp,{
          duration: MOTION_TIME
        });
      } else {
        window.Velocity(rightSideBar, {
          width: '0px'
        }, {
          duration: MOTION_TIME,
          begin: function() {
            window.Velocity(rightMotions, {
              opacity: 0
            });
          }
        })
        window.Velocity(viewport, closeProp ,{
          duration: MOTION_TIME
        });
      }
      for (let i = 0; i < drawerBox.children.length; i++) {
        drawerBox.children[i].classList.toggle('muse-line');
      }
      drawerBox.classList.toggle(sideBarOpen);
    }
  }

  // é“¾æ¥è·³è½¬
  let newWindow = 'true'
  if (newWindow === 'true') {
    let links = document.querySelectorAll('.post-body a')
    links.forEach(item => {
      if (!item.classList.contains('btn')) {
        item.setAttribute("target","_blank");
      }
    })
  }
  // ä»£ç é«˜äº®
  hljs.initHighlightingOnLoad();

</script>
    <div class="light-box" id="light_box"></div>
<script>
  let imgs = document.querySelectorAll('.post-body img');
  let lightBox = document.querySelector('#light_box');
  lightBox.addEventListener('mousedown', (e) => {
    e.preventDefault()
  })
  lightBox.addEventListener('mousewheel', (e) => {
    e.preventDefault()
  })
  let width = window.innerWidth * 0.8;
  lightBox.onclick = () => {
    let img = lightBox.querySelector('img');
    lightBox.style = '';
    img && img.remove();
  }
  imgs.forEach(item => {
    item.onclick = function (e) {
      let lightImg = document.createElement('img');
      lightImg.src = this.src;
      lightBox.style = `height: 100%; opacity: 1; background-color: rgba(0, 0, 0, 0.5);cursor: zoom-out;`;
      lightImg.style = `width: ${width}px; border: 1px solid #fff; border-radius: 2px;`;
      lightImg.onclick = function () {
        lightBox.style = '';
        this.remove();
      }
      lightBox.append(lightImg);
    }
  })
</script>
  </div>
</body>
<input hidden id="copy" />
<script>
  //æ‹¿æ¥ä¸»ä¹‰(çœŸé¦™)^_^ï¼ŒClipboard å®ç°æ‘˜è‡ªæ˜é‡‘ https://juejin.im/post/5aefeb6e6fb9a07aa43c20af
  window.Clipboard = (function (window, document, navigator) {
    var textArea,
      copy;

    // åˆ¤æ–­æ˜¯ä¸æ˜¯iosç«¯
    function isOS() {
      return navigator.userAgent.match(/ipad|iphone/i);
    }
    //åˆ›å»ºæ–‡æœ¬å…ƒç´ 
    function createTextArea(text) {
      textArea = document.createElement('textArea');
      textArea.value = text;
      textArea.style.width = 0;
      textArea.style.height = 0;
      textArea.clientHeight = 0;
      textArea.clientWidth = 0;
      document.body.appendChild(textArea);
    }
    //é€‰æ‹©å†…å®¹
    function selectText() {
      var range,
        selection;

      if (isOS()) {
        range = document.createRange();
        range.selectNodeContents(textArea);
        selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        textArea.setSelectionRange(0, 999999);
      } else {
        textArea.select();
      }
    }

    //å¤åˆ¶åˆ°å‰ªè´´æ¿
    function copyToClipboard() {
      try {
        document.execCommand("Copy")
      } catch (err) {
        alert("å¤åˆ¶é”™è¯¯ï¼è¯·æ‰‹åŠ¨å¤åˆ¶ï¼")
      }
      document.body.removeChild(textArea);
    }

    copy = function (text) {
      createTextArea(text);
      selectText();
      copyToClipboard();
    };

    return {
      copy: copy
    };
  })(window, document, navigator);

  function copyCode(e) {
    if (e.srcElement.tagName === 'SPAN' && e.srcElement.classList.contains('copy-code')) {
      let code = e.currentTarget.querySelector('code');
      var text = code.innerText;
      if (e.srcElement.textContent === 'å¤åˆ¶æˆåŠŸ') {
        console.log('å¤åˆ¶æ“ä½œé¢‘ç‡è¿‡é«˜');
        return;
      }
      e.srcElement.textContent = 'å¤åˆ¶æˆåŠŸ';
      (function (elem) {
        setTimeout(() => {
          if (elem.textContent === 'å¤åˆ¶æˆåŠŸ') {
            elem.textContent = 'å¤åˆ¶ä»£ç '
          }
        }, 1000);
      })(e.srcElement)
      Clipboard.copy(text);
    }
  }

  let pres = document.querySelectorAll('pre');
  pres.forEach(pre => {
    let code = pre.querySelector('code');
    let copyElem = document.createElement('span');
    copyElem.classList.add('copy-code');
    copyElem.textContent = 'å¤åˆ¶ä»£ç ';
    pre.appendChild(copyElem);
    pre.onclick = copyCode
  })
</script>
<script src="/media/js/motion.js"></script>

<script src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
<script>
  var scroll = new SmoothScroll('a[href*="#"]', {
    speed: 500
  });
</script>

<!-- <div class="search-mask" id="search_mask">
  <div class="search-box">
    <div class="search-title">
      <i class="fa fa-search"></i>
      <div class="input-box">
        <input type="text" placeholder="æœç´¢">
      </div>
      <i class="fa fa-times-circle"></i>
    </div>
    <div class="result">
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/wo-li-jie-de-cap/"" data-c="
          &lt;p&gt;æœ€è¿‘åœ¨æ¢³ç†æˆ‘ä»¬ç³»ç»Ÿæ¶æ„çš„æ—¶å€™ï¼Œæƒ³ä»åˆ†å¸ƒå¼é¢†åŸŸçš„è§’åº¦æ¥åˆ†ææ¶æ„è®¾è®¡ï¼Œä½†æ˜¯ç”±äºä¹‹å‰æ²¡ç³»ç»Ÿæ€§æ¥è§¦è¿‡åˆ†å¸ƒå¼ç›¸å…³çš„çŸ¥è¯†ï¼Œæ­£å¥½å€Ÿæ­¤æœºä¼šæ¥å­¦ä¹ åˆ†å¸ƒå¼ç›¸å…³çš„çŸ¥è¯†ï¼Œå¹¶è¿›è¡Œè‡ªå·±çš„æ€»ç»“ã€‚æœ¬æ–‡çš„ç›®çš„æ˜¯ææ¸…æ¥šä»€ä¹ˆæ˜¯CAPã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åˆ†å¸ƒå¼ç³»ç»Ÿçš„æœ€å¤§éš¾ç‚¹ï¼Œå°±æ˜¯å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€å¦‚ä½•åŒæ­¥&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;å†å²èƒŒæ™¯&#34;&gt;å†å²èƒŒæ™¯&lt;/h1&gt;
&lt;p&gt;æ—¶é—´å›åˆ° 1985 å¹´ï¼Œå½¼æ—¶ï¼Œåæ¥è¯æ˜äº† CAP ç†è®ºçš„ Lynch æ•™æˆæ­¤æ—¶ç»™å½“æ—¶çš„ IT ç•Œæ¥äº†ä¸€è®°æƒŠé›·ï¼šå¥¹é€šè¿‡ä¸å¯è¾©é©³çš„è¯æ˜å‘Šè¯‰ä¸šç•Œçš„å·¥ç¨‹å¸ˆä»¬ï¼Œå¦‚æœåœ¨ä¸€ä¸ªä¸ç¨³å®šï¼ˆæ¶ˆæ¯è¦ä¹ˆä¹±åºè¦ä¹ˆä¸¢äº†ï¼‰çš„ç½‘ç»œç¯å¢ƒé‡Œï¼ˆåˆ†å¸ƒå¼å¼‚æ­¥æ¨¡å‹ï¼‰ï¼Œæƒ³å§‹ç»ˆä¿æŒæ•°æ®ä¸€è‡´æ˜¯ä¸å¯èƒ½çš„ã€‚è¿™æ˜¯ä¸ªä»€ä¹ˆæ¦‚å¿µå‘¢ï¼Ÿå°±æ˜¯å¥¹æ‰“ç ´äº†é‚£äº›æ—¢æƒ³æä¾›è¶…é«˜è´¨é‡æœåŠ¡ï¼Œåˆæƒ³æä¾›è¶…é«˜æ€§èƒ½æœåŠ¡çš„æŠ€æœ¯äººå‘˜çš„å¹»æƒ³ã€‚è¿™æœ¬è´¨æ˜¯åœ¨å‘Šè¯‰å¤§å®¶ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œï¼Œéœ€è¦å¦¥åã€‚&lt;br&gt;
è¿‡äº†15å¹´ï¼Œåœ¨2000 å¹´æ—¶ï¼ŒEric Brewer æ•™æˆåœ¨ PODC ä¼šè®®ä¸Šæå‡ºäº† CAP ç†è®ºï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰è¢«è¯æ˜è¿‡ï¼Œæ‰€ä»¥ï¼Œå½“æ—¶åªèƒ½è¢«ç§°ä¸º CAP çŒœæƒ³ã€‚è¿™ä¸ªçŒœæƒ³å¼•èµ·äº†å·¨å¤§çš„åå“ï¼Œå› ä¸º CAP å¾ˆç¬¦åˆäººä»¬å¯¹è®¾è®¡çº²é¢†çš„é¢„æœŸã€‚åœ¨ 2002 å¹´åï¼Œç»è¿‡ Seth Gilbert å’Œ Nancy Lynch ä»ç†è®ºä¸Šè¯æ˜äº† CAP çŒœæƒ³åï¼ŒCAP ç†è®ºæ­£å¼æˆä¸ºäº†åˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºçš„åŸºçŸ³ä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ¦‚å¿µè§£é‡Š&#34;&gt;æ¦‚å¿µè§£é‡Š&lt;/h1&gt;
&lt;p&gt;è¦å‡†ç¡®çš„ç†è§£CAPï¼Œé¦–å…ˆå¿…é¡»æ˜ç™½CAPä¸­3ä¸ªæ¦‚å¿µçš„å‡†ç¡®å®šä¹‰ï¼Œ3ä¸ªæ¦‚å¿µåˆ†åˆ«å¯¹åº”CAPçš„3ä¸ªç¼©å†™ Consistencyã€Availabilityã€Partition Toleranceã€‚&lt;br&gt;
&lt;img src=&#34;https://tva1.sinaimg.cn/large/e6c9d24egy1h0iegjbmz8j20u00u0gno.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;consistency-ä¸€è‡´æ€§&#34;&gt;Consistency ä¸€è‡´æ€§&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;all nodes see the same data at the same time&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨æœåŠ¡èŠ‚ç‚¹è¿›è¡Œæ›´æ–°æ“ä½œåï¼Œæ‰€æœ‰èŠ‚ç‚¹åŒä¸€æ—¶é—´çš„æ•°æ®å®Œå…¨ä¸€è‡´ï¼Œä¹Ÿç§°æ•°æ®ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/e6c9d24egy1h0iegrn0bdj20lu0i00tb.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨DB1æ›´æ–°å®Œæˆåï¼Œæ­¥éª¤3çš„æŸ¥è¯¢ç»“æœä¸€å®šæ˜¯æœ€æ–°çš„æ•°æ®ï¼Œé‚£ä¹ˆæ­¥éª¤4çš„æŸ¥è¯¢ç»“æœå¿…é¡»è¦å’Œ3ä¸€æ ·ï¼Œä¸ç„¶å°±æ˜¯æ•°æ®ä¸ä¸€è‡´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;availability-å¯é æ€§&#34;&gt;Availability å¯é æ€§&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Reads and writes always succeed&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨é¢„æœŸçš„å“åº”æ—¶é—´å†…ï¼Œå¿…é¡»è¿”å›ç»“æœï¼ˆéå¼‚å¸¸çš„ï¼‰ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªæ¦‚å¿µï¼Œä¸€ä¸ªæ˜¯é¢„æœŸå“åº”æ—¶é—´ï¼Œä¸€ä¸ªæ˜¯éå¼‚å¸¸çš„ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;é¢„æœŸå“åº”æ—¶é—´åº”è¯¥æ˜¯æ—©åœ¨ç³»ç»Ÿè®¾è®¡æ—¶å°±å®šä¹‰å¥½çš„ï¼Œè¦ç»“åˆä¸šåŠ¡åœºæ™¯çš„è€ƒè™‘ï¼Œä¾‹å¦‚æˆ‘ä»¬googleæœç´¢è¦åœ¨0.5så†…è¿”å›æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œé‚£ä¹ˆ0.5å°±æ˜¯å®šä¹‰å¥½çš„ç»“æœï¼Œ&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªæ–‡ä»¶è½¬æ¢çš„æœåŠ¡ï¼Œé¢„æœŸå“åº”æ—¶é—´å¯èƒ½ä¼šæ˜¯æ•°åç§’ç”šè‡³ä»¥åˆ†é’Ÿè®¡ç®—ã€‚åªè¦èƒ½åœ¨é¢„æœŸå“åº”æ—¶é—´å†…è¿”å›ï¼Œéƒ½å¯ä»¥ç®—ä½œæœªè¶…æ—¶çš„ã€‚&lt;/p&gt;
&lt;p&gt;éå¼‚å¸¸çš„ç»“æœæ˜¯æŒ‡èƒ½è¢«å®¢æˆ·ç«¯æ¥æ”¶å¹¶è¿›è¡Œæ­£å¸¸åç»­å¤„ç†çš„ï¼Œ12306æŠ¢ç¥¨æ—¶åˆ·æ–°åçœ‹åˆ°æœ‰ç¥¨ï¼Œç‚¹å‡»è´­ä¹°åˆå‘ŠçŸ¥æ²¡ç¥¨äº†ï¼Œåˆ·æ–°åçœ‹åˆ°çš„æ˜¯æ—§æ•°æ®ï¼Œä½†æ•´ä¸ªæµç¨‹æ˜¯æ²¡æœ‰å‘ç”Ÿå¼‚å¸¸ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å¯é æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;partition-tolerance-åˆ†åŒºå®¹é”™æ€§&#34;&gt;Partition Tolerance åˆ†åŒºå®¹é”™æ€§&lt;/h2&gt;
&lt;p&gt;åˆ†å¸ƒå¼åœºæ™¯ä¸‹èŠ‚ç‚¹é—´éƒ½æ˜¯é€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡çš„ï¼Œç½‘ç»œè‚¯å®šä¸æ˜¯100%å¯é çš„ï¼Œä¹Ÿä¼šæœ‰å¼‚å¸¸çš„æ—¶å€™ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä¸¤ä¸ªèŠ‚ç‚¹é—´å‘ç”Ÿäº†å¼‚å¸¸ä¸èƒ½æ­£å¸¸é€šä¿¡äº†ï¼Œå°±å¯ä»¥è¯´è¿™ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´å‘ç”Ÿ&lt;strong&gt;åˆ†åŒº&lt;/strong&gt;äº†ã€‚&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/e6c9d24egy1h0iehceicrj20zq0muta5.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;é‚£ä¹ˆå¯¹äºAæœåŠ¡è€Œè¨€ï¼Œå‡è®¾Bå‘ç”Ÿå¼‚å¸¸äº†ï¼ŒAæ˜¯å¦è¦å®¹å¿è¿™ç§æƒ…å†µå‘¢ï¼Ÿé€‰æ‹©ä¸å®¹å¿ï¼Œé‚£ä¹ˆå¯¹åº”çš„æªæ–½å°±æ˜¯Aé©¬ä¸Šå¯¹å¤–åœæ­¢æœåŠ¡ã€‚è¿™å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ç»å¯¹æ˜¯ä¸èƒ½æ¥å—çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å®¹å¿ç½‘ç»œåˆ†åŒºçš„å‘ç”Ÿï¼Œå³ä½¿ç›¸å…³æœåŠ¡å‘ç”Ÿäº†å¼‚å¸¸ï¼ŒæœåŠ¡ä¹Ÿä¸èƒ½åœæ­¢è¿è¡Œã€‚&lt;br&gt;
è¿™ä¹ˆçœ‹æ¥CAPä¸­Pæ˜¯å¿…é¡»è¦çš„ï¼ŒåŒæ—¶ä¹ŸçŸ¥é“CAP3è¿™ä¸èƒ½åŒæ—¶æ»¡è¶³ï¼Œç°åœ¨çš„éš¾é¢˜å°±æ˜¯Cå’ŒAä¸­å¦‚ä½•è¿›è¡Œå–èˆ&lt;/p&gt;
&lt;h1 id=&#34;ä¸ºä»€ä¹ˆcå’Œaä¸èƒ½åŒæ—¶å­˜åœ¨&#34;&gt;ä¸ºä»€ä¹ˆCå’ŒAä¸èƒ½åŒæ—¶å­˜åœ¨&lt;/h1&gt;
&lt;p&gt;å‡å¦‚å¿…é¡»è¦æ»¡è¶³ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆæ•°æ®ä¸­å¿ƒåªèƒ½æœ‰ä¸€ä¸ªï¼Œè¿™æ ·æ‰€æœ‰çš„èŠ‚ç‚¹æ‹¿åˆ°çš„æ•°æ®è‚¯å®šéƒ½æ˜¯æœ€æ–°çš„äº†ã€‚&lt;/p&gt;
&lt;p&gt;é‚£å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ•°æ®ä¸­å¿ƒä¸€æ—¦å‘ç”Ÿç½‘ç»œåˆ†åŒºï¼Œå°±å¯¼è‡´æ‰€æœ‰èŠ‚ç‚¹æ— æ³•å¤„ç†è¯·æ±‚ï¼Œè¿™æ ·å¯é æ€§å¿…ç„¶ä¸èƒ½ä¿è¯ã€‚&lt;/p&gt;
&lt;p&gt;å‡å¦‚å¿…é¡»è¦æ»¡è¶³å¯é æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é‡‡ç”¨å¤šæ•°æ®ä¸­å¿ƒçš„æ–¹å¼ï¼Œè¿™æ ·å³ä½¿ä¸ªåˆ«èŠ‚ç‚¹å‘ç”Ÿç½‘ç»œåˆ†åŒºï¼Œä¹Ÿä¸ä¼šå¯¼è‡´æ•´ä¸ªæœåŠ¡ä¸å¯ç”¨ã€‚å¯æ˜¯è¿™å°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæœ€æ–°çš„æ•°æ®æ— æ³•åŒæ­¥ç»™å…¶ä»–åˆ†åŒºçš„èŠ‚ç‚¹ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€ä¸‹çš„å¯èƒ½ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å¦‚ä½•å–èˆcå’Œa&#34;&gt;å¦‚ä½•å–èˆCå’ŒA&lt;/h1&gt;
&lt;p&gt;åœ¨æ²¡æœ‰å‘ç”Ÿç½‘ç»œåˆ†åŒºçš„æ—¶å€™ï¼ŒCAPä¸‰è€…éƒ½æ˜¯æ»¡è¶³çš„ï¼Œåªæœ‰å½“å‘ç”Ÿç½‘ç»œåˆ†åŒºè¿™ç§å°æ¦‚ç‡äº‹ä»¶çš„æ—¶å€™ã€‚&lt;br&gt;
å…ˆçœ‹ä¸€äº›å¼€æºæ¡†æ¶æ˜¯å¦‚ä½•è¿›è¡Œè®¾è®¡çš„&lt;br&gt;
cp - Zookeeperï¼ŒRedisï¼šå½“zookeeperå’Œredisä¼šä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä¿è¯ä»»ä½•æ—¶å€™è·å–åˆ°çš„æ•°æ®éƒ½æ˜¯æœ€æ–°çš„ã€‚&lt;br&gt;
ca - Mysqlï¼ŒRocketMQ:  åœ¨Mysqlå’ŒRocketMQçš„ä¸»ä»æ¶æ„ä¸­ï¼Œå½“ä¸»ä»ä¹‹é—´å‘ç”Ÿç½‘ç»œåˆ†åŒºæ—¶&lt;br&gt;
ï¼Œä»ä»åº“è·å–åˆ°çš„æ•°æ®å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¯´åˆ°åº•ï¼Œè¿˜æ˜¯çœ‹ä¸šåŠ¡åœºæ™¯ã€‚ä¾‹å¦‚æ¶‰åŠåˆ°é’±çš„ç³»ç»Ÿï¼Œé‚£ä¹ˆä¸€è‡´æ€§æ˜¯è‚¯å®šè¦ä¿è¯çš„ï¼Œé“¶è¡Œç³»ç»Ÿå“ªæ€•åœæ­¢æœåŠ¡ä¹Ÿè¦ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚ç”¨è¿‡12306ï¼Œè‚¯å®šé‡åˆ°è¿‡é¡µé¢åˆ·æ–°ååŒä¸€è½¦æ¬¡æœ‰æ—¶å€™æœ‰ç¥¨æœ‰æ—¶å€™æ²¡ç¥¨çš„æƒ…å†µï¼Œè¿™å°±æ˜¯ä¸ºäº†æé«˜å¯ç”¨æ€§ï¼Œä¿è¯åˆ·æ–°æ“ä½œæˆåŠŸï¼Œä½†æ˜¯ä¸€è‡´æ€§å°±æ— æ³•å¾—åˆ°ä¿è¯äº†ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s/6PgqyigrgVICl0JiI73oNg&#34;&gt;https://mp.weixin.qq.com/s/6PgqyigrgVICl0JiI73oNg&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.zhihu.com/question/54105974/answer/1643846752&#34;&gt;https://www.zhihu.com/question/54105974/answer/1643846752&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.hollischuang.com/archives/666&#34;&gt;https://www.hollischuang.com/archives/666&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
">æˆ‘ç†è§£çš„CAP</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/kuai-su-kan-qing-lambda-de-ben-zhi/"" data-c="
          &lt;p&gt;åœ¨JDK8ä¹‹åï¼ŒLambdaè¡¨è¾¾å¼çš„åŠŸèƒ½ä¸ºæ—¥å¸¸å¼€å‘æä¾›äº†å¾ˆå¤šä¾¿æ·çš„æ“ä½œï¼Œä½†æ˜¯æ²¡æ¥è§¦è¿‡çš„äººä¼šå¯¹è¿™ç§è¡¨è¾¾å¼æœ‰å¾ˆå¤§çš„ç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·è¡¨ç¤ºï¼Ÿæˆ‘è¦æ€ä¹ˆå†™å‡ºLambdaé£æ ¼çš„ä»£ç ï¼Ÿæœ¬æ–‡æ—¨åœ¨å¿«é€Ÿç†è§£lambdaã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;å…ˆçœ‹ä¸‹lambdaè¡¨è¾¾å¼æ˜¯ä»€ä¹ˆã€‚åœ¨JDK8ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¥å£æ·»åŠ ä¸€ä¸ªæ³¨è§£&lt;code&gt;@FunctionalInterface&lt;/code&gt;,æˆ‘ä»¬çœ‹ä¸‹JDKä¸­&lt;code&gt;Runnalble&lt;/code&gt;æ¥å£&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@FunctionalInterface
public interface Runnable {
    
    void run();
    
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ¥å£å†…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•&lt;code&gt;run()&lt;/code&gt;ï¼Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå·±è¦å®ç°ä¸€ä¸ªlambdaæ¥å£ï¼Œé‚£ä¹ˆæ¥å£å†…æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼ˆ&lt;code&gt;default&lt;/code&gt;ä¿®é¥°çš„ä¸ç®—ï¼‰ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆé™åˆ¶ï¼Ÿçœ‹å®Œåæ–‡å°±çŸ¥é“äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸&lt;code&gt;Runnable&lt;/code&gt;å¸¸å¸¸ä¸€èµ·å‡ºç°çš„æ˜¯&lt;code&gt;Thread&lt;/code&gt;ç±»ï¼Œçœ‹ä¸‹Threadä¸­æ˜¯å¦‚ä½•ä½¿ç”¨&lt;code&gt;Runnable&lt;/code&gt;çš„&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public Thread(Runnable target) {
    init(null, target, &amp;quot;Thread-&amp;quot; + nextThreadNum(), 0);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ„é€ æ–¹æ³•ä¸­å¯ä»¥ä¼ å…¥ä¸€ä¸ª&lt;code&gt;Runnable&lt;/code&gt;å¯¹è±¡ï¼Œåœ¨JDK8ä¹‹å‰å¯ä»¥ä½¿ç”¨åŒ¿åç±»çš„æ–¹å¼&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;Thread thread = new Thread(new Runnable() {
    @Override
    public void run() {
        // ç¼–å†™è¿è¡Œé€»è¾‘
    }
});
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™å°±ç›¸å½“äºä¼ å…¥äº†ä¸€ä¸ªRunnalbleå®ä¾‹å¯¹è±¡äº†ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘ä»¬çŸ¥é“æ¥å£çš„å‚æ•°å¯¹è±¡æ˜¯Runnableï¼ŒçŸ¥åˆ°Runnableä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼ˆä¸Šæ–‡æåˆ°çš„é™åˆ¶ï¼‰ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ç®€åŒ–è¿™ä¸ªè¡¨è¾¾å¼å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å°è¯•å»æ‰å¤šä½™çš„å‚æ•°å£°æ˜è¯­å¥&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d806efa7ee00439bacd42920b680277c~tplv-k3u1fbpfcp-watermark.image?&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ¥ç€å»æ‰å¤šä½™çš„æ–¹æ³•å£°æ˜è¯­å¥&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/32b0646872074fac998da89e8225d212~tplv-k3u1fbpfcp-watermark.image?&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;æ˜¯çš„ï¼Œæœ€åå‰©ä¸‹çš„å°±æ˜¯å®é™…æœ‰æ•ˆçš„éƒ¨åˆ†ï¼Œæ–¹æ³•çš„å‚æ•°å’Œæ–¹æ³•çš„é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åæˆ‘ä»¬åŠ ä¸ªç®­å¤´&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2af1d6ea86aa4f34982b8b8040fb658c~tplv-k3u1fbpfcp-watermark.image?&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;æ²¡é”™ï¼Œè¿™ä¸ªå°±æ˜¯lambdaè¡¨è¾¾å¼äº†ï¼Œå°±æ˜¯è¿™ä¹ˆå˜åŒ–è¿‡æ¥çš„ã€‚&lt;/p&gt;
&lt;p&gt;è€ƒè™‘æœ‰å‚æ•°çš„æƒ…å†µï¼ŒåŠ å…¥Runnableæ¥å£çš„runæ–¹æ³•æ˜¯æœ‰å‚æ•°çš„ï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@FunctionalInterface
public interface Runnable {
    
    void run(String key,int val);
    
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é‚£ä¹ˆå¯¹åº”ï¼Œlambdaè¡¨è¾¾å¼å°±å˜æˆ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;new Thread((&amp;quot;hello&amp;quot;,20) -&amp;gt; {
    String k = key; // k == &amp;quot;hello&amp;quot;
    int v = val;    // v == 20
});
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚æœæ–¹æ³•çš„ä»£ç åªæœ‰ä¸€è¡Œï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥ä¸­æ‹¬å·&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;new Thread((&amp;quot;hello&amp;quot;,20) -&amp;gt; log.info(&amp;quot;key = {}&amp;quot;,key));
&lt;/code&gt;&lt;/pre&gt;
">å¿«é€Ÿçœ‹æ¸…lambdaçš„æœ¬è´¨</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/shi-xian-yi-zhi-xing-hash-suan-fa/"" data-c="
          &lt;blockquote&gt;
&lt;p&gt;å‡è®¾å·²ç»äº†è§£ä¸€è‡´æ€§Hashçš„ç›¸å…³çŸ¥è¯†ï¼Œå¦‚æœä¸äº†è§£å¯ä»¥å…ˆçœ‹&lt;a href=&#34;https://www.zsythink.net/archives/1182&#34;&gt;https://www.zsythink.net/archives/1182&lt;/a&gt;&lt;br&gt;
ä»£ç åœ°å€ï¼š&lt;a href=&#34;https://github.com/zexho994/ConsistentHash&#34;&gt;https://github.com/zexho994/ConsistentHash&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“ä¸€è‡´æ€§hashçš„æ ¸å¿ƒæ€æƒ³æ˜¯å¯¹2^32è¿›è¡Œå–æ¨¡ï¼Œç„¶åä¿å­˜åˆ°ä¸€ä¸ªHashç¯ä¸Š:&lt;/p&gt;
&lt;!-- more --&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/20726d0655964e89a79dbb2f4d91e809~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;è¦å®ç°ä¸€è‡´æ€§Hashï¼Œå…ˆè§£å†³å‡ ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚ä½•è¡¨ç¤ºè¿™ä¸ªç¯ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•åœ¨ç¯ä¸Šæ’å…¥èŠ‚ç‚¹ã€åˆ é™¤èŠ‚ç‚¹ã€æŸ¥æ‰¾æœ€è¿‘çš„èŠ‚ç‚¹ï¼Ÿ&lt;/li&gt;
&lt;li&gt;è™šæ‹ŸèŠ‚ç‚¹å¦‚ä½•è¡¨ç¤ºï¼Œæ€ä¹ˆæ’å…¥åˆ°ç¯ä¸­ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;hashç¯&#34;&gt;Hashç¯&lt;/h2&gt;
&lt;p&gt;æ€è€ƒä¸‹è¿™ä¸ªhashç¯çš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬çš„èŠ‚ç‚¹è¦æ’å…¥åˆ°å“ªä¸ªä½ç½®ç”±èŠ‚ç‚¹çš„hashå€¼å†³å®šï¼Œç°åœ¨åŠ å…¥æœ‰ä¸¤ä¸ªèŠ‚ç‚¹Aå’ŒBï¼Œ&lt;code&gt;A.hashcode = 50&lt;/code&gt;,&lt;code&gt;B.hashcode = 100&lt;/code&gt;,ç”±äºç¯æ˜¯æŒ‰é¡ºæ—¶é’ˆæ–¹å‘æŸ¥æ‰¾ï¼Œé‚£ä¹ˆæŸ¥æ‰¾çš„é€»è¾‘å°±æ˜¯:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;[0,50] , (50,2^32] çš„æ•°æ®ä¼šæ‰¾åˆ°A&lt;/li&gt;
&lt;li&gt;(50,100] çš„æ•°æ®ä¼šæ‰¾åˆ°B&lt;br&gt;
å¯ä»¥å‘ç°ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯è¦æœ‰åºï¼Œä»¥åŠå¯ä»¥æ”¯æŒå¿«é€Ÿæ‰¾åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ&lt;code&gt;TreeMap&lt;/code&gt;å°±ååˆ†å¥‘åˆ, æ¯ä¸ªèŠ‚ç‚¹çš„å³å­æ ‘å°±æ˜¯æœ€å°çš„æœ€è¿‘çš„å¤§äºæŸä¸ªhashcodeçš„èŠ‚ç‚¹ã€‚&lt;br&gt;
&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f70674010c44788ba3189a9a3522965~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ•´ä¸ªç®—æ³•æ ¸å¿ƒçš„éƒ¨åˆ†ä¹Ÿæ˜¯åŸºäº&lt;code&gt;TreeMap&lt;/code&gt;å®ç°çš„ï¼Œé¦–å…ˆå£°æ˜&lt;code&gt;ring&lt;/code&gt;ï¼Œåé¢æ‰€æœ‰çš„èŠ‚ç‚¹æ•°æ®éƒ½å°†å­˜å‚¨åˆ°ringä¸Šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class ConsistentHashManager {

    private final SortedMap&amp;lt;Integer/*ç´¢å¼•å¤§å°*/, Node/*èŠ‚ç‚¹*/&amp;gt; ring = new TreeMap();

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;ring&lt;/code&gt;ä¸­&lt;code&gt;key&lt;/code&gt;å­˜å‚¨çš„èŠ‚ç‚¹çš„&lt;code&gt;ç´¢å¼•&lt;/code&gt;å€¼ï¼ˆåé¢ä¼šè®²è®¡ç®—æ–¹å¼ï¼‰ï¼Œ&lt;code&gt;val&lt;/code&gt;ä¸­å­˜å‚¨èŠ‚ç‚¹å¯¹è±¡å®ä¾‹&lt;code&gt;Node&lt;/code&gt;ï¼Œå…¶ä¸­&lt;code&gt;Node&lt;/code&gt;æ˜¯æ¨¡æ‹Ÿè¡¨ç¤ºç°å®æœåŠ¡å™¨ä¿¡æ¯çš„å¯¹è±¡ï¼Œéœ€è¦é‡å†™&lt;code&gt;equals()&lt;/code&gt;å’Œ&lt;code&gt;hashcode()&lt;/code&gt;æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class Node {

    //æœåŠ¡å™¨åç§°
    private String name;
    //æœåŠ¡å™¨åŸŸå
    private String host;
    //æœåŠ¡å™¨ç«¯å£
    private Integer port;

    public Node(String name, String host, int port) {
        this.name = name;
        this.host = host;
        this.port = port;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof Node)) return false;
        Node node = (Node) o;
        return getPort() == node.getPort() &amp;amp;&amp;amp; getName().equals(node.getName()) &amp;amp;&amp;amp; getHost().equals(node.getHost());
    }

    @Override
    public int hashCode() {
        return Objects.hash(getName(), getHost(), getPort());
    }
    
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ·»åŠ æ–°èŠ‚ç‚¹&#34;&gt;æ·»åŠ æ–°èŠ‚ç‚¹&lt;/h2&gt;
&lt;p&gt;è¦å°†ä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨åˆ°ç¯ä¸Šï¼Œé¦–å…ˆæ˜¯è¦çŸ¥é“å­˜å‚¨åˆ°å“ªä¸ªä½ç½®ä¸Šï¼Œä½ç½®ç”±ç´¢å¼•çš„å¤§å°å†³å®šï¼Œè¿™å°±éœ€è¦è®¡ç®—&lt;code&gt;Nodeå¯¹è±¡&lt;/code&gt;çš„ç´¢å¼•å€¼&lt;br&gt;
&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/349fd9c6f8ca43268c9abdaf5e1d92c5~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å…ˆå£°æ˜ä¸€ä¸ªæ¥å£å¯¹è±¡ï¼Œå› ä¸ºä»¥åå¯èƒ½ä¼šæœ‰å„ç§è®¡ç®—æ–¹å¼ï¼Œé‚£ä¹ˆä¼šæœ‰å„ç§ä¸åŒçš„å…·ä½“å®ç°ç±»ï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨åŸºäºæ¥å£è€Œéå®ä¾‹çš„æ–¹å¼ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public interface HashUtil {

    int hash(String key);

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä½¿ç”¨MD5çš„æ–¹å¼ï¼Œè¿™è‚¯å®šä¸æ˜¯æœ€å¥½çš„æ–¹æ³•ï¼Œé‡ç‚¹æ˜¯è¡¨è¾¾&lt;code&gt;hash()&lt;/code&gt;çš„ä½œç”¨&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class Md5HashUtil implements HashUtil {

    private MessageDigest messageDigest;

    public Md5HashUtil() {
        try {
            this.messageDigest = MessageDigest.getInstance(&amp;quot;MD5&amp;quot;);
        } catch (NoSuchAlgorithmException e) {
            e.printStackTrace();
        }
    }

    @Override
    public int hash(String key) {
        this.messageDigest.update(String.valueOf(key).getBytes();
        byte[] digest = this.messageDigest.digest();
        int h = 0;
        for (int i = 0; i &amp;lt; 4; i++) {
            h |= ((int) digest[i]) &amp;amp; 0xFF;
            // å¾ªç¯4æ¬¡ï¼Œæ¯æ¬¡ç§»åŠ¨8ä½ï¼Œæ­£å¥½32æ¬¡
            h &amp;lt;&amp;lt;= 8;
        }
        return h;
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æœ‰äº†&lt;code&gt;hash()&lt;/code&gt;æ–¹æ³•ï¼Œå¯ä»¥çŸ¥é“èŠ‚ç‚¹çš„ç´¢å¼•å€¼äº†ï¼Œå°±å¯ä»¥å°†Nodeå­˜å‚¨åˆ°ringä¸­äº†&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public void addNode(Node node) {
    ring.put(hashUtil.hash(node.getKey()), node);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é‚£ä¹ˆè¿™æ—¶å€™è¿˜æœ‰ä¸€ä»¶äº‹è¦åšï¼Œå¦‚ä½•æ·»åŠ è™šæ‹ŸèŠ‚ç‚¹å‘¢ï¼Ÿåˆšå¼€å§‹çš„æ—¶å€™æˆ‘è®¤ä¸ºä¸ºäº†ä¿è¯å¹³å‡åˆ†å¸ƒï¼Œé‚£ä¹ˆè™šæ‹ŸèŠ‚ç‚¹çš„åˆ†å¸ƒç‰¹å¾åº”è¯¥å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/07ff31e6502b4cc195d50224ce7951a7~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;ä½†æ˜¯ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œè¦ç»§ç»­å¢åŠ æ›´å¤šç‰©ç†èŠ‚ç‚¹æ—¶ï¼Œå¦‚ä½•ç»§ç»­ä¿æŒå¹³å‡åˆ†å¸ƒï¼Ÿè¿™å¾ˆéš¾å®ç°ï¼Œä»å¦ä¸€ä¸ªæ–¹é¢å†æƒ³ï¼Œè™šæ‹ŸèŠ‚ç‚¹çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯ä¸ºäº†è®©åˆ†é…æ›´å¹³å‡ï¼Œé˜²æ­¢è¡€å´©çš„æ¦‚ç‡ï¼Œå…¶å®å“ªæ€•è¿™äº›è™šæ‹ŸèŠ‚ç‚¹çš„ä½ç½®éƒ½æ˜¯éšæœºçš„ï¼Œåªè¦èŠ‚ç‚¹æ•°é‡å¤Ÿå¤šï¼Œå°±å·²ç»è¾¾åˆ°äº†ç›®çš„ã€‚&lt;/p&gt;
&lt;p&gt;å®Œå–„ä¸€ä¸‹&lt;code&gt;addNode()&lt;/code&gt;æ–¹æ³•&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public void addNode(Node node) {
    ring.put(hashUtil.hash(node.getKey()), node);
    for (int i = 0; i &amp;lt; this.virNodeCount; i++) {
        this.ring.put(hashUtil.hash(node.getKey() + i), node);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;åˆ é™¤èŠ‚ç‚¹&#34;&gt;åˆ é™¤èŠ‚ç‚¹&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;ring&lt;/code&gt;ä¸­å­˜å‚¨çš„valæ˜¯Nodeï¼Œè¿™æ ·åœ¨éå†ringçš„åŒ¹é…nodeè¿›è¡Œåˆ é™¤å³å¯&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public void removeNote(Node node) {
    ring.entrySet().removeIf(next -&amp;gt; next.getValue().equals(node));
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;è·å–ä¸‹ä¸€ä¸ªèŠ‚ç‚¹&#34;&gt;è·å–ä¸‹ä¸€ä¸ªèŠ‚ç‚¹&lt;/h2&gt;
&lt;p&gt;è¿™éƒ¨åˆ†çœ‹ä»£ç äº†è§£ä¸‹&lt;code&gt;TreeMap&lt;/code&gt;çš„&lt;code&gt;api&lt;/code&gt;å°±å¯ä»¥ç†è§£ï¼Œæ²¡ä»€ä¹ˆéš¾åº¦&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public Node getNextNode(String key) {
    SortedMap&amp;lt;Integer, Node&amp;gt; longNodeSortedMap = ring.tailMap(hashUtil.hash(key));
    if (longNodeSortedMap.isEmpty()) {
        return ring.get(ring.firstKey());
    }
    return longNodeSortedMap.get(longNodeSortedMap.firstKey());
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;æµ‹è¯•&#34;&gt;æµ‹è¯•&lt;/h1&gt;
&lt;h2 id=&#34;è´Ÿè½½å‡è¡¡&#34;&gt;è´Ÿè½½å‡è¡¡&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Test
void loadBalancingTest() {
    ConsistentHashManager consistentHashManager = new ConsistentHashManager();
    // æ·»åŠ å››ä¸ªèŠ‚ç‚¹
    consistentHashManager.addNode(new Node(&amp;quot;node1&amp;quot;, &amp;quot;192.0.0.1&amp;quot;, 8080));
    consistentHashManager.addNode(new Node(&amp;quot;node2&amp;quot;, &amp;quot;192.0.0.2&amp;quot;, 8080));
    consistentHashManager.addNode(new Node(&amp;quot;node3&amp;quot;, &amp;quot;192.0.0.3&amp;quot;, 8080));
    consistentHashManager.addNode(new Node(&amp;quot;node4&amp;quot;, &amp;quot;192.0.0.4&amp;quot;, 8080));

    String preKey = &amp;quot;Data_&amp;quot;;
    // mapç”¨æ¥è®°å½•æ¯ä¸ªèŠ‚ç‚¹å‘½ä¸­çš„æ¬¡æ•°
    Map&amp;lt;String, Integer&amp;gt; map = new HashMap&amp;lt;&amp;gt;(200000);
    map.put(&amp;quot;node1&amp;quot;, 0);
    map.put(&amp;quot;node2&amp;quot;, 0);
    map.put(&amp;quot;node3&amp;quot;, 0);
    map.put(&amp;quot;node4&amp;quot;, 0);
    // å‡è®¾æœ‰20wä¸ªæ•°æ®
    for (int i = 0; i &amp;lt; 200000; i++) {
        Node nextNote = consistentHashManager.getNextNote(preKey + i);
        // ç´¯åŠ å‘½ä¸­æ¬¡æ•°
        map.computeIfPresent(nextNote.getName(), (k, v) -&amp;gt; v + 1);
    }
    // æ‰“å°
    map.entrySet().forEach(System.out::println);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/88147670d09b40c8aab81a41269e700d~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;æ•´ä½“çš„æ¯”ä¾‹æ˜¯ &lt;code&gt;5 : 6 : 4.5 : 4.5&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;åˆ é™¤èŠ‚ç‚¹åçš„å‘½ä¸­ç‡&#34;&gt;åˆ é™¤èŠ‚ç‚¹åçš„å‘½ä¸­ç‡&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Test
void removeNodeTest() {
    // çœç•¥æ·»åŠ èŠ‚ç‚¹çš„ä»£ç  ...
    
    // ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹
    consistentHashManager.removeNote(node4);
    // æµ‹è¯•ä¸‹ç§»é™¤èŠ‚ç‚¹åçš„å‘½ä¸­ç‡
    AtomicInteger n1 = new AtomicInteger(0);
    AtomicInteger n2 = new AtomicInteger(0);
    AtomicInteger n3 = new AtomicInteger(0);
    for (int i = 0; i &amp;lt; 200000; i++) {
        Node nextNode = consistentHashManager.getNextNode(preKey + i);
        if (nextNode.getName().equals(&amp;quot;node1&amp;quot;)) {
            n1.incrementAndGet();
        } else if (nextNode.getName().equals(&amp;quot;node2&amp;quot;)) {
            n2.incrementAndGet();
        } else if (nextNode.getName().equals(&amp;quot;node3&amp;quot;)) {
            n3.incrementAndGet();
        } else {
            throw new RuntimeException(&amp;quot;node4 æœªæ¸…ç†å¹²å‡€&amp;quot;);
        }
    }

    // æ‰“å°å‘½ä¸­ç‡, åŸæœ¬çš„æ¬¡æ•°/åˆ é™¤åçš„æ¬¡æ•°
    statistic.forEach((key, value) -&amp;gt; {
        if (key.equals(&amp;quot;node1&amp;quot;)) {
            System.out.println(&amp;quot;Node1,æ€»è®¿é—®æ¬¡æ•°=&amp;quot; + n1 + &amp;quot;,æœ‰æ•ˆè®¿é—® &amp;quot; + value + &amp;quot; å‘½ä¸­ç‡ = &amp;quot; + (double) (value) / n1.get());
        } else if (key.equals(&amp;quot;node2&amp;quot;)) {
            System.out.println(&amp;quot;Node2,æ€»è®¿é—®æ¬¡æ•°=&amp;quot; + n2 + &amp;quot;,æœ‰æ•ˆè®¿é—® &amp;quot; + value + &amp;quot; å‘½ä¸­ç‡ = &amp;quot; + (double) (value) / n2.get());
        } else if (key.equals(&amp;quot;node3&amp;quot;)) {
            System.out.println(&amp;quot;Node3,æ€»è®¿é—®æ¬¡æ•°=&amp;quot; + n3 + &amp;quot;,æœ‰æ•ˆè®¿é—® &amp;quot; + value + &amp;quot; å‘½ä¸­ç‡ = &amp;quot; + (double) (value) / n3.get());
        }
    });
}
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;4&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f72b63651f134c3eade1c41a75fdd122~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
">å®ç°ä¸€è‡´æ€§Hashç®—æ³•</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/li-yong-cglib-he-jdk-dong-tai-dai-li-shi-xian-aop/"" data-c="
          &lt;p&gt;å‰æï¼šæœ¬æ–‡å‡è®¾ä½ å·²ç»äº†è§£AOPåˆ‡é¢ç¼–ç¨‹çš„åŸºç¡€æ¦‚å¿µ&lt;br&gt;
é¡¹ç›®åœ°å€ï¼š&lt;a href=&#34;https://github.com/zexho994/IOC-AOP&#34;&gt;https://github.com/zexho994/IOC-AOP&lt;/a&gt;&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;aopçš„é€»è¾‘&#34;&gt;AOPçš„é€»è¾‘&lt;/h1&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè¢«ä»£ç†ç±»&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Bean
public class A interface I{

    public void print() {
        System.out.println(&amp;quot;aaa&amp;quot;);
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å®šä¹‰åˆ‡ç‚¹å’Œåˆ‡é¢&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Bean
@Aspect
public class AdviceSample {

    @Before
    @Pointcut(beanName = &amp;quot;A&amp;quot;)
    public void enhance2Before() {
        System.out.println(&amp;quot;before&amp;quot;);
    }


}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åç»­æˆ‘ä»¬ä½¿ç”¨Açš„æ—¶å€™ï¼Œéƒ½ä¼šå…ˆæ‰“å°åˆ‡é¢çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;before
aaa
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/83758a4da5594e43aee236ff3ba476df~tplv-k3u1fbpfcp-watermark.image?&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;å¦‚ä½•å°†åˆ‡é¢çš„å†…å®¹æ·»åŠ åˆ°ä»£ç†çš„æ–¹æ³•é‡Œé¢å»å‘¢ï¼Ÿ&lt;/p&gt;
&lt;h1 id=&#34;åˆ‡é¢åˆ‡å…¥å®ç°&#34;&gt;åˆ‡é¢åˆ‡å…¥å®ç°&lt;/h1&gt;
&lt;h2 id=&#34;jdkåŠ¨æ€ä»£ç†å®ç°&#34;&gt;JDKåŠ¨æ€ä»£ç†å®ç°&lt;/h2&gt;
&lt;p&gt;æåˆ°ä»£ç†ï¼Œæœ€å…ˆæƒ³åˆ°çš„æ˜¯JDKæä¾›çš„åŠ¨æ€ä»£ç†ç±»&lt;code&gt;InvocationHandler&lt;/code&gt;ï¼Œä¸‹é¢å°è¯•ä½¿ç”¨JDKåŠ¨æ€ä»£ç†å®ç° ï¼Œåˆ‡å…¥çš„æ–¹å¼å‡è®¾ä½¿ç”¨&lt;code&gt;before&lt;/code&gt;ï¼Œè€Œ&lt;code&gt;after&lt;/code&gt;å’Œ&lt;code&gt;around&lt;/code&gt;çœ‹å®Œå°±æ‡‚å¦‚ä½•å®ç°äº†ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class JDKDynamicProxy implements InvocationHandler {
    
    private Method before = null;
    private Object beforeObj = null;

    
    /**
     * @param proxy  ä»£ç†çš„çœŸå®å¯¹è±¡
     * @param method è¦è°ƒç”¨çš„çœŸå®å¯¹è±¡çš„æ–¹æ³•
     * @param args   æ–¹æ³•çš„å‚æ•°
     */
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
		// æ‰§è¡Œbeforeæ–¹æ³•
        if (before != null) {
            before.invoke(beforeObj);
        }

        // æ‰§è¡Œæœ¬ä½“æ–¹æ³•
        Object invoke = method.invoke(target, args);

        return invoke;
    }
    
    /**
     * è·å–åŠ¨æ€ä»£ç†å¯¹è±¡
     *
     * @param obj è¢«ä»£ç†ç±»
     * @return objçš„çˆ¶æ¥å£å®ç°å­ç±», å› ä¸ºè¿”å›çš„æ˜¯Tçˆ¶æ¥å£é‡å†™çš„ç±»
     */
    @SuppressWarnings(&amp;quot;unchecked&amp;quot;)
    public &amp;lt;T&amp;gt; T getDynamicProxyImpl(T obj,Method before, Object beforeObj) {
        assert obj != null;
        this.before = before;
        this.beforeObj = beforeObj;

        // newProxyInstance() ä¼šåˆ›å»ºç±»$Aï¼Œ$Aå®ç°äº†objçš„çˆ¶æ¥å£ï¼Œæ‰€æœ‰æ¥å£æ–¹æ³•å†…å®¹éƒ½ä¸º {@link #invoke()} ã€‚
        return (T) newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(), this);
    }
    
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç»Ÿä¸€è°ƒç”¨&lt;code&gt;getDynamicProxyImpl()&lt;/code&gt;æ¥è·å–æ–°çš„ä»£ç†ç±»ï¼Œå‚æ•°é‡Œé¢ä¼ å…¥beforeçš„Methodå¯¹è±¡ï¼Œ&lt;code&gt;invoke()&lt;/code&gt;æ–¹æ³•å®šä¹‰äº†åœ¨æ‰§è¡Œæœ¬ä½“æ–¹æ³•ä¹‹å‰æ‰§è¡Œ&lt;code&gt;before&lt;/code&gt;æ–¹æ³•ï¼Œè¿™æ ·æ–°çš„ä»£ç†ç±»éƒ½ä¼šå…ˆæ‰§è¡Œ&lt;code&gt;before&lt;/code&gt;æ–¹æ³•å†æ‰§è¡Œæœ¬ä½“æ–¹æ³•äº†ã€‚&lt;/p&gt;
&lt;p&gt;å®ç°éå¸¸ç®€å•æ˜“æ‡‚ï¼Œé‚£ä¹ˆè¦å®ç°&lt;code&gt;after&lt;/code&gt;æ–¹æ³•å°±æ˜¯å¯ä»¥ä¼ å…¥afterçš„&lt;code&gt;Method&lt;/code&gt;å¯¹è±¡ï¼Œç„¶ååœ¨&lt;code&gt;invoke()&lt;/code&gt;çš„æœ¬ä½“æ–¹æ³•ä¹‹åæ‰§è¡Œï¼Œ&lt;code&gt;around&lt;/code&gt;çš„å®ç°ä¸ç”¨å†å¢åŠ æ–°çš„é€»è¾‘äº†ï¼Œåªè¦åŒæ—¶ä¼ å…¥&lt;code&gt;before&lt;/code&gt;å’Œ&lt;code&gt;after&lt;/code&gt;çš„&lt;code&gt;Method&lt;/code&gt;å¯¹è±¡ï¼Œè¿™æ ·æ–°çš„ä»£ç†ç±»å°±ä¼šåŒæ—¶æ‰§è¡Œ&lt;code&gt;before()&lt;/code&gt;å’Œ&lt;code&gt;after()&lt;/code&gt;äº†ã€‚&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/72e5dca4c4a049519f0edaa0986605f5~tplv-k3u1fbpfcp-watermark.image?&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;cglibå®ç°&#34;&gt;Cglibå®ç°&lt;/h2&gt;
&lt;p&gt;JDKåŠ¨æ€ä»£ç†å¯ä»¥å®ç°ï¼Œä½†æ˜¯æœ‰çº¦æŸæ¡ä»¶å°±æ˜¯è¢«ä»£ç†ç±»å¿…é¡»è¦æœ‰çˆ¶æ¥å£ï¼Œå› ä¸ºJDKåŠ¨æ€å®ç°çš„åŸç†å°±æ˜¯å®ç°æ¥å£ç”Ÿæˆå¢å¼ºçš„å­ç±»ã€‚é‚£ä¹ˆå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰çˆ¶æ¥å£è¯¥å¦‚ä½•è¿›è¡Œåˆ‡é¢å¢å¼ºå‘¢ï¼Ÿ&lt;code&gt;Spring&lt;/code&gt;ä¸­ä½¿ç”¨äº†&lt;code&gt;cglib&lt;/code&gt;è¿™ä¸ªåº“æ¥å®ç°ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class CglibProxy implements MethodInterceptor {

    public static final Enhancer ENHANCER = new Enhancer();

    private Method before = null;
    private Object beforeObj = null;

    private Method after = null;
    private Object afterObj = null;

    /**
     * @param obj         cglibåŠ¨æ€ä»£ç†ç”Ÿæˆçš„å®ä¾‹
     * @param method      è¢«è°ƒç”¨çš„æ–¹æ³•çš„å¼•ç”¨
     * @param params      å‚æ•°åˆ—è¡¨
     * @param methodProxy ä»£ç†ç±»å¯¹æ–¹æ³•çš„ä»£ç†å¼•ç”¨
     */
    @Override
    public Object intercept(Object obj, Method method, Object[] params, MethodProxy methodProxy) throws Throwable {
        if (before != null) {
            before.invoke(beforeObj);
        }
        Object result = methodProxy.invokeSuper(obj, params);
        if (after != null) {
            after.invoke(afterObj);
        }
        return result;
    }

    public void setBefore(Method before, Object beforeObj) {
        this.before = before;
        this.beforeObj = beforeObj;
    }

    public void setAfter(Method after, Object afterObj) {
        this.after = after;
        this.afterObj = afterObj;
    }

    @SuppressWarnings(&amp;quot;unchecked&amp;quot;)
    public static &amp;lt;T&amp;gt; T getProxy(T target, Method before, Object beforeObj, Method after, Object afterObj) {
        ENHANCER.setSuperclass(target.getClass());
        CglibProxy cglibProxy = new CglibProxy();
        cglibProxy.setBefore(before, beforeObj);
        cglibProxy.setAfter(after, afterObj);

        ENHANCER.setCallback(cglibProxy);
        return (T) ENHANCER.create();
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å®ç°çš„æ€è·¯å’ŒJDKåŠ¨æ€ä»£ç†å‡ ä¹ä¸€è‡´ï¼Œé€šè¿‡è°ƒç”¨&lt;code&gt;getProxy()&lt;/code&gt;æ–¹æ³•ä¼ å…¥&lt;code&gt;before()&lt;/code&gt;æˆ–&lt;code&gt;after()&lt;/code&gt;æ–¹æ³•å°±å¯ä»¥è·å¾—ä»£ç†ç±»äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆcglibçš„å®ç°ä¸éœ€è¦æ¥å£å‘¢ï¼Ÿcglibçš„å®ç°åŸç†æ˜¯ä¸ºè¢«ä»£ç†ç±»åˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œç„¶åå°†åˆ‡é¢é€šè¿‡ASMæä¾›çš„å­—èŠ‚ç æŠ€æœ¯ç»‡å…¥åˆ°ç›®æ ‡æ–¹æ³•ä¸­ï¼Œè¿™æ ·å­ç±»çš„æ–¹æ³•å°±åŒ…å«äº†æœ¬ä½“å’Œåˆ‡é¢çš„é€»è¾‘äº†ã€‚&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d8116c3d61d4f8d8b72d525d210355d~tplv-k3u1fbpfcp-watermark.image?&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
">åˆ©ç”¨Cglibå’ŒJDKåŠ¨æ€ä»£ç†å®ç°AOP</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/rocketmq491-yuan-ma-fen-xi-namesrv-fu-wu-zhu-ce-andlu-you-fa-xian/"" data-c="
          &lt;p&gt;ä½•ä¸ºè·¯ç”±ä¸­å¿ƒï¼Ÿ&lt;br&gt;
åœ¨é€šå¸¸çš„ç†è§£ä¸­ï¼Œæåˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæœ€ç®€å•çš„æ¨¡å‹å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;!-- more --&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9f71895f47ec4236a5bea69b046546dc~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;å¾ˆå¥½ç†è§£ï¼Œç”Ÿäº§è€…åªè¦çŸ¥é“æ¶ˆæ¯é˜Ÿåˆ—çš„ç½‘ç»œåœ°å€ï¼Œç„¶åå‘é€æ¶ˆæ¯åˆ°è¿™ä¸ªç½‘ç»œåœ°å€ä¸Šã€‚ä½†æ˜¯å®é™…å¾€å¾€ä¸æ˜¯è¿™ä¹ˆç®€å•ï¼Œå› ä¸ºæ¶ˆæ¯é˜Ÿåˆ—ä¸€èˆ¬æ˜¯é›†ç¾¤æ¨¡å¼ï¼Œå†å¦‚ä¸‹å›¾ï¼Œ4ä¸ªå®ä¾‹ç»„æˆé›†ç¾¤ï¼š&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/506c5a983c63464da45316ec8e8d91ae~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;å‡å¦‚ç°åœ¨ç»§ç»­é‡‡ç”¨ç”Ÿäº§è€…/æ¶ˆè´¹è€…ç›´æ¥è®°å½•4ä¸ªå®ä¾‹ç½‘ç»œåœ°å€çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯å¯ä»¥å®ç°çš„ã€‚éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œéœ€è¦å¯¹é˜Ÿåˆ—è¿›è¡Œæ°´å¹³æ‰©å±•ï¼Œè¦å°†4å°å®ä¾‹ä¸´æ—¶æ‰©å±•åˆ°6å°ï¼Œé‚£ä¹ˆç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ˜¯ä¸çŸ¥é“æ–°å¢çš„ä¸¤ä¸ªå®ä¾‹ç½‘ç»œåœ°å€çš„ï¼Œè¿™æ—¶åªèƒ½é‡å¯ï¼Œè®°å½•ä¸¤ä¸ªæ–°å®ä¾‹çš„ç½‘ç»œåœ°å€å†é‡å¯ã€‚è¿™æ˜¯ä¸æ˜¯éå¸¸éº»çƒ¦ï¼Ÿé’ˆå¯¹è¿™ä¸ªé—®é¢˜å¯ä»¥æ€è€ƒä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹äºé›†ç¾¤æ¨¡å¼çš„æœåŠ¡ï¼Œæœ‰æ²¡æœ‰æ›´å¥½æ›´çµæ´»çš„æ–¹å¼å»è®°å½•è·¯ç”±ä¿¡æ¯ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å½“é›†ç¾¤å®ä¾‹æ•°é‡å¢åŠ æˆ–è€…å‡å°‘æ—¶ï¼Œæ€ä¹ˆè®©å…¶ä»–æœåŠ¡å¯ä»¥çŸ¥é“ï¼Ÿå¹¶ä¸”ä¸ç”¨åšä»»ä½•æ“ä½œã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™æ—¶å¦‚æœæˆ‘ä»¬æ–°å¢ä¸€ä¸ªè·¯ç”±ä¸­å¿ƒç³»ç»Ÿï¼Œè´Ÿè´£ä¸¤ä»¶äº‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ‰€æœ‰æœåŠ¡å¯ä»¥å»è·¯ç”±ä¸­å¿ƒä¸ŠæŠ¥è‡ªå·±çš„ç½‘ç»œåœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰æœåŠ¡å¯ä»¥å»è·¯ç”±ä¸­å¿ƒè·å–å…¶ä»–æœåŠ¡çš„ç½‘ç»œåœ°å€ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5e6aa125536e4dfb83330ef43de7e9d7~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;è¿™æ ·æˆ‘ä»¬ç³»ç»Ÿæœ‰å¤šå°‘çš„ä¸šåŠ¡ç³»ç»Ÿï¼Œæˆ‘ä»¬åªè¦çŸ¥é“è·¯ç”±ä¸­å¿ƒçš„åœ°å€å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆè·¯ç”±ä¸­å¿ƒæ€ä¹ˆæ„ŸçŸ¥å®ä¾‹æ•°é‡çš„å˜åŒ–å‘¢ï¼Ÿæœ€æœ´ç´ çš„æ‰‹æ®µå°±æ˜¯å¿ƒè·³ï¼Œè·¯ç”±ä¸­å¿ƒå®šæœŸå‘æ‰€æœ‰ä¸ŠæŠ¥çš„ç³»ç»Ÿå‘é€å¿ƒè·³åŒ…ï¼Œå¦‚æœå¿ƒè·³åŒ…æ²¡æœ‰å“åº”åˆ™è¯´æ˜å®ä¾‹å·²ç»åœæ­¢è¿è¡Œäº†ï¼Œåœ¨è·¯ç”±è®°å½•ä¸­å‰”é™¤è¯¥æœåŠ¡åœ°å€å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®è¿™ä¸¤ä¸ªæ­¥éª¤éƒ½æœ‰ä¸“é—¨åç§°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡æ³¨å†Œï¼šå°†æŸä¸ªæœåŠ¡è°ƒç”¨ä¿¡æ¯è®°å½•åˆ°ä¸€ä¸ªå…¬å…±ç»„ä»¶ä¸­&lt;/li&gt;
&lt;li&gt;æœåŠ¡å‘ç°ï¼šå½“æœåŠ¡æ–°å¢/å‡å°‘ï¼Œè¦èƒ½è¢«å…¶ä»–è°ƒç”¨è€…è‡ªåŠ¨å‘ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸‚é¢ä¸Šå·²æœ‰çš„ä»£è¡¨æ€§äº§å“æœ‰ï¼šzookeeperã€consulã€etcdã€‚&lt;/p&gt;
&lt;h1 id=&#34;rocketmqä¸­çš„namesrv&#34;&gt;RocketMQä¸­çš„Namesrv&lt;/h1&gt;
&lt;p&gt;å›¾ä¸­å±•ç¤ºäº†Namesrvçš„3ä¸ªåŠŸèƒ½ï¼Œä¹Ÿæ˜¯æ ¸å¿ƒçš„3ä¸ªåŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ³¨å†Œbroker&lt;/li&gt;
&lt;li&gt;è·å–è·¯ç”±ä¿¡æ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;!----&gt;
&lt;ul&gt;
&lt;li&gt;å®šæ—¶å¿ƒè·³æ£€æµ‹&lt;/li&gt;
&lt;/ul&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;4&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8c54c19fc50942ddbdd8bc47e62990b1~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;æ¥ä¸‹æ¥çœ‹çœ‹rocketmqçš„æºç æ˜¯å¦‚ä½•å®ç°è¿™3ä¸ªåŠŸèƒ½çš„&lt;/p&gt;
&lt;h1 id=&#34;è·¯ç”±å…ƒä¿¡æ¯&#34;&gt;è·¯ç”±å…ƒä¿¡æ¯&lt;/h1&gt;
&lt;p&gt;namesrvä½œä¸ºè·¯ç”±ä¿¡æ¯çš„ç®¡ç†è€…ï¼Œæœ¬è´¨ä¸Šå¯ä»¥è¿™ä¹ˆå¯¹namesrvè¿›è¡Œç†è§£ï¼š&lt;strong&gt;ä¿å­˜è·¯ç”±ä¿¡æ¯çš„æ•°æ®ç»“æ„ + æ“ä½œæ•°æ®ç»“æ„çš„ç®—æ³•&lt;/strong&gt;ï¼Œè·¯ç”±å…ƒä¿¡æ¯ä¾¿æ˜¯ç¬¬ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥å…ˆçœ‹çœ‹namesrvä¿å­˜è·¯ç”±ä¿¡æ¯çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åœ¨&lt;code&gt;namesrv/src/main/java/org/apache/rocketmq/namesrv/routeinfo/RouteInfoManager.java&lt;/code&gt;ç±»ä¸‹ï¼ŒåŒ…å«äº†æ‰€æœ‰çš„è·¯ç”±å…ƒä¿¡æ¯&lt;/p&gt;
&lt;h3 id=&#34;topicqueuetable&#34;&gt;topicQueueTable&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;    /**
     * ä¿å­˜Topicå’Œé˜Ÿåˆ—çš„ä¿¡æ¯ï¼Œä¹Ÿå«çœŸæ­£çš„è·¯ç”±ä¿¡æ¯ã€‚
     * ä¸€ä¸ªTopicçš„queueå¯èƒ½åˆ†å¸ƒåœ¨ä¸åŒçš„brokerä¸­ï¼Œä¹Ÿæœ‰å¯èƒ½åˆ†å¸ƒåœ¨åŒä¸€ä¸ªbrokerä¸­ã€‚
     * key:topic . val:QueueData
     */
    private final HashMap&amp;lt;String, List&amp;lt;QueueData&amp;gt;&amp;gt; topicQueueTable;
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;5&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6a9e4c5596d5446c904f294c0309bc2c~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;brokeraddrtable&#34;&gt;brokerAddrTable&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;    /**
     * BrokeråŸºç¡€ä¿¡æ¯ï¼Œbrokeråç§°å’Œbrokerä¿¡æ¯çš„å¯¹åº”ä¿¡æ¯
     * key:broker name . val:broker data
     */
    private final HashMap&amp;lt;String, BrokerData&amp;gt; brokerAddrTable;
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;6&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ddec0178522a42d791986edd1daf1756~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;clusteraddrtable&#34;&gt;clusterAddrTable&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;    /**
     * Brokeré›†ç¾¤ä¿¡æ¯,é›†ç¾¤ä¸­æ‰€æœ‰Brokeråç§°
     * key: cluster name . val:set&amp;lt;broker name&amp;gt;
     */
    private final HashMap&amp;lt;String, Set&amp;lt;String&amp;gt;&amp;gt; clusterAddrTable;
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;7&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2ac1bd42e6464d548a8df4725b37a8ab~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;brokerlivetable&#34;&gt;brokerLiveTable&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;    /**
     * BrokerçŠ¶æ€ä¿¡æ¯ï¼ŒNameServeræ¯æ¬¡æ”¶å¿ƒè·³åŒ…éƒ½ä¼šæ›¿æ¢è¯¥ä¿¡æ¯
     * key: broker addr . val:broker live info
     */
    private final HashMap&amp;lt;String, BrokerLiveInfo&amp;gt; brokerLiveTable;
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;8&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/24bca7def87a46868684c025076f71cd~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;filterservertable&#34;&gt;filterServerTable&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;    /**
     * ç”¨äºç±»æ¨¡å¼æ¶ˆæ¯è¿‡æ»¤
     * key:broker addr . val:filter server
     */
    private final HashMap&amp;lt;String, List&amp;lt;String&amp;gt;&amp;gt; filterServerTable;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;çŸ¥é“äº†è·¯ç”±å…ƒä¿¡æ¯çš„æ•°æ®ç»“æ„ï¼Œå†çœ‹çœ‹è·¯ç”±ä¿¡æ¯æ˜¯å¦‚ä½•ä¿å­˜åˆ°è¿™äº›mapä¸­çš„ä»¥åŠå¦‚ä½•æŸ¥è¯¢çš„ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æœåŠ¡æ³¨å†Œ&#34;&gt;æœåŠ¡æ³¨å†Œ&lt;/h1&gt;
&lt;p&gt;æ³¨å†Œbrokerå’Œè·å–è·¯ç”±ä¿¡æ¯æ˜¯namesrvæä¾›çš„APIï¼Œä½äº&lt;code&gt;namesrv/src/main/java/org/apache/rocketmq/namesrv/processor/DefaultRequestProcessor.java&lt;/code&gt;ç±»ä¸‹çš„&lt;code&gt;processRequest()&lt;/code&gt;ï¼Œæ ¹æ®è¯·æ±‚çš„codeåˆ¤æ–­è¯·æ±‚çš„ç±»å‹ã€‚ä¸‹é¢åŒ…å«äº†namesrvæ‰€æœ‰çš„å¯¹å¤–æ¥å£APIã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;switch (request.getCode()) {
    case RequestCode.PUT_KV_CONFIG:
        // æ·»åŠ é…ç½®
        return this.putKVConfig(ctx, request);
    case RequestCode.GET_KV_CONFIG:
        // è·å–é…ç½®
        return this.getKVConfig(ctx, request);
    case RequestCode.DELETE_KV_CONFIG:
        // åˆ é™¤é…ç½®
        return this.deleteKVConfig(ctx, request);
    case RequestCode.QUERY_DATA_VERSION:
        return queryBrokerTopicConfig(ctx, request);
    case RequestCode.REGISTER_BROKER:
        // æ³¨å†Œbroker
        Version brokerVersion = MQVersion.value2Version(request.getVersion());
        if (brokerVersion.ordinal() &amp;gt;= MQVersion.Version.V3_0_11.ordinal()) {
            // 3.0.11ä¹‹å
            return this.registerBrokerWithFilterServer(ctx, request);
        } else {
            // 3.0.11ä¹‹å‰
            return this.registerBroker(ctx, request);
        }
    case RequestCode.UNREGISTER_BROKER:
        // æ³¨é”€broker
        return this.unregisterBroker(ctx, request);
    case RequestCode.GET_ROUTEINFO_BY_TOPIC:
        // æ ¹æ®topicè·å–è·¯ç”±ä¿¡æ¯
        return this.getRouteInfoByTopic(ctx, request);
    case RequestCode.GET_BROKER_CLUSTER_INFO:
        // è·å–brokeré›†ç¾¤ä¿¡æ¯
        return this.getBrokerClusterInfo(ctx, request);
    case RequestCode.WIPE_WRITE_PERM_OF_BROKER:
        // åˆ é™¤Brokerçš„å†™æƒé™
        return this.wipeWritePermOfBroker(ctx, request);
    case RequestCode.GET_ALL_TOPIC_LIST_FROM_NAMESERVER:
        // è·å–å…¨éƒ¨Topicä¿¡æ¯
        return getAllTopicListFromNameserver(ctx, request);
    case RequestCode.DELETE_TOPIC_IN_NAMESRV:
        // åˆ é™¤Topicä¿¡æ¯
        return deleteTopicInNamesrv(ctx, request);
    case RequestCode.GET_KVLIST_BY_NAMESPACE:
        // è·å–kvåˆ—è¡¨
        return this.getKVListByNamespace(ctx, request);
    case RequestCode.GET_TOPICS_BY_CLUSTER:
        // è·å–topicæ ¹æ®é›†ç¾¤
        return this.getTopicsByCluster(ctx, request);
	..
    default:
        break;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…¶ä¸­æœåŠ¡æ³¨å†Œå¯¹åº”çš„æ˜¯codeæ˜¯&lt;code&gt;REGISTER_BROKER&lt;/code&gt;ï¼Œä¸‹é¢çœ‹åˆ°æ ¹æ®ç‰ˆæœ¬çš„ä¸åŒåˆ†ä¸º&lt;code&gt;registerBrokerWithFilterServer()&lt;/code&gt;å’Œ&lt;code&gt;registerBroker()&lt;/code&gt;ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯v4.9.1ï¼Œæ‰€ä»¥çœ‹çœ‹&lt;code&gt;registerBrokerWithFilterServer()&lt;/code&gt;çš„å®ç°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public RemotingCommand registerBrokerWithFilterServer(ChannelHandlerContext ctx, RemotingCommand request) throws RemotingCommandException {
	...çœç•¥...        
        
    // æ³¨å†Œçš„æ–¹æ³•
	RegisterBrokerResult result = this.namesrvController.getRouteInfoManager().registerBroker(...);

    ...çœç•¥...
    
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ ¸å¿ƒçš„æ³¨å†Œé€»è¾‘åœ¨&lt;code&gt;registerBroker()&lt;/code&gt;ä¸­ ,ç»§ç»­çœ‹ä¸‹&lt;code&gt;registerBroker()&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public RegisterBrokerResult registerBroker(final String clusterName, final String brokerAddr, final String brokerName, final long brokerId, final String haServerAddr, final TopicConfigSerializeWrapper topicConfigWrapper, final List&amp;lt;String&amp;gt; filterServerList, final Channel channel) {
    RegisterBrokerResult result = new RegisterBrokerResult();
    try {
        try {
            this.lock.writeLock().lockInterruptibly();

            // step1
            // æ ¹æ®é›†ç¾¤åç§°è·å– broker name é›†åˆ
            Set&amp;lt;String&amp;gt; brokerNames = this.clusterAddrTable.get(clusterName);
            if (null == brokerNames) {
                brokerNames = new HashSet&amp;lt;&amp;gt;();
                this.clusterAddrTable.put(clusterName, brokerNames);
            }
            // æ·»åŠ broker name åˆ°é›†åˆä¸­
            brokerNames.add(brokerName);

            // æ˜¯å¦ç¬¬ä¸€æ¬¡æ³¨å†Œ
            boolean registerFirst = false;

            // step2
            // å¦‚æœ broker table é‡Œæ²¡æœ‰æ•°æ®ï¼Œåˆ™è¡¨ç¤ºbrokerä¸ºç¬¬ä¸€æ¬¡æ³¨å†Œ
            BrokerData brokerData = this.brokerAddrTable.get(brokerName);
            if (null == brokerData) {
                registerFirst = true;
                brokerData = new BrokerData(clusterName, brokerName, new HashMap&amp;lt;&amp;gt;());
                this.brokerAddrTable.put(brokerName, brokerData);
            }
            Map&amp;lt;Long, String&amp;gt; brokerAddrsMap = brokerData.getBrokerAddrs();
            //Switch slave to master: first remove &amp;lt;1, IP:PORT&amp;gt; in namesrv, then add &amp;lt;0, IP:PORT&amp;gt;
            //The same IP:PORT must only have one record in brokerAddrTable
            brokerAddrsMap.entrySet().removeIf(item -&amp;gt; null != brokerAddr &amp;amp;&amp;amp; brokerAddr.equals(item.getValue()) &amp;amp;&amp;amp; brokerId != item.getKey());

            String oldAddr = brokerAddrsMap.put(brokerId, brokerAddr);
            registerFirst = registerFirst || (null == oldAddr);

            // step3
            // å¦‚æœ topic ä¿¡æ¯ä¸ä¸ºç©ºï¼Œè€Œä¸”æ˜¯ master
            if (null != topicConfigWrapper &amp;amp;&amp;amp; MixAll.MASTER_ID == brokerId) {
                // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ³¨å†Œï¼Œæˆ–è€… broker topic ä¿¡æ¯å‘ç”Ÿå˜åŠ¨è¿‡
                if (this.isBrokerTopicConfigChanged(brokerAddr, topicConfigWrapper.getDataVersion()) || registerFirst) {
                    // è·å– topic info åˆ—è¡¨
                    ConcurrentMap&amp;lt;String, TopicConfig&amp;gt; tcTable = topicConfigWrapper.getTopicConfigTable();
                    if (tcTable != null) {
                        for (Map.Entry&amp;lt;String, TopicConfig&amp;gt; entry : tcTable.entrySet()) {
                            this.createAndUpdateQueueData(brokerName, entry.getValue());
                        }
                    }
                }
            }

            // step4
            BrokerLiveInfo prevBrokerLiveInfo = this.brokerLiveTable.put(brokerAddr, new BrokerLiveInfo(System.currentTimeMillis(), topicConfigWrapper.getDataVersion(), channel, haServerAddr));
            if (null == prevBrokerLiveInfo) {
                log.info(&amp;quot;new broker registered, {} HAServer: {}&amp;quot;, brokerAddr, haServerAddr);
            }

            // step5
            if (filterServerList != null) {
                if (filterServerList.isEmpty()) {
                    this.filterServerTable.remove(brokerAddr);
                } else {
                    this.filterServerTable.put(brokerAddr, filterServerList);
                }
            }

            // å¦‚æœbrokerçš„èº«ä»½æ˜¯slave
            if (MixAll.MASTER_ID != brokerId) {
                String masterAddr = brokerData.getBrokerAddrs().get(MixAll.MASTER_ID);
                if (masterAddr != null) {
                    BrokerLiveInfo brokerLiveInfo = this.brokerLiveTable.get(masterAddr);
                    if (brokerLiveInfo != null) {
                        // åœ¨è¿”å›ç»“æœä¸­ï¼Œæºå¸¦masterçš„åœ°å€ï¼Œä¸»ä»åŒæ­¥æ­¥éª¤éœ€è¦ã€‚
                        result.setHaServerAddr(brokerLiveInfo.getHaServerAddr());
                        result.setMasterAddr(masterAddr);
                    }
                }
            }
        } finally {
            this.lock.writeLock().unlock();
        }
    } catch (Exception e) {
        log.error(&amp;quot;registerBroker Exception&amp;quot;, e);
    }

    return result;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä»£ç æ³¨é‡Šä¸­ä½¿ç”¨step1 ~ step5å¯¹5ä¸ªä¸åŒé˜¶æ®µè¿›è¡Œæ ‡è®°ï¼Œè¿™5ä¸ªé˜¶æ®µçš„ä½œç”¨å¯ä»¥è¿™ä¹ˆç†è§£&lt;br&gt;
&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c3b53e34de8e48ca8e5adcbb371babcd~tplv-k3u1fbpfcp-watermark.image?&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;è·¯ç”±å‰”é™¤&#34;&gt;è·¯ç”±å‰”é™¤&lt;/h1&gt;
&lt;p&gt;namesrvè¦åˆ é™¤ä¸€ä¸ªbrokerçš„è·¯ç”±ä¿¡æ¯çš„åªæœ‰ä¸€ä¸ªï¼šè¿™ä¸ªbrokerç›®å‰ä¸èƒ½æ­£å¸¸æä¾›æœåŠ¡äº†ã€‚è¿™ä¹Ÿå¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;brokeræ­£å¸¸åœæ­¢ã€‚&lt;/li&gt;
&lt;li&gt;brokerå‘ç”Ÿå¼‚å¸¸ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;broker-æ­£å¸¸åœæ­¢&#34;&gt;Broker æ­£å¸¸åœæ­¢&lt;/h2&gt;
&lt;p&gt;brokeråœ¨åœæ­¢çš„æ—¶å€™ä¼šç»™namesrvå‘é€ä¸€ä¸ª&lt;code&gt;unregisterBroker&lt;/code&gt;ç±»å‹çš„æ¶ˆæ¯ï¼Œå‘é€ä»£ç éƒ¨åˆ†åœ¨&lt;code&gt;broker/src/main/java/org/apache/rocketmq/broker/out/BrokerOuterAPI.java&lt;/code&gt;ç±»çš„&lt;code&gt;unregisterBrokerAll()&lt;/code&gt;ï¼Œnamesrvå¤„ç†è¿™ä¸ªæ¶ˆæ¯çš„å…¥å£ä¸Šæ–‡æœåŠ¡æ³¨å†Œéƒ¨åˆ†æåˆ°è¿‡ï¼Œä»£ç çš„é€»è¾‘å¾ˆç›´ç™½ï¼Œå°±æ˜¯ä»&lt;code&gt;topicQueueTable&lt;/code&gt; ã€&lt;code&gt;brokerAddrTable&lt;/code&gt; ã€&lt;code&gt;brokerLiveTable&lt;/code&gt; ã€&lt;code&gt;filterServerTable&lt;/code&gt; åˆ é™¤ä¸è¯¥Brokerç›¸å…³çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;broker-å¼‚å¸¸&#34;&gt;Broker å¼‚å¸¸&lt;/h2&gt;
&lt;p&gt;brokerå¼‚å¸¸çš„æ—¶å€™ï¼Œè‚¯å®šæ˜¯æ— æ³•ä¸»åŠ¨å‘namesrvå‘é€æ³¨é”€æ¶ˆæ¯çš„ï¼Œæ‰€ä»¥éœ€è¦namesrvä¸»åŠ¨å»å‘ç°å“ªäº›å¼‚å¸¸çš„brokerã€‚æŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œå¯ä»¥æƒ³åˆ°ä¸¤ç§å®ç°æ‰‹æ®µï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ–¹æ¡ˆä¸€ï¼š&lt;/strong&gt; namesrvå¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œç„¶åå‘æ‰€æœ‰brokerå‘é€å¿ƒè·³è¯·æ±‚ï¼Œæ— æ³•å“åº”çš„brokerå¯ä»¥æ€€ç–‘æ˜¯å‘ç”Ÿäº†å¼‚å¸¸äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ–¹æ¡ˆäºŒï¼š&lt;/strong&gt; è®°å½•brokerå‘namesrvæœ€åå‘é€å¿ƒè·³æ¶ˆæ¯çš„æ—¶é—´ï¼Œnamesrvå¯åŠ¨å®šæ—¶ä»»åŠ¡ï¼Œåˆ¤æ–­æ¯ä¸ªæœ€åå¿ƒè·³æ—¶é—´ä¸å½“å‰çš„æ—¶é—´æ˜¯å¦è¶…æ—¶ï¼Œè¶…æ—¶è¯´æ˜brokerå¼‚å¸¸å¯¼è‡´æ— æ³•å‘é€å¿ƒè·³åŒ…&lt;/p&gt;
&lt;p&gt;RocketMQçš„è®¾è®¡æ€è·¯å’Œæ–¹æ¡ˆäºŒç±»ä¼¼ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯åŠ¨å®šæ—¶ä»»åŠ¡&#34;&gt;å¯åŠ¨å®šæ—¶ä»»åŠ¡&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;namesrv/src/main/java/org/apache/rocketmq/namesrv/NamesrvController#initailize()&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public boolean initialize() {
    //...ç•¥
    
    this.scheduledExecutorService.scheduleAtFixedRate(NamesrvController.this.routeInfoManager::scanNotActiveBroker, 5, 10, TimeUnit.SECONDS);
    
	//... ç•¥
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;namesrv/src/main/java/org/apache/rocketmq/namesrv/routeinfo/RouteInfoManager#scanNotActiveBroker()&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public void scanNotActiveBroker() {
    // ä»å­˜æ´»åˆ—è¡¨é‡Œè·å–brokeræ•°æ®
    Iterator&amp;lt;Entry&amp;lt;String, BrokerLiveInfo&amp;gt;&amp;gt; it = this.brokerLiveTable.entrySet().iterator();
    while (it.hasNext()) {
        Entry&amp;lt;String, BrokerLiveInfo&amp;gt; next = it.next();
        long last = next.getValue().getLastUpdateTimestamp();
        // åˆ¤æ–­æ¶ˆæ¯å‘é€é—´éš”
        if ((last + BROKER_CHANNEL_EXPIRED_TIME) &amp;lt; System.currentTimeMillis()) {
            RemotingUtil.closeChannel(next.getValue().getChannel());
			// ç§»é™¤è¯¥brokerä¿¡æ¯
            it.remove();
            log.warn(&amp;quot;The broker channel expired, {} {}ms&amp;quot;, next.getKey(), BROKER_CHANNEL_EXPIRED_TIME);
            this.onChannelDestroy(next.getKey(), next.getValue().getChannel());
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
">RocketMQ4.9.1æºç åˆ†æ-NamesrvæœåŠ¡æ³¨å†Œ&è·¯ç”±å‘ç°</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/rocketmq491-yuan-ma-jie-xi-ha-mo-kuai-zhu-cong-slave-shang-bao-yu-xiao-xi-chu-li/"" data-c="
          &lt;p&gt;æ¥ç€ä¸Šä¸€ç¯‡ [RocketMQv4.9.1æºç åˆ†æ-HAä¸»ä» Masterè¯»å†™å¤„ç†] è§£ç­”äº†Masterç›¸å…³çš„é—®é¢˜ï¼Œè¿™ç¯‡æ–‡ç« å›´ç»•Slaveç›¸å…³çš„ä¸€äº›é—®é¢˜ç»§ç»­çœ‹ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºslaveï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹ä¸€äº›ç–‘æƒ‘ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;slave&lt;/code&gt;å¦‚ä½•è·å–&lt;code&gt;master&lt;/code&gt;çš„è·¯ç”±ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;&lt;code&gt;slave&lt;/code&gt;å¦‚ä½•å‘&lt;code&gt;master&lt;/code&gt;æŠ¥å‘Š&lt;code&gt;offset&lt;/code&gt;çš„&lt;/li&gt;
&lt;li&gt;&lt;code&gt;slave&lt;/code&gt;å¦‚ä½•å¤„ç†&lt;code&gt;master&lt;/code&gt;åŒæ­¥çš„æ•°æ®&lt;/li&gt;
&lt;/ol&gt;
&lt;!-- more --&gt;
&lt;p&gt;åœ¨æ•´ä½“çš„ç±»å›¾å¸ƒå±€ä¸­ï¼Œslaveç›¸å…³çš„ä»£ç éƒ½åœ¨HAClientç±»ä¸­&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ed3a2d9fc0214105b8bbf8f96114a677~tplv-k3u1fbpfcp-watermark.image?&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;haclient&#34;&gt;HAClient&lt;/h2&gt;
&lt;p&gt;HAClientéƒ¨åˆ†æ˜¯Slaveå¤„ç†çš„æ ¸å¿ƒï¼Œå…¶ä¸­åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;slaveä¸masterå»ºç«‹è¿æ¥&lt;/li&gt;
&lt;li&gt;slaveå‘masteræ±‡æŠ¥åŒæ­¥è¿›åº¦&lt;/li&gt;
&lt;li&gt;slaveæ¥æ”¶masterçš„åŒæ­¥æ•°æ®å¹¶å¤„ç†&lt;/li&gt;
&lt;/ol&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/49ce7b1d1f3a4b6bb097e0aef244cc56~tplv-k3u1fbpfcp-watermark.image?&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;haclient-å¯åŠ¨&#34;&gt;HAClient å¯åŠ¨&lt;/h3&gt;
&lt;p&gt;ä¹‹å‰æåˆ°äº†ï¼ŒHAClientå¯åŠ¨çš„è§¦å‘æ—¶æœºæ˜¯HAServiceå¯åŠ¨çš„æ–¹æ³•ä¸­ï¼Œåœ¨&lt;code&gt;store/src/main/java/org/apache/rocketmq/store/ha/HAService.start()&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;// HAService å¯åŠ¨
public void start() throws Exception {
    this.acceptSocketService.beginAccept();
    this.acceptSocketService.start();
    this.groupTransferService.start();
    this.haClient.start();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;HAClientçš„å¯åŠ¨ä»£ç åœ¨&lt;code&gt;store/src/main/java/org/apache/rocketmq/store/ha/HAService$HAClient.run()&lt;/code&gt;è·¯å¾„ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­3ä¸ªæ ¸å¿ƒçš„æ­¥éª¤åœ¨ä»£ç æ³¨é‡Šä¸­æœ‰è¿›è¡Œæ ‡è®°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
public void run() {
    log.info(this.getServiceName() + &amp;quot; service started&amp;quot;);

    while (!this.isStopped()) {
        try {
            // æ­¥éª¤ä¸€ï¼šè¿æ¥åˆ°master
            if (this.connectMaster()) {
                // æ­¥éª¤äºŒï¼šå¦‚æœè·ç¦»ä¸Šæ¬¡æŠ¥å‘Šçš„æ—¶é—´é—´éš”åˆ°äº†æœ€å¤§ç­‰å¾…æ—¶é—´,ç«‹åˆ»æ‰§è¡Œä¸€æ¬¡æŠ¥å‘Š
                if (this.isTimeToReportOffset()) {
                    // æŠ¥å‘Šslave offset
                    boolean result = this.reportSlaveMaxOffset(this.currentReportedOffset);
                    if (!result) {
                        this.closeMaster();
                    }
                }
                // æ£€æŸ¥æ˜¯å¦æœ‰è¯»äº‹ä»¶
                this.selector.select(1000);
                //æ­¥éª¤ä¸‰ï¼šå¤„ç†masterè¿”å›çš„æ¶ˆæ¯
                boolean ok = this.processReadEvent();
                if (!ok) {
                    this.closeMaster();
                }
                // å¤„ç†å®Œè¯»äº‹ä»¶åï¼Œå¦‚æœslave offsetæ›´æ–°ï¼Œéœ€è¦å†æ¬¡å‘é€æ–°çš„slave offset
                if (!reportSlaveMaxOffsetPlus()) {
                    continue;
                }

                long interval = HAService.this.getDefaultMessageStore().getSystemClock().now() - this.lastWriteTimestamp;
                if (interval &amp;gt; HAService.this.getDefaultMessageStore().getMessageStoreConfig().getHaHousekeepingInterval()) {
                    log.warn(&amp;quot;HAClient, housekeeping, found this connection[&amp;quot; + this.masterAddress + &amp;quot;] expired, &amp;quot; + interval);
                    this.closeMaster();
                    log.warn(&amp;quot;HAClient, master not response some time, so close connection&amp;quot;);
                }
            } else {
                this.waitForRunning(1000 * 5);
            }
        } catch (Exception e) {
            log.warn(this.getServiceName() + &amp;quot; service has exception. &amp;quot;, e);
            this.waitForRunning(1000 * 5);
        }
    }

    log.info(this.getServiceName() + &amp;quot; service end&amp;quot;);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;slaveè¿æ¥master&#34;&gt;Slaveè¿æ¥Master&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;connectMaster()&lt;/code&gt;æ–¹æ³•çš„ç›®çš„æ˜¯ä¸masterè¿›è¡Œè¿æ¥ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;// master åœ°å€(masterçš„åœ°å€åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®)
private final AtomicReference&amp;lt;String&amp;gt; masterAddress = new AtomicReference&amp;lt;&amp;gt;();

private boolean connectMaster() throws ClosedChannelException {
    if (null == socketChannel) {
        String addr = this.masterAddress.get();
        if (addr != null) {
            SocketAddress socketAddress = RemotingUtil.string2SocketAddress(addr);
            if (socketAddress != null) {
                this.socketChannel = RemotingUtil.connect(socketAddress);
                if (this.socketChannel != null) {
                    // è¯»äº‹ä»¶,ç”¨äºç›‘å¬masterçš„è¿”å›æ¶ˆæ¯
                    this.socketChannel.register(this.selector, SelectionKey.OP_READ);
                }
            }
        }
        // è®¾ç½®ä¸ºå½“å‰commitlogçš„åç§»é‡
        this.currentReportedOffset = HAService.this.defaultMessageStore.getMaxPhyOffset();
        this.lastWriteTimestamp = System.currentTimeMillis();
    }

    return this.socketChannel != null;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æœ‰ä¸€ä¸ªç‚¹å…³æ³¨ä¸‹ï¼Œå°±æ˜¯&lt;code&gt;currentReportedOffset&lt;/code&gt;å­—æ®µï¼Œè¿™ä¸ªå­—æ®µçš„ç›®çš„æ˜¯è¡¨ç¤ºå½“å‰slaveå·²åŒæ­¥çš„è¿›åº¦ï¼Œåç»­åœ¨å‘masterè¿›è¡Œæ±‡æŠ¥æ—¶ä¹Ÿæ˜¯ä½¿ç”¨è¯¥å­—æ®µçš„å€¼ã€‚è¿™é‡Œè¿›è¡Œåˆå§‹åŒ–çš„æ—¶å€™ç›´æ¥è®¾ç½®ä¸ºcommitlogæ–‡ä»¶çš„æœ€å¤§åç§»é‡ï¼Œå¦‚æœæ²¡æœ‰commitlogæ–‡ä»¶åˆ™ä¸º0ã€‚&lt;/p&gt;
&lt;h3 id=&#34;slaveæ±‡æŠ¥offset&#34;&gt;Slaveæ±‡æŠ¥offset&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;// æ­¥éª¤äºŒï¼šå¦‚æœè·ç¦»ä¸Šæ¬¡æŠ¥å‘Šçš„æ—¶é—´é—´éš”åˆ°äº†æœ€å¤§ç­‰å¾…æ—¶é—´,ç«‹åˆ»æ‰§è¡Œä¸€æ¬¡æŠ¥å‘Š
if (this.isTimeToReportOffset()) {
    // æŠ¥å‘Šslave offset
    boolean result = this.reportSlaveMaxOffset(this.currentReportedOffset);
    if (!result) {
        this.closeMaster();
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;isTimeToReportOffset()&lt;/code&gt;çš„ä½œç”¨æ˜¯åˆ¤æ–­ä¸Šä¸€æ¬¡è¿›è¡Œæ±‡æŠ¥çš„æ—¶é—´ä¸å½“å‰æ—¶é—´å·®æ˜¯å¦å¤§äºæœ€å¤§ç­‰å¾…é—´éš”ï¼ˆé»˜è®¤5sï¼‰ï¼Œè¿™æ„å‘³ç€å³ä½¿5sæ²¡æœ‰æ”¶åˆ°masterçš„ä»»ä½•æ¶ˆæ¯ï¼Œslaveä¹Ÿä¼šå‘é€ä¸€ä¸ªæ±‡æŠ¥è¯·æ±‚ç»™masterï¼Œä½œç”¨ç›¸å¯¹äºä¸€ä¸ªå¿ƒè·³åŒ…ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹ä¸‹&lt;code&gt;reportSlaveMaxOffset()&lt;/code&gt;æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private boolean reportSlaveMaxOffset(final long maxOffset) {
    // å†™ä½ç½®è®¾ä¸º0
    this.reportOffset.position(0);
    // å¯å†™é•¿åº¦ä¸º8å­—èŠ‚
    this.reportOffset.limit(8);
    // æ•°æ®å†…å®¹ä¸ºslaveå½“å‰çš„offset
    this.reportOffset.putLong(maxOffset);
    // å†™æ¨¡å¼åˆ‡æ¢åˆ°æ¨¡å¼
    // å°†è¯»ä½ç½®è®¾ä¸º0
    this.reportOffset.position(0);
    // å¯è¯»é•¿åº¦ä¸º8å­—èŠ‚
    this.reportOffset.limit(8);

    for (int i = 0; i &amp;lt; 3 &amp;amp;&amp;amp; this.reportOffset.hasRemaining(); i++) {
        try {
            // å°†æ•°æ®å†™å…¥channelä¸­
            this.socketChannel.write(this.reportOffset);
        } catch (IOException e) {
            log.error(this.getServiceName() + &amp;quot;reportSlaveMaxOffset this.socketChannel.write exception&amp;quot;, e);
            return false;
        }
    }

    lastWriteTimestamp = HAService.this.defaultMessageStore.getSystemClock().now();
    return !this.reportOffset.hasRemaining();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çŸ¥é“slaveçš„æ±‡æŠ¥è¯·æ±‚çš„æ•°æ®åŒ…å†…å®¹å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ª8å­—èŠ‚å¤§å°çš„offsetæ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä»£ç ä¸­æœ‰ä¸€ä¸ªç»†èŠ‚ï¼Œrocketmqçš„ä½œç”¨å†è¿›è¡Œå†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼æ—¶æ²¡æœ‰ä½¿ç”¨&lt;code&gt;flip()&lt;/code&gt;æ–¹æ³•ï¼Œè€Œæ˜¯æ‰‹åŠ¨è®¾ç½®&lt;code&gt;position&lt;/code&gt;å’Œ&lt;code&gt;limit&lt;/code&gt;,è¿™æ˜¯ç”±äºNIOæ˜¯ä¸€ä¸ªéé˜»å¡IOï¼Œwriteæ–¹æ³•ä¸ä¸€å®šä¼šä¸€æ¬¡å°†ByteBufferçš„æ•°æ®å…¨éƒ¨å†™å…¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;slaveå¤„ç†åŒæ­¥æ•°æ®&#34;&gt;Slaveå¤„ç†åŒæ­¥æ•°æ®&lt;/h3&gt;
&lt;p&gt;æ­¥éª¤ä¸‰ä¸­ï¼Œè°ƒç”¨&lt;code&gt;processReadEvent()&lt;/code&gt;å¯¹masterè¿”å›çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œçœ‹ä»£ç å‰ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“masterè¿”å›çš„æ•°æ®æ˜¯æœªåŒæ­¥çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆslaveè¦åšçš„äº‹æƒ…æ˜¯ä»€ä¹ˆï¼Ÿå½“ç„¶å°±æ˜¯æŠŠè¿™ä¸ªæœªåŒæ­¥çš„æ•°æ®ä¿å­˜åˆ°æœ¬åœ°çš„commitlogæ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private boolean processReadEvent() {
    // è¿ç»­è¯»å–åˆ°æ•°æ®å¤§å°ä¸º0çš„æ¬¡æ•°
    int readSizeZeroTimes = 0;
    // ä¸€ç›´è¯»å–ç¼“å†²åŒºçš„æ•°æ®ï¼Œç›´åˆ°æ²¡æœ‰å‰©ä½™
    while (this.byteBufferRead.hasRemaining()) {
        try {
            int readSize = this.socketChannel.read(this.byteBufferRead);
            if (readSize &amp;gt; 0) {
                readSizeZeroTimes = 0;
                boolean result = this.dispatchReadRequest();
                if (!result) {
                    log.error(&amp;quot;HAClient, dispatchReadRequest error&amp;quot;);
                    return false;
                }
            } else if (readSize == 0) {
                // å¦‚æœè¿ç»­ä¸‰æ¬¡è¯»åˆ°ä¸ºç©º,åˆ™è·³å‡ºæ–¹æ³•,è¿™é‡Œçš„ä½œç”¨ï¼Ÿ
                if (++readSizeZeroTimes &amp;gt;= 3) {
                    break;
                }
            } else {
                log.info(&amp;quot;HAClient, processReadEvent read socket &amp;lt; 0&amp;quot;);
                return false;
            }
        } catch (IOException e) {
            log.info(&amp;quot;HAClient, processReadEvent read socket exception&amp;quot;, e);
            return false;
        }
    }

    return true;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä»£ç é‡Œè°ƒç”¨äº†&lt;code&gt;dispatchReadRequest()&lt;/code&gt;æ–¹æ³•è¿›è¡Œè¯·æ±‚çš„å¤„ç†ï¼Œçœ‹ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private boolean dispatchReadRequest() {
    final int msgHeaderSize = 8 + 4; // phyoffset + size

    while (true) {
        int diff = this.byteBufferRead.position() - this.dispatchPosition;
        if (diff &amp;gt;= msgHeaderSize) {
            // master commitlog åç§»é‡
            long masterPhyOffset = this.byteBufferRead.getLong(this.dispatchPosition);
            // æ¶ˆæ¯å¤§å°
            int bodySize = this.byteBufferRead.getInt(this.dispatchPosition + 8);
            // æœ¬åœ°  commitlog åç§»é‡
            long slavePhyOffset = HAService.this.defaultMessageStore.getMaxPhyOffset();
            if (slavePhyOffset != 0) {
                // å¦‚æœslaveçš„offsetå’Œmasterçš„offsetä¸ä¸€æ ·ï¼Œè¯´æ˜æ•°æ®åŒæ­¥è¿‡ç¨‹å‘ç”Ÿäº†é—®é¢˜ï¼Œä¸å†ç»§ç»­åŒæ­¥ã€‚
                if (slavePhyOffset != masterPhyOffset) {
                    log.error(&amp;quot;master pushed offset not equal the max phy offset in slave, SLAVE: &amp;quot; + slavePhyOffset + &amp;quot; MASTER: &amp;quot; + masterPhyOffset);
                    return false;
                }
            }

            // å‰©ä½™ç©ºé—´å¤Ÿç”¨,å°†æ¶ˆæ¯è¿½åŠ åˆ°commitlogä¸­
            if (diff &amp;gt;= (msgHeaderSize + bodySize)) {
                // æ¶ˆæ¯æ•°ç»„
                byte[] bodyData = byteBufferRead.array();
                // æ¶ˆæ¯çš„
                int dataStart = this.dispatchPosition + msgHeaderSize;
                // æ·»åŠ æ•°æ®åˆ°æœ¬åœ°commitlogä¸­
                HAService.this.defaultMessageStore.appendToCommitLog(masterPhyOffset, bodyData, dataStart, bodySize);
                this.dispatchPosition += msgHeaderSize + bodySize;

                if (!reportSlaveMaxOffsetPlus()) {
                    return false;
                }

                continue;
            }
        }

        if (!this.byteBufferRead.hasRemaining()) {
            this.reallocateByteBuffer();
        }

        break;
    }

    return true;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ•´ä½“çš„é€»è¾‘å¯ä»¥åˆ†ä¸ºä¿©éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯è§£æè¯·æ±‚åŒ…ï¼Œè·å–æ¶ˆæ¯æ•°æ®ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯æŠŠæ¶ˆæ¯æ•°æ®å†™å…¥åˆ°commitlogæ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸¤éƒ¨åˆ†ä»£ç å·²ç»å†™çš„å¾ˆæ¸…æ¥šäº†ï¼Œæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå°±ä¸å†èµ˜è¿°ã€‚&lt;/p&gt;
">RocketMQ4.9.1æºç è§£æ-(HAæ¨¡å—)ä¸»ä»Slaveä¸ŠæŠ¥ä¸æ¶ˆæ¯å¤„ç†</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/rocketmq491-yuan-ma-fen-xi-ha-mo-kuai-master-du-xie-chu-li/"" data-c="
          &lt;p&gt;ä»æœ€æŠ½è±¡çš„è§’åº¦çœ‹ï¼Œä¸»ä»åŒæ­¥æµç¨‹å¯ä»¥åˆ†ä¸º3ä¸ªæ­¥éª¤:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;masterå¯åŠ¨&lt;/li&gt;
&lt;li&gt;slaveçš„å¯åŠ¨&lt;/li&gt;
&lt;li&gt;m/s æ•°æ®åŒæ­¥&lt;/li&gt;
&lt;/ol&gt;
&lt;!-- more --&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0f4040fe9fe04d9b877449592aaa9770~tplv-k3u1fbpfcp-watermark.image?&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;é’ˆå¯¹ä¸Šè¿°æ­¥éª¤ï¼Œç»“åˆrocketmqçš„è®¾è®¡ï¼Œå¯ä»¥å…ˆæä¸€äº›é—®é¢˜ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ç–‘é—®ç‚¹&#34;&gt;ç–‘é—®ç‚¹&lt;/h1&gt;
&lt;h2 id=&#34;master&#34;&gt;Master&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;master&lt;/code&gt;å¦‚ä½•æ¥å—&lt;code&gt;slave&lt;/code&gt;çš„è¯·æ±‚ï¼Ÿ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;master&lt;/code&gt;å¤„ç†&lt;code&gt;slave&lt;/code&gt;è¯·æ±‚æ—¶ï¼Œå¦‚ä½•åˆ¤æ–­å“ªäº›æ•°æ®éœ€è¦åŒæ­¥ï¼Ÿ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;master&lt;/code&gt;å¦‚ä½•ä¿è¯å‘é€çš„æ•°æ®åŒæ­¥æˆåŠŸçš„ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;slave&#34;&gt;Slave&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;slave&lt;/code&gt;å¦‚ä½•è·å–&lt;code&gt;master&lt;/code&gt;çš„è·¯ç”±ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;&lt;code&gt;slave&lt;/code&gt;å¦‚ä½•å‘&lt;code&gt;master&lt;/code&gt;æŠ¥å‘Š&lt;code&gt;offset&lt;/code&gt;çš„&lt;/li&gt;
&lt;li&gt;&lt;code&gt;slave&lt;/code&gt;å¦‚ä½•å¤„ç†&lt;code&gt;master&lt;/code&gt;åŒæ­¥çš„æ•°æ®&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;é«˜çº§&#34;&gt;é«˜çº§&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åŒæ­¥é€šçŸ¥&lt;/strong&gt;å’Œ&lt;strong&gt;å¼‚æ­¥é€šçŸ¥&lt;/strong&gt;æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ&lt;/li&gt;
&lt;li&gt;RocketMQçš„&lt;strong&gt;è¯»å†™åˆ†ç¦»&lt;/strong&gt;æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æœ¬æ–‡å…ˆå¯¹Masterçš„éƒ¨åˆ†è¿›è¡Œè§£æï¼š&lt;/p&gt;
&lt;h1 id=&#34;haç±»&#34;&gt;HAç±»&lt;/h1&gt;
&lt;p&gt;ä¸»ä»ç›¸å…³çš„ä»£ç ä½äº &lt;code&gt;store/src/main/java/org/apache/rocketmq/store/ha/&lt;/code&gt;è·¯å¾„ä¸‹ï¼Œå…¶ä¸­ä¸»è¦ä¸ºä¸¤ä¸ªç±»&lt;code&gt;HAService&lt;/code&gt;å’Œ&lt;code&gt;HAConnection&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;haç±»è¯´æ˜&#34;&gt;HAç±»è¯´æ˜&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;HAService: RocketMQ ä¸»ä»åŒæ­¥æ ¸å¿ƒå®ç°ç±»&lt;/li&gt;
&lt;li&gt;HAService$AcceptSocketService: Master ç›‘å¬å®¢æˆ·ç«¯è¿æ¥&lt;/li&gt;
&lt;li&gt;HAService$GroupTransferService: ä¸»ä»åŒæ­¥é€šçŸ¥&lt;/li&gt;
&lt;li&gt;HAService$HAClient: Client ç«¯&lt;/li&gt;
&lt;li&gt;HAConnection: M/Sé—´Channelçš„å°è£…ï¼ŒåŒæ—¶è´Ÿè´£MSæ•°æ®åŒæ­¥é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;HAConnection$ReadSocketServiceï¼š Master ç½‘ç»œè¯»å®ç°ç±»&lt;/li&gt;
&lt;li&gt;HAConnection$WriteSocketServiceï¼šMaster ç½‘ç»œå†™å®ç°ç±»&lt;/li&gt;
&lt;/ul&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f9f4b11e8cac44a3940e929af0f2f839~tplv-k3u1fbpfcp-watermark.image?&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h1 id=&#34;æºç éƒ¨åˆ†&#34;&gt;æºç éƒ¨åˆ†&lt;/h1&gt;
&lt;h2 id=&#34;haservice-æ¨¡å—å¯åŠ¨&#34;&gt;HAService æ¨¡å—å¯åŠ¨&lt;/h2&gt;
&lt;p&gt;HAæ¨¡å—çš„å¯åŠ¨è·¯å¾„åœ¨&lt;code&gt;store/src/main/java/org/apache/rocketmq/store/ha/HAService#start()&lt;/code&gt;ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;// HAService å¯åŠ¨
public void start() throws Exception {
    // masterç›¸å…³
    this.acceptSocketService.beginAccept();
    this.acceptSocketService.start();
    this.groupTransferService.start();  // åŒæ­¥æ¨¡å¼çš„å®ç°
    
    //slaveç›¸å…³
    this.haClient.start();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;acceptSocketService.beginAccept() : å¯åŠ¨slaveçš„ç›‘å¬æœåŠ¡&lt;/li&gt;
&lt;li&gt;acceptSocketService.start(): å¤„ç†slaveçš„è¿æ¥äº‹ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;acceptsocketservicebeginaccept&#34;&gt;acceptSocketService.beginAccept()&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public void beginAccept() throws Exception {
    // åˆ›å»º channel
    this.serverSocketChannel = ServerSocketChannel.open();
    // åˆ›å»º selector
    this.selector = RemotingUtil.openSelector();
    // è®¾ç½® TCP reuseAddress
    this.serverSocketChannel.socket().setReuseAddress(true);
    // ç»‘å®šç›‘å¬ç«¯å£,é»˜è®¤10912
    this.serverSocketChannel.socket().bind(this.socketAddressListen);
    // è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼
    this.serverSocketChannel.configureBlocking(false);
    // æ³¨å†ŒOP_ACCEPT(è¿æ¥äº‹ä»¶)
    this.serverSocketChannel.register(this.selector, SelectionKey.OP_ACCEPT);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;acceptsocketservicestart&#34;&gt;acceptSocketService.start()&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
public void run() {
    log.info(this.getServiceName() + &amp;quot; service started&amp;quot;);

    while (!this.isStopped()) {
        try {
            // æ¯1sé’Ÿå¤„ç†ä¸€æ¬¡slaveè¿æ¥äº‹ä»¶
            this.selector.select(1000);
            Set&amp;lt;SelectionKey&amp;gt; selected = this.selector.selectedKeys();

            if (selected != null) {
                for (SelectionKey k : selected) {
                    if ((k.readyOps() &amp;amp; SelectionKey.OP_ACCEPT) != 0) {
                        // slaveçš„è¿æ¥channel
                        SocketChannel sc = ((ServerSocketChannel) k.channel()).accept();

                        if (sc != null) {
                            HAService.log.info(&amp;quot;HAService receive new connection, &amp;quot; + sc.socket().getRemoteSocketAddress());

                            try {
                                // åˆ›å»ºä¸€ä¸ªHAConnectionå¯¹è±¡ï¼Œä¿å­˜slaveçš„Channel
                                HAConnection conn = new HAConnection(HAService.this, sc);
                                // å¯åŠ¨HAConnection
                                conn.start();
                                // ä¿å­˜HAConnectionåˆ°connectionListä¸­
                                HAService.this.addConnection(conn);
                            } catch (Exception e) {
                                log.error(&amp;quot;new HAConnection exception&amp;quot;, e);
                                sc.close();
                            }
                        }
                    } else {
                        log.warn(&amp;quot;Unexpected ops in select &amp;quot; + k.readyOps());
                    }
                }

                selected.clear();
            }
        } catch (Exception e) {
            log.error(this.getServiceName() + &amp;quot; service has exception.&amp;quot;, e);
        }
    }

    log.info(this.getServiceName() + &amp;quot; service end&amp;quot;);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å½“æœ‰æ–°çš„è¿æ¥æ—¶ï¼Œä¼šå°†è¯¥è¿æ¥å°è£…æˆä¸€ä¸ª&lt;code&gt;HAConnection&lt;/code&gt;å¯¹è±¡ï¼Œè°ƒç”¨&lt;code&gt;HAConnection.start()&lt;/code&gt;æ–¹æ³•ï¼Œç„¶åå°†è¿æ¥ä¿å­˜åˆ°è¿æ¥åˆ—è¡¨ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;masterå¦‚ä½•å¤„ç†slaveçš„è¯·æ±‚ä»¥åŠå¦‚ä½•å‘slaveå‘é€æ¶ˆæ¯çš„é€»è¾‘å…¨éƒ¨åœ¨&lt;code&gt;HAConnection&lt;/code&gt;å¯¹è±¡é‡Œï¼Œç»§ç»­è¿½è¸ª&lt;code&gt;HAConnection#start()&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;haconnectionå¯åŠ¨&#34;&gt;HAConnectionå¯åŠ¨&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public void start() {
    // masterå¤„ç†slaveçš„æ¶ˆæ¯éƒ¨åˆ†
    this.readSocketService.start();
    // mastgerå‘slaveå‘é€æ¶ˆæ¯éƒ¨åˆ†
    this.writeSocketService.start();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œåˆ†ä¸º&lt;code&gt;readSocketService&lt;/code&gt;å’Œ&lt;code&gt;writeSocketService&lt;/code&gt;ï¼Œé¡¾åæ€ä¹‰ï¼Œä¸€ä¸ªå¤„ç†slaveçš„è¯»äº‹ä»¶ï¼Œä¸€ä¸ªå¤„ç†å†™äº‹ä»¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;readSocketService : å¤„ç†æ¥æ”¶åˆ°çš„slaveçš„è¯·æ±‚&lt;/li&gt;
&lt;li&gt;writeSocketService: è´Ÿè´£masterå‘slaveåŒæ­¥æ•°æ®çš„é€»è¾‘&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;masterå¤„ç†slaveè¯·æ±‚&#34;&gt;Masterå¤„ç†slaveè¯·æ±‚&lt;/h3&gt;
&lt;p&gt;åœ¨ &lt;code&gt;store/src/main/java/org/apache/rocketmq/store/ha/HAConnection.run()&lt;/code&gt;ä¸­ï¼Œä¸»è¦å…³æ³¨è¿™éƒ¨åˆ†é€»è¾‘:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;while (!this.isStopped()) {
    try {
        // 1sæ£€æŸ¥ä¸€æ¬¡è¯»è¯·æ±‚
        this.selector.select(1000);
        // å¤„ç†è¯»äº‹ä»¶
        boolean ok = this.processReadEvent();
        if (!ok) {
            HAConnection.log.error(&amp;quot;processReadEvent error&amp;quot;);
            break;
        }

        // ä¸¤æ¬¡è¯»äº‹ä»¶çš„é—´éš”è¶…è¿‡äº†æ—¢å®šçš„å€¼ï¼Œåˆ™masterå’Œslaveçš„è¿æ¥å¤±æ•ˆï¼Œè·³å‡ºå¾ªç¯ã€‚
        long interval = HAConnection.this.haService.getDefaultMessageStore().getSystemClock().now() - this.lastReadTimestamp;
        if (interval &amp;gt; HAConnection.this.haService.getDefaultMessageStore().getMessageStoreConfig().getHaHousekeepingInterval()) {
            log.warn(&amp;quot;ha housekeeping, found this connection[&amp;quot; + HAConnection.this.clientAddr + &amp;quot;] expired, &amp;quot; + interval);
            break;
        }
    } catch (Exception e) {
        HAConnection.log.error(this.getServiceName() + &amp;quot; service has exception.&amp;quot;, e);
        break;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¤„ç†è¯»äº‹ä»¶çš„ä»£ç ï¼š&lt;/p&gt;
&lt;p&gt;slaveå‘é€çš„æ¶ˆæ¯å†…å®¹ä¸ºè¦æ‹‰å–çš„æ•°æ®çš„offsetï¼Œè€Œmasteræ¥æ”¶è¦è¿™ä¸ªoffsetåï¼Œå«ä¹‰æœ‰ä¸¤å±‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¿™ä¸ªoffsetè¡¨ç¤ºslaveè¿™æ¬¡è¦æ‹‰å–çš„ä½ç½®ï¼Œç»™masteræä¾›å‚è€ƒã€‚&lt;/li&gt;
&lt;li&gt;è¿™ä¸ªoffsetä¹Ÿè¡¨ç¤ºslaveä»¥åŠåŒæ­¥åˆ°çš„ä½ç½®ï¼Œå¯ä»¥å½“ä½œä¸€ä¸ªackåŒ…çš„ä½œç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private boolean processReadEvent() {
    int readSizeZeroTimes = 0;

    // è‹¥byteBufferReadæ²¡æœ‰å‰©ä½™
    if (!this.byteBufferRead.hasRemaining()) {
        this.byteBufferRead.flip();
        this.processPosition = 0;
    }

    while (this.byteBufferRead.hasRemaining()) {
        try {
            int readSize = this.socketChannel.read(this.byteBufferRead);
            if (readSize &amp;gt; 0) {
                readSizeZeroTimes = 0;
                this.lastReadTimestamp = HAConnection.this.haService.getDefaultMessageStore().getSystemClock().now();
                // è¶…è¿‡8å­—èŠ‚å°±å¤„ç†,å› ä¸ºslaveå‘é€çš„å¿ƒè·³åŒ…å°±æ˜¯8å­—èŠ‚çš„offset
                if ((this.byteBufferRead.position() - this.processPosition) &amp;gt;= 8) {
                    // è·å–ç¦»byteBufferRead.position()æœ€è¿‘çš„8çš„æ•´æ•°
                    int pos = this.byteBufferRead.position() - (this.byteBufferRead.position() % 8);
                    long readOffset = this.byteBufferRead.getLong(pos - 8);
                    this.processPosition = pos;
                    // æ›´æ–°slave å·²æ‹‰å–çš„ offset
                    HAConnection.this.slaveAckOffset = readOffset;
                    // å‡å¦‚æ˜¯ç¬¬ä¸€æ¬¡æ‹‰å–çš„æƒ…å†µ
                    if (HAConnection.this.slaveRequestOffset &amp;lt; 0) {
                        HAConnection.this.slaveRequestOffset = readOffset;
                        log.info(&amp;quot;slave[&amp;quot; + HAConnection.this.clientAddr + &amp;quot;] request offset &amp;quot; + readOffset);
                    }
                    // é€šçŸ¥slaveå·²ç»æ›´æ–°ï¼Œæ›´æ–°push2SlaveMaxOffsetå­—æ®µ
                    HAConnection.this.haService.notifyTransferSome(HAConnection.this.slaveAckOffset);
                }
            } else if (readSize == 0) {
                if (++readSizeZeroTimes &amp;gt;= 3) {
                    break;
                }
            } else {
                log.error(&amp;quot;read socket[&amp;quot; + HAConnection.this.clientAddr + &amp;quot;] &amp;lt; 0&amp;quot;);
                return false;
            }
        } catch (IOException e) {
            log.error(&amp;quot;processReadEvent exception&amp;quot;, e);
            return false;
        }
    }

    return true;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;masterè·å–åˆ°offsetåï¼Œæ›´æ–°&lt;code&gt;push2SlavemaxOffset&lt;/code&gt;å­—æ®µï¼Œè¿™ä¸ªå­—æ®µçš„ä½œç”¨æ˜¯è¡¨ç¤ºå½“å‰M/Sä¹‹é—´å·²æˆåŠŸåŒæ­¥çš„ä½ç½®ï¼Œåœ¨masterå‘slaveå‘é€æ•°æ®æ—¶éœ€è¦ã€‚&lt;/p&gt;
&lt;h2 id=&#34;masterä¼ è¾“æ•°æ®&#34;&gt;Masterä¼ è¾“æ•°æ®&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;while (!this.isStopped()) {
    try {
        this.selector.select(1000);

        if (-1 == HAConnection.this.slaveRequestOffset) {
            Thread.sleep(10);
            continue;
        }

        // æ˜¯å¦ç¬¬ä¸€æ¬¡è¿›è¡Œä¼ è¾“
        if (-1 == this.nextTransferFromWhere) {
            // requestä¸º0
            if (0 == HAConnection.this.slaveRequestOffset) {
                long masterOffset = HAConnection.this.haService.getDefaultMessageStore().getCommitLog().getMaxOffset();
                masterOffset = masterOffset - (masterOffset % HAConnection.this.haService.getDefaultMessageStore().getMessageStoreConfig().getMappedFileSizeCommitLog());

                if (masterOffset &amp;lt; 0) {
                    masterOffset = 0;
                }

                this.nextTransferFromWhere = masterOffset;
            } else {
                // slaveRequestOffset != 0
                this.nextTransferFromWhere = HAConnection.this.slaveRequestOffset;
            }

            log.info(&amp;quot;master transfer data from &amp;quot; + this.nextTransferFromWhere + &amp;quot; to slave[&amp;quot; + HAConnection.this.clientAddr + &amp;quot;], and slave request &amp;quot; + HAConnection.this.slaveRequestOffset);
        }

        // ä¸Šæ¬¡ä¼ è¾“æ˜¯å¦æˆåŠŸ
        if (this.lastWriteOver) {
            // è·ç¦»ä¸Šæ¬¡å†™çš„æ—¶é—´é—´éš”
            long interval = HAConnection.this.haService.getDefaultMessageStore().getSystemClock().now() - this.lastWriteTimestamp;
            // å¦‚æœç­‰å¾…æ—¶é—´é—´éš” &amp;gt; haå¿ƒè·³æ—¶é—´é—´éš”
            if (interval &amp;gt; HAConnection.this.haService.getDefaultMessageStore().getMessageStoreConfig().getHaSendHeartbeatInterval()) {
                // Build Header
                this.byteBufferHeader.position(0);
                this.byteBufferHeader.limit(headerSize);
                this.byteBufferHeader.putLong(this.nextTransferFromWhere);
                this.byteBufferHeader.putInt(0);
                this.byteBufferHeader.flip();
                this.lastWriteOver = this.transferData();
                if (!this.lastWriteOver) continue;
            }
        } else {
            //ä¸Šæ¬¡å¤±è´¥ï¼Œéœ€è¦è¿›è¡Œé‡æ–°ä¼ è¾“
            this.lastWriteOver = this.transferData();
            if (!this.lastWriteOver) continue;
        }

        // æ ¹æ®nextTransferFromWhereè·å–commitlogæ•°æ®
        SelectMappedBufferResult selectResult = HAConnection.this.haService.getDefaultMessageStore().getCommitLogData(this.nextTransferFromWhere);
        if (selectResult != null) {
            int size = selectResult.getSize();
            if (size &amp;gt; HAConnection.this.haService.getDefaultMessageStore().getMessageStoreConfig().getHaTransferBatchSize()) {
                size = HAConnection.this.haService.getDefaultMessageStore().getMessageStoreConfig().getHaTransferBatchSize();
            }

            long thisOffset = this.nextTransferFromWhere;
            this.nextTransferFromWhere += size;

            selectResult.getByteBuffer().limit(size);
            this.selectMappedBufferResult = selectResult;

            // Build Header
            this.byteBufferHeader.position(0);
            this.byteBufferHeader.limit(headerSize);
            this.byteBufferHeader.putLong(thisOffset);
            this.byteBufferHeader.putInt(size);
            this.byteBufferHeader.flip();

            this.lastWriteOver = this.transferData();
        } else {

            HAConnection.this.haService.getWaitNotifyObject().allWaitForRunning(100);
        }
    } catch (Exception e) {

        HAConnection.log.error(this.getServiceName() + &amp;quot; service has exception.&amp;quot;, e);
        break;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/438c5aae0acf4ea3b06b92a35b010648~tplv-k3u1fbpfcp-watermark.image?&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h1 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;master&lt;/code&gt;å¦‚ä½•æ¥å—&lt;code&gt;slave&lt;/code&gt;çš„è¯·æ±‚ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç­”ï¼šåœ¨readSocketServiceç±»ä¸­è¿›è¡ŒOP_READäº‹ä»¶å¤„ç†ã€‚masteræ”¶åˆ°slaveå‘é€çš„çš„offsetï¼Œè¡¨ç¤ºslaveå½“å‰åŒæ­¥çš„ä½ç½®ï¼Œmasterä¿å­˜è¯¥offsetã€‚&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;code&gt;master&lt;/code&gt;å¤„ç†&lt;code&gt;slave&lt;/code&gt;è¯·æ±‚æ—¶ï¼Œå¦‚ä½•åˆ¤æ–­å“ªäº›æ•°æ®éœ€è¦åŒæ­¥ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç­”ï¼šslaveçš„è¯·æ±‚ä¼šæºå¸¦åŒæ­¥å®Œçš„offsetï¼Œmasteråœ¨readSocketServiceä¸­ä¿å­˜äº†è¯¥offsetï¼Œåç»­writeSocketServiceåœ¨æ‰§è¡ŒOP_WRITEäº‹ä»¶æ—¶ï¼Œä¼šä¸ masterçš„offsetè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœ‰æ–°çš„æ•°æ®åˆ™å‘é€ç»™slaveã€‚&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;&lt;code&gt;master&lt;/code&gt;å¦‚ä½•ä¿è¯å‘é€çš„æ•°æ®åŒæ­¥æˆåŠŸçš„ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç­”ï¼šackæœºåˆ¶ï¼Œslave -&amp;gt; master å‘é€çš„è¯·æ±‚ä¸­çš„offsetå³ä»£è¡¨slaveå·²åŒæ­¥å®Œæˆçš„è¿›åº¦ï¼Œå‡å¦‚slaveåœ¨åŒæ­¥æ“ä½œæ—¶å‘é€å¼‚å¸¸ï¼Œé‚£ä¹ˆæœªåŒæ­¥æˆåŠŸçš„æ•°æ®ä¸‹ä¸€æ¬¡masterä¼šå†å‘é€è¿‡æ¥ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å…³äºslaveäºé«˜çº§éƒ¨åˆ†åœ¨åç»­æ–‡ç« ä¸­æ›´æ–°ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
">RocketMQ4.9.1æºç åˆ†æ(HAæ¨¡å—) Masterè¯»å†™å¤„ç†</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/rocketmq491-yuan-ma-fen-xi-_shi-wu-half-ban-xiao-xi-chu-li/"" data-c="
          &lt;p&gt;halfæ¶ˆæ¯å±äºRocketMQäº‹åŠ¡å¤„ç†çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œå¯ä»¥åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;producer -&amp;gt; broker å‘é€halfæ¶ˆæ¯&lt;/li&gt;
&lt;li&gt;broker å¤„ç†halfæ¶ˆæ¯&lt;/li&gt;
&lt;/ol&gt;
&lt;!-- more --&gt;
&lt;p&gt;å¯¹åº”å›¾ä¸­çš„æ­¥éª¤1ã€2ã€‚&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7bd34b7c086149a298df6672e9c5dda2~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;å¸¦ç€é—®é¢˜çœ‹æºç , å…ˆæå‡ ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;producer å¦‚ä½•å‘é€ half æ¶ˆæ¯çš„ï¼Ÿ&lt;/li&gt;
&lt;li&gt;broker åˆæ˜¯å¦‚ä½•åŒºåˆ†æ™®é€šæ¶ˆæ¯å’Œäº‹åŠ¡æ¶ˆæ¯çš„&lt;/li&gt;
&lt;/ol&gt;
&lt;!----&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;halfæ¶ˆæ¯ä¸ä¼šè¢«Consumeræ¶ˆè´¹ï¼Œæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;çœ‹å®Œå°±æœ‰ç­”æ¡ˆäº†ã€‚&lt;/p&gt;
&lt;h1 id=&#34;producer-half-æ¶ˆæ¯å‘é€&#34;&gt;Producer Half æ¶ˆæ¯å‘é€&lt;/h1&gt;
&lt;p&gt;é¦–å…ˆç”Ÿäº§è€…çš„ä½¿ç”¨ä»£ç å¦‚ä¸‹ï¼Œè¦ä½¿ç”¨äº‹åŠ¡æ¶ˆæ¯çš„åŠŸèƒ½ï¼Œç”Ÿäº§è€…å¯¹è±¡è¦ä½¿ç”¨&lt;code&gt;TransactionMQProducer&lt;/code&gt;è¿›è¡Œå£°æ˜ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void main(String[] args) throws MQClientException {
    // åˆ›å»º TransactionMQProducer å®ä¾‹ï¼Œå¹¶è®¾ç½®ç”Ÿäº§è€…ç»„å
    TransactionMQProducer producer = new TransactionMQProducer(&amp;quot;transactionGroup&amp;quot;);
    // è®¾ç½® NameServer åœ°å€
    producer.setNamesrvAddr(&amp;quot;127.0.0.1:9876&amp;quot;);

    // æ·»åŠ äº‹åŠ¡ç›‘å¬å™¨
    producer.setTransactionListener(new TransactionListener() {
        /**
         * æ‰§è¡Œæœ¬åœ°äº‹åŠ¡çš„æ–¹æ³•
         */
        @Override
        public LocalTransactionState executeLocalTransaction(Message message, Object o) {
            // æ‰§è¡Œæœ¬åœ°äº‹åŠ¡
            doXXX();
            // è¿”å›æ‰§è¡Œç»“æœ
            return LocalTransactionState.xxx;
        }

        /**
         * æ¶ˆæ¯å›æŸ¥æ‰§è¡Œçš„æ–¹æ³•
         */
        @Override
        public LocalTransactionState checkLocalTransaction(MessageExt messageExt) {
			// å›æŸ¥äº‹åŠ¡çŠ¶æ€
            findxxx();
            // æ¶ˆæ¯æ¥å›æŸ¥çš„æ—¶å€™ï¼Œè¿›è¡Œæäº¤äº‹åŠ¡
            return LocalTransactionState.xxx;
        }
    });

    // å¯åŠ¨producer
    producer.start();
}

// å‘é€æ¶ˆæ¯
SendResult result = producer.sendMessageInTransaction(msg, null);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å’Œæ™®é€šæ¶ˆæ¯ä¸åŒï¼Œåœ¨37è¡Œä¸­ä½¿ç”¨&lt;code&gt;sendMessageIntransaction()&lt;/code&gt;æ–¹æ³•å‘é€äº‹åŠ¡æ–¹æ³•ï¼Œé‚£ä¹ˆå‘é€çš„é€»è¾‘è‚¯å®šéƒ½åœ¨è¿™ä¸ªæ–¹æ³•ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
public TransactionSendResult sendMessageInTransaction(final Message msg, final Object arg) throws MQClientException {
    // æœ¬åœ°äº‹åŠ¡å¤„ç†é€»è¾‘å¿…é¡»è¦å…ˆå®šä¹‰å¥½
    if (null == this.transactionListener) {
        throw new MQClientException(&amp;quot;TransactionListener is null&amp;quot;, null);
    }

    // å¯¹topicè¿›è¡ŒåŒ…è£…,é™„å¸¦å»¶è¿Ÿã€é‡è¯•æ ‡è®°
    msg.setTopic(NamespaceUtil.wrapNamespace(this.getNamespace(), msg.getTopic()));
    return this.defaultMQProducerImpl.sendMessageInTransaction(msg, null, arg);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿›å…¥&lt;code&gt;sendMessageInTransaction()&lt;/code&gt;æ–¹æ³•, æˆ‘ä»¬ä¸»è¦å…³æ³¨æ–¹æ³•çš„å‰åŠéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public TransactionSendResult sendMessageInTransaction(final Message msg, final LocalTransactionExecuter localTransactionExecuter, final Object arg) throws MQClientException {
    TransactionListener transactionListener = getCheckListener();
    if (null == localTransactionExecuter &amp;amp;&amp;amp; null == transactionListener) {
        throw new MQClientException(&amp;quot;tranExecutor is null&amp;quot;, null);
    }

    // ignore DelayTimeLevel parameter
    if (msg.getDelayTimeLevel() != 0) {
        MessageAccessor.clearProperty(msg, MessageConst.PROPERTY_DELAY_TIME_LEVEL);
    }
    Validators.checkMessage(msg, this.defaultMQProducer);

    SendResult sendResult;
    // ç»™æ¶ˆæ¯æ‰“ä¸ŠTRAN_MSGæ ‡è®°,æ ‡è®°ä¸ºäº‹åŠ¡æ¶ˆæ¯
    MessageAccessor.putProperty(msg, MessageConst.PROPERTY_TRANSACTION_PREPARED, &amp;quot;true&amp;quot;);
    // æ ‡è®°ç”Ÿäº§è€…ç»„çš„ç›®çš„æ˜¯brokerè¿›è¡Œå›æŸ¥æ—¶éœ€è¦
    MessageAccessor.putProperty(msg, MessageConst.PROPERTY_PRODUCER_GROUP, this.defaultMQProducer.getProducerGroup());
    try {
        // å‘é€halfæ¶ˆæ¯
        sendResult = this.send(msg);
    } catch (Exception e) {
        throw new MQClientException(&amp;quot;send message Exception&amp;quot;, e);
    }
    
    // ç•¥
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ä»£ç é‡Œç»™æ¶ˆæ¯æ·»åŠ äº†ä¸¤ä¸ªå±æ€§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PROPERTY_TRANSACTION_PREPARED : æ ‡è®°ä¸ºäº‹åŠ¡æ¶ˆæ¯ï¼Œbrokerå¯ä»¥æ ¹æ®msgæ˜¯å¦æœ‰è¯¥å­—æ®µæ¥åˆ¤æ–­æ˜¯å¦æ˜¯äº‹åŠ¡æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;PROPERTY_PRODUCER_GROUP : ç”Ÿäº§è€…ç»„ï¼Œè¿™ä¸ªåœ¨brokerè¿›è¡Œäº‹åŠ¡ç»“æœå›æŸ¥æ—¶å€™éœ€è¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨å¯¹æ¶ˆæ¯è¿›è¡Œç‰¹æ®ŠåŒ…è£…å˜æˆäº‹åŠ¡æ¶ˆæ¯åï¼Œè°ƒç”¨çš„&lt;code&gt;send()&lt;/code&gt;æ–¹æ³•å°±æ˜¯é€šç”¨çš„æ¶ˆæ¯å‘é€æ–¹æ³•äº†ï¼Œæ‰€æœ‰æ¶ˆæ¯éƒ½æ˜¯é€šè¿‡è¿™ä¸ªæ–¹æ³•è¿›è¡Œå‘é€çš„ã€‚&lt;/p&gt;
&lt;h1 id=&#34;broker-å¤„ç†-half-æ¶ˆæ¯&#34;&gt;Broker å¤„ç† Half æ¶ˆæ¯&lt;/h1&gt;
&lt;p&gt;åœ¨ broker/src/main/java/org/apache/rocketmq/broker/processor/SendMessageProcessor.java ç±»ä¸­ï¼Œ&lt;code&gt;asyncSendMessage()&lt;/code&gt;æ–¹æ³•ä¸­æœ‰ä¸€æ®µä»£ç ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;...
// è·å–äº‹åŠ¡å±æ€§å­—æ®µ
String transFlag = origProps.get(MessageConst.PROPERTY_TRANSACTION_PREPARED);
// åˆ¤æ–­æ˜¯å¦ä¸ºç©º &amp;amp;&amp;amp; å€¼ä¸ºtrue
if (transFlag != null &amp;amp;&amp;amp; Boolean.parseBoolean(transFlag)) {
  if (this.brokerController.getBrokerConfig().isRejectTransactionMessage()) {
    response.setCode(ResponseCode.NO_PERMISSION);
    response.setRemark(&amp;quot;the broker[&amp;quot; + this.brokerController.getBrokerConfig().getBrokerIP1() + &amp;quot;] sending transaction message is forbidden&amp;quot;);
    return CompletableFuture.completedFuture(response);
  }
  // å­˜å‚¨prepareæ¶ˆæ¯
  putMessageResult = this.brokerController.getTransactionalMessageService().asyncPrepareMessage(msgInner);
} else {
  // å­˜å‚¨æ™®é€šæ¶ˆæ¯
  putMessageResult = this.brokerController.getMessageStore().asyncPutMessage(msgInner);
}
...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;çœ‹çœ‹å¦‚æœå¤„ç†prepareæ¶ˆæ¯çš„ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
public CompletableFuture&amp;lt;PutMessageResult&amp;gt; asyncPrepareMessage(MessageExtBrokerInner messageInner) {
    return transactionalMessageBridge.asyncPutHalfMessage(messageInner);  //1 è°ƒç”¨asyncPutHalfMessage()æ–¹æ³•
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;asyncPrepareMessage()&lt;/code&gt;è°ƒç”¨&lt;code&gt;asyncPutHalfMessage()&lt;/code&gt;æ–¹æ³•&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public CompletableFuture&amp;lt;PutMessageResult&amp;gt; asyncPutHalfMessage(MessageExtBrokerInner messageInner) {
    return store.asyncPutMessage(parseHalfMessageInner(messageInner));
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;store.asyncPutMessage()&lt;/code&gt;å°±æ˜¯é€šç”¨çš„æ–¹æ³•ï¼Œæ™®é€šæ¶ˆæ¯çš„å­˜å‚¨ä¹Ÿæ˜¯ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥halfæ¶ˆæ¯çš„ç‰¹æ®Šå¤„ç†åœ¨&lt;code&gt;parseHalfMessageInner()&lt;/code&gt;ä¸­&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private MessageExtBrokerInner parseHalfMessageInner(MessageExtBrokerInner msgInner) {
    // å¤‡ä»½æ¶ˆæ¯çš„åŸä¸»é¢˜å’ŒåŸé˜Ÿåˆ—ID
    MessageAccessor.putProperty(msgInner, MessageConst.PROPERTY_REAL_TOPIC, msgInner.getTopic());
    MessageAccessor.putProperty(msgInner, MessageConst.PROPERTY_REAL_QUEUE_ID, String.valueOf(msgInner.getQueueId()));
    msgInner.setSysFlag(MessageSysFlag.resetTransactionValue(msgInner.getSysFlag(), MessageSysFlag.TRANSACTION_NOT_TYPE));
    // äº‹åŠ¡æ¶ˆæ¯çš„topicå’ŒqueueIDæ˜¯å†™æ­»å›ºå®šçš„
    msgInner.setTopic(TransactionalMessageUtil.buildHalfTopic());
    msgInner.setQueueId(0);
    msgInner.setPropertiesString(MessageDecoder.messageProperties2String(msgInner.getProperties()));
    return msgInner;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åˆ†ä¸ºä¸¤éƒ¨åˆ†é€»è¾‘&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¤‡ä»½åŸæœ‰çš„topicå’ŒqueueIdï¼Œå°†æ¶ˆæ¯çœŸæ­£çš„topicæ”¾åœ¨&lt;code&gt;REAL_TOPIC&lt;/code&gt;å±æ€§ä¸­ï¼ŒqueueIdæ”¾åœ¨&lt;code&gt;REAL_QID&lt;/code&gt;å±æ€§ä¸­&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨äº‹åŠ¡ä¸“ç”¨çš„topicå’ŒqueueIdè¦†ç›–æ—§å€¼ï¼Œtopic = &lt;code&gt;RMQ_SYS_TRANS_HALF_TOPIC&lt;/code&gt;,queueId = 0ã€‚è¿™æ ·æ„å‘³ç€æ‰€æœ‰çš„halfæ¶ˆæ¯éƒ½ä¼šå­˜åœ¨åŒä¸€ä¸ªtopicé˜Ÿåˆ—ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;ç–‘é—®è§£ç­”&#34;&gt;ç–‘é—®è§£ç­”&lt;/h1&gt;
&lt;p&gt;ç°åœ¨å¯ä»¥å›ç­”ä¹‹å‰çš„ç–‘æƒ‘äº†&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;producer å¦‚ä½•å‘é€ half æ¶ˆæ¯çš„ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç­”ï¼šRocketMQå¯¹äºäº‹åŠ¡æ¶ˆæ¯ï¼Œä½¿ç”¨äº†ä¸“é—¨çš„Producerå¯¹è±¡&lt;code&gt;TransactionMQProducer&lt;/code&gt;ï¼Œè¿™ä¸ªproducerçš„å‘é€æ¶ˆæ¯çš„æ–¹æ³•æŠŠæ¶ˆæ¯åŒ…è£…æˆäº‹åŠ¡æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;broker åˆæ˜¯å¦‚ä½•åŒºåˆ†æ™®é€šæ¶ˆæ¯å’Œäº‹åŠ¡æ¶ˆæ¯çš„&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç­”ï¼šåœ¨æ¶ˆæ¯å‘é€çš„æ—¶å€™ï¼Œåœ¨æ¶ˆæ¯çš„ &lt;code&gt;property&lt;/code&gt;é‡Œæ·»åŠ &lt;code&gt;PROPERTY_TRANSACTION_PREPARED&lt;/code&gt;æ ‡è®°ï¼Œbrokeræ ¹æ®å’Œè¿™ä¸ªæ ‡è®°æ¥åŒºåˆ†æ™®é€šæ¶ˆæ¯å’Œäº‹åŠ¡æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;halfæ¶ˆæ¯ä¸ä¼šè¢«Consumeræ¶ˆè´¹ï¼Œæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç­”ï¼šæ¶ˆæ¯ç»è¿‡ç‰¹æ®Šå¤„ç†ï¼Œéƒ½è¢«åˆ†é…åˆ°ç‰¹æœ‰çš„topicé˜Ÿåˆ—ä¸­ï¼Œè¢«éš”ç¦»äº†ã€‚è¿™æ ·æ¶ˆè´¹è€…å°±æ— æ³•è·å–åˆ°è¿™äº›æ¶ˆæ¯äº†ã€‚&lt;/p&gt;
">RocketMQ4.9.1æºç åˆ†æ_(äº‹åŠ¡) HalfåŠæ¶ˆæ¯å¤„ç†</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/rocketmq491-yuan-ma-fen-xi-_shi-wu-broker-ding-shi-hui-cha/"" data-c="
          &lt;h1 id=&#34;å¯åŠ¨ä»»åŠ¡&#34;&gt;å¯åŠ¨ä»»åŠ¡&lt;/h1&gt;
&lt;p&gt;broker/src/main/java/org/apache/rocketmq/broker/transaction/queue/TransactionalMessageServiceImpl.javaç±»ä¸­ã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
public void run() {
    log.info(&amp;quot;Start transaction check service thread!&amp;quot;);
    long checkInterval = brokerController.getBrokerConfig().getTransactionCheckInterval();  // é»˜è®¤å€¼ä¸º60000ï¼Œå³60s
    while (!this.isStopped()) {
        this.waitForRunning(checkInterval);
    }
    log.info(&amp;quot;End transaction check service thread!&amp;quot;);
}

@Override
protected void onWaitEnd() {
    long timeout = brokerController.getBrokerConfig().getTransactionTimeOut();
    int checkMax = brokerController.getBrokerConfig().getTransactionCheckMax();
    long begin = System.currentTimeMillis();
    log.info(&amp;quot;Begin to check prepare message, begin time:{}&amp;quot;, begin);
    // è°ƒç”¨chekcæ–¹æ³•
    this.brokerController.getTransactionalMessageService().check(timeout, checkMax, this.brokerController.getTransactionalMessageCheckListener());
    log.info(&amp;quot;End to check prepare message, consumed time:{}&amp;quot;, System.currentTimeMillis() - begin);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œé‡‡ç”¨äº†æ¨¡æ¿è®¾è®¡æ¨¡å¼ï¼Œé‡å†™äº†&lt;code&gt;run()&lt;/code&gt;å’Œ&lt;code&gt;onWaitEnd()&lt;/code&gt;ä¸¤ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­å¯ä»¥çœ‹åˆ°&lt;code&gt;onWaitEnd()&lt;/code&gt;æ–¹æ³•ä¸­è°ƒç”¨äº†&lt;code&gt;check()&lt;/code&gt;æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨å“ªé‡Œè°ƒç”¨äº†è¿™ä¸ªonWaitEnd()æ–¹æ³•å‘¢ï¼Ÿçœ‹ä¸‹&lt;code&gt;waitForRunning()&lt;/code&gt;æ–¹æ³•ï¼Œåœ¨&lt;code&gt;src/main/java/org/apache/rocketmq/common/ServiceThread.java&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;protected void waitForRunning(long interval) {
    if (hasNotified.compareAndSet(true, false)) {
        // è°ƒç”¨å­ç±»é‡å†™çš„é€»è¾‘
        this.onWaitEnd();
        return;
    }

    //entry to wait
    waitPoint.reset();

    try {
        // ç­‰å¾…
        waitPoint.await(interval, TimeUnit.MILLISECONDS);
    } catch (InterruptedException e) {
        log.error(&amp;quot;Interrupted&amp;quot;, e);
    } finally {
        hasNotified.set(false);
        this.onWaitEnd();
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ€»ç»“å°±æ˜¯ä»¥é»˜è®¤60sçš„é—´éš”æ‰§è¡Œä¸€æ¬¡check()æ–¹æ³•ï¼Œcheck()æ–¹æ³•å°±æ˜¯å®šæ—¶å›æŸ¥æ–¹æ³•ï¼Œä¸‹é¢çœ‹ä¸‹ã€‚&lt;/p&gt;
&lt;h1 id=&#34;check-æµç¨‹&#34;&gt;check æµç¨‹&lt;/h1&gt;
&lt;p&gt;broker/src/main/java/org/apache/rocketmq/broker/transaction/queue/TransactionalMessageServiceImpl.javaç±»ä¸­,å…ˆçœ‹ä¸‹å…¨éƒ¨çš„ä»£ç ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
    public void check(long transactionTimeout, int transactionCheckMax, AbstractTransactionalMessageCheckListener listener) {
        try {
            // å®šä¹‰topicä¸º&amp;quot;RMQ_SYS_TRANS_HALF_TOPIC&amp;quot;
            String topic = TopicValidator.RMQ_SYS_TRANS_HALF_TOPIC;
            // è·å–halfé˜Ÿåˆ—
            Set&amp;lt;MessageQueue&amp;gt; msgQueues = transactionalMessageBridge.fetchMessageQueues(topic);
            if (msgQueues == null || msgQueues.size() == 0) {
                log.warn(&amp;quot;The queue of topic is empty :&amp;quot; + topic);
                return;
            }
            log.debug(&amp;quot;Check topic={}, queues={}&amp;quot;, topic, msgQueues);
            for (MessageQueue messageQueue : msgQueues) {
                long startTime = System.currentTimeMillis();
                // è·å–opQueue
                MessageQueue opQueue = getOpQueue(messageQueue);
                // è·å–halfé˜Ÿåˆ—çš„æ¶ˆè´¹offset
                long halfOffset = transactionalMessageBridge.fetchConsumeOffset(messageQueue);
                // è·å–opé˜Ÿåˆ—çš„offset
                long opOffset = transactionalMessageBridge.fetchConsumeOffset(opQueue);
                log.info(&amp;quot;Before check, the queue={} msgOffset={} opOffset={}&amp;quot;, messageQueue, halfOffset, opOffset);
                if (halfOffset &amp;lt; 0 || opOffset &amp;lt; 0) {
                    log.error(&amp;quot;MessageQueue: {} illegal offset read: {}, op offset: {},skip this queue&amp;quot;, messageQueue, halfOffset, opOffset);
                    continue;
                }

                List&amp;lt;Long/*å¤„ç†è¿‡å¾—opQueueçš„offset*/&amp;gt; doneOpOffset = new ArrayList&amp;lt;&amp;gt;();
                HashMap&amp;lt;Long/*halfQueue offset*/, Long/*opQueue offset*/&amp;gt; removeMap = new HashMap&amp;lt;&amp;gt;();  //å­˜å‚¨å·²ç»å¤„ç†è¿‡,ä½†è¿˜æœªæ·»åŠ åˆ°doneOpOffsetä¸­çš„æ¶ˆæ¯
                // å°†å·²å¤„ç†ä½†æœªæ›´æ–°çš„æ¶ˆæ¯ä¿å­˜åˆ°removeMapä¸­ï¼Œåç»­è¿›è¡Œåˆ¤æ–­æ—¶éœ€è¦
                PullResult pullResult = fillOpRemoveMap(removeMap, opQueue, opOffset, halfOffset, doneOpOffset);
                if (null == pullResult) {
                    log.error(&amp;quot;The queue={} check msgOffset={} with opOffset={} failed, pullResult is null&amp;quot;, messageQueue, halfOffset, opOffset);
                    continue;
                }
                int getMessageNullCount = 1;  //è·å–ç©ºæ¶ˆæ¯çš„æ¬¡æ•°
                long newOffset = halfOffset;  //å½“å‰å¤„ç†halfé˜Ÿåˆ—çš„æœ€æ–°è¿›åº¦
                long i = halfOffset; //å½“å‰å¤„ç†æ¶ˆæ¯çš„halfé˜Ÿåˆ—åç§»é‡
                while (true) {
                    // æ£€æŸ¥å½“å‰ä»»åŠ¡çš„æ—¶é—´ç‰‡æ˜¯å¦ç”¨å®Œ
                    if (System.currentTimeMillis() - startTime &amp;gt; MAX_PROCESS_TIME_LIMIT) {
                        log.info(&amp;quot;Queue={} process time reach max={}&amp;quot;, messageQueue, MAX_PROCESS_TIME_LIMIT);
                        break;
                    }
                    // å¦‚æœhalfæ¶ˆæ¯å·²ç»è¢«å¤„ç†è¿‡,ç»§ç»­å¤„ç†ä¸‹ä¸€æ¡æ¶ˆæ¯
                    if (removeMap.containsKey(i)) {
                        log.debug(&amp;quot;Half offset {} has been committed/rolled back&amp;quot;, i);
                        Long removedOpOffset = removeMap.remove(i);
                        doneOpOffset.add(removedOpOffset);
                    } else {
                        // æ ¹æ®halfé˜Ÿåˆ—æ¶ˆè´¹offsetè·å–æ¶ˆæ¯
                        GetResult getResult = getHalfMsg(messageQueue, i);
                        MessageExt msgExt = getResult.getMsg();
                        if (msgExt == null) {
                            // æ˜¯å¦æœ€å¤§é‡è¯•æ¬¡æ•°
                            if (getMessageNullCount++ &amp;gt; MAX_RETRY_COUNT_WHEN_HALF_NULL) {
                                break;
                            }
                            if (getResult.getPullResult().getPullStatus() == PullStatus.NO_NEW_MSG) {
                                log.debug(&amp;quot;No new msg, the miss offset={} in={}, continue check={}, pull result={}&amp;quot;, i, messageQueue, getMessageNullCount, getResult.getPullResult());
                                break;
                            } else {
                                log.info(&amp;quot;Illegal offset, the miss offset={} in={}, continue check={}, pull result={}&amp;quot;, i, messageQueue, getMessageNullCount, getResult.getPullResult());
                                i = getResult.getPullResult().getNextBeginOffset();
                                newOffset = i;
                                continue;
                            }
                        }

                        // å¦‚æœè¶…è¿‡å­˜å‚¨æ—¶é—´(é»˜è®¤3å¤©)æˆ–è€…è¶…è¿‡å›æŸ¥æ—¶é—´(é»˜è®¤15æ¬¡)
                        if (needDiscard(msgExt, transactionCheckMax) || needSkip(msgExt)) {
                            listener.resolveDiscardMsg(msgExt);
                            newOffset = i + 1;
                            i++;
                            continue;
                        }

                        // å¦‚æœå­˜å‚¨æ—¶é—´å¤§äºå¼€å§‹æ—¶é—´ï¼Œä¸å¤„ç†
                        if (msgExt.getStoreTimestamp() &amp;gt;= startTime) {
                            log.debug(&amp;quot;Fresh stored. the miss offset={}, check it later, store={}&amp;quot;, i, new Date(msgExt.getStoreTimestamp()));
                            break;
                        }

                        long valueOfCurrentMinusBorn = System.currentTimeMillis() - msgExt.getBornTimestamp();  //æ¶ˆæ¯å·²å­˜å‚¨æ—¶é—´
                        long checkImmunityTime = transactionTimeout; //ç«‹å³æ£€æµ‹äº‹åŠ¡æ¶ˆæ¯çš„æ—¶é—´
                        String checkImmunityTimeStr = msgExt.getUserProperty(MessageConst.PROPERTY_CHECK_IMMUNITY_TIME_IN_SECONDS); //è·å–æ¶ˆæ¯çš„æœ€æ™šå›æŸ¥æ—¶é—´
                        if (null != checkImmunityTimeStr) {
                            checkImmunityTime = getImmunityTime(checkImmunityTimeStr, transactionTimeout);
                            // å¦‚æœæœªåˆ°å›æŸ¥æ—¶é—´ï¼Œä¸å¤„ç†
                            if (valueOfCurrentMinusBorn &amp;lt; checkImmunityTime) {
                                if (checkPrepareQueueOffset(removeMap, doneOpOffset, msgExt)) {
                                    newOffset = i + 1;
                                    i++;
                                    continue;
                                }
                            }
                        } else {
                            if ((0 &amp;lt;= valueOfCurrentMinusBorn) &amp;amp;&amp;amp; (valueOfCurrentMinusBorn &amp;lt; checkImmunityTime)) {
                                log.debug(&amp;quot;New arrived, the miss offset={}, check it later checkImmunity={}, born={}&amp;quot;, i, checkImmunityTime, new Date(msgExt.getBornTimestamp()));
                                break;
                            }
                        }

                        // è·å–æ¶ˆæ¯åˆ—è¡¨
                        List&amp;lt;MessageExt&amp;gt; opMsg = pullResult.getMsgFoundList();
                        // åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œå›æŸ¥
                        boolean isNeedCheck = (opMsg == null &amp;amp;&amp;amp; valueOfCurrentMinusBorn &amp;gt; checkImmunityTime) || (opMsg != null &amp;amp;&amp;amp; (opMsg.get(opMsg.size() - 1).getBornTimestamp() - startTime &amp;gt; transactionTimeout)) || (valueOfCurrentMinusBorn &amp;lt;= -1);
                        if (isNeedCheck) {
                            // æ¶ˆæ¯é‡æ–°putåˆ°halfQueueä¸­
                            if (!putBackHalfMsgQueue(msgExt, i)) {
                                continue;
                            }
                            // æ‰§è¡Œå›æŸ¥
                            listener.resolveHalfMsg(msgExt);
                        } else {
                            pullResult = fillOpRemoveMap(removeMap, opQueue, pullResult.getNextBeginOffset(), halfOffset, doneOpOffset);
                            log.debug(&amp;quot;The miss offset:{} in messageQueue:{} need to get more opMsg, result is:{}&amp;quot;, i, messageQueue, pullResult);
                            continue;
                        }
                    }
                    newOffset = i + 1;
                    i++;
                }
                if (newOffset != halfOffset) {
                    // æ›´æ–°halfQueueæ¶ˆè´¹è¿›åº¦
                    transactionalMessageBridge.updateConsumeOffset(messageQueue, newOffset);
                }
                long newOpOffset = calculateOpOffset(doneOpOffset, opOffset);
                if (newOpOffset != opOffset) {
                    // æ›´æ–°opQueueæ¶ˆè´¹è¿›åº¦
                    transactionalMessageBridge.updateConsumeOffset(opQueue, newOpOffset);
                }
            }
        } catch (Throwable e) {
            log.error(&amp;quot;Check error&amp;quot;, e);
        }

    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä»£ç å¤ªå¤šäº†ï¼Œä¸€ä¸ªä¸ªæ‹†è§£åˆ†æï¼š&lt;/p&gt;
&lt;h2 id=&#34;è·å–halfé˜Ÿåˆ—&#34;&gt;è·å–halfé˜Ÿåˆ—&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;// å®šä¹‰topicä¸º&amp;quot;RMQ_SYS_TRANS_HALF_TOPIC&amp;quot;
String topic = TopicValidator.RMQ_SYS_TRANS_HALF_TOPIC;
// è·å–halfé˜Ÿåˆ—
Set&amp;lt;MessageQueue&amp;gt; msgQueues = transactionalMessageBridge.fetchMessageQueues(topic);
if (msgQueues == null || msgQueues.size() == 0) {
    log.warn(&amp;quot;The queue of topic is empty :&amp;quot; + topic);
    return;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨rocketmqä¸­ï¼Œæ‰€æœ‰äº‹åŠ¡æ¶ˆæ¯ä¼šä¿å­˜åœ¨ä¸¤ä¸ªtopicé˜Ÿåˆ—ä¸­ï¼Œåˆ†åˆ«æ˜¯&lt;code&gt;RMQ_SYS_TRANS_HALF_TOPIC&lt;/code&gt;ï¼ˆç®€ç§°halfQueueï¼‰å’Œ&lt;code&gt;RMQ_SYS_TRANS_OP _HALF _TOPIC&lt;/code&gt;ï¼ˆç®€ç§°opQueueï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RMQ_SYS_TRANS _HALF _TOPIC : ä¿å­˜ half æ¶ˆæ¯&lt;/li&gt;
&lt;li&gt;RMQ_SYS_TRANS_OP _HALF _TOPIC : å½“ halfæ¶ˆæ¯æ”¶åˆ° commit/rollback åï¼Œä¼šä¿å­˜åˆ°opQueueä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å®šä¹‰åç§»é‡&#34;&gt;å®šä¹‰åç§»é‡&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;// å¼€å§‹æ—¶é—´
long startTime = System.currentTimeMillis();
// è·å–opQueue
MessageQueue opQueue = getOpQueue(messageQueue);
// è·å–halfé˜Ÿåˆ—çš„æ¶ˆè´¹offset
long halfOffset = transactionalMessageBridge.fetchConsumeOffset(messageQueue);
// è·å–opé˜Ÿåˆ—çš„offset
long opOffset = transactionalMessageBridge.fetchConsumeOffset(opQueue);
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;startTime : ä½œç”¨æ˜¯è®°å½•å½“å‰æ—¶é—´ï¼Œåç»­åœ¨åˆ¤æ–­ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´æ—¶éœ€è¦&lt;/li&gt;
&lt;li&gt;opQueue : å³&lt;code&gt;RMQ_SYS_TRANS_OP_HALF_TOPIC&lt;/code&gt;é˜Ÿåˆ—ï¼Œä¿å­˜å·²å¤„ç†è¿‡çš„æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;halfOffset ï¼š halfQueue ä¸­çš„æ¶ˆè´¹è®°å½•ä½ç½®ï¼Œå¯ä»¥ä¿è¯çš„halfOffsetä¹‹åçš„æ¶ˆæ¯æ‰éœ€è¦è¿›è¡Œå›æŸ¥æ“ä½œ&lt;/li&gt;
&lt;li&gt;opOffset : opQueueä¸­çš„æ¶ˆè´¹è®°å½•ï¼Œå¤§äºopOffsetçš„æ¶ˆæ¯å°±æ˜¯è·ç¦»ä¸Šæ¬¡å®šæ—¶å›æŸ¥ä»»åŠ¡ç»“æŸåï¼Œè¿™æ®µæ—¶é—´æ–°å¢çš„æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ ‡è®°å·²å¤„ç†æ¶ˆæ¯&#34;&gt;æ ‡è®°å·²å¤„ç†æ¶ˆæ¯&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;List&amp;lt;Long/*å¤„ç†è¿‡å¾—opQueueçš„offset*/&amp;gt; doneOpOffset = new ArrayList&amp;lt;&amp;gt;();
HashMap&amp;lt;Long/*halfQueue offset*/, Long/*opQueue offset*/&amp;gt; removeMap = new HashMap&amp;lt;&amp;gt;();  //å­˜å‚¨å·²ç»å¤„ç†è¿‡,ä½†è¿˜æœªæ·»åŠ åˆ°doneOpOffsetä¸­çš„æ¶ˆæ¯
// å°†å·²å¤„ç†ä½†æœªæ›´æ–°çš„æ¶ˆæ¯ä¿å­˜åˆ°removeMapä¸­ï¼Œåç»­è¿›è¡Œåˆ¤æ–­æ—¶éœ€è¦
PullResult pullResult = fillOpRemoveMap(removeMap, opQueue, opOffset, halfOffset, doneOpOffset);
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;doneOpOffset: ä¿å­˜opQueueä¸­å·²ç»å¤„ç†è¿‡å¾—æ¶ˆæ¯çš„offsetï¼Œåç»­æ›´æ–°opQueueçš„offsetæ—¶å€™è¦ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;removeMap : ä¿å­˜å·²ç»ä¿å­˜åˆ°opQueueä¸­ï¼Œä½†ä»åœ¨halfQueueä¸­çš„æ¶ˆæ¯ï¼Œåç»­åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦éœ€è¦å›æŸ¥æ—¶çš„ä¾æ®ä¹‹ä¸€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;fillopremove&#34;&gt;fillOpRemove()&lt;/h3&gt;
&lt;p&gt;æ–¹æ³•çš„ç›®çš„å°±æ˜¯å¡«å……å·²å¤„ç†çš„æ¶ˆæ¯åˆ° removeMap&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private PullResult fillOpRemoveMap(HashMap&amp;lt;Long, Long&amp;gt; removeMap, MessageQueue opQueue, long pullOffsetOfOp, long miniOffset, List&amp;lt;Long&amp;gt; doneOpOffset) {
    // step1 : è·å–opæ¶ˆæ¯,æ‹‰å–32æ¡æ¶ˆæ¯
    PullResult pullResult = pullOpMsg(opQueue, pullOffsetOfOp, 32);
    if (null == pullResult) {
        return null;
    }
    // step2 : åˆ¤æ–­çŠ¶æ€
    if (pullResult.getPullStatus() == PullStatus.OFFSET_ILLEGAL || pullResult.getPullStatus() == PullStatus.NO_MATCHED_MSG) {
        log.warn(&amp;quot;The miss op offset={} in queue={} is illegal, pullResult={}&amp;quot;, pullOffsetOfOp, opQueue, pullResult);
        transactionalMessageBridge.updateConsumeOffset(opQueue, pullResult.getNextBeginOffset());
        return pullResult;
    } else if (pullResult.getPullStatus() == PullStatus.NO_NEW_MSG) { //æ²¡æœ‰æ–°æ¶ˆæ¯
        log.warn(&amp;quot;The miss op offset={} in queue={} is NO_NEW_MSG, pullResult={}&amp;quot;, pullOffsetOfOp, opQueue, pullResult);
        return pullResult;
    }
    List&amp;lt;MessageExt&amp;gt; opMsg = pullResult.getMsgFoundList();
    if (opMsg == null) {
        log.warn(&amp;quot;The miss op offset={} in queue={} is empty, pullResult={}&amp;quot;, pullOffsetOfOp, opQueue, pullResult);
        return pullResult;
    }
    // step3 : éå†æ‰€æœ‰æ¶ˆæ¯
    for (MessageExt opMessageExt : opMsg) {
        // è·å–opQueueçš„offset
        Long queueOffset = getLong(new String(opMessageExt.getBody(), TransactionalMessageUtil.charset));
        log.debug(&amp;quot;Topic: {} tags: {}, OpOffset: {}, HalfOffset: {}&amp;quot;, opMessageExt.getTopic(), opMessageExt.getTags(), opMessageExt.getQueueOffset(), queueOffset);
        if (TransactionalMessageUtil.REMOVETAG.equals(opMessageExt.getTags())) {
            if (queueOffset &amp;lt; miniOffset) {
                // æ­£å¸¸æƒ…å†µï¼ŒopQueueé‡Œçš„æ¶ˆæ¯åœ¨halfQueueä¸­offsetè¦å°äºå½“å‰halfQueueçš„offset
                doneOpOffset.add(opMessageExt.getQueueOffset());
            } else {
                // æ¶ˆæ¯å·²ç»å­˜å‚¨åˆ°opQueueä¸­ï¼Œä½†æ˜¯halfQueueä¸­çš„offsetè¿˜æ²¡æœ‰æ›´æ–°
                // ä¿å­˜åˆ°removeMapä¸­ï¼Œé˜²æ­¢åç»­é‡å¤è¿›è¡Œå›æŸ¥æ“ä½œ
                removeMap.put(queueOffset, opMessageExt.getQueueOffset());
            }
        } else {
            log.error(&amp;quot;Found a illegal tag in opMessageExt= {} &amp;quot;, opMessageExt);
        }
    }
    log.debug(&amp;quot;Remove map: {}&amp;quot;, removeMap);
    log.debug(&amp;quot;Done op list: {}&amp;quot;, doneOpOffset);
    return pullResult;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å®šä¹‰å˜é‡&#34;&gt;å®šä¹‰å˜é‡&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;int getMessageNullCount = 1;  //è·å–ç©ºæ¶ˆæ¯çš„æ¬¡æ•°
long newOffset = halfOffset;  //å½“å‰å¤„ç†halfé˜Ÿåˆ—çš„æœ€æ–°è¿›åº¦
long i = halfOffset; //å½“å‰å¤„ç†æ¶ˆæ¯çš„halfé˜Ÿåˆ—åç§»é‡
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;getMessageNullCount : rocketMQå…è®¸è¿›è¡Œé‡è¯•ï¼Œè¯¥å­—æ®µæ˜¯é‡è¯•æ¬¡æ•°åˆ¤æ–­çš„ä¾æ®&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åˆ¤æ–­æ˜¯å¦æ»¡è¶³å›æŸ¥æ¡ä»¶&#34;&gt;åˆ¤æ–­æ˜¯å¦æ»¡è¶³å›æŸ¥æ¡ä»¶&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;// æ£€æŸ¥å½“å‰ä»»åŠ¡çš„æ—¶é—´ç‰‡æ˜¯å¦ç”¨å®Œ
if (System.currentTimeMillis() - startTime &amp;gt; MAX_PROCESS_TIME_LIMIT) {
    log.info(&amp;quot;Queue={} process time reach max={}&amp;quot;, messageQueue, MAX_PROCESS_TIME_LIMIT);
    break;
}
// å¦‚æœhalfæ¶ˆæ¯å·²ç»è¢«å¤„ç†è¿‡,ç»§ç»­å¤„ç†ä¸‹ä¸€æ¡æ¶ˆæ¯
if (removeMap.containsKey(i)) {
    log.debug(&amp;quot;Half offset {} has been committed/rolled back&amp;quot;, i);
    Long removedOpOffset = removeMap.remove(i);
    doneOpOffset.add(removedOpOffset);
} else {
    // æ ¹æ®halfé˜Ÿåˆ—æ¶ˆè´¹offsetè·å–æ¶ˆæ¯
    GetResult getResult = getHalfMsg(messageQueue, i);
    MessageExt msgExt = getResult.getMsg();
    if (msgExt == null) {
        // æ˜¯å¦æœ€å¤§é‡è¯•æ¬¡æ•°
        if (getMessageNullCount++ &amp;gt; MAX_RETRY_COUNT_WHEN_HALF_NULL) {
            break;
        }
        if (getResult.getPullResult().getPullStatus() == PullStatus.NO_NEW_MSG) {
            log.debug(&amp;quot;No new msg, the miss offset={} in={}, continue check={}, pull result={}&amp;quot;, i, messageQueue, getMessageNullCount, getResult.getPullResult());
            break;
        } else {
            log.info(&amp;quot;Illegal offset, the miss offset={} in={}, continue check={}, pull result={}&amp;quot;, i, messageQueue, getMessageNullCount, getResult.getPullResult());
            i = getResult.getPullResult().getNextBeginOffset();
            newOffset = i;
            continue;
        }
    }

    // å¦‚æœè¶…è¿‡å­˜å‚¨æ—¶é—´(é»˜è®¤3å¤©)æˆ–è€…è¶…è¿‡å›æŸ¥æ—¶é—´(é»˜è®¤15æ¬¡)
    if (needDiscard(msgExt, transactionCheckMax) || needSkip(msgExt)) {
        listener.resolveDiscardMsg(msgExt);
        newOffset = i + 1;
        i++;
        continue;
    }

    // å¦‚æœå­˜å‚¨æ—¶é—´å¤§äºå¼€å§‹æ—¶é—´ï¼Œä¸å¤„ç†
    if (msgExt.getStoreTimestamp() &amp;gt;= startTime) {
        log.debug(&amp;quot;Fresh stored. the miss offset={}, check it later, store={}&amp;quot;, i, new Date(msgExt.getStoreTimestamp()));
        break;
    }

    long valueOfCurrentMinusBorn = System.currentTimeMillis() - msgExt.getBornTimestamp();  //æ¶ˆæ¯å·²å­˜å‚¨æ—¶é—´
    long checkImmunityTime = transactionTimeout; //ç«‹å³æ£€æµ‹äº‹åŠ¡æ¶ˆæ¯çš„æ—¶é—´
    String checkImmunityTimeStr = msgExt.getUserProperty(MessageConst.PROPERTY_CHECK_IMMUNITY_TIME_IN_SECONDS); //è·å–æ¶ˆæ¯çš„æœ€æ™šå›æŸ¥æ—¶é—´
    if (null != checkImmunityTimeStr) {
        checkImmunityTime = getImmunityTime(checkImmunityTimeStr, transactionTimeout);
        // å¦‚æœæœªåˆ°å›æŸ¥æ—¶é—´ï¼Œä¸å¤„ç†
        if (valueOfCurrentMinusBorn &amp;lt; checkImmunityTime) {
            if (checkPrepareQueueOffset(removeMap, doneOpOffset, msgExt)) {
                newOffset = i + 1;
                i++;
                continue;
            }
        }
    } else {
        if ((0 &amp;lt;= valueOfCurrentMinusBorn) &amp;amp;&amp;amp; (valueOfCurrentMinusBorn &amp;lt; checkImmunityTime)) {
            log.debug(&amp;quot;New arrived, the miss offset={}, check it later checkImmunity={}, born={}&amp;quot;, i, checkImmunityTime, new Date(msgExt.getBornTimestamp()));
            break;
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä»»åŠ¡æ—¶é—´ç‰‡æœºåˆ¶ï¼šåœ¨rocketmqä¸­ï¼Œæœ‰ä¸€ç§é€šç”¨çš„è®¾è®¡æ–¹æ¡ˆå°±æ˜¯ç»™ä»»åŠ¡åˆ†é…æ—¶é—´ç‰‡ï¼Œ å¦‚æœæ—¶é—´ç‰‡ç”¨å®Œåˆ™ç›´æ¥é€€å‡ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ‰§è¡Œå›æŸ¥&#34;&gt;æ‰§è¡Œå›æŸ¥&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;// è·å–æ¶ˆæ¯åˆ—è¡¨
List&amp;lt;MessageExt&amp;gt; opMsg = pullResult.getMsgFoundList();
// åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œå›æŸ¥
boolean isNeedCheck = (opMsg == null &amp;amp;&amp;amp; valueOfCurrentMinusBorn &amp;gt; checkImmunityTime) || (opMsg != null &amp;amp;&amp;amp; (opMsg.get(opMsg.size() - 1).getBornTimestamp() - startTime &amp;gt; transactionTimeout)) || (valueOfCurrentMinusBorn &amp;lt;= -1);
if (isNeedCheck) {
    // æ¶ˆæ¯é‡æ–°putåˆ°halfQueueä¸­
    if (!putBackHalfMsgQueue(msgExt, i)) {
        continue;
    }
    // æ‰§è¡Œå›æŸ¥
    listener.resolveHalfMsg(msgExt);
} else {
    pullResult = fillOpRemoveMap(removeMap, opQueue, pullResult.getNextBeginOffset(), halfOffset, doneOpOffset);
    log.debug(&amp;quot;The miss offset:{} in messageQueue:{} need to get more opMsg, result is:{}&amp;quot;, i, messageQueue, pullResult);
    continue;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…¶ä¸­æ¯”è¾ƒé‡è¦çš„ä¸¤ä¸ªéƒ¨åˆ†ï¼Œ&lt;code&gt;putBackHalfMsgQueue()&lt;/code&gt;å’Œ&lt;code&gt;resolveHalfMsg()&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;putbackhalfmsgqueue&#34;&gt;putBackHalfMsgQueue()&lt;/h3&gt;
&lt;p&gt;è¿™é‡Œæ¶ˆæ¯ä¼šé‡å†™è¿½åŠ åˆ°commitlogä¸­ï¼Œè®¾è®¡å·§å¦™ä¹‹å¤„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å‘é€å›æŸ¥çš„æ¥å£æ˜¯å¼‚æ­¥çš„ï¼Œå°†æ¶ˆæ¯é‡å†™è¿½åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œä¸‹ä¸€æ¬¡å›æŸ¥çš„æ—¶å€™è¿˜èƒ½è·å–åˆ°è¯¥æ¶ˆæ¯ã€‚å¦‚æœå›æŸ¥æœ‰ç»“æœï¼Œæ¶ˆæ¯å°±ä¼šä¿å­˜åˆ°opQueueä¸­ï¼Œè¿™æ ·ä¹Ÿä¼šåœ¨fillOpRemove()ä¸­è¢«è¿‡æ»¤æ‰ï¼Œä¸å½±å“ã€‚&lt;/li&gt;
&lt;li&gt;æ¯æ¬¡è¿›è¡Œå›æŸ¥æ¶ˆæ¯éƒ½è¦ä¿®æ”¹æ¶ˆæ¯çš„å›æŸ¥æ¬¡æ•°å±æ€§ï¼Œä½¿ç”¨é¡ºåºå†™çš„æ€§èƒ½è¦é«˜äºä¿®æ”¹å·²å­˜å‚¨æ¶ˆæ¯çš„æ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private boolean putBackHalfMsgQueue(MessageExt msgExt, long offset) {
    // å†æ¬¡å°†æ¶ˆæ¯å­˜å‚¨åˆ°commitlogä¸­
    PutMessageResult putMessageResult = putBackToHalfQueueReturnResult(msgExt);
    // å­˜å‚¨æˆåŠŸä¿®æ”¹æ¶ˆæ¯çš„å±æ€§
    if (putMessageResult != null &amp;amp;&amp;amp; putMessageResult.getPutMessageStatus() == PutMessageStatus.PUT_OK) {
        // è®¾ç½®æ–°çš„æ¶ˆè´¹é˜Ÿåˆ—é€»è¾‘offset
        msgExt.setQueueOffset(putMessageResult.getAppendMessageResult().getLogicsOffset());
        // è®¾ç½®æ–°çš„commitlogçš„offset
        msgExt.setCommitLogOffset(putMessageResult.getAppendMessageResult().getWroteOffset());
        // è®¾ç½®æ–°çš„msgId
        msgExt.setMsgId(putMessageResult.getAppendMessageResult().getMsgId());
        log.debug(&amp;quot;Send check message, the offset={} restored in queueOffset={} &amp;quot; + &amp;quot;commitLogOffset={} &amp;quot; + &amp;quot;newMsgId={} realMsgId={} topic={}&amp;quot;, offset, msgExt.getQueueOffset(), msgExt.getCommitLogOffset(), msgExt.getMsgId(), msgExt.getUserProperty(MessageConst.PROPERTY_UNIQ_CLIENT_MESSAGE_ID_KEYIDX), msgExt.getTopic());
        return true;
    } else {
        log.error(&amp;quot;PutBackToHalfQueueReturnResult write failed, topic: {}, queueId: {}, &amp;quot; + &amp;quot;msgId: {}&amp;quot;, msgExt.getTopic(), msgExt.getQueueId(), msgExt.getMsgId());
        return false;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ›´æ–°ç´¢å¼•&#34;&gt;æ›´æ–°ç´¢å¼•&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;if (newOffset != halfOffset) {
    // æ›´æ–°halfQueueæ¶ˆè´¹è¿›åº¦
    transactionalMessageBridge.updateConsumeOffset(messageQueue, newOffset);
}
// æ ¹æ®doneOpOffset åˆ—è¡¨è·å–opQueueçš„offset
long newOpOffset = calculateOpOffset(doneOpOffset, opOffset);
if (newOpOffset != opOffset) {
    // æ›´æ–°opQueueæ¶ˆè´¹è¿›åº¦
    transactionalMessageBridge.updateConsumeOffset(opQueue, newOpOffset);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;calculateOpOffset()&lt;/code&gt;æ–¹æ³•ç®€å•è¯´è¿”å›å°±æ˜¯doneOffsetåˆ—è¡¨ä¸­æœ€åä¸€ä¸ªå€¼ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private long calculateOpOffset(List&amp;lt;Long&amp;gt; doneOffset, long oldOffset) {
    Collections.sort(doneOffset);
    long newOffset = oldOffset;
    for (int i = 0; i &amp;lt; doneOffset.size(); i++) {
        if (doneOffset.get(i) == newOffset) {
            newOffset++;
        } else {
            break;
        }
    }
    return newOffset;

}
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c075a3fc1d8440d5abf8ad13e2622179~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
">RocketMQ4.9.1æºç åˆ†æ_(äº‹åŠ¡)brokerå®šæ—¶å›æŸ¥</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/shou-xie-shi-xian-java-stream/"" data-c="
          &lt;p&gt;é¡¹ç›®åœ°å€ï¼š&lt;a href=&#34;https://github.com/zexho994/River&#34;&gt;https://github.com/zexho994/River&lt;/a&gt;&lt;br&gt;
å®ç°ç›®æ ‡ï¼šæ”¯æŒå’ŒJDK Streamä¸€æ ·çš„åŠŸèƒ½, æä¾›ä¸Streamä¸€æ ·çš„APIï¼Œåç»­ä¼šè¿›è¡Œæ›´å¤šçš„APIæ‰©å±•ã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æ–¹æ³•&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;åˆ›å»ºæ“ä½œ&lt;/td&gt;
&lt;td&gt;of(T...t)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä¸­é—´æ“ä½œ&lt;/td&gt;
&lt;td&gt;map()limit()sort()peek()skip()filter()distinct()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç»ˆç»“æ“ä½œ&lt;/td&gt;
&lt;td&gt;toArray()reduce()collect()max()anyMatch()findFirst()ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;åŒæ—¶Riverè¿˜éœ€è¦å…·å¤‡å»¶è¿Ÿå¤„ç†ï¼ˆé‡åˆ°ç»ˆç»“æ“ä½œæ‰è§¦å‘ï¼‰çš„ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é¡¶å±‚æ¥å£-river&#34;&gt;é¡¶å±‚æ¥å£-River&lt;/h2&gt;
&lt;p&gt;åœ¨riveræ¥å£ä¸­å®šä¹‰å¥½æ‰€æœ‰éœ€è¦æ”¯æŒçš„æ–¹æ³•api&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public interface River&amp;lt;E&amp;gt; {

    //===============================åˆ›å»ºæ“ä½œ=====================================

    @SafeVarargs
    static &amp;lt;T&amp;gt; River&amp;lt;T&amp;gt; of(T... t) {
        return RiverGenerator.create(t);
    }

    static &amp;lt;T&amp;gt; River&amp;lt;T&amp;gt; of(Collection&amp;lt;T&amp;gt; collection) {
        return RiverGenerator.create(collection);
    }

    //===============================ä¸­é—´æ“ä½œ=====================================

    /**
     * å°†æµè½¬æ¢ä¸ºå¹¶è¡Œæµ
     *
     * @return River
     */
    River&amp;lt;E&amp;gt; parallel();

    /**
     * å°†æµè½¬æ¢ä¸ºä¸²è¡Œæµ
     *
     * @return River
     */
    River&amp;lt;E&amp;gt; sequential();

    /**
     * è¿‡æ»¤æ“ä½œ
     *
     * @param predicate è¿‡æ»¤çš„è¡¨è¾¾å¼
     * @return è¿‡æ»¤åçš„River
     */
    River&amp;lt;E&amp;gt; filter(Predicate&amp;lt;E&amp;gt; predicate);

    /**
     * å…ƒç´ å»é‡æ“ä½œ
     *
     * @return å»é‡åçš„River
     */
    River&amp;lt;E&amp;gt; distinct();

    /**
     * é™åˆ¶Riverçš„å…ƒç´ æ•°é‡
     *
     * @param size å…ƒç´ çš„æœ€å¤§æ•°é‡
     * @return River
     */
    River&amp;lt;E&amp;gt; limit(int size);

    /**
     * æ’åº
     *
     * @param comparable æ¯”è¾ƒå™¨
     * @return æ·»åŠ æ’åºåçš„River
     */
    River&amp;lt;E&amp;gt; sort(Comparator&amp;lt;E&amp;gt; comparable);

    /**
     * å¯¹å…ƒç´ è¿›è¡Œé¢„æ“ä½œ
     *
     * @param consumer æ‰§è¡Œçš„æ“ä½œ
     * @return æ–°River
     */
    River&amp;lt;E&amp;gt; peek(Consumer&amp;lt;E&amp;gt; consumer);

    /**
     * è·³è¿‡æŒ‡å®šæ•°é‡çš„å…ƒç´ 
     *
     * @param size è¦è·³è¿‡çš„å…ƒç´ æ•°
     * @return new River
     */
    River&amp;lt;E&amp;gt; skip(int size);

    /**
     * å…ƒç´ è½¬æ¢æ˜ å°„
     *
     * @param function æ˜ å°„æ‰§è¡Œé€»è¾‘
     * @return new River
     */
    &amp;lt;E_OUT&amp;gt; River&amp;lt;E_OUT&amp;gt; map(Function&amp;lt;? super E, ? extends E_OUT&amp;gt; function);

    //===============================ç»ˆç»“æ“ä½œ=====================================

    /**
     * éå†Riveræ‰€æœ‰å…ƒç´ 
     *
     * @param consumer è¡¨è¾¾å¼
     */
    void forEach(Consumer&amp;lt;E&amp;gt; consumer);

    /**
     * è¾“å‡ºä¸€ä¸ªæ•°ç»„
     *
     * @return Eç±»å‹çš„æ•°ç»„
     */
    Object[] toArray();

    /**
     * è¾“å‡ºå…ƒç´ åˆ°å‚æ•°æ•°ç»„ä¸­
     *
     * @param e æ‰¿è½½å…ƒç´ çš„æ•°ç»„
     */
    void toArray(E[] e);

    /**
     * è®¡ç®—å…ƒç´ çš„æ•°é‡
     *
     * @return Riverä¸­å…ƒç´ çš„æ•°é‡
     */
    long count();

    /**
     * æ“ä½œ
     *
     * @param identity    åˆå§‹å€¼
     * @param accumulator æ“ä½œå‡½æ•°
     * @return reduce result
     */
    E reduce(E identity, BinaryOperator&amp;lt;E&amp;gt; accumulator);

    /**
     * æ‰§è¡Œæ“ä½œ
     *
     * @param collector æ‰§è¡Œæ“ä½œçš„æ”¶é›†å™¨
     * @param &amp;lt;R&amp;gt;       ç»“æœç±»å‹
     * @param &amp;lt;A&amp;gt;       ä¸­é—´ç´¯åŠ ç±»å‹
     * @return æ‰§è¡Œç»“æœ
     */
    &amp;lt;R, A&amp;gt; R collect(Collector&amp;lt;? super E, A, R&amp;gt; collector);

    /**
     * è·å–æ¯”è¾ƒåï¼Œæœ€å°çš„å…ƒç´ 
     *
     * @param comparator æ¯”è¾ƒå™¨
     * @return æœ€å°çš„å…ƒç´ 
     */
    Optional&amp;lt;E&amp;gt; min(Comparator&amp;lt;? super E&amp;gt; comparator);

    /**
     * è·å–æ¯”è¾ƒåï¼Œæœ€å¤§çš„å…ƒç´ 
     *
     * @param comparator æ¯”è¾ƒå™¨
     * @return æœ€å¤§çš„å…ƒç´ 
     */
    Optional&amp;lt;E&amp;gt; max(Comparator&amp;lt;? super E&amp;gt; comparator);

    /**
     * åˆ¤æ–­åŒ¹é…ï¼Œä»»æ„å³å¯
     *
     * @param predicate
     * @return true:match success
     */
    boolean anyMatch(Predicate&amp;lt;? super E&amp;gt; predicate);

    /**
     * åˆ¤æ–­åŒ¹é…ï¼Œæ‰€æœ‰éƒ½è¦åŒ¹é…
     *
     * @param predicate
     * @return
     */
    boolean allMatch(Predicate&amp;lt;? super E&amp;gt; predicate);

    /**
     * åˆ¤æ–­åŒ¹é…ï¼Œéƒ½ä¸è¦åŒ¹é…ä¸Š
     *
     * @param predicate
     * @return
     */
    boolean noneMatch(Predicate&amp;lt;? super E&amp;gt; predicate);

    /**
     * è·å–ç¬¬ä¸€ä¸ªå…ƒç´ 
     *
     * @return
     */
    Optional&amp;lt;E&amp;gt; findFirst();

}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;riverå®ç°ç±»-abstractriverpipeline&#34;&gt;Riverå®ç°ç±» - AbstractRiverPipeline&lt;/h2&gt;
&lt;p&gt;Riveræ¥å£çš„å®ç°ä¸»è¦éƒ½åœ¨&lt;code&gt;AbstractRiverPipeline&lt;/code&gt;ç±»ä¸­, ä»¥&lt;code&gt;filter()&lt;/code&gt;ä¸ºä¾‹ï¼Œè¿”å›äº†ä¸€ä¸ªæ–°çš„Riverå¯¹è±¡ï¼Œå…¸å‹çš„æµå¼ç¼–ç¨‹çš„å®ç°æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;æ–¹æ³•äº‹æƒ…ä¸»è¦ä¸¤ä¸ªï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;newä¸€ä¸ªæ–°çš„Riverçš„å®ç°ç±»ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨&lt;code&gt;accept()&lt;/code&gt;æ–¹æ³•ä¸­å®ç°&lt;code&gt;wrapSink()&lt;/code&gt;,è¿™ä¸ªæ–¹æ³•åœ¨åç»­æ„å»º&lt;code&gt;SinkChain&lt;/code&gt;æ—¶å€™éœ€è¦è°ƒç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class AbstractRiverPipeline&amp;lt;I, O&amp;gt;
        extends Pipeline&amp;lt;I, O&amp;gt; implements River&amp;lt;O&amp;gt; {
    
    //å­˜å‚¨å…ƒç´ çš„spliteratorå¯¹è±¡å¼•ç”¨
    protected Spliterator sourceSpliterator;

    ...
        
    /**
     * è¿½åŠ filteræ“ä½œ
     * åˆ›å»ºä¸€ä¸ªfilterçš„{@link PipelineStage},ç„¶åå°†è¯¥stageè¿½åˆ°åˆ°Pipelineçš„å°¾éƒ¨
     *
     * @param predicate è¿‡æ»¤çš„è¡¨è¾¾å¼
     * @return æ–°å¢çš„filterå¯¹è±¡
     */
    @Override
    public River&amp;lt;O&amp;gt; filter(Predicate&amp;lt;O&amp;gt; predicate) {
        return new PipelineStage&amp;lt;O, O&amp;gt;(this) {
            @Override
            public SinkChain&amp;lt;O, O&amp;gt; wrapSink(SinkChain&amp;lt;O, ?&amp;gt; sink) {
                SinkChain&amp;lt;O, O&amp;gt; sinkChain = new SinkChain&amp;lt;O, O&amp;gt;() {
                    @Override
                    public void accept(O t) {
                        if (!predicate.test(t)) {
                            return;
                        }
                        getNext().accept(t);
                    }
                };
                sinkChain.setNext(sink);
                return sinkChain;
            }
        };
    }
    
    ...
        
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿”å›çš„å¯¹è±¡æ˜¯&lt;code&gt;PipelineStage&lt;/code&gt;ï¼Œæ˜¯Riverçš„å­ç±»ï¼Œæ‰©å±•äº†ä¸€äº›äºSinkç›¸å…³çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é˜¶æ®µå°è£…-pipelinestage&#34;&gt;é˜¶æ®µå°è£…-PipelineStage&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;PipelineStage&lt;/code&gt;è¡¨ç¤ºä¸€ä¸ªé˜¶æ®µï¼Œä»€ä¹ˆæ˜¯é˜¶æ®µï¼Ÿè°ƒç”¨filter()åï¼Œå°±ç›¸å½“æ•´ä¸ªé“¾ä¸­æ·»åŠ äº†ä¸€ä¸ªé˜¶æ®µï¼Œå¯ä»¥ç†è§£ä¸ºé“¾è¡¨ä¸­çš„èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class PipelineStage&amp;lt;I, O&amp;gt; extends AbstractRiverPipeline&amp;lt;I, O&amp;gt; {

    public PipelineStage(Spliterator&amp;lt;I&amp;gt; spliterator) {
        this.setSourceSpliterator(spliterator);
        this.isParallel = false;
    }

    /**
     * @param river ä¸Šä¸€ä¸ªstage
     */
    public PipelineStage(AbstractRiverPipeline&amp;lt;?, I&amp;gt; river) {
        previous = river;
        isParallel = river.isParallel;
        sourceSpliterator = river.sourceSpliterator;
    }

    public Object[] getArray() {
        throw new UnsupportedOperationException(&amp;quot;to override&amp;quot;);
    }

    public Object getState() {
        throw new UnsupportedOperationException(&amp;quot;to override&amp;quot;);
    }

    public void setState(O s) {
    }

    @Override
    public PipelineStage&amp;lt;I, O&amp;gt; clone() {
        throw new UnsupportedOperationException(&amp;quot;to override&amp;quot;);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸è¿‡stageä¸­åŸºäºå‰é©±æŒ‡é’ˆpreviousé“¾æ¥çš„ï¼Œæ‰€ä»¥åç»­wrapSinkæ—¶å€™ä¹Ÿæ˜¯ï¼Œä¹Ÿæ˜¯ä»å°¾åˆ°å¤´çš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾æˆ‘ä»¬çš„ä»£ç æ˜¯è¿™æ ·&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;River.of(1,2,3).filter().distinct()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;of()æ“ä½œç”Ÿæˆç¬¬ä¸€ä¸ªstageï¼Œfilter()æ“ä½œç”Ÿæˆç¬¬äºŒä¸ªstageï¼Œdistinct()æ“ä½œç”Ÿæˆç¬¬ä¸‰ä¸ªstageã€‚æ•´ä½“çœ‹ä¸‹æ¥å°±æ˜¯è¿™æ ·ï¼š&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f92d0302e7b640c9a65d8ad5b70fdaab~tplv-k3u1fbpfcp-watermark.image?&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;headé˜¶æ®µç”Ÿæˆ-rivergenerator&#34;&gt;Headé˜¶æ®µç”Ÿæˆ-RiverGenerator&lt;/h2&gt;
&lt;p&gt;headæ˜¯æŒ‡ç¬¬ä¸€ä¸ªRiverå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸ºstage0ã€‚Riveræ¥å£ä¸­é»˜è®¤å®ç°äº†of()æ–¹æ³•ï¼Œè°ƒç”¨çš„å°±æ˜¯&lt;code&gt;RiverGenerator.create()&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static &amp;lt;E&amp;gt; River&amp;lt;E&amp;gt; create(E... e) {
    Spliterator&amp;lt;E&amp;gt; spliterator = Arrays.spliterator(e);
    PipelineStage&amp;lt;E, E&amp;gt; head = new PipelineStage&amp;lt;E, E&amp;gt;(spliterator) {
        @Override
        public SinkChain&amp;lt;E, E&amp;gt; wrapSink(SinkChain&amp;lt;E, ?&amp;gt; sink) {
            SinkChain&amp;lt;E, E&amp;gt; sinkChain = new SinkChain&amp;lt;E, E&amp;gt;() {
                @Override
                public void accept(E t) {
                    next.accept(t);
                }
            };
            sinkChain.setNext(sink);
            return sinkChain;
        }
    };
    head.setSourceSpliterator(spliterator);
    return head;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æµçš„å¤„ç†é“¾-sinkchain&#34;&gt;æµçš„å¤„ç†é“¾-SinkChain&lt;/h2&gt;
&lt;p&gt;ä»»ä½•æ—¶å€™ï¼Œåœ¨è°ƒç”¨ç»ˆç»“æ“ä½œä¹‹å‰ï¼Œä¸€åˆ‡æ“ä½œéƒ½åªæ˜¯é€šè¿‡stageé“¾è¿æ¥åœ¨ä¸€èµ·ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œä»»ä½•å®é™…çš„å¤„ç†æ“ä½œï¼Œè¿™å°±éœ€è¦ä¸€ä¸ªå¼€å…³æ¥å¯åŠ¨æµï¼Œè¿™ä¸ªå¼€å…³æ”¾åœ¨äº†æ‰€æœ‰ç»ˆç»“æ“ä½œä¸­,çœ‹ä¸‹&lt;code&gt;AbstractRiverPipeline.forEach()&lt;/code&gt;æ–¹æ³•&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
    public void forEach(Consumer&amp;lt;O&amp;gt; consumer) {
        PipelineStage&amp;lt;O, O&amp;gt; stage = new PipelineStage&amp;lt;O, O&amp;gt;(this) {
            @Override
            public SinkChain&amp;lt;O, O&amp;gt; wrapSink(SinkChain&amp;lt;O, ?&amp;gt; sink) {
                return new SinkChain&amp;lt;O, O&amp;gt;() {
                    @Override
                    public void accept(O t) {
                        consumer.accept(t);
                    }
                };
            }
        };
        // å¯åŠ¨æµçš„å¼€å…³
        evaluate(stage);
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;evaluate()&lt;/code&gt;ä¸»è¦åšä¸¤ä»¶äº‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å°†æ‰€æœ‰stageåŒ…è£…æˆ&lt;code&gt;SinkChain&lt;/code&gt;ã€‚ï¼ˆå¯¹ç›¸å…³åè¯æ¦‚å¿µä¸æ¸…æ¥šçš„å¯ä»¥çœ‹ä¹‹å‰çš„Streamæºç è§£ææ–‡ç« ï¼‰&lt;/li&gt;
&lt;li&gt;å¯åŠ¨æµï¼Œå¯¹æ‰€æœ‰å…ƒç´ è¿›è¡Œå¤„ç†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private void evaluate(PipelineStage&amp;lt;?, O&amp;gt; stage) {
    //æ„å»ºå¤„ç†é“¾
    SinkChain&amp;lt;O, O&amp;gt; sinkHead = warpPipeline(stage);

    //å¼€å§‹å¤„ç†
    sinkHead.begin(-1);
    //éå†å…ƒç´ 
    sinkHead.getSourceSpliterator().forEachRemaining(sinkHead);
    sinkHead.end();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;åŒ…è£…-wrappipeline&#34;&gt;åŒ…è£… - wrapPipeline&lt;/h3&gt;
&lt;p&gt;é¡ºåºæ˜¯ä»å°¾åˆ°å¤´è¿›è¡Œçš„ï¼Œè¿”å›çš„sinkæ˜¯ç¬¬ä¸€ä¸ªé˜¶æ®µã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private SinkChain&amp;lt;O, O&amp;gt; warpPipeline(AbstractRiverPipeline river) {
    SinkChain&amp;lt;O, O&amp;gt; sink = null;
    for (; river != null; river = river.previous) {
        sink = river.wrapSink(sink);
    }
    return sink;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œçš„&lt;code&gt;wrapSink()&lt;/code&gt;çš„é€»è¾‘å¯¹åº”çš„å°±æ˜¯&lt;code&gt;AbstractRiverPipeline&lt;/code&gt;ä¸­é‡å†™çš„é€»è¾‘&lt;/p&gt;
&lt;p&gt;è¿™æ ·è¿”å›çš„å¯¹è±¡å°±æ˜¯ä¸€æ¡sinké“¾äº†ï¼Œå¹¶ä¸”é“¾ä¸­æ¯ä¸€ä¸ªsinkéƒ½æœ‰è‡ªå·±çš„&lt;code&gt;begin()&lt;/code&gt;ã€&lt;code&gt;accept()&lt;/code&gt;ã€&lt;code&gt;end()&lt;/code&gt;æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æµçš„è¿è¡Œæµç¨‹&#34;&gt;æµçš„è¿è¡Œæµç¨‹&lt;/h3&gt;
&lt;p&gt;evaluateç¬¬äºŒéƒ¨åˆ†çš„å·¥ä½œæ˜¯è¿è¡Œæµ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆè°ƒç”¨&lt;code&gt;begin()&lt;/code&gt;æ–¹æ³•ï¼Œä»å¤´åˆ°å°¾æ‰§è¡Œä¸€éæ‰€æœ‰å¯¹è±¡çš„&lt;code&gt;begin()&lt;/code&gt;æ–¹æ³•ï¼Œä¸»è¦ä½œç”¨æ˜¯è¿›è¡Œåˆå§‹åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;forEachRemaining&lt;/code&gt;çš„ä½œç”¨å°±æ˜¯å¯¹æ•°æ®æºspliteratorå…ƒç´ æ‰§è¡Œ&lt;code&gt;accept()&lt;/code&gt;æ–¹æ³•ï¼Œå¯ä»¥ä»å¤´å€’å°¾ä¸€ä¸ªä¸ªæ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;æœ€åè°ƒç”¨&lt;code&gt;end()&lt;/code&gt;æ–¹æ³•ï¼Œä»å¤´åˆ°å°¾æ‰§è¡Œä¸€éï¼Œä¸»è¦ç›®çš„æ˜¯æ•°æ®çš„æƒ…å†µï¼Œå­—æ®µè®¾ä¸ºnullç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¾ç„¶ç”¨ä¸Šé¢çš„&lt;code&gt;filter()&lt;/code&gt;æ–¹æ³•å’Œ&lt;code&gt;distinct()&lt;/code&gt;ä¸ºä¾‹:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
public River&amp;lt;O&amp;gt; filter(Predicate&amp;lt;O&amp;gt; predicate) {
    return new PipelineStage&amp;lt;O, O&amp;gt;(this) {
        @Override
        public SinkChain&amp;lt;O, O&amp;gt; wrapSink(SinkChain&amp;lt;O, ?&amp;gt; sink) {
            SinkChain&amp;lt;O, O&amp;gt; sinkChain = new SinkChain&amp;lt;O, O&amp;gt;() {
                @Override
                public void accept(O t) {
                    // å¦‚æœä¸ç¬¦åˆè¦æ±‚ï¼Œä¸å†å‘åä¼ é€’è¯¥å…ƒç´ ï¼Œè¯¥å…ƒç´ çš„å¤„ç†åˆ°æ­¤ä¸ºæ­¢
                    if (!predicate.test(t)) {
                        return;
                    }
                    //å¦‚ä½•è¦æ±‚åˆ™è°ƒç”¨ä¸‹ä¸€ä¸ªsinkçš„accept()æ–¹æ³•
                    getNext().accept(t);
                }
            };
            sinkChain.setNext(sink);
            return sinkChain;
        }
    };
}

@Override
public River&amp;lt;O&amp;gt; distinct() {
    return new PipelineStage&amp;lt;O, O&amp;gt;(this) {
        @Override
        public SinkChain&amp;lt;O, O&amp;gt; wrapSink(SinkChain&amp;lt;O, ?&amp;gt; sink) {
            SinkChain&amp;lt;O, O&amp;gt; sinkChain = new SinkChain&amp;lt;O, O&amp;gt;() {
                private HashSet&amp;lt;O&amp;gt; set;

                @Override
                public void begin(int n) {
                    //æ‰§è¡Œåˆå§‹åŒ–å·¥ä½œ
                    this.set = new HashSet&amp;lt;&amp;gt;(n &amp;gt; 0 ? n : 16);
                    //è°ƒç”¨ä¸‹ä¸€ä¸ªsinkçš„begin()æ–¹æ³•
                    super.begin(n);
                }

                @Override
                public void end() {
                    this.set = null;
                    super.end();
                }

                @Override
                public void accept(O t) {
                    if (!set.add(t)) {
                        return;
                    }
                    getNext().accept(t);
                }
            };
            sinkChain.setNext(sink);
            return sinkChain;
        }
    };
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æ–‡ç« åªæ˜¯åˆ—ä¸¾äº†ä¸€äº›å…³é”®æ­¥éª¤çš„è®¾è®¡ä¸å®ç°ï¼Œè®¾è®¡çš„æ€è·¯å¤§å¤šæ•°æ¥æºäºJDK Streamçš„æºç ï¼Œå¦‚ä½•å®ç°ä¸€ä¸ªStreamï¼Œä¸»è¦çš„ç›®çš„æ˜¯å¯ä»¥æ›´å¥½çš„ç†è§£Streamä¸€äº›åœ°æ–¹ä¸ºä»€ä¹ˆè¦é‚£ä¹ˆè®¾è®¡ï¼Œå› ä¸ºåªæœ‰åœ¨è‡ªå·±å¼€å‘çš„æ—¶å€™æ‰èƒ½ä½“ä¼šåˆ°è®¾è®¡çš„ç²¾å¦™ã€‚&lt;/p&gt;
&lt;p&gt;é¡¹ç›®çš„æºç åœ¨githubï¼Œæµ‹è¯•ä»£ç åœ¨teståŒ…ä¸‹ï¼Œç›®å‰åªæ”¯æŒä¸²è¡Œæµï¼Œåç»­ä¼šæ·»åŠ å¹¶è¡Œæµçš„æ”¯æŒï¼Œå¹¶ä¸”æä¾›æ›´å¤šçš„APIï¼Œè®©Riverå¯ä»¥è¿›è¡Œæ›´å¤šæ›´å¼ºå¤§çš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;é¡¹ç›®åœ°å€ï¼š&lt;a href=&#34;https://github.com/zexho994/River&#34;&gt;https://github.com/zexho994/River&lt;/a&gt;&lt;/p&gt;
">æ‰‹å†™å®ç° Java Stream</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/shen-ru-jie-xi-java-parallel-stream/"" data-c="
          &lt;h2 id=&#34;æå‡ºç–‘é—®&#34;&gt;æå‡ºç–‘é—®&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚ä½•è½¬æ¢æµç±»å‹ï¼Œæ€ä¹ˆå®ç°çš„ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•åˆ‡åˆ†ä»»åŠ¡çš„ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•åˆå¹¶ä»»åŠ¡ç»“æœçš„ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;ä»»åŠ¡åˆ‡åˆ†&#34;&gt;ä»»åŠ¡åˆ‡åˆ†&lt;/h2&gt;
&lt;p&gt;å¹¶è¡Œæµçš„åº•å±‚æ‰§è¡Œæ˜¯åŸºäºForkJoinæ¡†æ¶çš„ï¼Œäº†è§£çš„éƒ½çŸ¥é“ForkJoinæ¡†æ¶è¦æ‰§è¡Œçš„ä»»åŠ¡é€»è¾‘éœ€è¦ä½¿ç”¨è€…é‡å†™ï¼Œé‡å†™å†…å®¹åŒ…æ‹¬å¦‚æœåˆ‡åˆ†ä»»åŠ¡ï¼Œæ‰€ä»¥å»çœ‹ForkJoinTaskçš„å®ç°å­ç±»å¦‚ä½•å®ç°Compute()æ–¹æ³•å°±å¯ä»¥çŸ¥é“å¦‚ä½•è¿›è¡Œä»»åŠ¡åˆ‡åˆ†çš„ã€‚&lt;br&gt;
åœ¨AbstractTaskç±»ä¸­å®ç°äº†æ ¸å¿ƒæ–¹æ³•ã€‚&lt;br&gt;
&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ec498e18d90a4c11bb046b48ce762f02~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å…¶ä¸­æœ€æ ¸å¿ƒçš„æ–¹æ³•æ˜¯compute()æ–¹æ³•ï¼Œå®šä¹‰äº†è®¡ç®—ç®—æ³•çš„é€»è¾‘ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;    /**
    * å†³å®šæ˜¯å¦è¿›ä¸€æ­¥æ‹†åˆ†ä¸€ä¸ªä»»åŠ¡æˆ–ç›´æ¥è®¡ç®—å®ƒã€‚
    * å¦‚æœç›´æ¥è®¡ç®—,è°ƒç”¨doLeafå¹¶å°†ç»“æœä¼ é€’ç»™setRawResultã€‚
    * å¦åˆ™å°±æ‹†åˆ†å­ä»»åŠ¡ï¼Œåˆ†å‰ä¸€ä¸ªï¼Œç»§ç»­ä½œä¸ºå¦ä¸€ä¸ªã€‚
	* è¯¥æ–¹æ³•çš„ç»“æ„æ˜¯ä¸ºäº†åœ¨ä¸€ç³»åˆ—çš„ä½¿ç”¨ä¸­èŠ‚çº¦èµ„æºã€‚å¾ªç¯åœ¨åˆ†è£‚æ—¶ç»§ç»­è¿›è¡Œå…¶ä¸­ä¸€ä¸ªå­ä»»åŠ¡ï¼Œ
    * ä»¥é¿å…æ·±åº¦é€’å½’ã€‚ä¸ºäº†åº”å¯¹å¯èƒ½ç³»ç»Ÿæ€§åœ°åå‘äºå·¦é‡æˆ–å³é‡æ‹†åˆ†çš„æ‹†åˆ†å™¨ï¼Œæˆ‘ä»¬åœ¨å¾ªç¯ä¸­äº¤æ›¿ä½¿ç”¨å“ªä¸ªå­ä»»åŠ¡è¢«åˆ†å‰æˆ–ç»§ç»­ã€‚
    **/
    @Override
    public void compute() {
        Spliterator&amp;lt;P_IN&amp;gt; rs = spliterator, ls; // right, left spliterators
        //ä¼°è®¡rsçš„å…ƒç´ æ•°é‡
        long sizeEstimate = rs.estimateSize();
        //è·å–å¤§å°é˜ˆå€¼
        long sizeThreshold = getTargetSize(sizeEstimate);
        //
        boolean forkRight = false;
        @SuppressWarnings(&amp;quot;unchecked&amp;quot;) K task = (K) this;
        // åˆ¤æ–­æ¡ä»¶
        // 1. å…ƒç´ æ•°é‡ &amp;gt; é˜ˆå€¼
        // 2. rså¯ä»¥è¿›è¡Œåˆ‡å‰²
        while (sizeEstimate &amp;gt; sizeThreshold &amp;amp;&amp;amp; (ls = rs.trySplit()) != null) {
            K leftChild, rightChild, taskToFork;
            // ä½¿ç”¨ls,rsæ„é€ ä¸¤ä¸ªæ–°çš„ä»»åŠ¡
            task.leftChild  = leftChild = task.makeChild(ls);
            task.rightChild = rightChild = task.makeChild(rs);
            //è®¾ç½®ç­‰å¾…æ•°é‡ä¸º1
            task.setPendingCount(1);
            
            // è½®æµæ‰§è¡Œå·¦/å³ä¸¤ä¸ªä»»åŠ¡
            if (forkRight) {
                forkRight = false;
                rs = ls;
                task = leftChild;
                taskToFork = rightChild;// rightChild.fork()
            }
            else { 
                forkRight = true;
                task = rightChild;
                taskToFork = leftChild;//leftChild.fork()
            }
            // é€’å½’
            taskToFork.fork();
            sizeEstimate = rs.estimateSize();
        }
        task.setLocalResult(task.doLeaf());
        task.tryComplete();
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æœ¬è´¨ä¸Šç†è§£ï¼Œå°±æ˜¯å°†ä¸€ä¸ªSpliteratorè¿›è¡Œåˆ‡åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œç„¶åä¸¤éƒ¨åˆ†å†è¿›è¡Œåˆ‡åˆ†ï¼Œç›´åˆ°while()æ¡ä»¶æ— æ³•å†æ»¡è¶³ï¼Œç„¶åå¯¹è¯¥éƒ¨åˆ†è¿›è¡Œè¿ç®—ï¼Œå°†è¿ç®—ç»“æœä¿å­˜åœ¨èŠ‚ç‚¹çš„LocalResultå­—æ®µä¸Šã€‚è¿™éƒ¨åˆ†å°±æ˜¯åˆ†æ”¯çš„åˆ‡åˆ†é˜¶æ®µã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“æœåˆå¹¶&#34;&gt;ç»“æœåˆå¹¶&lt;/h2&gt;
&lt;p&gt;æµ‹è¯•ä»£ç ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;long count = Stream.of(1, 2, 3, 4, 5).parallel().reduce((x, y) -&amp;gt; x + y + 10).get();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;AbstractPipeline.evaluate()&lt;/code&gt;æ–¹æ³•æ˜¯å¹¶è¡Œæµä¸ä¸²è¡Œæµçš„åˆ†å‰ç‚¹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;final &amp;lt;R&amp;gt; R evaluate(TerminalOp&amp;lt;E_OUT, R&amp;gt; terminalOp) {
        assert getOutputShape() == terminalOp.inputShape();
        if (linkedOrConsumed)
            throw new IllegalStateException(MSG_STREAM_LINKED);
        linkedOrConsumed = true;

        return isParallel()
               ? terminalOp.evaluateParallel(this, sourceSpliterator(terminalOp.getOpFlags()))  //å¹¶è¡Œæµæ‰§è¡Œç‚¹
               : terminalOp.evaluateSequential(this, sourceSpliterator(terminalOp.getOpFlags()));
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;ReduceOps.evaluateParallel()&lt;/code&gt;æ–¹æ³•æ˜¯å…¶å®ç°ä¹‹ä¸€&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
public &amp;lt;P_IN&amp;gt; R evaluateParallel(PipelineHelper&amp;lt;T&amp;gt; helper,
                                 Spliterator&amp;lt;P_IN&amp;gt; spliterator) {
    return new ReduceTask&amp;lt;&amp;gt;(this, helper, spliterator).invoke().get();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ªReduceTaskä»»åŠ¡&lt;/li&gt;
&lt;li&gt;ä»»åŠ¡è°ƒç”¨invoke()æ‰§è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åˆ›å»ºçš„é€»è¾‘æ²¡æœ‰é¢å¤–çš„æ“ä½œï¼Œå°±æ˜¯å°†ä¸‰ä¸ªå‚æ•°èµ‹å€¼åˆ°å®ä¾‹å˜é‡ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;invoke()æ˜¯ForkJoinTaskçš„æ–¹æ³•ï¼Œæ–¹æ³•è¿™é‡Œä¸»è¦å…³æ³¨&lt;code&gt;invoke()&lt;/code&gt;æ–¹æ³•çš„é€»è¾‘ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;/**
* Commences performing this task, awaits its completion if
* necessary, and returns its result, or throws an (unchecked)
* {@code RuntimeException} or {@code Error} if the underlying
* computation did so.
*
* @return the computed result
*/
public final V invoke() {
    int s;
    //æ‰§è¡Œä»»åŠ¡
    if ((s = doInvoke() &amp;amp; DONE_MASK) != NORMAL)
        reportException(s);

    // è¿™é‡Œæ”¾å›çš„æ˜¯æœ€ç»ˆç»“æœ
    return getRawResult();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;/**
* Implementation for invoke, quietlyInvoke.
*
* @return status upon completion
*/
private int doInvoke() {
    int s; Thread t; ForkJoinWorkerThread wt;
    return (s = doExec()) &amp;lt; 0 ? s :
    ((t = Thread.currentThread()) instanceof ForkJoinWorkerThread) ?
        (wt = (ForkJoinWorkerThread)t).pool.
        awaitJoin(wt.workQueue, this, 0L) :
    externalAwaitDone();
}

==&amp;gt; JDKä»£ç ä¸ºäº†æ€§èƒ½ï¼Œç‰ºç‰²äº†å¯è¯»æ€§ï¼Œè¿™é‡Œæ•´ç†ä¸‹ï¼š

private int doInvoke() {
    s = doExec();
    if (s &amp;lt; 0) return s;
    
	t = Thread.currentThread();
    if (t instanceof ForkJoinWorkerThread) {
    	ForkJoinWorkerThread wt = (ForkJoinWorkerThread)t.pool();
        return wt.awaitJoin(wt.workQueue,this,0L);
    }
    
    return externalAwaitDone();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;    /**
     * If the pending count is nonzero, decrements the count;
     * otherwise invokes {@link #onCompletion(CountedCompleter)}
     * and then similarly tries to complete this task&#39;s completer,
     * if one exists, else marks this task as complete.
     */
    public final void tryComplte() {
        CountedCompleter&amp;lt;?&amp;gt; a = this, s = a;
        for (int c;;) {
            if ((c = a.pending) == 0) {
                a.onCompletion(s);
                if ((a = (s = a).completer) == null) {
                    s.quietlyComplete();
                    return;
                }
            }
            else if (U.compareAndSwapInt(a, PENDING, c, c - 1))
                return;
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨&lt;code&gt;ReduceOps.onCompletion()&lt;/code&gt;çš„é‡å†™æ–¹æ³•ä¸­ï¼Œå¦‚æœæ˜¯ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œåˆ™åˆå¹¶ä¸¤ä¸ªå­èŠ‚ç‚¹çš„ç»“æœï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;@Override
public void onCompletion(CountedCompleter&amp;lt;?&amp;gt; caller) {
    if (!isLeaf()) {
        //å¦‚æœä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå°†å·¦å³ä¸¤ä¸ªå­èŠ‚ç‚¹çš„ç»“æœåˆå¹¶ã€‚
        S leftResult = leftChild.getLocalResult();
        leftResult.combine(rightChild.getLocalResult());
        setLocalResult(leftResult);
    }
    // GC spliterator, left and right child
    super.onCompletion(caller);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…³æ³¨é‡Œé¢3ä¸ªæ–¹æ³•:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;isLeaf()&lt;/li&gt;
&lt;li&gt;combine()&lt;/li&gt;
&lt;li&gt;super.onCompletion()&lt;br&gt;
isLeaf()åˆ¤æ–­æ˜¯ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œåªæœ‰éå¶å­èŠ‚ç‚¹æ‰æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œç„¶åæ‰èƒ½è¿›è¡Œåˆå¹¶ä»»åŠ¡ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;protected boolean isLeaf() {
    return leftChild == null;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;èŠ‚ç‚¹åœ¨æ‰§è¡Œå®Œåè°ƒç”¨&lt;code&gt;super.onCompletionc(caller)&lt;/code&gt;æ–¹æ³•, å­—æ®µè®¾ä¸ºnullï¼Œä¸ºäº†gc&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
public void onCompletion(CountedCompleter&amp;lt;?&amp;gt; caller) {
    spliterator = null;
    leftChild = rightChild = null;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç»ˆç‚¹çœ‹ä¸‹combine()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯å°†ç»“æœç»„åˆ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
public void combine(ReducingSink other) {
    if (!other.empty)
        accept(other.state);
}

// å°†æœ¬ç±»çš„stateå’Œå‚æ•°tè¿›è¡Œä¸€æ¬¡è¿ç®—ï¼Œç”±äºtæ˜¯å¦ä¸€ä¸ªéƒ¨åˆ†è¿ç®—çš„ç»“æœ
// è¿™é‡Œçš„ä½œç”¨å°±æ˜¯ä¸¤éƒ¨åˆ†è¿›è¡Œè¿ç®—æ±‚å‡ºç»“æœ
@Override
public void accept(T t) {
    if (empty) {
        empty = false;
        state = t;
    } else {
        state = operator.apply(state, t);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;apply(state,t)&lt;/code&gt;è¿ç®—çš„é€»è¾‘æ˜¯ä½¿ç”¨è€…å®šä¹‰çš„ï¼Œå¯¹åº”æˆ‘ä»¬çš„ç¤ºä¾‹å³ &lt;code&gt;.reduce((x, y) -&amp;gt; x + y + 10)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œå°±å¯ä»¥å¯¹æ‰€æœ‰èŠ‚ç‚¹çš„ç»“æœè¿›è¡Œä¸¤ä¸¤ç»„åˆï¼Œå¾—å‡ºæœ€ç»ˆç»“æœäº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç–‘é—®è§£ç­”&#34;&gt;ç–‘é—®è§£ç­”&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚ä½•è½¬æ¢æµç±»å‹ï¼Œæ€ä¹ˆå®ç°çš„ï¼Ÿ
&lt;ul&gt;
&lt;li&gt;å¯ä»¥ä½¿ç”¨&lt;code&gt;sequential()&lt;/code&gt;æˆ– &lt;code&gt;parallel()&lt;/code&gt;è½¬æ¢æµçš„ç±»å‹ï¼Œæºç ä¸­æ˜¯å¯¹ &lt;code&gt;sourceStage.parallel = true;&lt;/code&gt;è¿›è¡Œæ ‡è®°ï¼Œæœ€ååœ¨å¯åŠ¨æ—¶å€™æ ¹æ®å’Œè¿™ä¸ªæ ‡è®°å†³å®šä¸²è¡Œorå¹¶è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚ä½•åˆ‡åˆ†ä»»åŠ¡çš„ï¼Ÿ
&lt;ul&gt;
&lt;li&gt;åº•å±‚åˆ©ç”¨ForkJoindPoolæ¡†æ¶å®ç°å¯¹ä»»åŠ¡çš„åˆ‡åˆ†å’Œåˆå¹¶ä»»åŠ¡ï¼Œé‡å†™&lt;code&gt;compute()&lt;/code&gt;ï¼Œå¯¹Splitertorè¿›è¡Œæ‹†åˆ†ï¼Œç„¶åé€’å½’è°ƒç”¨&lt;code&gt;compute()&lt;/code&gt;æ–¹æ³•è¿›è¡Œä¸æ–­åˆ‡åˆ†ï¼Œç›´åˆ°Splitertoræ— æ³•å†åˆ‡åˆ†ï¼Œæ‰§è¡Œè¯¥éƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚ä½•åˆå¹¶ä»»åŠ¡ç»“æœçš„ï¼Ÿ
&lt;ul&gt;
&lt;li&gt;é‡å†™&lt;code&gt;onCompletionc()&lt;/code&gt;ï¼Œå¯¹æ¯ä¸€ä¸ªéå¶å­èŠ‚ç‚¹ï¼Œéƒ½ä¼šå°†ä¸¤ä¸ªå­èŠ‚ç‚¹çš„ç»“æœé€šè¿‡&lt;code&gt;combine()&lt;/code&gt;æ–¹æ³•è¿›è¡Œç»„åˆï¼Œç„¶åä¸€ç›´å‘ä¸Šä»¿ä½›ï¼ŒçŸ¥é“æ‰€æœ‰èŠ‚ç‚¹ç»“æœéƒ½ç»„åˆï¼Œæœ€åè¿”å›æ ¹èŠ‚ç‚¹çš„ç»“æœã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
">æ·±å…¥è§£æ Java Parallel Stream</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/shen-ru-jie-xi-java-streamxia-zhong-jie-cao-zuo/"" data-c="
          &lt;h3 id=&#34;å‡ ä¸ªç–‘é—®&#34;&gt;å‡ ä¸ªç–‘é—®&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ç»ˆç»“æ–¹æ³•æ˜¯å¦‚ä½•è¿›è¡Œæ“ä½œçš„ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•å®ç°ç”±ç»ˆç»“æ“ä½œè§¦å‘æµçš„è¿ä½œçš„ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ä¿è¯ä¸€ä¸ªæµä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªç»ˆç»“æ–¹æ³•ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;!-- more --&gt;
&lt;h3 id=&#34;ä½¿ç”¨æ–¹å¼&#34;&gt;ä½¿ç”¨æ–¹å¼&lt;/h3&gt;
&lt;p&gt;åˆ—ä¸¾å››ç§ç»ˆç»“æ“ä½œï¼Œåœ¨Streamæä¾›çš„APIä¸­ï¼Œä¹Ÿæ˜¯å››ç±»ï¼š&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f302257d5bb44e519c5bb32da6fb5daa~tplv-k3u1fbpfcp-watermark.image&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;// è®¡ç®—æµä¸­å…ƒç´ æ•°é‡ï¼ŒFindOP
long count = afterLimit.count();

// éå†æ‰€æœ‰å…ƒç´ ,ForEachOp
afterLimit.forEach(System.out::printl);

// è·å–ç¬¬ä¸€ä¸ªå…ƒç´ ,MatchOp
Optional&amp;lt;Integer&amp;gt; any = afterLimit.findFirst();

// åˆ¤æ–­æ˜¯å¦,ReduceOp
boolean flag = afterLimit.anyMatch(i -&amp;gt; i == 1);
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;count&#34;&gt;count()&lt;/h3&gt;
&lt;p&gt;åœ¨&lt;code&gt;ReferencePipeline&lt;/code&gt;ç±»ä¸­å®ç°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
public final long count() {
 	// è°ƒç”¨mapToLongå°†æ‰€æœ‰å…ƒç´ å˜æˆ1ï¼Œç„¶åè®¡ç®—sum
    return mapToLong(e -&amp;gt; 1L).sum();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;maotolong&#34;&gt;maoToLong()&lt;/h4&gt;
&lt;p&gt;mapToLong()æ–¹æ³•ï¼Œæ˜¯ä¸€ä¸ªä¸­é—´æ“ä½œ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
    public final LongStream mapToLong(ToLongFunction&amp;lt;? super P_OUT&amp;gt; mapper) {
        Objects.requireNonNull(mapper);
        return new LongPipeline.StatelessOp&amp;lt;P_OUT&amp;gt;(this, StreamShape.REFERENCE,
                                      StreamOpFlag.NOT_SORTED | StreamOpFlag.NOT_DISTINCT) {
            @Override
            Sink&amp;lt;P_OUT&amp;gt; opWrapSink(int flags, Sink&amp;lt;Long&amp;gt; sink) {
                return new Sink.ChainedReference&amp;lt;P_OUT, Long&amp;gt;(sink) {
                    @Override
                    public void accept(P_OUT u) {
                        //
                        downstream.accept(mapper.applyAsLong(u));
                    }
                };
            }
        };
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ToLongFunctionæ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ç±», accept()é‡Œçš„é€»è¾‘ä¾¿æ˜¯&lt;code&gt;e -&amp;gt; 1L&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@FunctionalInterface
public interface ToLongFunction&amp;lt;T&amp;gt; {

    /**
     * Applies this function to the given argument.
     *
     * @param value the function argument
     * @return the function result
     */
    long applyAsLong(T value);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;çœ‹ä¸‹Sum()æ–¹æ³•,åœ¨LongPipelineç±»ä¸­ï¼Œä¼ å…¥å‚æ•°æ˜¯ä¸€ä¸ªLong::sum, sumçš„ä½œç”¨æ˜¯ç›¸åŠ ä¸¤ä¸ªå€¼ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
public final long sum() {
    // use better algorithm to compensate for intermediate overflow?
    return reduce(0, Long::sum);
}

//public static long sum(long a, long b) {
//    return a + b;
//}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;reduce&#34;&gt;reduce()&lt;/h4&gt;
&lt;p&gt;reduceæ–¹æ³•,å°†æ“ä½œå‡½æ•°opå°è£…æˆä¸€ä¸ªSinkï¼ŒmakeLong()çš„ä½œç”¨å°±æ˜¯ä¼šç”Ÿäº§ä¸€ä¸ªSink&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
public final long reduce(long identity, LongBinaryOperator op) {
    return evaluate(ReduceOps.makeLong(identity, op));
}
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;    /**
     * Constructs a {@code TerminalOp} that implements a functional reduce on
     * {@code long} values.
     *
     * @param identity the identity for the combining function
     * @param operator the combining function
     * @return a {@code TerminalOp} implementing the reduction
     */
    public static TerminalOp&amp;lt;Long, Long&amp;gt;
    makeLong(long identity, LongBinaryOperator operator) {
        Objects.requireNonNull(operator);
        class ReducingSink
                implements AccumulatingSink&amp;lt;Long, Long, ReducingSink&amp;gt;, Sink.OfLong {
                
            //stateæ˜¯ä¸€ä¸ªç”¨ä½œè®°å½•çš„å€¼
            private long state;

            @Override
            public void begin(long size) {
                state = identity;
            }

			//å‚æ•°ä¼ è¿›æ¥çš„å°±æ˜¯sun(),æ‰€ä»¥è¿™é‡Œçš„accept()çš„ä½œç”¨å°±æ˜¯å¯¹stateä¸æ–­è¿›è¡Œç´¯åŠ 
            @Override
            public void accept(long t) {
                state = operator.applyAsLong(state, t);
            }

            @Override
            public Long get() {
                return state;
            }

            @Override
            public void combine(ReducingSink other) {
                accept(other.state);
            }
        }
        return new ReduceOp&amp;lt;Long, Long, ReducingSink&amp;gt;(StreamShape.LONG_VALUE) {
            @Override
            public ReducingSink makeSink() {
                return new ReducingSink();
            }
        };
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;evaluate&#34;&gt;evaluate()&lt;/h4&gt;
&lt;p&gt;çœ‹å›evaluate()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨æ¥æ‰§è¡Œç»ˆç»“æ“ä½œçš„&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;final &amp;lt;R&amp;gt; R evaluate(TerminalOp&amp;lt;E_OUT, R&amp;gt; terminalOp) {
    assert getOutputShape() == terminalOp.inputShape();
    //åˆ¤æ–­æµæ˜¯å¦å·²è¢«ä½¿ç”¨
    if (linkedOrConsumed)
        throw new IllegalStateException(MSG_STREAM_LINKED);
    //è®¾ç½®ä½¿ç”¨æ ‡è®°ä¸ºtrue
    linkedOrConsumed = true;

    //æ ¹æ®æµç±»å‹ï¼Œæ‰§è¡Œç›¸åº”çš„æ¨æ–­æ“ä½œ
    return isParallel()
        ? terminalOp.evaluateParallel(this, sourceSpliterator(terminalOp.getOpFlags()))
        : terminalOp.evaluateSequential(this, sourceSpliterator(terminalOp.getOpFlags()));
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…³æ³¨æ—¶åºæµçš„æ¨æ–­æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•çš„å®ç°åˆ†ä¸ºå››ç§ï¼Œå¯¹åº”ä¸Šé¢æåˆ°çš„å››ç±»ç±»å‹æ“ä½œï¼Œcountå±äºReduceOpï¼Œè¿›å»çœ‹ä¸‹ã€‚&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/140540bd57794266af310e7c016400f5~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;
@Override
public &amp;lt;P_IN&amp;gt; R evaluateSequential(PipelineHelper&amp;lt;T&amp;gt; helper,
                                   Spliterator&amp;lt;P_IN&amp;gt; spliterator) {
    //è°ƒç”¨wrapAndCopyInto()æ–¹æ³•
    return helper.wrapAndCopyInto(makeSink(), spliterator).get();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;wrapandcopyinto&#34;&gt;wrapAndCopyInto()&lt;/h4&gt;
&lt;p&gt;ä¿è¯æ‰€æœ‰stage -&amp;gt; sinké“¾è¡¨ï¼Œç„¶åæ‰§è¡ŒcopyInto()æ–¹æ³•&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;	@Override
    final &amp;lt;P_IN, S extends Sink&amp;lt;E_OUT&amp;gt;&amp;gt; S wrapAndCopyInto(S sink, Spliterator&amp;lt;P_IN&amp;gt; spliterator) {
        copyInto(wrapSink(Objects.requireNonNull(sink)), spliterator);
        return sink;
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;warpsink&#34;&gt;warpSink()&lt;/h4&gt;
&lt;p&gt;å°±æ˜¯åœ¨è¿™é‡Œï¼Œä»åå‘å‰ï¼ŒåŒ…è£…æ‰€æœ‰çš„stageé˜¶æ®µï¼Œå½¢æˆä¸€æ¡sinké“¾è¡¨ã€‚è¿™æ ·å°†ä¹‹å‰ä¸€ä¸ªä¸ªstageçš„é“¾è¡¨ç»“æ„åŒ…è£…æˆä¸€ä¸ªä¸ªSinkã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;	@Override
    @SuppressWarnings(&amp;quot;unchecked&amp;quot;)
    final &amp;lt;P_IN&amp;gt; Sink&amp;lt;P_IN&amp;gt; wrapSink(Sink&amp;lt;E_OUT&amp;gt; sink) {
        Objects.requireNonNull(sink);
		
        //ä»åå‘å‰éå†
        for ( @SuppressWarnings(&amp;quot;rawtypes&amp;quot;) AbstractPipeline p=AbstractPipeline.this; p.depth &amp;gt; 0; p=p.previousStage) {
            //æ‰§è¡Œæ¯ä¸ªopWrapSink()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨æ¯ä¸ªæ“ä½œç±»ä¸­éƒ½è¿›è¡Œäº†é‡å†™
            sink = p.opWrapSink(p.previousStage.combinedFlags, sink);
        }
        //è¿”å›å¤´sink
        return (Sink&amp;lt;P_IN&amp;gt;) sink;
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;copyinto&#34;&gt;copyInto()&lt;/h4&gt;
&lt;p&gt;è¿™ä¸ªæ–¹æ³•æ˜¯æ•´ä¸ªæµæ°´çº¿çš„å¯åŠ¨å¼€å…³ï¼Œæµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è°ƒç”¨ç¬¬ä¸€ä¸ªsinkçš„begin()æ–¹æ³•&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œæ•°æ®æºçš„spliterator.forEachRemaining(wrappendSink)æ–¹æ³•éå†è°ƒç”¨accept()æ–¹æ³•&lt;/li&gt;
&lt;li&gt;end() é€šçŸ¥ç»“æŸ&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;	@Override
    final &amp;lt;P_IN&amp;gt; void copyInto(Sink&amp;lt;P_IN&amp;gt; wrappedSink, Spliterator&amp;lt;P_IN&amp;gt; spliterator) {
        Objects.requireNonNull(wrappedSink);

        if (!StreamOpFlag.SHORT_CIRCUIT.isKnown(getStreamAndOpFlags())) {
            //é€šçŸ¥ç¬¬ä¸€ä¸ªsinkï¼Œåšå¥½å‡†å¤‡æ¥å—æµ
            wrappedSink.begin(spliterator.getExactSizeIfKnown());
            //æ‰§è¡Œ
            spliterator.forEachRemaining(wrappedSink);
            wrappedSink.end();
        }
        else {
            copyIntoWithCancel(wrappedSink, spliterator);
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;foreachremaining&#34;&gt;forEachRemaining()&lt;/h4&gt;
&lt;p&gt;åœ¨å„ä¸ªå®¹å™¨ä¸­éƒ½æœ‰å®ç°forEachRemaining()è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨ArrayListä¸­:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public boolean tryAdvance(Consumer&amp;lt;? super E&amp;gt; action) {
    if (action == null)
        throw new NullPointerException();
    int hi = getFence(), i = index;
    if (i &amp;lt; hi) {
        index = i + 1;
        @SuppressWarnings(&amp;quot;unchecked&amp;quot;) E e = (E)list.elementData[i];
        //æ‰§è¡Œaccept()æ–¹æ³•
        action.accept(e);
        if (list.modCount != expectedModCount)
            throw new ConcurrentModificationException();
        return true;
    }
    return false;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;å…¶ä»–ç»ˆç»“æ“ä½œ&#34;&gt;å…¶ä»–ç»ˆç»“æ“ä½œ&lt;/h3&gt;
&lt;h4 id=&#34;foreach&#34;&gt;forEach()&lt;/h4&gt;
&lt;p&gt;åœ¨&lt;code&gt;ReferencePipeline&lt;/code&gt;ç±»ä¸­ï¼Œå®ç°äº†forEach()æ–¹æ³•ï¼Œ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;// from ReferencePipeline.class

@Override
public void forEach(Consumer&amp;lt;? super P_OUT&amp;gt; action) {
    // ForEachOps..
    evaluate(ForEachOps.makeRef(action, false));
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;evaluateåé¢çš„é€»è¾‘ä¸countåé¢çš„ä¸€æ ·äº†ï¼Œç•¥ã€‚&lt;/p&gt;
&lt;h4 id=&#34;findfirst-anymatch&#34;&gt;findFirst() anyMatch()&lt;/h4&gt;
&lt;p&gt;findFirst()å’ŒanyMatch()çš„é€»è¾‘ä¹Ÿä¸å†å¤šè¯´äº†ï¼Œä¸€ä¸ªå¥—è·¯ï¼Œçœ‹ä¸‹å®ç°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
public final Optional&amp;lt;P_OUT&amp;gt; findFirst() {
    return evaluate(FindOps.makeRef(true));
}

@Override
public final boolean anyMatch(Predicate&amp;lt;? super P_OUT&amp;gt; predicate) {
    return evaluate(MatchOps.makeRef(predicate, MatchOps.MatchKind.ANY));
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;ç–‘é—®è§£ç­”&#34;&gt;ç–‘é—®è§£ç­”&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ç»ˆç»“æ–¹æ³•æ˜¯å¦‚ä½•è¿›è¡Œæ“ä½œçš„ï¼Ÿ
&lt;ul&gt;
&lt;li&gt;ç»ˆç»“æ“ä½œçš„å®ç°é‡Œé¢éƒ½æœ‰è°ƒç”¨evaluate()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æœ€åä¼šwarpæ‰€æœ‰æ“ä½œå˜æˆä¸€ä¸²sinkï¼Œç„¶åä»å¤´å¼€å§‹æ‰§è¡Œbegin(),accept(),end()æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚ä½•å®ç°ç”±ç»ˆç»“æ“ä½œè§¦å‘æµçš„è¿ä½œçš„ï¼Ÿ
&lt;ul&gt;
&lt;li&gt;è§¦å‘çš„å¼€å…³æ˜¯wrapAndCopyInto(),è¿™ä¸ªæ–¹æ³•åªæœ‰åœ¨ç»ˆç»“æ“ä½œä¸­æ‰æœ‰è¢«è°ƒç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ä¿è¯ä¸€ä¸ªæµä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªç»ˆç»“æ–¹æ³•ï¼Ÿ
&lt;ul&gt;
&lt;li&gt;evaluate()æ–¹æ³•ä¸­æ‰§è¡Œä¸€æ¬¡å&lt;code&gt;linkedOrConsumed&lt;/code&gt;è®¾ä¸ºtrueï¼Œåç»­å†å‡ºå‘evaluate()æ–¹æ³•å°±ä¼šå¼‚å¸¸ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å‚è€ƒå¼•ç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://colobu.com/2014/11/18/Java-8-Stream/&#34;&gt;Java 8 Streamæ¢ç§˜ (colobu.com)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;&#34;&gt;åŸæ¥ä½ æ˜¯è¿™æ ·çš„ Streamï¼šæµ…æ Java Stream å®ç°åŸç† (https_toutiao.io)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
">æ·±å…¥è§£æJava Streamï¼ˆä¸‹ï¼‰ï¼šç»ˆç»“æ“ä½œ</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/shen-ru-jie-xi-java-streamzhong-op-cao-zuo-liu/"" data-c="
          &lt;h3 id=&#34;å‡ ä¸ªç–‘é—®&#34;&gt;å‡ ä¸ªç–‘é—®&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å„ä¸ªä¸­é—´æ“ä½œæ˜¯å¦‚ä½•è¿›è¡Œå…³è”çš„ï¼Ÿ&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¦‚ä½•æ‰§è¡Œå®Œä¸€ä¸ªä¸­é—´æ“ä½œï¼Œç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ªï¼Ÿ&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ‰çŠ¶æ€çš„ä¸­é—´æ“ä½œæ˜¯æ€ä¹ˆä¿å­˜çŠ¶æ€çš„ï¼Ÿ&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‡’åŠ è½½å¦‚ä½•å®ç°çš„&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;!-- more --&gt;
&lt;h3 id=&#34;ä½¿ç”¨æ–¹å¼&#34;&gt;ä½¿ç”¨æ–¹å¼&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;Stream&amp;lt;Integer&amp;gt; st = headStream.filter(e-&amp;gt; e=1).distinct().sort();
//ç­‰åŒäº
Stream&amp;lt;Integer&amp;gt; afterFilter = headStream.filter(e -&amp;gt; e != 2);
Stream&amp;lt;Integer&amp;gt; afterDistinct = afterFilter.distinct();
Stream&amp;lt;Integer&amp;gt; afterSort = afterDistinct.sort();
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;filter&#34;&gt;Filter&lt;/h3&gt;
&lt;p&gt;æ‰§è¡Œfilter(op)ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;Stream&amp;lt;Integer&amp;gt; afterFilter = head.filter(e -&amp;gt; e = 1);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;filter()æ–¹æ³•å®šä¹‰åœ¨&lt;code&gt;Stream&lt;/code&gt;ç±»ï¼Œå®ç°åœ¨&lt;code&gt;ReferencePipeline&lt;/code&gt;ç±»ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;//ReferencePipeline.class

@Override
public final Stream&amp;lt;P_OUT&amp;gt; filter(Predicate&amp;lt;? super P_OUT&amp;gt; predicate) {
    Objects.requireNonNull(predicate);

    // è¿”å›ä¸€ä¸ªStatelessOpç±»
    // æ„é€ å‡½æ•°å‚æ•°ä¸º(this,)
    return new StatelessOp&amp;lt;P_OUT, P_OUT&amp;gt;(this, StreamShape.REFERENCE,
                                         StreamOpFlag.NOT_SIZED) {
        @Override
        Sink&amp;lt;P_OUT&amp;gt; opWrapSink(int flags, Sink&amp;lt;P_OUT&amp;gt; sink) {
            return new Sink.ChainedReference&amp;lt;P_OUT, P_OUT&amp;gt;(sink) {
                @Override
                public void begin(long size) {
                    downstream.begin(-1);
                }

                @Override
                public void accept(P_OUT u) {
                    if (predicate.test(u))
                        downstream.accept(u);
                }
            };
        }
    };
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿”å›ä¸€ä¸ª&lt;code&gt;StatelessOp&lt;/code&gt;ç±»(å› ä¸ºfilteræ˜¯ä¸€ä¸ªæ— çŠ¶æ€æ“ä½œ)ï¼Œçœ‹ä¸‹&lt;code&gt;StatelessOp&lt;/code&gt;ç±»,æ˜¯ä¸€ä¸ªé™æ€æŠ½è±¡å†…éƒ¨ç±»ï¼Œç»§æ‰¿äº†&lt;code&gt;ReferencePipeline&lt;/code&gt;ç±»ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;//ReferencePipeline.class

    /**
     * Base class for a stateless intermediate stage of a Stream.
     *
     * @param &amp;lt;E_IN&amp;gt; type of elements in the upstream source
     * @param &amp;lt;E_OUT&amp;gt; type of elements in produced by this stage
     * @since 1.8
     */
    abstract static class StatelessOp&amp;lt;E_IN, E_OUT&amp;gt;
            extends ReferencePipeline&amp;lt;E_IN, E_OUT&amp;gt; {
        /**
         * Construct a new Stream by appending a stateless intermediate
         * operation to an existing stream.
         *
         * @param upstream The upstream pipeline stage
         * @param inputShape The stream shape for the upstream pipeline stage
         * @param opFlags Operation flags for the new stage
         */
        StatelessOp(AbstractPipeline&amp;lt;?, E_IN, ?&amp;gt; upstream,
                    StreamShape inputShape,
                    int opFlags) {
            super(upstream, opFlags);
            assert upstream.getOutputShape() == inputShape;
        }

        @Override
        final boolean opIsStateful() {
            return false;
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸­é—´super()ä¼šæ‰§è¡Œ&lt;code&gt;AbstractPipeline&lt;/code&gt;ç±»çš„æ„é€ æ–¹æ³•, è¿æ¥stageä¹‹é—´çš„å…³ç³»&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;//AbstractPipeline.class

    /**
     * Constructor for appending an intermediate operation stage onto an
     * existing pipeline.
     *
     * @param previousStage the upstream pipeline stage
     * @param opFlags the operation flags for the new stage, described in
     * {@link StreamOpFlag}
     */
    AbstractPipeline(AbstractPipeline&amp;lt;?, E_IN, ?&amp;gt; previousStage, int opFlags) {
        if (previousStage.linkedOrConsumed)
            throw new IllegalStateException(MSG_STREAM_LINKED);
        previousStage.linkedOrConsumed = true;
        previousStage.nextStage = this;

        this.previousStage = previousStage;
        this.sourceOrOpFlags = opFlags &amp;amp; StreamOpFlag.OP_MASK;
        this.combinedFlags = StreamOpFlag.combineOpFlags(opFlags, previousStage.combinedFlags);
        this.sourceStage = previousStage.sourceStage;
        if (opIsStateful())
            sourceStage.sourceAnyStateful = true;
        this.depth = previousStage.depth + 1;
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f83eb7d9726541b5826f8d5bcfef7538~tplv-k3u1fbpfcp-watermark.image&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;distinct&#34;&gt;Distinct&lt;/h3&gt;
&lt;p&gt;ç¤ºä¾‹&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;Stream&amp;lt;Integer&amp;gt; afterDistinct = afterFilter.distinct();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;distinctçš„æ–¹æ³•å®ç°åœ¨&lt;code&gt;ReferencePipeline&lt;/code&gt;ç±»ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
public final Stream&amp;lt;P_OUT&amp;gt; distinct() {
    return DistinctOps.makeRef(this);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è°ƒç”¨DistinctOpsç±»çš„makeRef()æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªStatefulOpç±»ï¼Œå¹¶é‡å†™äº†4ä¸ªæ–¹æ³•ï¼Œå®ç°é€»è¾‘åœ¨opWrapSink()ä¸­:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;    /**
     * Appends a &amp;quot;distinct&amp;quot; operation to the provided stream, and returns the
     * new stream.
     *
     * @param &amp;lt;T&amp;gt; the type of both input and output elements
     * @param upstream a reference stream with element type T
     * @return the new stream
     */
    static &amp;lt;T&amp;gt; ReferencePipeline&amp;lt;T, T&amp;gt; makeRef(AbstractPipeline&amp;lt;?, T, ?&amp;gt; upstream) {
        // è¿”å›ä¸€ä¸ªStatefulOpç±»
        return new ReferencePipeline.StatefulOp&amp;lt;T, T&amp;gt;(upstream, StreamShape.REFERENCE,
                                                      StreamOpFlag.IS_DISTINCT | StreamOpFlag.NOT_SIZED) {

            // é‡å†™äº†ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼Œå†…å®¹çœç•¥...
            &amp;lt;P_IN&amp;gt; Node&amp;lt;T&amp;gt; reduce(PipelineHelper&amp;lt;T&amp;gt; helper, Spliterator&amp;lt;P_IN&amp;gt; spliterator) {...}

            @Override
            &amp;lt;P_IN&amp;gt; Node&amp;lt;T&amp;gt; opEvaluateParallel(PipelineHelper&amp;lt;T&amp;gt; helper,
                                              Spliterator&amp;lt;P_IN&amp;gt; spliterator,
                                              IntFunction&amp;lt;T[]&amp;gt; generator) {...}

            @Override
            &amp;lt;P_IN&amp;gt; Spliterator&amp;lt;T&amp;gt; opEvaluateParallelLazy(PipelineHelper&amp;lt;T&amp;gt; helper, Spliterator&amp;lt;P_IN&amp;gt; spliterator) {...}

            @Override
            Sink&amp;lt;T&amp;gt; opWrapSink(int flags, Sink&amp;lt;T&amp;gt; sink) {
                Objects.requireNonNull(sink);

                if (StreamOpFlag.DISTINCT.isKnown(flags)) {
                    ...
                } else if (StreamOpFlag.SORTED.isKnown(flags)) {
                    ...
                } else {
                    // è¿”å›ä¸€ä¸ªSinkChainedReferenceç±»
                    return new Sink.ChainedReference&amp;lt;T, T&amp;gt;(sink) {
                        //ä½¿ç”¨ä¸€ä¸ªSetç¼“å­˜æ•°æ®ï¼Œè¿›è¡Œå»é‡
                        Set&amp;lt;T&amp;gt; seen;

                        //å½“ä¸Šæ¸¸é€šçŸ¥beginçš„æ—¶å€™ï¼Œåˆå§‹åŒ–Set
                        @Override
                        public void begin(long size) {
                            seen = new HashSet&amp;lt;&amp;gt;();
                            downstream.begin(-1);
                        }

                        //ç•¥
                        @Override
                        public void end() {
                            seen = null;
                            downstream.end();
                        }

                        //å¦‚æœå·²ç»å­˜åœ¨ï¼Œä¹‹é—´æŠ›å¼ƒ
                        @Override
                        public void accept(T t) {
                            if (!seen.contains(t)) {
                                seen.add(t);
                                downstream.accept(t);
                            }
                        }
                    };
                }
            }
        };
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;StatefulOpç±»ä¸StatelessOpç±»ç›¸ä¼¼,éƒ½æ˜¯ç»§æ‰¿äº†&lt;code&gt;ReferencePipeline&lt;/code&gt;ç±»ï¼Œç„¶åä¸­é—´super()é¡µä¼šæ‰§è¡Œ&lt;code&gt;AbstractPipeline&lt;/code&gt;ç±»çš„æ„é€ æ–¹æ³•, è¿æ¥stageä¹‹é—´çš„å…³ç³»&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;    /**
     * Base class for a stateful intermediate stage of a Stream.
     *
     * @param &amp;lt;E_IN&amp;gt; type of elements in the upstream source
     * @param &amp;lt;E_OUT&amp;gt; type of elements in produced by this stage
     * @since 1.8
     */
    abstract static class StatefulOp&amp;lt;E_IN, E_OUT&amp;gt; extends ReferencePipeline&amp;lt;E_IN, E_OUT&amp;gt; {
 		//çœç•¥
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6c1bb602651a41efb5b38673063b1523~tplv-k3u1fbpfcp-watermark.image&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;è‡³äºå…¶ä»–çš„ä¸­é—´æ“ä½œï¼Œå¥—è·¯éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œæ“ä½œé€»è¾‘å°è£…åœ¨&lt;code&gt;opWrapSink()&lt;/code&gt;æ–¹æ³•é‡Œ, å¯ä»¥æ…¢æ…¢çš„çœ‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç–‘é—®è§£ç­”&#34;&gt;ç–‘é—®è§£ç­”&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å„ä¸ªä¸­é—´æ“ä½œæ˜¯å¦‚ä½•è¿›è¡Œå…³è”çš„ï¼Ÿ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªä¸ªçš„æ“ä½œå°è£…æˆäº†ä¸€ä¸ªä¸ªçš„&lt;code&gt;statelessOp&lt;/code&gt;æˆ–&lt;code&gt;stateFulOp&lt;/code&gt;å¯¹è±¡ï¼Œä»¥åŒå‘é“¾è¡¨çš„æ–¹æ³•ä¸²èµ·æ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¦‚ä½•æ‰§è¡Œå®Œä¸€ä¸ªä¸­é—´æ“ä½œï¼Œç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ªï¼Ÿ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Sinkç±»è´Ÿè´£æµæ°´çº¿æ“ä½œçš„æ‰¿æ¥ä¸Šä¸‹æ¸¸å’Œæ‰§è¡Œæ“ä½œçš„ä»»åŠ¡ï¼Œæ ¸å¿ƒæ–¹æ³•ä¸ºbegain()ã€accept()ã€end()ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ‰çŠ¶æ€çš„ä¸­é—´æ“ä½œæ˜¯æ€ä¹ˆä¿å­˜çŠ¶æ€çš„ï¼Ÿ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰çŠ¶æ€çš„ä¸­é—´æ“ä½œå°è£…æˆ&lt;code&gt;stateFulOp&lt;/code&gt;å¯¹è±¡ï¼Œå„è‡ªéƒ½æœ‰ç‹¬ç«‹çš„é€»è¾‘ï¼Œå…·ä½“çš„å‚è€ƒ&lt;code&gt;sort()&lt;/code&gt;çš„å®ç°é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‡’åŠ è½½å¦‚ä½•å®ç°çš„&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ªä¸­é—´æ“ä½œè°ƒç”¨åï¼Œåªæ˜¯appendåœ¨æµç¨‹çš„å°¾éƒ¨ï¼Œä¿å­˜äº†å…³è”å…³ç³»è€Œå·²ã€‚&lt;/li&gt;
&lt;li&gt;æµæ°´çº¿æ“ä½œçš„å¯åŠ¨ï¼Œè¦äº¤ç»™wrapAndCopyInto()æ–¹æ³•è°ƒç”¨Headçš„Sink()æ“ä½œï¼Œè€ŒwrapAndCopyInto()æ–¹æ³•éƒ½éœ€è¦ç”±ç»ˆç»“æ“ä½œè¿›è¡Œè§¦å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
">æ·±å…¥è§£æJava Streamï¼ˆä¸­ï¼‰ï¼šOPæ“ä½œæµ</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/1V4Hrg06J/"" data-c="
          &lt;blockquote&gt;
&lt;p&gt;äº†è§£Streamä¸­Sinkå’ŒPiplineçš„æ¦‚å¿µï¼Œä»¥åŠå‰–æStreamæ˜¯å¦‚ä½•åˆ›å»ºã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;ç±»å›¾&#34;&gt;ç±»å›¾&lt;/h2&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1fccb594381b4b488f58abd47d935f06~tplv-k3u1fbpfcp-watermark.image&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;æ¦‚å¿µè§£é‡Š&#34;&gt;æ¦‚å¿µè§£é‡Š&lt;/h2&gt;
&lt;h3 id=&#34;piplineå’Œstage&#34;&gt;Piplineå’ŒStage&lt;/h3&gt;
&lt;p&gt;Piplineæ˜¯æµæ°´çº¿ï¼Œè¡¨ç¤ºä¸€æ•´ä¸ªæµç¨‹ã€‚Stageè¡¨ç¤ºæµæ°´çº¿çš„å…¶ä¸­ä¸€ä¸ªé˜¶æ®µã€‚æ˜¯ä¸€ä¸ªæ¯”è¾ƒæŠ½è±¡å±‚é¢çš„æè¿°ï¼Œå› ä¸ºstageä¸»è¦è¡¨ç¤ºä¸€ç§é€»è¾‘ä¸Šçš„é¡ºåºå…³ç³»ï¼Œè€Œå…·ä½“æ¯ä¸€ä¸ªé˜¶æ®µè¦å¹²å˜›ã€æ€ä¹ˆå¹²ï¼Œä½¿ç”¨Sinkæ¥è¿›è¡Œæè¿°ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;new stream          //stage 0
    .filter()       //stage 1
    .sort()         //stage 2
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/37dd9b847b014b8c9ae5710c0be1907c~tplv-k3u1fbpfcp-watermark.image&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;sink&#34;&gt;Sink&lt;/h3&gt;
&lt;p&gt;ç›´è¯‘ä¸ºæ°´æ§½ï¼Œç”Ÿæ´»ä¸­æ°´æ§½çš„ä½œç”¨æ— é&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰“å¼€æ°´é¾™å¤´ï¼ŒçŸ¥é“æœ‰æ°´è¦æ¥&lt;/li&gt;
&lt;li&gt;æ°´åœ¨æ°´æ§½é‡Œ, å¯ä»¥è¿›è¡Œä¸€äº›æ“ä½œ&lt;/li&gt;
&lt;li&gt;æ‰“å¼€æ°´é—¸ï¼Œæ”¾æ°´&lt;br&gt;
Javaä¸­çš„Sinkæ ¸å¿ƒåŠŸèƒ½ä¸ºï¼š&lt;/li&gt;
&lt;li&gt;begin(): å‘Šè¯‰è¯¥æ°´æ§½æ°´æµè¦æ¥äº†ï¼Œå¯ä»¥è¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œ&lt;/li&gt;
&lt;li&gt;accept()ï¼šæ¥å—æ°´æµï¼Œç„¶åè¿›è¡Œæ“ä½œ&lt;/li&gt;
&lt;li&gt;end()ï¼šæ°´æµå…¨éƒ¨å¤„ç†å®Œäº†ã€‚&lt;br&gt;
çœ‹ä¸€ä¸ªsort()çš„ç¤ºä¾‹,sortè¿™ä¸ªstageçš„ç›®çš„å°±æ˜¯å¯¹æ‰€æœ‰æ°´æµè¿›è¡Œæ’åºï¼Œç„¶åå†æµåˆ°ä¸‹æ¸¸ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private static final class SizedRefSortingSink&amp;lt;T&amp;gt; extends AbstractRefSortingSink&amp;lt;T&amp;gt; {
        private T[] array;  //è¦è¿›è¡Œæ’åºï¼Œéœ€è¦ä¸€ä¸ªæ•°ç»„è¿›è¡Œç¼“å­˜
        private int offset; 

        SizedRefSortingSink(Sink&amp;lt;? super T&amp;gt; sink, Comparator&amp;lt;? super T&amp;gt; comparator) {
            super(sink, comparator);
        }

        @Override
        @SuppressWarnings(&amp;quot;unchecked&amp;quot;)
        public void begin(long size) {
            if (size &amp;gt;= Nodes.MAX_ARRAY_SIZE)
                throw new IllegalArgumentException(Nodes.BAD_SIZE);
            //ä¸Šæ¸¸è°ƒç”¨begin(),é€šçŸ¥sortè¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œç”Ÿäº§ä¸€ä¸ªæ•°ç»„
            array = (T[]) new Object[(int) size];
        }

    	//ä¸Šæ¸¸è°ƒç”¨end()æ–¹æ³•ï¼Œå‘Šè¯‰sortæ°´å·²ç»å…¨éƒ¨æµè¿‡æ¥äº†ã€‚sortå¼€å§‹æ‰§è¡Œæ“ä½œ
        @Override
        public void end() {
            //æ“ä½œ
            Arrays.sort(array, 0, offset, comparator);
            //å‘Šè¯‰sortçš„ä¸‹æ¸¸å‡†å¤‡æ¥å—æ°´æµ
            downstream.begin(offset);
            //ä¸€ä¸ªä¸ªå…ƒç´ çš„ä¼ é€’ç»™ä¸‹æ¸¸
            if (!cancellationWasRequested) {
                for (int i = 0; i &amp;lt; offset; i++)
                    downstream.accept(array[i]);
            }
            else {
                for (int i = 0; i &amp;lt; offset &amp;amp;&amp;amp; !downstream.cancellationRequested(); i++)
                    downstream.accept(array[i]);
            }
            //å‘Šè¯‰ä¸‹æ¸¸æ°´æµä¼ é€’ç»“æŸ
            downstream.end();
            //ç¼“å­˜æ¸…ç©º
            array = null;
        }

    	//ä¸Šæ¸¸è°ƒç”¨accept()æ–¹æ³•ï¼Œå°†æ°´æµå­˜å‚¨åˆ°åˆ°sortçš„ç¼“å­˜æ•°ç»„ä¸­
        @Override
        public void accept(T t) {
            array[offset++] = t;
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;åˆ›å»ºhead&#34;&gt;åˆ›å»ºHead&lt;/h2&gt;
&lt;h3 id=&#34;ç–‘é—®&#34;&gt;ç–‘é—®&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å®˜æ–¹è¯´Streamä¸å­˜å‚¨æ•°æ®ï¼Œé‚£ä¹ˆæ•°æ®ä¿å­˜åœ¨é‚£é‡Œå‘¢ï¼Ÿ&lt;br&gt;
è§£ç­”åœ¨åé¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä½¿ç”¨æ–¹å¼&#34;&gt;ä½¿ç”¨æ–¹å¼&lt;/h3&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨Stream.of()åˆ›å»ºä¸€ä¸ªæµï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;//åˆ›å»ºæ–¹å¼ of()
Stream&amp;lt;Integer&amp;gt; stream = Stream.of(1, 2, 3);
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æºç åˆ†æ&#34;&gt;æºç åˆ†æ&lt;/h3&gt;
&lt;p&gt;of()æ–¹æ³•è°ƒç”¨&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;StreamSupport.stream(Arrays.spliterator(arr, 0, arr.length), false);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;stream()æ–¹æ³•é€»è¾‘ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static &amp;lt;T&amp;gt; Stream&amp;lt;T&amp;gt; stream(Spliterator&amp;lt;T&amp;gt; spliterator, boolean parallel) {
    Objects.requireNonNull(spliterator);
    return new ReferencePipeline.Head&amp;lt;&amp;gt;(spliterator,
                                        StreamOpFlag.fromCharacteristics(spliterator),
                                        parallel);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è°ƒç”¨äº†&lt;code&gt;ReferencePipeline.Head&amp;lt;&amp;gt;&lt;/code&gt;ï¼Œè¿”å›ä¸€ä¸ªHeadå¯¹è±¡ã€‚Headæ˜¯ReferencePipelineçš„å­ç±»ã€‚å¯ä»¥ç†è§£ä¸ºHeadæ˜¯æµæ°´çº¿çš„ç¬¬ä¸€ä¸ªstageã€‚&lt;br&gt;
æ„é€ æ–¹æ³•çš„ä¸»è¦äº†é€»è¾‘è¦ä¸€ç›´super()åˆ°&lt;code&gt;AbstractPipeline&lt;/code&gt;ç±»&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;    /**
     * The source spliterator. Only valid for the head pipeline.
     * Before the pipeline is consumed if non-null then {@code sourceSupplier}
     * must be null. After the pipeline is consumed if non-null then is set to
     * null.
     */
    private Spliterator&amp;lt;?&amp;gt; sourceSpliterator;

    /**
     * Constructor for the head of a stream pipeline.
     *
     * @param source {@code Spliterator} describing the stream source
     * @param sourceFlags the source flags for the stream source, described in
     * {@link StreamOpFlag}
     * @param parallel {@code true} if the pipeline is parallel
     */
    AbstractPipeline(Spliterator&amp;lt;?&amp;gt; source,
                     int sourceFlags, boolean parallel) {
        this.previousStage = null;
        //ä½¿ç”¨ä¸€ä¸ªå­—æ®µæŒ‡å‘æ•°æ®é›†åˆçš„Spliterator,åç»­ç»ˆç»“æ“ä½œçš„æ—¶å€™ï¼Œå¼•ç”¨çš„æ–¹å¼æ“ä½œæ•°æ®
        this.sourceSpliterator = source;
        this.sourceStage = this;
        this.sourceOrOpFlags = sourceFlags &amp;amp; StreamOpFlag.STREAM_MASK;
        // The following is an optimization of:
        // StreamOpFlag.combineOpFlags(sourceOrOpFlags, StreamOpFlag.INITIAL_OPS_VALUE);
        this.combinedFlags = (~(sourceOrOpFlags &amp;lt;&amp;lt; 1)) &amp;amp; StreamOpFlag.INITIAL_OPS_VALUE;
        this.depth = 0;
        this.parallel = parallel;
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0e6bb4ba6d9042e3a1f6b4547b68edec~tplv-k3u1fbpfcp-watermark.image&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;ç–‘é—®è§£ç­”&#34;&gt;ç–‘é—®è§£ç­”&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®˜æ–¹è¯´Streamä¸å­˜å‚¨æ•°æ®ï¼Œé‚£ä¹ˆæ•°æ®ä¿å­˜åœ¨é‚£é‡Œå‘¢ï¼Ÿ&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Headä¸­ä¿å­˜æ•°æ®æºçš„Spliteratorå¯¹è±¡ï¼Œåç»­æ“ä½œSpliteratorçš„æ–¹å¼æ“ä½œæ•°æ®&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å‚è€ƒå¼•ç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://colobu.com/2014/11/18/Java-8-Stream/&#34;&gt;Java 8 Streamæ¢ç§˜ (colobu.com)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;&#34;&gt;åŸæ¥ä½ æ˜¯è¿™æ ·çš„ Streamï¼šæµ…æ Java Stream å®ç°åŸç† (https_toutiao.io)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
">æ·±å…¥è§£æJava Streamæºç ï¼ˆä¸Šï¼‰ï¼šåˆå§‹åŒ– Sink</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/nL7teffDj/"" data-c="
          &lt;p&gt;Javaé‡Œæ³›å‹ï¼Œä¸c#æ¯”èµ·æ¥ï¼Œæ›´ç®—æ˜¯ä¸€ç§è¯­æ³•ç³–ã€‚å…³äºè¯­æ³•ç³–ï¼Œæ˜¯ç¼–è¯‘æ—¶çš„ä¸€ç§â€œå°æŠŠæˆâ€ï¼Œç›®çš„æ˜¯è®©ä½¿ç”¨è€…å¯ä»¥æœ‰æ›´å¤šçš„æ‰‹æ®µæ˜¯ç¼–å†™ä»£ç ã€‚&lt;br&gt;
å¥½å¤„æ˜¯æ•ˆç‡ï¼Œäº†è§£Rustçš„å¯ä»¥æ„Ÿå—åˆ°ï¼Œç¼–å†™Rustçš„ä»£ç æå…¶é«˜æ•ˆçš„ï¼Œä»£ä»·å°±æ˜¯å­¦ä¹ æˆæœ¬éå¸¸é«˜ï¼ŒåŸå› ä¹‹ä¸€å°±æ˜¯å¤§é‡çš„è¯­æ³•ç³–ã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;åœ¨java ä¸­:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public void foo(Person&amp;lt;String&amp;gt; p){}

public void foo(Person&amp;lt;Long&amp;gt; p){}
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8b95e4b789e245b581f3159d90c25eec~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;æ³›å‹æ“¦é™¤-å­—èŠ‚ç åˆ†æ&#34;&gt;æ³›å‹æ“¦é™¤-å­—èŠ‚ç åˆ†æ&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public void foo(Person&amp;lt;String&amp;gt; p){}  ==&amp;gt; public void foo(Person&amp;lt;Object&amp;gt; p){}

public void foo(Person&amp;lt;Long&amp;gt; p){} ==&amp;gt; public void foo(Person&amp;lt;Object&amp;gt; p){}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸‹é¢è¿™ä¸ªç±»&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class Person&amp;lt;T&amp;gt;{

    T name;

    public static void main(String[] args) {
        Person&amp;lt;String&amp;gt; p = new Person&amp;lt;String&amp;gt;();
        p.name = &amp;quot;å¼ ä¸‰&amp;quot;;
        GvmOut.to(p.name);
    }

    public void foo(T t){}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/356e67eb94044e85bc0270e8dbd05805~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/498461b0cf404349baaf98ca47e5f2c7~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;å­—æ®µçš„ç­¾åå’Œæ–¹æ³•çš„ç­¾åéƒ½æ˜¯Objectå¯¹è±¡ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜éœ€è¦èŒƒå‹ï¼Œç›´æ¥ç”¨Objectå£°æ˜ä¸å°±å¥½äº†å—ã€‚ç­”æ¡ˆæ˜¯çº¦æŸï¼Œä½¿ç”¨æ³›å‹å¯ä»¥ä¿è¯ç±»å‹ç¬¦åˆè¦æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­ï¼Œä¼šæ·»åŠ checkcastå‘½ä»¤å»æ£€æŸ¥ç±»å‹æ˜¯å¦åŒ¹é…ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6a2ceac67b4b4b8e98e3725639bbca97~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d997841902ca4fb9b4c1473a45265c7b~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ³›å‹ä¸Šä¸‹è¾¹ç•Œ-å­—èŠ‚ç åˆ†æ&#34;&gt;æ³›å‹ä¸Šä¸‹è¾¹ç•Œ-å­—èŠ‚ç åˆ†æ&lt;/h3&gt;
&lt;p&gt;æ³›å‹å¸¸è§çš„åœºæ™¯ä¹‹ä¸€æ˜¯ä½¿ç”¨extendsï¼Œå¯ä»¥çº¦æŸå‚æ•°çš„èŒƒå›´ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class Son&amp;lt;T extends Person&amp;gt;{

    T father;

    public static void main(String[] args) {
        Son&amp;lt;Person&amp;gt; son = new Son&amp;lt;&amp;gt;();
        son.father = new Person();
    }

    public T name(T t){
        return t;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6005fb3ea7494860b1a9669d34bda1c5~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc1e578969da44529d65f459c4baf301~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/h2&gt;
&lt;p&gt;æœ¬è´¨ä¸Šï¼Œç¼–è¯‘åï¼Œæ³›å‹ä¾ç„¶è¢«æ“¦é™¤äº†ï¼Œä½†æ˜¯ä¸å†æ˜¯Objectç±»ï¼Œè€Œæ˜¯Personç±»ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ç§æ–¹å¼å®ç°èŒƒå‹&#34;&gt;ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ç§æ–¹å¼å®ç°èŒƒå‹&lt;/h3&gt;
&lt;p&gt;å‘ä¸‹å…¼å®¹ã€‚å‘ä¸‹å…¼å®¹ã€‚å‘ä¸‹å…¼å®¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒï¼š&lt;/h2&gt;
&lt;p&gt;-ã€Šè™šæ‹Ÿæœºè§„èŒƒ(SE8)ã€‹&lt;br&gt;
-ã€Šè‡ªå·±åŠ¨æ‰‹äº›è™šæ‹Ÿæœºã€‹&lt;/p&gt;
">ä»å­—èŠ‚ç å‰–ææ³›å‹</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/l7YU2lRvP/"" data-c="
          &lt;p&gt;åœ¨jvmä¸­ï¼Œå®šä¹‰äº†æœ‰205æ¡æŒ‡ä»¤ï¼Œä»0x00 -&amp;gt; 0xCA , 0xFE -&amp;gt; 0xFFã€‚æˆ‘ä»¬åœ¨æ–¹æ³•ä¸­å†™çš„æ‰€æœ‰é€»è¾‘ï¼Œæœ€ç»ˆéƒ½ä¼šè½¬æ¢æˆè¿™äº›æŒ‡ä»¤ï¼Œè€Œè™šæ‹Ÿæœºçš„æœ€é‡è¦çš„ä¸€ä¸ªä»»åŠ¡å°±æ˜¯è§£é‡Šæ‰§è¡Œè¿™äº›æŒ‡ä»¤ã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;jvmæŒ‡ä»¤é›†&#34;&gt;JVMæŒ‡ä»¤é›†&lt;/h1&gt;
&lt;p&gt;æŒ‡ä»¤ç±»å‹ç§ç±»å¾ˆå¤š&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ebfd1be8ab947b1b8452e46405b1839~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;æ¯”è¾ƒå¸¸è§çš„ç±»å‹æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;load ï¼š æ•°æ®ä»å±€éƒ¨å˜é‡è¡¨ -&amp;gt; æ“ä½œæ•°æ ˆä¸­&lt;/li&gt;
&lt;li&gt;store ï¼š æ•°æ®ä»æ“ä½œæ•°æ ˆ -&amp;gt; å±€éƒ¨å˜é‡è¡¨ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;!----&gt;
&lt;ul&gt;
&lt;li&gt;references : æ–¹æ³•è°ƒç”¨ã€ç±»å‹å¼ºè½¬ã€monitoré”ç­‰&lt;/li&gt;
&lt;li&gt;math ï¼šè¿ç®—æ“ä½œç›¸å…³&lt;/li&gt;
&lt;/ul&gt;
&lt;!----&gt;
&lt;ul&gt;
&lt;li&gt;comparisons : é€»è¾‘æ“ä½œï¼Œifï¼Œwhileï¼Œforï¼Œgotoç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æŒ‡ä»¤æ ¼å¼&#34;&gt;æŒ‡ä»¤æ ¼å¼&lt;/h3&gt;
&lt;p&gt;æŒ‡ä»¤éƒ½æ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œ&lt;strong&gt;æ“ä½œç &lt;/strong&gt;å’Œ&lt;strong&gt;æ“ä½œæ•°ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ“ä½œç ï¼š&lt;/strong&gt; ç”¨äºè¡¨ç¤ºæ˜¯ä»€ä¹ˆæŒ‡ä»¤. 0x1a , 0x45 ,0x57 æ˜¯æ“ä½œç &lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ“ä½œæ•°ï¼š&lt;/strong&gt; æœ‰äº›æŒ‡ä»¤éœ€è¦æ“ä½œå±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆï¼Œéœ€è¦çŸ¥é“ç´¢å¼•çš„ä½ç½®.&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;//åŒ¹é…æŒ‡ä»¤
switch opcode {
    ...
    case 0x1a:
		return iload_0
    ...
	case 0x45:
		return fstore_2
    ...
    case 0x57:
		return pop
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;è¶…çº§æŒ‡ä»¤&#34;&gt;è¶…çº§æŒ‡ä»¤&lt;/h3&gt;
&lt;p&gt;è§£é‡Šçš„é€Ÿåº¦é€šå¸¸æ¯”è¾ƒæ…¢ï¼ŒåŸå› ä¹‹ä¸€æ˜¯è§£é‡Šå™¨åœ¨åˆ¤æ–­æŒ‡ä»¤ç±»å‹çš„æ—¶å€™æ¶‰åŠåˆ°åˆ†æ”¯ï¼Œcpuå±‚é¢åˆ†æ”¯é¢„æµ‹å¤±è´¥å’ŒæŒ‡ä»¤ç¼“å­˜æœªå‘½ä¸­çš„å¼€é”€éƒ½å¾ˆå¤§ã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³åŠæ³•å¾ˆå®¹æ˜“æƒ³åˆ°ï¼ŒæŠŠä¸¤ä¸ªæˆ–è€…å¤šä¸ªä»£ç åˆå¹¶æˆä¸€ä¸ªä»£ç ï¼Œåœ¨ä¸€è¶Ÿå¤„ç†ä¸­å¯ä»¥ç›´æ¥è·å–ç„¶åæ‰§è¡ŒæŒ‡ä»¤ï¼Œè¿™æ ·å°±å‡å°‘äº†åˆ†æ”¯çš„æ¬¡æ•°ï¼Œè¿™äº›æŒ‡ä»¤ä¾¿ç§°ä¸ºè¶…çº§æŒ‡ä»¤ã€å¿«é€ŸæŒ‡ä»¤ã€è™šæ‹ŸæŒ‡ä»¤ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;...
case 0x59:
	return dup
...
case 0x60:
	return iadd
...
case 0x84:
	return iinc
...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;dup: æŒ‡ä»¤è¡¨ç¤ºå°†æ“ä½œæ•°æ ˆé¡¶çš„å…ƒç´ å¤åˆ¶ä¸€ä»½ã€‚&lt;/li&gt;
&lt;li&gt;iinc: è¡¨ç¤ºå±€éƒ¨å˜é‡è¡¨+1ï¼Œçœç•¥äº†ç»è¿‡æ“ä½œæ•°æ ˆ+1ï¼Œç„¶åå†ä¿å­˜çš„è¿‡ç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æŒ‡ä»¤æµè·å–&#34;&gt;æŒ‡ä»¤æµè·å–&lt;/h3&gt;
&lt;p&gt;åœ¨ç±»åŠ è½½è¿‡ç¨‹-åŠ è½½æ­¥éª¤ã€‚åœ¨å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼ŒæŒ‡ä»¤çš„æ•°æ®ä¿å­˜åœ¨åœ¨methodsçš„çš„å±æ€§è¡¨çš„codeå­—æ®µä¸­ã€‚åœ¨ç±»åŠ è½½é˜¶æ®µï¼Œè¯»å–å­—èŠ‚ç æ–‡ä»¶æ—¶å€™ä¼šç”Ÿæˆä¸€ä»½ç­‰ä»·çš„å¯¹è±¡ï¼Œå¯¹è±¡çš„æ„å»ºå°±æ˜¯ä»å¤´åˆ°å°¾çš„æŠŠæ‰€æœ‰æ•°æ®éƒ½è¿›è¡Œè¯»å–ï¼Œç„¶åè§£æã€‚æ¯ä¸ªä¸åŒç»„ä»¶éƒ½æœ‰ä¸åŒçš„æ–¹æ³•è¯»å–ã€‚&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a5bde907abd949a4a154053757390bf2~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;// è¯»å–lengthé•¿åº¦çš„æ•°æ®
func parseMethod(count uint16, reader *loader.ClassReader, pool *constant_pool.ConstantPool, k *Klass) Methods {
	methods := make([]*MethodKlass, count)
	for i := range methods {
		method := &amp;amp;MethodKlass{}
		//è®¾ç½®å¸¸é‡æ± 
		method.ConstantPool = pool
		//è®¾ç½®è®¿é—®æ ‡è®°
		method.accessFlag = reader.ReadUint16()
		//nameå¸¸é‡æ± ç´¢å¼•
		method.nameIdx = reader.ReadUint16()
		//æè¿°ç¬¦å¸¸é‡æ± ç´¢å¼•
		method.descriptorIdx = reader.ReadUint16()
		//å±æ€§è¡¨æ•°é‡
		method.attrCount = reader.ReadUint16()
		// è§£ææ–¹æ³•è¡¨ä¸­çš„å±æ€§è¡¨å­—æ®µ
		method.AttributesInfo = attribute.ParseAttributes(method.attrCount, reader, pool)
		// ç»‘å®šklass&amp;amp;method
		method.Klass = k
		// æœ¬åœ°æ–¹æ³•æ³¨å…¥å­—èŠ‚ç 
		method.InjectCodeAttrIfNative()
	}
	return methods
}

func (c *AttrCode) parse(reader *loader.ClassReader) {
	c.MaxStack = reader.ReadUint16()
	c.MaxLocals = reader.ReadUint16()
	//codeé•¿åº¦
	c.codeLen = reader.ReadUint32()
	//è¯»å–lené•¿åº¦çš„å­—èŠ‚
	c.code = reader.ReadBytes(c.codeLen)
	c.ExceptionTable = parseExceptionTable(reader)
	c.attrCount = reader.ReadUint16()
	c.AttributesInfo = ParseAttributes(c.attrCount, reader, c.ConstantPool)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æŒ‡ä»¤çš„è§£é‡Šè¿‡ç¨‹&#34;&gt;æŒ‡ä»¤çš„è§£é‡Šè¿‡ç¨‹&lt;/h3&gt;
&lt;p&gt;æŒ‡ä»¤çš„æ‰§è¡Œæ˜¯ç”±è§£é‡Šå™¨è´Ÿè´£çš„ï¼Œè§£æå™¨çš„æµç¨‹ç®€å•è¯´å°±æ˜¯:&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/e6c9d24egy1h0e47eze27j211s03cq3e.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;æŒ‡ä»¤è§£é‡Šå°±æ˜¯å°†è¿™ä¸‰æ­¥é‡å¤å¾ªç¯ï¼Œå…¶ä¸­è¦æ³¨æ„çš„ç‚¹æ˜¯æ ˆå¸§ä¸­çš„pcå’Œæ•´ä½“pcå¯„å­˜å™¨çš„å€¼è¦ä¿æŒä¸€è‡´ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;//å¾ªç¯è§£é‡Š
func loop(thread *runtime.Thread) {
    methodReader := &amp;amp;base.MethodCodeReader{}
        for {
        // æ›´æ–°pcå¯„å­˜å™¨
        updatePC(thread)
        // æ›´æ–°æ–¹æ³•code
        updateCodeArrt(thread, methodReader)
        //æ‰§è¡ŒæŒ‡ä»¤
        execInst(thread, methodReader)
        if finished(thread) {
                break
        }
    }
}

//æ‰§è¡Œ
func execInst(thread *runtime.Thread, reader *base.MethodCodeReader) {
    curFrame := thread.PeekFrame()
    //è·å–æ“ä½œç 
    opcode := reader.ReadOpenCdoe()
    //åˆ›å»ºæŒ‡ä»¤
    inst := instructions.NewInstruction(opcode)
    //è·å–æ“ä½œæ•°
    inst.FetchOperands(reader)
    curFrame.SetFramePC(reader.MethodReaderPC())
    //æ‰§è¡ŒæŒ‡ä»¤
    inst.Execute(curFrame)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æŒ‡ä»¤è§£é‡Šæ‰§è¡Œ&#34;&gt;æŒ‡ä»¤è§£é‡Šæ‰§è¡Œ&lt;/h3&gt;
&lt;p&gt;è·å–åˆ°æŒ‡ä»¤åï¼Œ&lt;code&gt;inst.Execute(curFrame)&lt;/code&gt; æ‰§è¡ŒæŒ‡ä»¤ã€‚æ¯æ¡æŒ‡ä»¤éƒ½æœ‰å„è‡ªçš„æ‰§è¡Œé€»è¾‘&lt;/p&gt;
&lt;p&gt;æ¯æ¡æŒ‡ä»¤éƒ½æœ‰ä¸åŒçš„æ‰§è¡Œé€»è¾‘ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func iload_0(frame *runtime.Frame) {
	val := frame.LocalVars().GetInt(0)
	frame.OperandStack().PushInt(val)
}

func iload_1(frame *runtime.Frame) {
	val := frame.LocalVars().GetInt(1)
	frame.OperandStack().PushInt(val)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;i-i&#34;&gt;i++ &amp;amp; ++i&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;int i = 1;
print(i++);  
print(++i);  
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¼–è¯‘åå­—èŠ‚ç ä¸¤è€…æ˜¯ä¸åŒçš„ï¼ŒåŸå› ä¸javaç¼–è¯‘å™¨çš„éå†ASTï¼ˆjavacé‡‡ç”¨é€†æ³¢å…°è¡¨è¾¾ç®—æ³•ï¼‰æœ‰å…³ã€‚&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;4&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/268c4ab96e09427194ff1d0ac6ff94d3~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (i *IINC) Execute(frame *runtime.Frame) {
	idx := i.Index &amp;gt;&amp;gt; 8         //å±€éƒ¨å˜é‡è¡¨ä¸‹æ ‡
	toAdd := i.Index &amp;amp; 0x0011   //å€¼
	old := frame.LocalVars().GetInt(uint(idx)) 
	frame.LocalVars().SetInt(uint(idx), int32(toAdd)+old) //è®¾ç½®æ–°çš„å€¼
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;i++ ï¼šå…ˆæŠŠiä¿å­˜åˆ°äº†æ“ä½œæ•°æ ˆï¼Œç„¶åå†å¯¹å±€éƒ¨å˜é‡è¡¨çš„i+1ã€‚&lt;/p&gt;
&lt;p&gt;++i ï¼šå…ˆå¯¹å±€éƒ¨å˜é‡è¡¨çš„i+1ï¼Œç„¶åå†æŠŠiä¿å­˜åˆ°äº†æ“ä½œæ•°æ ˆã€‚&lt;/p&gt;
&lt;h4 id=&#34;ifelseå…³é”®å­—&#34;&gt;if..else..å…³é”®å­—&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;public static void if_test() {
    int n = 10;
    GvmOut.to(&amp;quot;testing if&amp;quot;);
    GvmOut.to(&amp;quot;10 &amp;gt; 9 ?&amp;quot;);
    if (n &amp;gt; 9) {
        GvmOut.to(&amp;quot;yes&amp;quot;);
    } else {
        GvmOut.to(&amp;quot;no&amp;quot;);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;5&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b5de568db80345d2ba675a334dc78683~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h4 id=&#34;forå…³é”®å­—&#34;&gt;for..å…³é”®å­—&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;public static void for_test() {
    GvmOut.to(&amp;quot;testing for&amp;quot;);
    for (int i = 0; i &amp;lt; 5; i++) {
        GvmOut.to(i);
	}
}
    
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;6&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f9b03ddacdcc42b2ac9061589646298b~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;// Execute to branch if and only if val1 great or equals val2
func (icmp *IfIcmpge) Execute(frame *runtime.Frame) {
	val2 := frame.PopInt()      //å¼¹å‡ºæ ˆé¡¶çš„int
	val1 := frame.PopInt()      //å¼¹å‡ºæ ˆé¡¶çš„int
	goNext := icmp.Index        //è·å–æŒ‘æˆ˜åœ°å€
	if val1 &amp;gt;= val2 {           //æ¯”è¾ƒ
		base.Branch(frame, int(goNext))  
	}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;while&#34;&gt;while&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void while_test() {
    GvmOut.to(&amp;quot;testing while&amp;quot;);
    int x = 100;
    while (x &amp;lt; 105) {
        x++;
        GvmOut.to(x);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;7&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd42f104f9fd43079416b393a2624003~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
">JVM æŒ‡ä»¤è¿è¡Œ è§£æ</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/65lQ_SxQ1/"" data-c="
          &lt;blockquote&gt;
&lt;p&gt;é¡¹ç›®ä»£ç ï¼š&lt;a href=&#34;https://github.com/zexho994/gvm&#34;&gt;https://github.com/zexho994/gvm&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;è™šæ‹Ÿæœºæ•´ä½“çš„æµç¨‹&#34;&gt;è™šæ‹Ÿæœºæ•´ä½“çš„æµç¨‹&lt;/h2&gt;
&lt;h2 id=&#34;ä¸åŒç±»å‹çš„è™šæ‹Ÿæœº&#34;&gt;ä¸åŒç±»å‹çš„è™šæ‹Ÿæœº&lt;/h2&gt;
&lt;p&gt;ä»è§£é‡Šå™¨çš„å®ç°æ–¹å¼ä¸Šæ¥çœ‹ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„è™šæ‹Ÿæœºæ‰§è¡Œæ¶æ„ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åŸºäºæ ˆç»“æ„&lt;/li&gt;
&lt;li&gt;åŸºäºå¯„å­˜å™¨&lt;br&gt;
jvmå®¶æ—çš„è™šæ‹ŸæœºåŸºæœ¬éƒ½æ˜¯åŸºäºæ ˆçš„ï¼ŒåŸºäºæ ˆçš„å®ç°ç¨å¾®ç®€å•ï¼Œç§»æ¤æ€§é«˜ã€‚åŸºäºå¯„å­˜å™¨çš„è™šæ‹Ÿæœºå’Œcpuçš„æ‰§è¡Œæ–¹å¼ç±»ä¼¼ï¼Œæ€§èƒ½æ›´å¿«ï¼Œä¾‹å¦‚v8ã€‚Luaè™šæ‹Ÿæœºä»5.0ä¹‹å‰æ˜¯æ ˆè™šæ‹Ÿæœºï¼Œ5.0æ—¶è½¬å˜ä¸ºå¯„å­˜å™¨è™šæ‹Ÿæœº&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;Lars Bak æ˜¯v8çš„ä½œè€…ï¼Œä¹Ÿæ˜¯hotspotçš„ä½œè€…ä¹‹ä¸€ï¼Œè¿˜æ˜¯Dartè¯­è¨€çš„ä½œè€…ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;æ ˆè™šæ‹Ÿæœº&#34;&gt;æ ˆè™šæ‹Ÿæœº&lt;/h3&gt;
&lt;p&gt;ä¸€æ®µjavaä»£ç &lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public void foo(){
	int a = 1;  
    int b = 2;  
    int c = a*b;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨ä¸åŒç±»å‹çš„è™šæ‹Ÿæœºä¸­ï¼Œè¦æ‰§è¡Œè¿™æ®µä»£ç ï¼Œé¦–å…ˆç¼–è¯‘çš„æ–¹å¼ä¹Ÿä¼šæœ‰ä¸åŒ,åœ¨åŸºäºæ ˆçš„è™šæ‹Ÿæœºä¸­ï¼Œç¼–è¯‘åçš„æŒ‡ä»¤ä¸º&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public void fooj();
    Code:
       0: iconst_1   //å¸¸é‡1å­˜å…¥åˆ°æ“ä½œæ•°æ ˆ
       1: istore_1   //æ“ä½œæ•°æ ˆé¡¶popåˆ°å±€éƒ¨å˜é‡è¡¨1
       2: iconst_2   
       3: istore_2
       4: iload_1    //å±€éƒ¨å˜é‡è¡¨ç´¢å¼•1æ•°pushåˆ°æ“ä½œæ•°æ ˆ
       5: iload_2    
       6: iadd       //æ“ä½œæ•°æ ˆé¡¶ä¸¤ä¸ªæ•°ç›¸åŠ 
       7: iconst_5
       8: imul       //æ“ä½œæ•°æ ˆé¡¶ä¸¤ä¸ªæ•°ç›¸ä¹˜
       9: istore_3
      10: return  
          
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dffe4e0c06c44ec1a3d74146ab023cd1~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;å¯„å­˜å™¨è™šæ‹Ÿæœº&#34;&gt;å¯„å­˜å™¨è™šæ‹Ÿæœº&lt;/h3&gt;
&lt;p&gt;å’Œæ±‡ç¼–çš„é£æ ¼ç±»ä¼¼ï¼Œå› ä¸ºcpuæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªåŸºäºå¯„å­˜å™¨çš„è§£é‡Šå™¨ã€‚å¯„å­˜å™¨è™šæ‹Ÿæœºæœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯æ€§èƒ½å¥½ï¼Œæ”¯æŒéšæœºè®¿é—®ï¼Œç›¸æ¯”èµ·æ¥æ ˆè™šæ‹Ÿæœºçš„æŒ‡ä»¤æ‰§è¡Œå°±æ˜¾å¾—ååˆ†éº»çƒ¦çš„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åŸºäºå¯„å­˜å™¨çš„è™šæ‹Ÿæœºä¸­ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;add ax bx	//å…¶ä¸­AXå¯„å­˜å™¨çš„å€¼ä¸º1,BXå¯„å­˜å™¨çš„å€¼ä¸º2ï¼Œå°†ç»“æœæ”¾å…¥AX
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/63c9bd9e740241a3b9e8154f39a15106~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;è™šæ‹Ÿæœºç±»å‹çš„æŠ‰æ‹©&#34;&gt;è™šæ‹Ÿæœºç±»å‹çš„æŠ‰æ‹©&lt;/h3&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆJVMé€‰æ‹©äº†ä½¿ç”¨æ ˆè™šæ‹Ÿæœºçš„æ–¹å¼? åŸå› æœ‰å¾ˆå¤šï¼Œä»å†å²çš„è§’åº¦ä¸Šçœ‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ ˆè™šæ‹Ÿæœºä¸­ï¼ŒæŒ‡ä»¤çš„å¹³å°æ— å…³æ€§å¥½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;!----&gt;
&lt;ul&gt;
&lt;li&gt;æ ˆè™šæ‹Ÿæœºçš„ä¼˜ç‚¹ä¹‹ä¸€æ˜¯æŒ‡ä»¤æ›´çŸ­ï¼Œåªç”¨1å­—èŠ‚ï¼Œè€ŒåŸºäºå¯„å­˜å™¨çš„éœ€è¦é¢å¤–ä¿å­˜åœ°å€ï¼Œä¸€èˆ¬ä¸º2å­—èŠ‚ã€‚åœ¨å½“æ—¶ï¼Œå†…å­˜æ˜¯æ¯”è¾ƒé‡è¦çš„ã€‚&lt;/li&gt;
&lt;li&gt;James Gosling å¯¹è¿™ç§æ–¹å¼çš„å®ç°æ¯”è¾ƒç†Ÿæ‚‰ï¼ˆä¹‹å‰ä»–å®ç°äº†PostScriptè™šæ‹Ÿæœºï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å¯¹javaçš„å½±å“&#34;&gt;å¯¹Javaçš„å½±å“&lt;/h3&gt;
&lt;p&gt;æŒ‡ä»¤é‡æ’åºä¹‹ä¸€çš„ç¼–è¯‘å™¨é‡æ’åºï¼Œæ˜¯IRä¼˜åŒ–é˜¶æ®µçš„ä¸€ç§æ‰‹æ®µï¼Œå«è¡¨è¾¾å¼æå‡ã€è¡¨è¾¾å¼ä¸‹æ²‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¼˜åŒ–çš„åŸå› ä¹‹ä¸€å°±æ˜¯è€ƒè™‘æ ˆçš„ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;a=1;         b=2;
b=2;         a=1;
c=a+1;  ==&amp;gt;  c=a+1;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ–¹æ³•æ‰§è¡Œ&#34;&gt;æ–¹æ³•æ‰§è¡Œ&lt;/h2&gt;
&lt;h3 id=&#34;æ ˆå¸§&#34;&gt;æ ˆå¸§&lt;/h3&gt;
&lt;p&gt;æ ˆå¸§æ˜¯æ–¹æ³•çš„æ‰§è¡Œå•ä½ï¼Œä¸€ä¸ªæ–¹æ³•å¯¹åº”ä¸€ä¸ªæ ˆå¸§ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;//æ ˆå¸§
type Frame struct {
	framePC   uint
	nextFrame *Frame
	*LocalVars
	*OperandStack
	*klass.MethodKlass
	*Thread
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1478dbbbd6704bbe98da7eea1d55b726~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/h3&gt;
&lt;h3 id=&#34;è™šæ‹Ÿæœºæ ˆ&#34;&gt;è™šæ‹Ÿæœºæ ˆ&lt;/h3&gt;
&lt;p&gt;è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œç”¨äºå­˜æ”¾æ ˆå¸§ã€‚å½“ä¸€ä¸ªæ–¹æ³•å‡†å¤‡æ‰§è¡Œæ—¶å€™ï¼Œæ ˆå¸§pushè¿›è¡Œï¼Œå®Œæˆ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;//çº¿ç¨‹æ¨¡å‹
type Thread struct {
    ...
	*Stack  //è™šæ‹Ÿæœºæ ˆ,å­˜æ”¾æ ˆå¸§
    ...
}
//è™šæ‹Ÿæœºæ ˆ
type Stack struct {
    ...
	// æ ˆæœ€å¤§å¤§å°
	maxSize uint
	// å½“å‰æ ˆçš„å¤§å°
	size uint
	// é¡¶å±‚å¸§
	top *Frame
    ...
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;-2&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/edf832f25aed447c87e2fc26fd868add~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/h3&gt;
&lt;h3 id=&#34;å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆsize&#34;&gt;å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆsize&lt;/h3&gt;
&lt;p&gt;å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆçš„å¤§å°å¦‚ä½•ç¡®å®šï¼Ÿåœ¨codeå±æ€§è¡¨ä¸­ï¼ŒMaxStackè¡¨ç¤ºæ ˆçš„æœ€å¤§æ·±åº¦ï¼ŒMaxLocalsè¡¨ç¤ºå±€éƒ¨å˜é‡è¡¨çš„æœ€å¤§æ·±åº¦ã€‚&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5dc1b27cd5c64897ba2677d8cdaffe6f~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;type Attr_Code struct {
	NameIdx uint16
	name    string
	AttrLen uint32
	cp      constant_pool.ConstantPool
	// æ–¹æ³•çš„æ“ä½œæ•°æ ˆåœ¨ä»»ä½•æ—¶é—´ç‚¹çš„æœ€å¤§æ·±åº¦ï¼Œåœ¨ç¼–è¯‘æœŸå°±å¯ä»¥ç¡®å®š
	MaxStack uint16
	// å±€éƒ¨å˜é‡è¡¨å¤§å°ï¼ŒåŒ…æ‹¬æ–¹æ³•çš„å‚æ•°
	MaxLocals uint16
	codeLen   uint32
	code      []byte
	// å¼‚å¸¸è¡¨
	ExceptionTable []*ExceptionTable
	// å±æ€§è¡¨
	attrCount uint16
	attrInfo  AttributesInfo
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸¤ä¸ªå€¼çš„å¤§å°å·²ç»åœ¨ç¼–è¯‘æœŸé—´ç¡®å®šï¼Œåœ¨å­—èŠ‚ç ä¸­ä¿å­˜ï¼Œæœ€ååœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­ï¼Œè·å–è¿™ä¸¤ä¸ªå­—æ®µã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (c *Attr_Code) parse(reader *classfile.ClassReader) {
	c.MaxStack = reader.ReadUint16()
	c.MaxLocals = reader.ReadUint16()
	c.codeLen = reader.ReadUint32()
	c.code = reader.ReadBytes(c.codeLen)
	c.ExceptionTable = parseExceptionTable(reader)
	c.attrCount = reader.ReadUint16()
	c.attrInfo = ParseAttributes(c.attrCount, reader, c.cp)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ–¹æ³•è°ƒç”¨&#34;&gt;æ–¹æ³•è°ƒç”¨&lt;/h2&gt;
&lt;h3 id=&#34;invoke-æŒ‡ä»¤ç°‡&#34;&gt;Invoke æŒ‡ä»¤ç°‡&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;invokeinterface : è°ƒç”¨æ¥å£æ–¹æ³•&lt;/li&gt;
&lt;li&gt;invokespecial : è°ƒç”¨å®ä¾‹æ–¹æ³•ï¼Œï¼ˆçˆ¶ç±»æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€å®ä¾‹åˆå§‹åŒ–æ–¹æ³•ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;!----&gt;
&lt;ul&gt;
&lt;li&gt;invokevirtual : è°ƒç”¨è™šæ–¹æ³•ï¼Œä¼šæ ¹æ®å®ä¾‹çš„ç±»å‹è¿›è¡Œåˆ†æ´¾&lt;/li&gt;
&lt;li&gt;invokestatic : è°ƒç”¨é™æ€æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;!----&gt;
&lt;ul&gt;
&lt;li&gt;invokedynamic : è°ƒç”¨åŠ¨æ€æ–¹æ³•(java7æ–°å¢ï¼Œæ”¯æŒåŠ¨æ€è¯­è¨€çš„æ–¹æ³•è°ƒç”¨)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è°ƒç”¨æ‰§è¡Œé€»è¾‘&#34;&gt;è°ƒç”¨æ‰§è¡Œé€»è¾‘&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class Invokevirtual {
    
    public static void main(String[] args) {
        Invokevirtual invokevirtual = new Invokevirtual();
        int res = invokevirtual.additive(1, 2);
        GvmOut.to(res);
    }

    public int additive(int x, int y) {
        int r = x + y;
        return r;
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;javaä¸­å‡½æ•°è°ƒç”¨å¦‚ä½•å®ç°ï¼Ÿ&lt;br&gt;
mainæ–¹æ³•çš„codeæŒ‡ä»¤æµï¼š&lt;br&gt;
&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a9610b89aa564ef08ab23c577af54559~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;additiveæ–¹æ³•çš„codeæŒ‡ä»¤æµï¼š&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;4&#34;&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c31c3e99e2c04fd2b774172edde8fd13~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;5&#34;&gt;&lt;img src=&#34;https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/91cbecea94264be485a5a7dc87f010df~tplv-k3u1fbpfcp-watermark.image&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;é™æ€ç»‘å®šä¸åŠ¨æ€ç»‘å®š&#34;&gt;é™æ€ç»‘å®šä¸åŠ¨æ€ç»‘å®š&lt;/h2&gt;
&lt;p&gt;ç½‘ä¸Šå¾ˆå¤šæ–‡ç« å¯¹äºè¿™ä¸¤è€…çš„è§£é‡Šä¸ºé‡è½½æ˜¯é™æ€ç»‘å®šï¼ˆç¼–è¯‘æ—¶å¤šæ€ï¼‰ï¼Œé‡å†™æ˜¯åŠ¨æ€ç»‘å®šã€‚å…¶å®ä¸å®Œå…¨æ­£ç¡®ï¼Œé‡è½½ä¹Ÿå¯èƒ½è¢«å­ç±»é‡å†™çš„æƒ…å†µï¼Œä¸€æ ·éœ€è¦åœ¨è¿è¡ŒæœŸé—´åˆ¤æ–­ã€‚&lt;/p&gt;
&lt;p&gt;å‡†ç¡®åœ°è¯´ï¼ŒJava è™šæ‹Ÿæœºä¸­çš„é™æ€ç»‘å®šæŒ‡çš„æ˜¯åœ¨è§£ææ—¶ä¾¿èƒ½å¤Ÿç›´æ¥è¯†åˆ«ç›®æ ‡æ–¹æ³•çš„æƒ…å†µï¼Œè€ŒåŠ¨æ€ç»‘å®šåˆ™æŒ‡çš„æ˜¯éœ€è¦åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ ¹æ®è°ƒç”¨è€…çš„åŠ¨æ€ç±»å‹æ¥è¯†åˆ«ç›®æ ‡æ–¹æ³•çš„æƒ…å†µã€‚æ¦‚æ‹¬å°±æ˜¯&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é™æ€ç»‘å®š&lt;/strong&gt;åªåœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥çŸ¥é“å…·ä½“è¦è°ƒç”¨çš„æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€ç»‘å®š&lt;/strong&gt;æŒ‡è¦åˆ°è¿è¡ŒæœŸé—´æ‰èƒ½çŸ¥é“è¦è°ƒç”¨çš„æ–¹æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨invokeå‘½ä»¤ä¸­ï¼Œinvokestaticå¯¹åº”çš„ä¸ºé™æ€ç»‘å®šï¼ˆä½¿ç”¨staticä¿®é¥°ï¼‰ï¼Œinvokevirtualã€invokeinterfaceä¸ºåŠ¨æ€ç»‘å®šçš„ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨ä»£ç è¿›è¡Œè¯´æ˜å°±æ˜¯&lt;/p&gt;
&lt;h4 id=&#34;invokestaticçš„é€»è¾‘&#34;&gt;invokestaticçš„é€»è¾‘&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (i *INVOKE_STATIC) Execute(frame *runtime.Frame) {
	cp := frame.Method().CP()
	contantMethod := cp.GetConstantInfo(i.Index).(*constant_pool.ConstantMethod)
	className := contantMethod.ClassName()
	perm := jclass.GetPerm()
	class := perm.Space[className]
	if class == nil {
		class = jclass.ParseInstanceByClassName(className)
	}
	name, _type := contantMethod.NameAndDescriptor()
	methodInfo, err := class.FindStaticMethod(name, _type)        //è·å–ç›®æ ‡æ–¹æ³•
	if err != nil {
		panic(&amp;quot;[gvm]&amp;quot; + err.Error())
	}
	if !jclass.IsStatic(methodInfo.AccessFlag()) {
		panic(&amp;quot;[gvm] invoke static error&amp;quot;)
	}
	methodInfo.SetJClass(class)
	base.InvokeMethod(frame, methodInfo, true)
}

func (j JClass_Instance) FindStaticMethod(name, descriptor string) (*MethodInfo, error) {       // åœ¨æœ¬ç±»ä¸­è·å–
	for i := range j.Methods {
		methodInfo := j.Methods[i]
		if !IsStatic(methodInfo.accessFlag) {
			continue
		}
		mName := j.ConstantPool.GetUtf8(methodInfo.nameIdx)
		mDesc := j.ConstantPool.GetUtf8(methodInfo.descriptorIdx)
		if name != mName || mDesc != descriptor {
			continue
		}
		return j.Methods[i], nil
	}
	return nil, exception.GvmError{Msg: &amp;quot;not find static method it name &amp;quot; + name}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;invokevirtualçš„é€»è¾‘&#34;&gt;invokevirtualçš„é€»è¾‘&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (i *INVOKE_VIRTUAL) Execute(frame *runtime.Frame) {
	constantMethod := frame.Method().CP().GetConstantInfo(i.Index).(*constant_pool.ConstantMethod)
	methodNameStr, methodDescStr := constantMethod.NameAndDescriptor()
	exception.AssertTrue(methodNameStr != &amp;quot;&amp;lt;init&amp;gt;&amp;quot; &amp;amp;&amp;amp; methodNameStr != &amp;quot;&amp;lt;clinit&amp;gt;&amp;quot;, &amp;quot;IncompatibleClassChangeError&amp;quot;)

	classNameStr := constantMethod.ClassName()
	permSpace := jclass.GetPerm().Space
	jc := permSpace[classNameStr]
	if jc == nil {
		jc = jclass.ParseInstanceByClassName(classNameStr)
	}
	exception.AssertTrue(jc != nil, &amp;quot;NullPointerException&amp;quot;)
    
    //*****æŸ¥æ‰¾ç›®æ ‡å®ä¾‹æ–¹æ³•*****
	methodInfo, err, _ := jc.FindMethod(methodNameStr, methodDescStr)     
	exception.AssertTrue(err == nil, &amp;quot;no find the method of &amp;quot;+methodNameStr)
	exception.AssertFalse(jclass.IsStatic(methodInfo.AccessFlag()), &amp;quot;IncompatibleClassChangeError&amp;quot;)

	if jclass.IsProteced(methodInfo.AccessFlag()) {
		// todo if is proteced , need to judge the relation between caller and called
	}

	base.InvokeMethod(frame, methodInfo, false)
}


func (j *JClass_Instance) FindMethod(name, descriptor string) (*MethodInfo, error, *JClass_Instance) {
	for i := range j.Methods {
		methodInfo := j.Methods[i]
		if IsStatic(methodInfo.accessFlag) {
			continue
		}
		mName := j.ConstantPool.GetUtf8(methodInfo.nameIdx)
		mDesc := j.ConstantPool.GetUtf8(methodInfo.descriptorIdx)
		if mName == name &amp;amp;&amp;amp; mDesc == descriptor {
			return j.Methods[i], nil, j
		}
	}
	// åœ¨çˆ¶ç±»ä¸­éå†æŸ¥æ‰¾
	m, err, jc := j.SuperClass.FindMethod(name, descriptor)
	if err == nil {
		return m, nil, jc
	}
	// åœ¨æ¥å£ä¸­éå†æŸ¥æ‰¾
	for i := range j.Interfaces {
		m, err, jc := j.Interfaces[i].FindMethod(name, descriptor)
		if err == nil {
			return m, nil, jc
		}
	}
	return nil, exception.GvmError{Msg: &amp;quot;not find method it name &amp;quot; + name}, nil
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;jniæ–¹æ³•ç®€è¿°&#34;&gt;JNIæ–¹æ³•ç®€è¿°&lt;/h2&gt;
&lt;p&gt;æœ‰ä¸€äº›åœºæ™¯ä¸­ï¼Œjavaæœ¬èº«æ²¡æœ‰èƒ½åŠ›å»å®Œæˆï¼Œæœ€å¸¸è§çš„å°±æ˜¯å½“è¦ç³»ç»Ÿè°ƒç”¨æ—¶å€™,å°±è¦ä½¿ç”¨JNIï¼ˆJava Native Interfaceï¼‰è¿™ç§æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚nioä¸­çš„Selector&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private native int poll0(long var1, int var3, long var4);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;unsafe.cas&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public final native boolean compareAndSwapInt(Object var1, long var2, int var4, int var5);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™ç§æ–¹å¼æœ¬è´¨ä¸Šä¹Ÿæ˜¯è°ƒç”¨å¦ä¸€ä¸ªåœ°æ–¹çš„å‡½æ•°ï¼Œé“¾æ¥çš„å·¥ä½œç”±è™šæ‹Ÿæœºå®Œæˆã€‚GvmOutæ˜¯invokeè°ƒç”¨æ—¶åŸºäºGoçš„Printæ–¹æ³•å®ç°ï¼Œä½¿ç”¨nativeæ–¹æ³•å¯ä»¥è¿›è¡Œéå¸¸å¤šçš„æ‰©å±•æ“ä½œã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class GvmOut{
    public native static void to(int i);
    public native static void to(float i);
    public native static void to(double i);
    public native static void to(boolean i);
    public native static void to(long i);
    public native static void to(String i);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒï¼š&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.zhihu.com/question/35777031&#34;&gt;æ ˆå¼è™šæ‹Ÿæœºå’Œå¯„å­˜å™¨å¼è™šæ‹Ÿæœºï¼Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.iteye.com/blog/rednaxelafx-492667&#34;&gt;è™šæ‹Ÿæœºéšè°ˆï¼ˆä¸€ï¼‰ï¼šè§£é‡Šå™¨ï¼Œæ ‘éå†è§£é‡Šå™¨ï¼ŒåŸºäºæ ˆä¸åŸºäºå¯„å­˜å™¨ï¼Œå¤§æ‚çƒ© - Script Ahead, Code Behind - ITeyeåšå®¢&lt;/a&gt;&lt;br&gt;
-ã€Šè™šæ‹Ÿæœºè§„èŒƒ(SE8)ã€‹&lt;br&gt;
-ã€Šè‡ªå·±åŠ¨æ‰‹äº›è™šæ‹Ÿæœºã€‹&lt;/li&gt;
&lt;/ul&gt;
">JVM æ–¹æ³•è°ƒç”¨ä¸æ‰§è¡Œ</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/ioc_2/"" data-c="
          &lt;p&gt;githubåœ°å€ï¼šhttps://github.com/zexho994/IOC-AOP&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;æ ¸å¿ƒå®ç°&#34;&gt;æ ¸å¿ƒå®ç°&lt;/h1&gt;
&lt;h3 id=&#34;æµç¨‹&#34;&gt;æµç¨‹&lt;/h3&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ba70855125c48d280678e5d1538979d~tplv-k3u1fbpfcp-watermark.image&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;beançš„å£°æ˜&#34;&gt;Beançš„å£°æ˜&lt;/h3&gt;
&lt;p&gt;ä»¥æ³¨è§£çš„æ–¹å¼ä¸ºä¾‹ï¼Œåœ¨ç±»ä¸Šæ·»åŠ @Beanæ³¨è§£å³è¡¨ç¤ºè¯¥Classä¸ºä¸€ä¸ªBeanï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Bean
public class BeanTest1 implements BeanTest {

    @Override
    public void print() {
        System.out.println(&amp;quot;BeanTest1&amp;quot;);
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™ä¼šæ‰«æç›®å½•ä¸‹æ‰€æœ‰çš„Classï¼Œæµç¨‹å¦‚ä¸‹:&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/585f5fd3ead84ba491753ffa4276d292~tplv-k3u1fbpfcp-watermark.image&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static List&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt; findAllBean() {
    ClassLoader contextClassLoader = getDefaultClassLoader();  //è·å–é»˜è®¤ç±»åŠ è½½å™¨
    List&amp;lt;String&amp;gt; classes = scanClasses(contextClassLoader);    //æ‰«ææ‰€æœ‰Classç±»
    return filtersAndLoadBeans(classes, contextClassLoader);   //è¿‡æ»¤ï¼Œè·å–æ‰€æœ‰Bean
}

public void loadBean() {
    BeanScanner
        .findAllBean()
        .forEach(bean -&amp;gt; AnnotationDefinitionLoaderRegistry.
                 this.register(bean.getSimpleName(), bean));  //æ³¨å†Œæ‰€æœ‰çš„bean
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…·ä½“çš„çš„ä»£ç ç»†èŠ‚ä¸è¯¦ç»†å±•å¼€ï¼Œéœ€è¦çš„å¯ä»¥çœ‹æºç ã€‚&lt;/p&gt;
&lt;p&gt;åˆ°æ­¤ï¼Œæ‰€æœ‰çš„Beanéƒ½å·²ç»ä¿å­˜åˆ°äº†mapç»“æ„ä¸­ï¼Œå½“éœ€è¦ä½¿ç”¨Beançš„æ—¶å€™æ ¹æ®bean nameè¿›è¡Œè·å–å°±å¥½äº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;autowiredå®ç°&#34;&gt;@Autowiredå®ç°&lt;/h3&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7d52d41f1d9d4b7fa7da3e63563931e7~tplv-k3u1fbpfcp-watermark.image&#34; alt=&#34;image.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Bean
public class AutowiredTest {

    @Autowired
    public BeanTest1 beanTest1;
    @Autowired
    public BeanTest2 beanTest2;

    public void print1() {
        beanTest1.print();
    }

    public void print2() {
        beanTest2.print();
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;// åˆå§‹åŒ–bean
private void initBean(BeanDefinition beanDefinition) throws IllegalAccessException {
    Object instance = beanDefinition.getInstance();

    // åˆå§‹åŒ–Autowired
    this.initAutowire(instance);

    beanDefinition.setStatusInitialized();
}

/** 
* è®¾ç½®beané‡Œé¢çš„æ³¨å…¥å­—æ®µ
*/
private void initAutowire(Object instance) throws IllegalAccessException {
    // è·å–æ‰€æœ‰å­—æ®µï¼Œå¦‚æœæœ‰Autowiredæ³¨è§£ï¼Œè·å–è¯¥beanï¼Œç„¶åèµ‹å€¼ç»™å­—æ®µ
    for (Field field : instance.getClass().getFields()) {
        if (field.getDeclaredAnnotationsByType(Autowired.class).length == 0) {
            continue;
        }
        Class&amp;lt;?&amp;gt; fieldType = field.getType();
        Object bean = this.getBean(fieldType.getSimpleName());
        field.set(instance, bean);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;è§£å†³å¾ªç¯ä¾èµ–&#34;&gt;è§£å†³å¾ªç¯ä¾èµ–&lt;/h1&gt;
&lt;p&gt;åœ¨springä¸­ä½¿ç”¨â€œ3çº§ç¼“å­˜â€æ¥è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä¸è¦çº ç»“springä¸ºä½•è¦ä½¿ç”¨3ä¸ªmapæ¥å®ç°ï¼ŒæŠ›å¼€å®ç°çš„ç»†èŠ‚ï¼Œä»é—®é¢˜åŸå› ç€æ‰‹ï¼Œè¿™ä¸ªé—®é¢˜å…¶å®ä½¿ç”¨å¾ˆå¥½ç†è§£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½•ä¸ºå¾ªç¯ä¾èµ–&#34;&gt;ä½•ä¸ºå¾ªç¯ä¾èµ–ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢çš„Aå’ŒBå°±äº’ç›¸ä¾èµ–å½¼æ­¤ï¼Œè¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨åˆ›å»ºAçš„æ—¶å€™éœ€è¦åˆ›å»ºBï¼Œä½†æ˜¯åˆ›å»ºBçš„æ—¶å€™åˆéœ€è¦åˆ›å»ºAï¼Œçœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªå…ˆæœ‰é¸¡è¿˜æ˜¯è›‹çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;@Bean
public class ClassA {
    @Autowired
    public ClassB ib;

}

@Bean
public class ClassB {
    @Autowired
    public ClassA ia;
    
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä½†æ˜¯è¦çŸ¥é“Beançš„åˆ›å»ºå…¶å®æ˜¯åˆ†ä¸ºå¤šä¸ªæ­¥éª¤çš„ï¼Œå°±å¥½ç†è§£äº†ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-mermaid&#34;&gt;graph LR
n0(start) --&amp;gt; n1(åˆ›å»ºinstance) --&amp;gt; n2(å¡«å……éœ€è¦æ³¨å…¥çš„fieldså­—æ®µ) --&amp;gt; n3(end)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨åˆ›å»ºå®Œinstanceåï¼Œé‡Œé¢çš„å­—æ®µå…¶å®éƒ½è¿˜æ˜¯nullçš„,ä¾‹å¦‚å·²ç»åˆ›å»ºClassAå®ä¾‹aï¼Œå’ŒClassBå®ä¾‹bï¼Œæ­¤æ—¶&lt;code&gt;a.ib = null&lt;/code&gt;å’Œ&lt;code&gt;b.ia = null&lt;/code&gt;. ç„¶åèµ‹å€¼ &lt;code&gt;a.ib = b&lt;/code&gt; å’Œ &lt;code&gt;b.ia = a&lt;/code&gt;ï¼Œè¿™ä¹‹åï¼Œaå’Œbä¸­çš„å­—æ®µéƒ½èµ‹å€¼å®Œäº†ï¼Œä¸”éƒ½æ˜¯å®Œæ•´å¯ç”¨çš„å¯¹è±¡äº†ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public Object getBean(String beanName) {
    BeanDefinition bean = this.getBeanInstance(beanName);
    if (!bean.isInit()) {
        try {
            this.initBean(bean);
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }
    }
    return bean.getInstance();
}

// åˆå§‹åŒ–bean
private void initBean(BeanDefinition beanDefinition) throws IllegalAccessException {
    Object instance = beanDefinition.getInstance(); // è·å–beançš„isntance
    beanDefinition.setStatusInitialized();  //è®¾ç½®ä¸ºå·²åˆå§‹åŒ–
    this.initAutowire(instance);
}

// éå†æ‰€æœ‰å­—æ®µï¼Œä¸ºæœ‰@Authwiredæ³¨è§£çš„å®ç°æ³¨å…¥
private void initAutowire(Object instance) throws IllegalAccessException {
    Field[] fields = instance.getClass().getFields();
    for (Field field : fields) {
        if (field.getDeclaredAnnotationsByType(Autowired.class).length == 0) {
            continue;
        }
        Class&amp;lt;?&amp;gt; fieldType = field.getType();
        Object bean = this.getBean(fieldType.getSimpleName());
        field.set(instance, bean);  //fieldèµ‹å€¼
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æœ‰ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ç±»æ¯”ï¼Œleetcodeçš„ä¸€é“ç®—æ³•é¢˜two sum &lt;a href=&#34;https://leetcode-cn.com/problems/two-sum/&#34;&gt;https://leetcode-cn.com/problems/two-sum/&lt;/a&gt;ï¼Œå…¶ä¸­ä¸€ç§é¢˜è§£å°±æ˜¯éå†ä¸€è¾¹ï¼Œå­˜å‚¨æ‰€æœ‰å€¼å’Œç´¢å¼•åˆ°mapä¸­ï¼Œç„¶åéå†ä¸€æ¬¡mapï¼Œæ¯æ¬¡åˆ¤æ–­æ˜¯å¦æœ‰è¦çš„æ•°ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªä¹Ÿæ˜¯ï¼Œå…ˆè®²instanceå­˜åˆ°mapä¸­ï¼Œç„¶åæŠŠmapä¸­instanceçš„fieldséƒ½è¿›è¡Œå¡«å……ï¼Œå°±å¯ä»¥äº†ã€‚&lt;/p&gt;
">å‚è€ƒSpringå®ç° IOCï¼ˆä¸‹ï¼‰</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/ioc_1/"" data-c="
          &lt;h1 id=&#34;åŸºæœ¬æ¦‚å¿µ&#34;&gt;åŸºæœ¬æ¦‚å¿µ&lt;/h1&gt;
&lt;h3 id=&#34;æ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥&#34;&gt;æ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;æ§åˆ¶åè½¬ï¼ˆIOCï¼‰ï¼Œä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»€ä¹ˆæ˜¯æ§åˆ¶åè½¬ï¼Ÿç®€å•çš„è¯´ï¼Œæ§åˆ¶åè½¬å°±æ˜¯ä¸€ç§æ€æƒ³ï¼Œç›®çš„æ˜¯å°†å¯¹è±¡çš„åˆ›å»ºç”±ä¸»åŠ¨å˜æˆè¢«åŠ¨ã€‚&lt;br&gt;
ä¸‹é¢çš„å®ä¾‹å°±æ˜¯ä¸»åŠ¨newäº†ä¸€ä¸ªå¯¹è±¡ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class Service{
    public DependObject object1 = new DenpendObject();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é‚£ä¹ˆå¦‚ä½•åšåˆ°ä¸ä½¿ç”¨newå‘¢ï¼Ÿä¾èµ–æ³¨å…¥ä¾¿æ˜¯å…¶ä¸­ä¸€ç§å®ç°æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¾èµ–æ³¨å…¥çš„æ–¹å¼æœ‰ä¸‰ç§&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ„é€ å™¨æ³¨å…¥&lt;/li&gt;
&lt;li&gt;setteræ³¨å…¥&lt;/li&gt;
&lt;li&gt;æ¥å£æ³¨å…¥&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class Service{
    public DependObject object;

    // æ„é€ å™¨æ³¨å…¥
    public Service (DependObject obj){
        this.object = obj;
    }

    // setteræ³¨å…¥
    public void setDependObject(DependObject obj){
        this.object = obj;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸å†ç”±Serviceç±»ä¸­ä¸»åŠ¨åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡æ³¨å…¥çš„æ–¹å¼èµ‹å€¼ã€‚&lt;br&gt;
é¡ºä¾¿æ¯”è¾ƒä¸€ä¸‹3ä¸­æ–¹å¼çš„ä¼˜åŠ£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¥å£æ³¨å…¥ï¼š&lt;/strong&gt; ä»æ³¨å…¥æ–¹å¼çš„ä½¿ç”¨ä¸Šæ¥è¯´ï¼Œæ¥å£æ³¨å…¥æ˜¯ç°åœ¨ä¸ç”šæå€¡çš„ä¸€ç§æ–¹å¼ï¼ŒåŸºæœ¬å¤„äºâ€œé€€ å½¹çŠ¶æ€â€ã€‚å› ä¸ºå®ƒå¼ºåˆ¶è¢«æ³¨å…¥å¯¹è±¡å®ç°ä¸å¿…è¦çš„æ¥å£ï¼Œå¸¦æœ‰ä¾µå…¥æ€§ã€‚è€Œæ„é€ æ–¹æ³•æ³¨å…¥å’Œsetter æ–¹æ³•æ³¨å…¥åˆ™ä¸éœ€è¦å¦‚æ­¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ„é€ æ–¹æ³•æ³¨å…¥ï¼š&lt;/strong&gt; è¿™ç§æ³¨å…¥æ–¹å¼çš„ä¼˜ç‚¹å°±æ˜¯ï¼Œå¯¹è±¡åœ¨æ„é€ å®Œæˆä¹‹åï¼Œå³å·²è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œå¯ä»¥ é©¬ä¸Šä½¿ç”¨ã€‚ç¼ºç‚¹å°±æ˜¯ï¼Œå½“ä¾èµ–å¯¹è±¡æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œæ„é€ æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¼šæ¯”è¾ƒé•¿ã€‚è€Œé€šè¿‡å å°„æ„é€ å¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹ç›¸åŒç±»å‹çš„å‚æ•°çš„å¤„ç†ä¼šæ¯”è¾ƒå›°éš¾ï¼Œç»´æŠ¤å’Œä½¿ç”¨ä¸Šä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚è€Œä¸” åœ¨Javaä¸­ï¼Œæ„é€ æ–¹æ³•æ— æ³•è¢«ç»§æ‰¿ï¼Œæ— æ³•è®¾ç½®é»˜è®¤å€¼ã€‚å¯¹äºéå¿…é¡»çš„ä¾èµ–å¤„ç†ï¼Œå¯èƒ½éœ€è¦å¼•å…¥å¤š ä¸ªæ„é€ æ–¹æ³•ï¼Œè€Œå‚æ•°æ•°é‡çš„å˜åŠ¨å¯èƒ½é€ æˆç»´æŠ¤ä¸Šçš„ä¸ä¾¿ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;setteræ–¹æ³•æ³¨å…¥ï¼š&lt;/strong&gt; å› ä¸ºæ–¹æ³•å¯ä»¥å‘½åï¼Œæ‰€ä»¥setteræ–¹æ³•æ³¨å…¥åœ¨æè¿°æ€§ä¸Šè¦æ¯”æ„é€ æ–¹æ³•æ³¨å…¥å¥½ä¸€äº›ã€‚ å¦å¤–ï¼Œ setteræ–¹æ³•å¯ä»¥è¢«ç»§æ‰¿ï¼Œ å…è®¸è®¾ç½®é»˜è®¤å€¼ï¼Œè€Œä¸”æœ‰è‰¯å¥½çš„IDEæ”¯æŒã€‚ç¼ºç‚¹å½“ç„¶å°±æ˜¯å¯¹è±¡æ—  æ³•åœ¨æ„é€ å®Œæˆåé©¬ä¸Šè¿›å…¥å°±ç»ªçŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;iocå®¹å™¨&#34;&gt;IOCå®¹å™¨&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†æ‰€æœ‰å¯¹è±¡çš„ç»Ÿä¸€ç®¡ç†ï¼Œéœ€è¦æœ‰ä¸€ä¸ªè§’è‰²è´Ÿè´£å°†è¿™äº›ç›¸äº’ä¾èµ–çš„å¯¹è±¡ç»‘å®šåˆ°ä¸€èµ·ï¼ŒIOCå®¹å™¨å°±æ˜¯è¿™æ ·ä¸€ä¸ªè§’è‰²ã€‚å®ƒçš„ä¸»è¦èŒè´£å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸šåŠ¡å¯¹è±¡çš„æ„å»ºç®¡ç†ï¼šä¾‹å¦‚å¦‚ä½•åŠ è½½ç±»ï¼Œç®¡ç†ç±»çš„ç”Ÿå‘½å‘¨æœŸç­‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¸šåŠ¡å¯¹è±¡é—´çš„ä¾èµ–ç»‘å®šï¼šæä¾›æ„å»ºå¥½çš„å¯¹è±¡ç»™ä¸šåŠ¡æ–¹ä½¿ç”¨ã€‚&lt;br&gt;
æ€»ç»“å°±æ˜¯åˆ›å»ºå’Œç»‘å®š&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;IOCå®¹å™¨å¦‚ä½•çŸ¥é“ç®¡ç†å“ªäº›å¯¹è±¡å‘¢ï¼Ÿæœ¬ç³»åˆ—å°†å®ç°ä¸¤ç§æ–¹å¼ï¼š1.ä½¿ç”¨ç¼–ç ç”³æ˜ï¼Œ2. ä½¿ç”¨æ³¨è§£@Beanå£°æ˜ï¼Œç†Ÿæ‚‰Springçš„çŸ¥é“å¸¸ç”¨çš„è¿˜æœ‰XMLçš„æ–¹å¼ï¼Œè¿™ä¸ªå¯ä»¥è‡ªè¡Œå®ç°ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Springä¸­ï¼Œä½¿ç”¨Beançš„æ¦‚å¿µè¡¨ç¤ºIOCç®¡ç†çš„å¯¹è±¡ï¼Œåœ¨è¿™é‡Œä¾ç„¶é‡‡ç”¨è¿™ç§å®šä¹‰æ–¹å¼ï¼Œä¸‹ç¯‡æ–‡ç« ä»‹ç»IOCæ¨¡å—çš„ç»“æ„è®¾è®¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ‹“å±•é˜…è¯»&#34;&gt;æ‹“å±•é˜…è¯»&lt;/h3&gt;
&lt;p&gt;å¯¹IOCçš„åŸºæœ¬æ¦‚å¿µä¸ç†Ÿæ‚‰çš„å¯ä»¥é˜…è¯»ï¼š&lt;br&gt;
ã€Šspringæ­å¯†ã€‹2.1 IOCåŸºæœ¬æ¦‚å¿µ&lt;/p&gt;
&lt;h1 id=&#34;é¢„æœŸå®ç°æ•ˆæœ&#34;&gt;é¢„æœŸå®ç°æ•ˆæœ&lt;/h1&gt;
&lt;h2 id=&#34;beançš„å£°æ˜æ–¹å¼&#34;&gt;Beançš„å£°æ˜æ–¹å¼&lt;/h2&gt;
&lt;h3 id=&#34;é€šè¿‡ç¼–ç æ–¹å¼è¿›è¡Œå£°æ˜&#34;&gt;é€šè¿‡ç¼–ç æ–¹å¼è¿›è¡Œå£°æ˜&lt;/h3&gt;
&lt;p&gt;ç»§æ‰¿CodeDefinitionLoderRegistryç±»ï¼Œé‡å†™loadBean()æ–¹æ³•&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class MyCodeBeanDefinition extends CodeDefinitionLoaderRegistry {

    @Override
    public void loadBean() {
        this.register(&amp;quot;BeanTest1&amp;quot;, BeanTest1.class);
        this.register(&amp;quot;BeanTest2&amp;quot;, BeanTest2.class);
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç„¶åç¼–ç ä½¿ç”¨register(beançš„åç§°ï¼Œbeanæ‰€å¯¹åº”ç±»)è¿›è¡Œæ³¨å†Œï¼Œå’ŒXMLçš„å£°æ˜æ–¹å¼æ˜¯ç±»ä¼¼çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é€šè¿‡æ³¨è§£beançš„æ–¹å¼å£°æ˜&#34;&gt;é€šè¿‡æ³¨è§£@Beançš„æ–¹å¼å£°æ˜&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Bean
public class BeanTest1 implements BeanTest {

    @Override
    public void print() {
        System.out.println(&amp;quot;BeanTest1&amp;quot;);
    }

}

@Bean
public class BeanTest2 implements BeanTest {

    @Override
    public void print() {
        System.out.println(&amp;quot;BeanTest2&amp;quot;);
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;è·å–bean&#34;&gt;è·å–Bean&lt;/h2&gt;
&lt;h3 id=&#34;ä»å·¥å‚ä¸­è·å–bean&#34;&gt;ä»å·¥å‚ä¸­è·å–Bean&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void foo() {

    // ç¬¬ä¸€æ­¥ï¼šcæ ¹æ®å£°æ˜çš„æ–¹å¼é€‰æ‹© 1 or 2
    // æ–¹å¼ä¸€ï¼š åˆ›å»ºæ³¨å†Œç±»,æ³¨å†Œç±»ä¸­ä½¿ç”¨ç¼–ç å®ç°æ³¨å†Œé€»è¾‘
    AbstractDefinitionLoaderRegistry registry = new MyCodeBeanDefinition();
    // æ–¹å¼äºŒï¼š åˆ›å»ºæ³¨å†Œç±»,Beané€šè¿‡æ³¨è§£çš„æ–¹å¼è‡ªåŠ¨æ³¨å…¥
    AbstractDefinitionLoaderRegistry registry = new AnnotationDefinitionLoaderRegistry();
    
    // ç¬¬äºŒæ­¥ï¼šæ³¨å†Œç±»æ·»åŠ åˆ°å·¥å‚ä¸­
    ApplicationContext factory = new ApplicationContext(registry);

    // ç¬¬ä¸‰æ­¥ï¼šè·å–Bean
    BeanTest obj1 = factory.getBeanInstance(&amp;quot;BeanTest1&amp;quot;, BeanTest1.class);
    BeanTest obj2 = factory.getBeanInstance(&amp;quot;BeanTest2&amp;quot;, BeanTest2.class);
    
    obj1.print();
    obj2.print();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;é€šè¿‡æ³¨è§£è‡ªåŠ¨æ³¨å…¥bean&#34;&gt;é€šè¿‡æ³¨è§£è‡ªåŠ¨æ³¨å…¥Bean&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨@Autowiredè‡ªåŠ¨æ³¨å…¥&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Bean
public class AutowiredTest {

    @Autowired
    public BeanTest1 beanTest1;
    @Autowired
    public BeanTest2 beanTest2;

    public void print1() {
        beanTest1.print();
    }

    public void print2() {
        beanTest2.print();
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;é¡¹ç›®ç»„ç»‡ç»“æ„&#34;&gt;é¡¹ç›®ç»„ç»‡ç»“æ„&lt;/h1&gt;
&lt;h2 id=&#34;springä¸­çš„iocè®¾è®¡&#34;&gt;Springä¸­çš„IOCè®¾è®¡&lt;/h2&gt;
&lt;p&gt;springä¸­iocæ¨¡å—å¯ä»¥åˆ†ä¸º3ä¸­è§’è‰²ï¼Œåˆ†åˆ«å¯¹åº”3ä¸ªæœ€é¡¶å±‚æ¥å£ï¼š&lt;br&gt;
&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b1c03834b5a348a18794a7ee8aed7546~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;é€šä¿—çš„ç†è§£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;BeanDefinition: å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„Beanï¼Œç†è§£ä¸ºå›¾ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;BeanDefinitionRegistry: ä¹¦æ¶ï¼Œå­˜æ”¾ä¹¦çš„åœ°æ–¹ã€‚&lt;/li&gt;
&lt;li&gt;BeanFactory: å›¾ä¹¦é¦†ï¼Œå€Ÿä¹¦çš„åœ°æ–¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬çš„å®ç°ä¸­ï¼ŒåŒæ ·ä½¿ç”¨äº†è¿™3ä¸ªæ¦‚å¿µï¼Œçœ‹ä¸‹3ä¸ªæ¥å£éƒ½æœ‰å“ªäº›æ–¹æ³•ï¼š&lt;/p&gt;
&lt;h3 id=&#34;beandefinition&#34;&gt;BeanDefinition&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public interface BeanDefinition {
    // 0è¡¨ç¤ºæœªåˆå§‹åŒ–
    int STATUS_UNINITIALIZED = 0;
    // 1è¡¨ç¤ºå·²åˆå§‹åŒ–
    int STATUS_INITIALIZED = 1;

    /**
     * Sets name.
     *
     * @param beanClassName the bean class name
     */
    void setName(String beanClassName);

    /**
     * Gets name.
     *
     * @return the name
     */
    String getName();

    /**
     * Sets instance.
     *
     * @param instance the instance
     */
    void setInstance(Object instance);

    /**
     * Gets instance.
     *
     * @return the instance
     */
    Object getInstance();

    /**
     * Gets bean class.
     *
     * @return bean class
     */
    Class&amp;lt;?&amp;gt; getBeanClass();

    /**
     * åˆ¤æ–­beanæ˜¯å¦æœ‰åˆå§‹åŒ–
     *
     * @return status == {@link #STATUS_INITIALIZED} ?
     */
    Boolean isInit();

    /**
     * set status to {@link #STATUS_INITIALIZED}
     */
    void setStatusInitialized();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;beandefinitionregistry&#34;&gt;BeanDefinitionRegistry&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public interface BeanDefinitionRegistry {

    /**
     * æ³¨å†Œä¸€ä¸ªæ–°çš„Bean
     *
     * @param beanName       beançš„æ³¨å†Œä½¿ç”¨åç§°
     * @param beanDefinition beançš„ç±»å‹
     */
    void registerBean(String beanName, BeanDefinition beanDefinition);

    /**
     * ç§»é™¤ä¸€ä¸ªBean
     *
     * @param beanName è¦ç§»é™¤çš„Beançš„åç§°
     */
    void removeBean(String beanName);

    /**
     * æ ¹æ®åç§°è·å–Bean
     *
     * @param beanName beanåç§°
     * @return å·²æ³¨å†Œçš„ {@link BeanDefinition} å¯¹è±¡
     */
    BeanDefinition getBean(String beanName);

    /**
     * è·å–Bean
     * {@link BeanDefinition}
     *
     * @param beanName     beanåç§°
     * @param requiredType beanç±»å‹ï¼Œä¼šè¿›è¡Œæ ¡éªŒ
     * @return å·²æ³¨å†Œçš„ {@link BeanDefinition} å¯¹è±¡
     */
    &amp;lt;T&amp;gt; BeanDefinition getBean(String beanName, Class&amp;lt;T&amp;gt; requiredType);

}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;beanfactory&#34;&gt;BeanFactory&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public interface BeanFactory {

    /**
     * æ ¹æ®åç§°è·å–bean
     *
     * @param beanName beanåç§°
     * @return beanåç§°å¯¹åº”çš„Bean
     */
    BeanDefinition getBeanInstance(String beanName);

    /**
     * æ ¹æ®åç§°è·å–ä¸€ä¸ªbean
     *
     * @param beanName     beançš„åç§°
     * @param requiredType beanç±»å‹
     * @return beanåç§°å¯¹åº”çš„Bean
     */
    &amp;lt;T&amp;gt; T getBeanInstance(String beanName, Class&amp;lt;T&amp;gt; requiredType);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æˆ‘ä»¬çš„iocç±»å›¾&#34;&gt;æˆ‘ä»¬çš„IOCç±»å›¾&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3a49e7bfb13849aeb2e2c96eccd438cb~tplv-k3u1fbpfcp-zoom-1.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å¯¹3ä¸ªé¡¶å±‚æ¥å£éƒ½æ·»åŠ äº†é»˜è®¤å®ç°ç±»ï¼Œå…¶ä¸­æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;BeanDefinitionRegistry ä½¿ç”¨Mapè¿›è¡ŒBeançš„å­˜å‚¨ï¼ŒKeyä¸ºBeançš„åç§°ï¼ŒValä¸ºBeanDefinition&lt;/li&gt;
&lt;li&gt;BeanDefinitionä¸­æœ‰3ä¸ªå­—æ®µ&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private String beanName;  //beanåç§°
private T beanInstance = null; // beançš„å®ä¾‹
private final Class&amp;lt;T&amp;gt; beanClass; //beanå¯¹åº”çš„class
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;BeanFactoryä¸­å­˜å‚¨BeanDefinitionRegistryç±»ï¼Œå°è£…è·å–beançš„æ¥å£ï¼Œå·¥å‚å¯¹å¤–æä¾›&lt;/li&gt;
&lt;/ul&gt;
">å‚è€ƒSpringå®ç° IOCï¼ˆä¸Šï¼‰</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/u5bZtrIU8/"" data-c="
          &lt;ol&gt;
&lt;li&gt;æ‰¾åˆ°License.class&lt;br&gt;
åœ¨wordsçš„jaråŒ…ä¸­æ‰¾åˆ°Licenseç±».éªŒè¯æ–¹æ³•å…¥å£åœ¨è¿™é‡Œ&lt;br&gt;
è™½ç„¶æœ‰ä¸¤ä¸ªsetLicenseï¼ˆï¼‰æ–¹æ³•ï¼Œç»†å¿ƒç‚¹çœ‹ï¼Œæœ€åè°ƒç”¨çš„éƒ½æ˜¯zzVæ–¹æ³•ï¼Œåªæ˜¯ä¸åŒçš„é‡è½½ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;!-- more --&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class License {
    private zz2B zzYIM = zz2B.zzoF();

    public License() {
    }

    public void setLicense(String licenseName) throws Exception {
        if (licenseName == null) {
            throw new NullPointerException(this.zzYIM.zzZu(new byte[]{108, 105, 99, 101, 110, 115, 101, 78, 97, 109, 101}));
        } else {
            (new zzZJ5()).zzV(licenseName, zzZY2.zzkc());
        }
    }

    public void setLicense(InputStream stream) throws Exception {
        if (stream == null) {
            throw new NullPointerException(this.zzYIM.zzZu(new byte[]{115, 116, 114, 101, 97, 109}));
        } else {
            (new zzZJ5()).zzV(stream);
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿›å…¥zzV()æ–¹æ³•&lt;br&gt;
åœ¨zzV()æ–¹æ³•ä¸‹é¢æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œç±»ä¼¼äºä¸‹é¢è¿™æ ·ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;zzZaQå°±æ˜¯è¦ä¿®æ”¹çš„æ–¹æ³•ã€‚è®©ä»–å§‹ç»ˆè¿”å›1å°±å¥½äº†&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;static int zzZaQ() {
        boolean var0 = zzYIF == null || zzYIF.zzYIH == 0 || (new Date()).after(zzYIF.zzYII) || zzYNP.zzYlS() == 4096;
        boolean var1 = zzZE1.zzYZQ() == 0;
        int var2 = var0 &amp;amp;&amp;amp; var1 ? 0 : 1;
        return var2; // update , return 1
    }

    static int zzZaP() {
        boolean var0 = zzYIF == null || zzYIF.zzYIH == 0 || (new Date()).after(zzYIF.zzYII) || zzYNP.zzYlS() == 4096;
        boolean var1 = zzZE1.zzYZQ() == 0;
        int var2 = var0 &amp;amp;&amp;amp; var1 ? 0 : 1;
        return var2;
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;2-åˆ©ç”¨javassistä¿®æ”¹å­—èŠ‚ç &#34;&gt;2. åˆ©ç”¨Javassistä¿®æ”¹å­—èŠ‚ç &lt;/h2&gt;
&lt;h3 id=&#34;mavenæ·»åŠ ä¾èµ–&#34;&gt;Mavenæ·»åŠ ä¾èµ–&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.javassist&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;javassist&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;${javaassist.version}&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
 
&amp;lt;properties&amp;gt;
    &amp;lt;javaassist.version&amp;gt;3.21.0-GA&amp;lt;/javaassist.version&amp;gt;
&amp;lt;/properties&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;ç¼–å†™æ–¹æ³•&#34;&gt;ç¼–å†™æ–¹æ³•&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public void removeWatermark() throws NotFoundException, CannotCompileException, IOException {
        ClassPool.getDefault().insertClassPath(&amp;quot;xxxx&amp;quot;); // jaråŒ…çš„ç»å¯¹è·¯å¾„
        CtClass targetClass = ClassPool.getDefault().getCtClass(&amp;quot;com.aspose.words.zzZJ5&amp;quot;); //ç±»è·¯å¾„
        CtMethod targetMethod = targetClass.getDeclaredMethod(&amp;quot;zzZaQ&amp;quot;); //æ–¹æ³•è·¯å¾„
        targetMethod.setBody(&amp;quot;{return 1;}&amp;quot;); //ä¿®æ”¹æ–¹æ³•ä½“ï¼Œå§‹ç»ˆè¿”å›1
        targetClass.writeFile(&amp;quot;/Users/zexho/Documents/&amp;quot;); //ä¿å­˜ä¿®æ”¹ï¼Œå†…å®¹ä¸ºä¿å­˜çš„è·¯å¾„ã€‚
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;3-æ›´æ–°jaråŒ…&#34;&gt;3. æ›´æ–°JaråŒ…&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;å°†.jaråŒ…ååç¼€æ”¹ä¸ºå…¶ä»–å‹ç¼©æ ¼å¼ã€‚macçš„æ”¹ä¸ºtarï¼Œwinå¯ä»¥æ”¹ä¸ºzip&lt;/li&gt;
&lt;li&gt;è§£å‹tar,å°†æ–°ç”Ÿæˆclassæ–‡ä»¶æ›¿æ¢æ—§çš„&lt;/li&gt;
&lt;li&gt;åˆ é™¤META-INFæ–‡ä»¶ä¸­çš„RSAå’ŒSFæ–‡ä»¶&lt;/li&gt;
&lt;li&gt;ç¡®ä¿å½“å‰ä½ç½®åœ¨ä¸€çº§ç›®å½•ä¸­ï¼Œçœ‹åˆ°è¿™ä¸¤ä¸ªæ–‡ä»¶çš„ä½ç½®ã€‚&lt;br&gt;
&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlgy1gi3x36zscbj306403zdfo.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/li&gt;
&lt;li&gt;é‡æ–°æ‰“åŒ…Jar &lt;code&gt;jar cvf [æ–°æ–‡ä»¶çš„åå­—.jar] .&lt;/code&gt;ä¾‹å¦‚&lt;code&gt;jar cvf aspose-slides-20.5-jdk16.jar .&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;4-mavené‡æ–°å¯¼å…¥jaråŒ…&#34;&gt;4. Mavené‡æ–°å¯¼å…¥JaråŒ…&lt;/h2&gt;
&lt;p&gt;åœ¨mavenä¸­å¯¼å…¥è¯¥jaråŒ…ã€‚ç„¶ååˆ·æ–°å°±å¯ä»¥ç”¨äº†ã€‚&lt;br&gt;
&lt;img src=&#34;https://tva1.sinaimg.cn/large/007S8ZIlgy1gi3x5s3oxsj307n04bjre.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åªèƒ½ä¸ªäººä½¿ç”¨ï¼Œä¸å¯å•†ç”¨&lt;/p&gt;
&lt;/blockquote&gt;
">åç¼–è¯‘+å­—èŠ‚ç æ³¨å…¥ç ´è§£ Aspose Words 20.6</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/g8YKXeC-j/"" data-c="
          &lt;h2 id=&#34;javaè´Ÿæ•°çš„è®¡ç®—è¿‡ç¨‹&#34;&gt;Javaè´Ÿæ•°çš„è®¡ç®—è¿‡ç¨‹&lt;/h2&gt;
&lt;p&gt;javaä¸­æœ€é«˜ä½è¡¨ç¤ºç¬¦å·ä½,0è¡¨ç¤ºæ­£æ•°ï¼Œ1è¡¨ç¤ºè´Ÿæ•°&lt;/p&gt;
&lt;h3 id=&#34;æ ¹æ®åè¿›åˆ¶æ¨ç®—äºŒè¿›åˆ¶&#34;&gt;æ ¹æ®åè¿›åˆ¶æ¨ç®—äºŒè¿›åˆ¶&lt;/h3&gt;
&lt;p&gt;ä»¥-5ä¸ºä¾‹å­&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;-5çš„åŸç ï¼š&lt;code&gt;1000 0101&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ±‚åç  : &lt;code&gt;1111 1010&lt;/code&gt; ï¼Œç¬¦å·ä½ä¸è¿›è¡Œå–å&lt;/li&gt;
&lt;li&gt;æ±‚è¡¥ç ï¼ˆ+1ï¼‰ï¼š&lt;code&gt;1111 1011&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ‰€ä»¥-5ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºä¸º&lt;code&gt;1111 1011&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ ¹æ®äºŒè¿›åˆ¶é€†æ¨åè¿›åˆ¶&#34;&gt;æ ¹æ®äºŒè¿›åˆ¶é€†æ¨åè¿›åˆ¶&lt;/h3&gt;
&lt;p&gt;ä»¥&lt;code&gt;10001010&lt;/code&gt;ä¸ºä¾‹å­&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è·å–è¡¥ç ,ï¼ˆ-1æ“ä½œï¼‰&lt;/p&gt;
&lt;p&gt;&lt;code&gt;10001010 - 1 = 10001001&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è·å–åç &lt;/p&gt;
&lt;p&gt;&lt;code&gt;10001001&lt;/code&gt; çš„åç  &lt;code&gt;11110110&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸çœ‹ç¬¦å·ä½ï¼Œç®—å‡ºå¤§å°&lt;/p&gt;
&lt;p&gt;&lt;code&gt;1110110&lt;/code&gt;  å¯¹åº”çš„å€¼ä¸º &lt;code&gt;118&lt;/code&gt;ï¼Œæ‰€ä»¥10001010çš„å€¼å°±æ˜¯-118&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºæ¥ï¼Œå¯¹äºè´Ÿæ•°è€Œè¨€ï¼Œå› ä¸º&lt;code&gt;1000 0000&lt;/code&gt; åä¸ƒä½å› ä¸ºè¦å–åï¼Œæ‰€ä»¥åä¸ƒä½è¶Šå¤§åè€Œç»å¯¹å€¼è¶Šå°ï¼Œä¾‹å¦‚&lt;code&gt;1111 1111&lt;/code&gt; ç­‰äº-1ï¼Œè€Œ&lt;code&gt;1111 1110&lt;/code&gt; ç­‰äº-2&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå¯¹äºè´Ÿæ•°è€Œè¨€ &lt;code&gt;1000 0000&lt;/code&gt; å°±æ˜¯ç»å¯¹å€¼æœ€å¤§ï¼Œç›¸å¯¹å€¼æœ€å°çš„äº†ï¼Œç­‰äº-128&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡&#34;&gt;ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆåœ¨è®¡ç®—æœºä¸­å‡æ³•å®é™…ä¸Šæ˜¯åŠ æ³•ï¼Œ2-1 == 2 + (-1)ï¼Œé‚£ä¹ˆè¿›è¡Œæ¨ç†ä¸€ä¸‹&lt;/p&gt;
&lt;h3 id=&#34;å¦‚æœéƒ½ç”¨åŸç &#34;&gt;å¦‚æœéƒ½ç”¨åŸç &lt;/h3&gt;
&lt;p&gt;&lt;code&gt;2&lt;/code&gt; çš„åŸç ï¼š&lt;code&gt;0000 0010&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-1&lt;/code&gt; çš„åŸç : &lt;code&gt;1000 0001&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;2 + (-1)&lt;/code&gt;= &lt;code&gt;10000 0011&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ç­”æ¡ˆæ˜¯æ˜¯ -3ï¼Œç­”æ¡ˆé”™è¯¯&lt;/p&gt;
&lt;h3 id=&#34;å¦‚æœæ­£æ•°ç”¨åŸç è´Ÿæ•°ç”¨è¡¥ç &#34;&gt;å¦‚æœæ­£æ•°ç”¨åŸç ï¼Œè´Ÿæ•°ç”¨è¡¥ç &lt;/h3&gt;
&lt;p&gt;äº‹ä¾‹1&lt;/p&gt;
&lt;p&gt;&lt;code&gt;2&lt;/code&gt;åŸç :&lt;code&gt;0000 0010&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-1&lt;/code&gt;è¡¥ç : &lt;code&gt;1111 1111&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ç›¸åŠ  =&lt;code&gt;0000 0001&lt;/code&gt; ï¼Œå°±ç­‰äº1&lt;/p&gt;
&lt;p&gt;äº‹ä¾‹2&lt;/p&gt;
&lt;p&gt;&lt;code&gt;10&lt;/code&gt;åŸç :&lt;code&gt;0000 1010&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-20&lt;/code&gt;è¡¥ç : &lt;code&gt;1110 1100&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;10 + (-20)&lt;/code&gt; =  &lt;code&gt;1111 0110&lt;/code&gt; ç­‰äº-10&lt;/p&gt;
&lt;h3 id=&#34;ä¸ºä»€ä¹ˆè¦ç”¨è¡¥ç è¡¨ç¤ºè´Ÿæ•°è€Œä¸æ˜¯åç &#34;&gt;ä¸ºä»€ä¹ˆè¦ç”¨è¡¥ç è¡¨ç¤ºè´Ÿæ•°ï¼Œè€Œä¸æ˜¯åç &lt;/h3&gt;
&lt;p&gt;æˆ–è€…æ¢ä¸ªè¯´æ³•ï¼Œä¸ºä»€ä¹ˆè¦è¿›è¡Œ+1æ“ä½œ&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸ç”¨è¡¥ç ,è€Œç”¨åç &lt;/p&gt;
&lt;p&gt;1çš„åŸç : &lt;code&gt;0000 0001&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;-1çš„åç :&lt;code&gt;1111 1110&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;1 + (-1) = &lt;code&gt;1111 1111&lt;/code&gt; = -128&lt;/p&gt;
&lt;p&gt;å¾ˆæ˜æ˜¾ç­”æ¡ˆé”™è¯¯&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆä¸ºä»€ä¹ˆè¦è¿›è¡Œ+1æ“ä½œï¼Œå¦‚æœä½ å¯¹&lt;code&gt;1111 11111&lt;/code&gt; +1å¯ä»¥å‘ç° = &lt;code&gt;0001 0000 0000&lt;/code&gt;ï¼Œè€Œå› ä¸ºbyteçš„å¤§å°åªæœ‰8ä½ï¼Œç¬¬9ä½è¦èˆå¼ƒä¹Ÿå°±æ˜¯&lt;code&gt;0000 0000&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å› ä¸ºè´Ÿæ•°æœ€é«˜ä½å­˜åœ¨ä¸€ä¸ª1ï¼Œä¹Ÿå°±æ˜¯è¯´è´Ÿæ•°å¤©ç„¶è¦æ¯”æ­£æ•°å¤šä¸€ä¸ª1ï¼Œå¯¹äºæ­£æ•°è€Œè¨€ï¼Œä½ å°±å¾—é¢å¤–+1æ‰èƒ½ä¿è¯æ­£æ•°å’Œè´Ÿæ•°æ˜¯ä¸€æ ·å¤§çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äºbyteå–å€¼èŒƒå›´&#34;&gt;å…³äºbyteå–å€¼èŒƒå›´&lt;/h2&gt;
&lt;p&gt;byteçš„å–å€¼èŒƒå›´ä¸º&lt;code&gt;-128 ~ 127&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆè´Ÿå€¼è¦å¤§äºæ­£å€¼ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¯¹äºæœ€å¤§å€¼å¾ˆå®¹æ˜“å¾—å‡ºï¼š&lt;code&gt;0111 1111&lt;/code&gt; å°±ç­‰äº127&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è´Ÿæ•°ä¸åŒï¼Œåœ¨&lt;code&gt;1000 0000&lt;/code&gt;è¿™ä¸ªç‰¹æ®Šæƒ…å†µä¸‹ç¬¦å·ä½æ˜¯å‚ä¸è¿ç®—çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ&lt;code&gt;1000 0000&lt;/code&gt; æ˜¯æœ€å°å€¼ï¼Œè½¬åŒ–æˆåè¿›åˆ¶å°±æ˜¯-128äº†&lt;/p&gt;
&lt;h2 id=&#34;javaä»£ç æµ‹è¯•&#34;&gt;Javaä»£ç æµ‹è¯•&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void main(String[] args) {
        byte x1 = (byte)0b00000010;
        byte x2 = (byte)0b11111111;

        System.out.println(&amp;quot;x1 = &amp;quot; + x1);
        System.out.println(&amp;quot;x2 = &amp;quot; + x2);
        System.out.println(&amp;quot;x1 + x2 = &amp;quot; +  (x1 + x2));

        byte x3 = (byte)0b11111110;
        System.out.println(&amp;quot;x3 = &amp;quot; + x3);

        byte negative20 = (byte)0b11101100;
        System.out.println(&amp;quot;negative20 : &amp;quot; + negative20);

        byte negative10 = (byte)0b11110110;
        System.out.println(&amp;quot;negative10:&amp;quot;+negative10);

    }
&lt;/code&gt;&lt;/pre&gt;
">Javaä¸­äºŒè¿›åˆ¶çš„è¡¥ç ï¼Œåç ï¼Œæ­£è´Ÿæ•°</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/docker_1/"" data-c="
          &lt;h2 id=&#34;1-åœ¨-docker-hub-ä¸‹æŸ¥çœ‹-neo4j-é•œåƒ&#34;&gt;1. åœ¨ docker hub ä¸‹æŸ¥çœ‹ neo4j é•œåƒ&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;docker search neo4j
&lt;/code&gt;&lt;/pre&gt;
&lt;!-- more --&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/15/170480cf6017aa71~tplv-t2oaga2asx-image.image&#34; alt=&#34;image-20200215164627841&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;2-æ‹‰å–-neo4j-é•œåƒ&#34;&gt;2. æ‹‰å– neo4j é•œåƒ&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;docker pull neo4j
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ‹‰å–å®Œæˆåè¾“å…¥å‘½ä»¤å¯ä»¥çœ‹åˆ°é•œåƒå·²ç»å­˜åœ¨&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;docker images
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/15/170480cf6284ad96~tplv-t2oaga2asx-image.image&#34; alt=&#34;image-20200215164707134&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;3-å¯åŠ¨-neo4j-é•œåƒ&#34;&gt;3. å¯åŠ¨ neo4j é•œåƒ&lt;/h2&gt;
&lt;p&gt;æ‰§è¡Œå‘½ä»¤&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-docker&#34;&gt;docker run \
    --publish=7474:7474 --publish=7687:7687 \
    --volume=$HOME/neo4j/data:/data \
    --rm -d neo4j
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/15/170480f43959d204~tplv-t2oaga2asx-image.image&#34; alt=&#34;image-20200215164756361&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;â€‹	&lt;em&gt;å‚æ•°è¯´æ˜ï¼š&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;publish&lt;/strong&gt;: é…ç½®æœ¬æœºä¸å®¹å™¨ä¹‹é—´çš„æ˜ å°„ç«¯å£,&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;volume&lt;/strong&gt;:é…ç½®å…±äº«çš„å®—å·ï¼Œç”¨äºæ•°æ®æŒä¹…åŒ–&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;4-å¯åŠ¨-neo4j-è‡ªå¸¦çš„å‰ç«¯é¡µé¢&#34;&gt;4. å¯åŠ¨ neo4j è‡ªå¸¦çš„å‰ç«¯é¡µé¢&lt;/h2&gt;
&lt;p&gt;åœ¨æµè§ˆå™¨ä¸­è¾“å…¥&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-txt&#34;&gt;http://localhost:7474/browser
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°,è¿™é‡Œçš„ç«¯å£æ˜¯7474,æ˜¯æˆ‘ä»¬ run å‘½ä»¤é‡Œé¢è®¾ç½®çš„.è¿˜æœ‰ä¸€ä¸ªç«¯å£7687ç”¨æ¥è¿æ¥æ•°æ®åº“&lt;/p&gt;
&lt;h2 id=&#34;5-è¿æ¥neo4j&#34;&gt;5. è¿æ¥neo4j&lt;/h2&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;4&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/15/170480cf628a5e65~tplv-t2oaga2asx-image.image&#34; alt=&#34;image-20200215165022204&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;è´¦å·å¯†ç é»˜è®¤éƒ½æ˜¯ neo4j&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è‡³æ­¤å°±è¿æ¥ä¸Šäº†neo4j&lt;/strong&gt;&lt;/p&gt;
">Docker ä¸­æ­å»º Neo4j å›¾æ•°æ®åº“ </a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/git_1/"" data-c="
          &lt;p&gt;åœ¨åˆšå¼€å§‹å­¦ä¹ gitçš„æ—¶å€™ï¼Œæˆ‘å¾ˆç–‘æƒ‘gitå¯ä»¥åŒæ—¶ç®¡ç†è¿™ä¹ˆå¤šåˆ†æ”¯ï¼Œè€Œä¸”åˆ‡æ¢åˆ†æ”¯éƒ½æ˜¯ç¬é—´å®Œæˆã€‚å°½ç®¡Gitå®˜æ–¹æ¨èæˆ‘ä»¬å¤šä½¿ç”¨åˆ†æ”¯å»å¼€å‘ï¼Œä½†æ˜¯å¤©çœŸçš„æˆ‘å¾ˆæ‹…å¿ƒåˆ†æ”¯å¤ªå¤šï¼Œå¯¼è‡´æ–‡ä»¶æ•°é‡ä¼šå‰§å¢ï¼Œæ‰€ä»¥ä¸€ç›´ä¸æ•¢ä½¿ç”¨å¤ªå¤šåˆ†æ”¯ã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;ç›´åˆ°æœ‰ä¸€å¤©æƒ³è¦å»æ­å¼€å¿ƒä¸­çš„ç–‘æƒ‘ï¼Œgitæ˜¯æ€ä¹ˆæ ·ç®¡ç†è¿™äº›ä¸åŒåˆ†æ”¯çš„ï¼Œæœ€åå‘ç°å’Œgité‡Œé¢çš„3ä¸ªå¯¹è±¡æœ‰å…³ï¼Œææ‡‚3ä¸ªå¯¹è±¡çš„å…³ç³»ï¼Œç›¸ä¿¡åœ¨ä»¥åä½¿ç”¨gitå‘½ä»¤çš„æ—¶å€™ï¼Œå¤´è„‘é‡Œä¼šè‡ªç„¶è€Œç„¶çš„æµ®ç°è¿™äº›å¯¹è±¡çš„å…³ç³»ç½‘å›¾&lt;/p&gt;
&lt;p&gt;åœ¨å‘½ä»¤è¡Œä¸­ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;git cat-file -p &amp;lt;object id&amp;gt;&lt;/code&gt;å»æŸ¥çœ‹æ¯ä¸ªå¯¹è±¡é‡Œé¢çš„å†…å®¹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Commitå¯¹è±¡&lt;/p&gt;
&lt;p&gt;ç”±3éƒ¨åˆ†ç»„æˆï¼Œparentå­˜å‚¨çˆ¶commitå¯¹è±¡çš„IDï¼Œæ¯ä¸€ä¸ªcommitå¯¹è±¡éƒ½ä¸€ä¸ªIDï¼Œä½¿ç”¨&lt;code&gt;git log&lt;/code&gt;å¯ä»¥æŸ¥çœ‹ã€‚Treeéƒ¨åˆ†å­˜å‚¨ä¸€ä¸ªTreeå¯¹è±¡çš„IDï¼Œä¸‹é¢éƒ¨åˆ†å­˜å‚¨çš„å°±æ˜¯&lt;code&gt;git commit -m &amp;quot;xxx&amp;quot;&lt;/code&gt;é‡Œé¢çš„æ³¨é‡Šå†…å®¹äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h6 id=&#34;img-srchttpsp1-jjbyteimgcomtos-cn-i-t2oaga2asxgold-user-assets202011216f9a15b6f68a02e~tplv-t2oaga2asx-imageimage-altimage-20200112200749581-stylezoom50&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/12/16f9a15b6f68a02e~tplv-t2oaga2asx-image.image&#34; alt=&#34;image-20200112200749581&#34; style=&#34;zoom:50%;&#34; /&gt;&lt;/h6&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;mark&gt;Tree å¯¹è±¡&lt;/mark&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥æŠŠTreeå¯¹è±¡ç†è§£ä¸ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ¯ä¸€ä¸ªcommitå¯¹è±¡å¯¹åº”ä¸€ä¸ªTreeï¼Œå¯ä»¥æŠŠè¿™ä¸ªTreeå½“ä½œæ ¹ç›®å½•ã€‚è¿™ä¸ªTreeé‡Œé¢å­˜å‚¨äº†æ ¹ç›®å½•ä¸‹çš„å­Treeçš„IDï¼Œä»¥åŠBlobIdã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;mark&gt;Blob å¯¹è±¡&lt;/mark&gt;&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªTreeå¯¹åº”ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ŒBlobå¯¹åº”çš„æ˜¯æ–‡ä»¶ï¼ŒBlogé‡Œé¢å­˜å‚¨çš„ä¹ŸçœŸçš„æ˜¯æ–‡ä»¶çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;ä¸¾ä¸ª&#34;&gt;ä¸¾ä¸ªğŸŒ°&lt;/h4&gt;
&lt;h6 id=&#34;img-srchttpsp1-jjbyteimgcomtos-cn-i-t2oaga2asxgold-user-assets202011216f9a15b7661d997~tplv-t2oaga2asx-imageimage-altimage-20200112202046245-stylezoom50&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/12/16f9a15b7661d997~tplv-t2oaga2asx-image.image&#34; alt=&#34;image-20200112202046245&#34; style=&#34;zoom:50%;&#34; /&gt;&lt;/h6&gt;
&lt;p&gt;gitçš„æ ¹ç›®å½•æ˜¯Javaï¼ŒJavaæ–‡ä»¶å¤¹é‡Œæœ‰ä¸€ä¸ªtest.classæ–‡ä»¶å’Œä¸€ä¸ªJDKæ–‡ä»¶å¤¹ï¼ŒJDKæ–‡ä»¶å¤¹ä¸‹é¢è¿˜æœ‰ä¸€ä¸ªjava8.classæ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç¬¬ä¸€æ¬¡&lt;code&gt;git commit&lt;/code&gt;åçš„å…³ç³»å›¾å°±æ˜¯è¿™æ ·&lt;/p&gt;
&lt;h6 id=&#34;img-srchttpsp1-jjbyteimgcomtos-cn-i-t2oaga2asxgold-user-assets202011216f9a15b78581bba~tplv-t2oaga2asx-imageimage-altimage-20200112202700139-stylezoom-25&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/12/16f9a15b78581bba~tplv-t2oaga2asx-image.image&#34; alt=&#34;image-20200112202700139&#34; style=&#34;zoom: 25%;&#34; /&gt;&lt;/h6&gt;
&lt;p&gt;æ­¤æ—¶æˆ‘ä»¬ä¿®æ”¹äº†test.classæ–‡ä»¶çš„å†…å®¹åï¼Œé‡æ–°&lt;code&gt;git add test.class&lt;/code&gt;å†&lt;code&gt;git commit -m&#39;update&#39;&lt;/code&gt;ï¼Œè¿™æ—¶å€™å°±ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„commitå¯¹è±¡ï¼Œç»“æ„å°±åƒè¿™æ ·:&lt;/p&gt;
&lt;h6 id=&#34;img-srchttpsp1-jjbyteimgcomtos-cn-i-t2oaga2asxgold-user-assets202011216f9a15b7b5e4a69~tplv-t2oaga2asx-imageimage-altimage-20200112203735217-stylezoom25&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/12/16f9a15b7b5e4a69~tplv-t2oaga2asx-image.image&#34; alt=&#34;image-20200112203735217&#34; style=&#34;zoom:25%;&#34; /&gt;&lt;/h6&gt;
&lt;p&gt;å‘ç°åªæ˜¯ä¿å­˜äº†ä¸€ä¸ªæ–°çš„test.classçš„å¿«ç…§ï¼Œjava8.classæ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œå°±æ²¡æœ‰ç”Ÿæˆç”Ÿæˆæ–°çš„å¿«ç…§ã€‚è¿™æ ·çœ‹æ¥ï¼ŒçœŸçš„æ˜¯å¾ˆèŠ‚çœç£ç›˜äº†ã€‚&lt;/p&gt;
&lt;p&gt;gitè¿˜æœ‰è®¸è®¸å¤šå¤šçš„ä½¿ç”¨åœºæ™¯ï¼Œå¦‚æœä½ èƒ½ç†è§£ä»¥ä¸Šçš„å…³ç³»ï¼Œé‚£ä¹ˆå…¶ä»–çš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸å¦¨è‡ªå·±å»å‘½ä»¤è¡Œ &lt;code&gt;git cat-file -p &amp;lt;object id&amp;gt;&lt;/code&gt; éªŒè¯éªŒè¯å§ï½&lt;/p&gt;
&lt;h3 id=&#34;img-srchttpsp1-jjbyteimgcomtos-cn-i-t2oaga2asxgold-user-assets202011216f9a15b80651833~tplv-t2oaga2asx-imageimage-altç›®å½•-stylezoom65-æ¨èé˜…è¯»&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/12/16f9a15b80651833~tplv-t2oaga2asx-image.image&#34; alt=&#34;ç›®å½•&#34; style=&#34;zoom:65%;&#34; /&gt;æ¨èé˜…è¯»&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://ruby-china.org/topics/20723&#34;&gt;ç†è§£gitå¯¹è±¡&lt;/a&gt;&lt;/p&gt;
">Git ä¸­æŒ‡é’ˆä¸æ ‘çš„å®ç°</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/Uh0rKjiE0/"" data-c="
          &lt;blockquote&gt;
&lt;p&gt;ä»Šå¤©çœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œè§‰å¾—ä¸é”™ã€‚&lt;br&gt;
åŸæ–‡é“¾æ¥ï¼šhttps://medium.com/@adamhooper/in-mysql-never-use-utf8-use-utf8mb4-11761243e434&lt;br&gt;
è¯‘æ–‡ï¼šhttps://www.jianshu.com/p/ab9aa8d4df7d&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;&#34;&gt;&lt;/h1&gt;
&lt;p&gt;æœ€è¿‘æˆ‘é‡åˆ°äº†ä¸€ä¸ªbugï¼Œæˆ‘è¯•ç€é€šè¿‡Railsåœ¨ä»¥â€œutf8â€ç¼–ç çš„MariaDBä¸­ä¿å­˜ä¸€ä¸ªUTF-8å­—ç¬¦ä¸²ï¼Œç„¶åå‡ºç°äº†ä¸€ä¸ªç¦»å¥‡çš„é”™è¯¯ï¼š&lt;/p&gt;
&lt;p&gt;Incorrect string value:â€˜Ã°ÂŸÂ˜Âƒ&amp;lt;â€¦â€™for column â€˜summaryâ€™ at row 1&lt;br&gt;
æˆ‘ç”¨çš„æ˜¯UTF-8ç¼–ç çš„å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨ä¹Ÿæ˜¯UTF-8ç¼–ç çš„ï¼Œæ•°æ®åº“ä¹Ÿæ˜¯ï¼Œå°±è¿è¦ä¿å­˜çš„è¿™ä¸ªå­—ç¬¦ä¸²â€œ???? &amp;lt;â€¦â€ä¹Ÿæ˜¯åˆæ³•çš„UTF-8ã€‚&lt;/p&gt;
&lt;p&gt;é—®é¢˜çš„ç—‡ç»“åœ¨äºï¼ŒMySQLçš„â€œutf8â€å®é™…ä¸Šä¸æ˜¯çœŸæ­£çš„UTF-8ã€‚&lt;/p&gt;
&lt;p&gt;â€œutf8â€åªæ”¯æŒæ¯ä¸ªå­—ç¬¦æœ€å¤šä¸‰ä¸ªå­—èŠ‚ï¼Œè€ŒçœŸæ­£çš„UTF-8æ˜¯æ¯ä¸ªå­—ç¬¦æœ€å¤šå››ä¸ªå­—èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;MySQLä¸€ç›´æ²¡æœ‰ä¿®å¤è¿™ä¸ªbugï¼Œä»–ä»¬åœ¨2010å¹´å‘å¸ƒäº†ä¸€ä¸ªå«ä½œâ€œutf8mb4â€çš„å­—ç¬¦é›†ï¼Œç»•è¿‡äº†è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œä»–ä»¬å¹¶æ²¡æœ‰å¯¹æ–°çš„å­—ç¬¦é›†å¹¿è€Œå‘Šä¹‹ï¼ˆå¯èƒ½æ˜¯å› ä¸ºè¿™ä¸ªbugè®©ä»–ä»¬è§‰å¾—å¾ˆå°´å°¬ï¼‰ï¼Œä»¥è‡´äºç°åœ¨ç½‘ç»œä¸Šä»ç„¶åœ¨å»ºè®®å¼€å‘è€…ä½¿ç”¨â€œutf8â€ï¼Œä½†è¿™äº›å»ºè®®éƒ½æ˜¯é”™è¯¯çš„ã€‚&lt;/p&gt;
&lt;p&gt;ç®€å•æ¦‚æ‹¬å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;1.MySQLçš„â€œutf8mb4â€æ˜¯çœŸæ­£çš„â€œUTF-8â€ã€‚&lt;/p&gt;
&lt;p&gt;2.MySQLçš„â€œutf8â€æ˜¯ä¸€ç§â€œä¸“å±çš„ç¼–ç â€ï¼Œå®ƒèƒ½å¤Ÿç¼–ç çš„Unicodeå­—ç¬¦å¹¶ä¸å¤šã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘è¦åœ¨è¿™é‡Œæ¾„æ¸…ä¸€ä¸‹ï¼šæ‰€æœ‰åœ¨ä½¿ç”¨â€œutf8â€çš„MySQLå’ŒMariaDBç”¨æˆ·éƒ½åº”è¯¥æ”¹ç”¨â€œutf8mb4â€ï¼Œæ°¸è¿œéƒ½ä¸è¦å†ä½¿ç”¨â€œutf8â€ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆä»€ä¹ˆæ˜¯ç¼–ç ï¼Ÿä»€ä¹ˆæ˜¯UTF-8ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œè®¡ç®—æœºä½¿ç”¨0å’Œ1æ¥å­˜å‚¨æ–‡æœ¬ã€‚æ¯”å¦‚å­—ç¬¦â€œCâ€è¢«å­˜æˆâ€œ01000011â€ï¼Œé‚£ä¹ˆè®¡ç®—æœºåœ¨æ˜¾ç¤ºè¿™ä¸ªå­—ç¬¦æ—¶éœ€è¦ç»è¿‡ä¸¤ä¸ªæ­¥éª¤ï¼š&lt;/p&gt;
&lt;p&gt;1ã€è®¡ç®—æœºè¯»å–â€œ01000011â€ï¼Œå¾—åˆ°æ•°å­—67ï¼Œå› ä¸º67è¢«ç¼–ç æˆâ€œ01000011â€ã€‚&lt;/p&gt;
&lt;p&gt;2ã€è®¡ç®—æœºåœ¨Unicodeå­—ç¬¦é›†ä¸­æŸ¥æ‰¾67ï¼Œæ‰¾åˆ°äº†â€œCâ€ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ ·çš„ï¼š&lt;/p&gt;
&lt;p&gt;1ã€æˆ‘çš„ç”µè„‘å°†â€œCâ€æ˜ å°„æˆUnicodeå­—ç¬¦é›†ä¸­çš„67ã€‚&lt;/p&gt;
&lt;p&gt;2ã€æˆ‘çš„ç”µè„‘å°†67ç¼–ç æˆâ€œ01000011â€ï¼Œå¹¶å‘é€ç»™WebæœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;p&gt;å‡ ä¹æ‰€æœ‰çš„ç½‘ç»œåº”ç”¨éƒ½ä½¿ç”¨äº†Unicodeå­—ç¬¦é›†ï¼Œå› ä¸ºæ²¡æœ‰ç†ç”±ä½¿ç”¨å…¶ä»–å­—ç¬¦é›†ã€‚&lt;/p&gt;
&lt;p&gt;Unicodeå­—ç¬¦é›†åŒ…å«äº†ä¸Šç™¾ä¸‡ä¸ªå­—ç¬¦ã€‚æœ€ç®€å•çš„ç¼–ç æ˜¯UTF-32ï¼Œæ¯ä¸ªå­—ç¬¦ä½¿ç”¨32ä½ã€‚è¿™æ ·åšæœ€ç®€å•ï¼Œå› ä¸ºä¸€ç›´ä»¥æ¥ï¼Œè®¡ç®—æœºå°†32ä½è§†ä¸ºæ•°å­—ï¼Œè€Œè®¡ç®—æœºæœ€åœ¨è¡Œçš„å°±æ˜¯å¤„ç†æ•°å­—ã€‚ä½†é—®é¢˜æ˜¯ï¼Œè¿™æ ·å¤ªæµªè´¹ç©ºé—´äº†ã€‚&lt;/p&gt;
&lt;p&gt;UTF-8å¯ä»¥èŠ‚çœç©ºé—´ï¼Œåœ¨UTF-8ä¸­ï¼Œå­—ç¬¦â€œCâ€åªéœ€è¦8ä½ï¼Œä¸€äº›ä¸å¸¸ç”¨çš„å­—ç¬¦ï¼Œæ¯”å¦‚â€œâ€éœ€è¦32ä½ã€‚å…¶ä»–çš„å­—ç¬¦å¯èƒ½ä½¿ç”¨16ä½æˆ–24ä½ã€‚ä¸€ç¯‡ç±»ä¼¼æœ¬æ–‡è¿™æ ·çš„æ–‡ç« ï¼Œå¦‚æœä½¿ç”¨UTF-8ç¼–ç ï¼Œå ç”¨çš„ç©ºé—´åªæœ‰UTF-32çš„å››åˆ†ä¹‹ä¸€å·¦å³ã€‚&lt;/p&gt;
&lt;p&gt;MySQLçš„â€œutf8â€å­—ç¬¦é›†ä¸å…¶ä»–ç¨‹åºä¸å…¼å®¹ï¼Œå®ƒæ‰€è°“çš„â€œâ€ï¼Œå¯èƒ½çœŸçš„æ˜¯ä¸€å¨â€¦â€¦&lt;br&gt;
MySQLç®€å²&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆMySQLå¼€å‘è€…ä¼šè®©â€œutf8â€å¤±æ•ˆï¼Ÿæˆ‘ä»¬æˆ–è®¸å¯ä»¥ä»æäº¤æ—¥å¿—ä¸­å¯»æ‰¾ç­”æ¡ˆã€‚&lt;br&gt;
MySQLä»4.1ç‰ˆæœ¬å¼€å§‹æ”¯æŒUTF-8ï¼Œä¹Ÿå°±æ˜¯2003å¹´ï¼Œè€Œä»Šå¤©ä½¿ç”¨çš„UTF-8æ ‡å‡†ï¼ˆRFC3629ï¼‰æ˜¯éšåæ‰å‡ºç°çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ—§ç‰ˆçš„UTF-8æ ‡å‡†ï¼ˆRFC2279ï¼‰æœ€å¤šæ”¯æŒæ¯ä¸ªå­—ç¬¦6ä¸ªå­—èŠ‚ã€‚2002å¹´3æœˆ28æ—¥ï¼ŒMySQLå¼€å‘è€…åœ¨ç¬¬ä¸€ä¸ªMySQL4.1é¢„è§ˆç‰ˆä¸­ä½¿ç”¨äº†RFC2279ã€‚&lt;/p&gt;
&lt;p&gt;åŒå¹´9æœˆï¼Œä»–ä»¬å¯¹MySQLæºä»£ç è¿›è¡Œäº†ä¸€æ¬¡è°ƒæ•´ï¼šâ€œUTF8ç°åœ¨æœ€å¤šåªæ”¯æŒ3ä¸ªå­—èŠ‚çš„åºåˆ—â€ã€‚&lt;br&gt;
æ˜¯è°æäº¤äº†è¿™äº›ä»£ç ï¼Ÿä»–ä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿè¿™ä¸ªé—®é¢˜ä¸å¾—è€ŒçŸ¥ã€‚åœ¨è¿ç§»åˆ°Gitåï¼ˆMySQLæœ€å¼€å§‹ä½¿ç”¨çš„æ˜¯BitKeeperï¼‰ï¼ŒMySQLä»£ç åº“ä¸­çš„å¾ˆå¤šæäº¤è€…çš„åå­—éƒ½ä¸¢å¤±äº†ã€‚2003å¹´9æœˆçš„é‚®ä»¶åˆ—è¡¨ä¸­ä¹Ÿæ‰¾ä¸åˆ°å¯ä»¥è§£é‡Šè¿™ä¸€å˜æ›´çš„çº¿ç´¢ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡æˆ‘å¯ä»¥è¯•ç€çŒœæµ‹ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;2002å¹´ï¼ŒMySQLåšå‡ºäº†ä¸€ä¸ªå†³å®šï¼šå¦‚æœç”¨æˆ·å¯ä»¥ä¿è¯æ•°æ®è¡¨çš„æ¯ä¸€è¡Œéƒ½ä½¿ç”¨ç›¸åŒçš„å­—èŠ‚æ•°ï¼Œé‚£ä¹ˆMySQLå°±å¯ä»¥åœ¨æ€§èƒ½æ–¹é¢æ¥ä¸€ä¸ªå¤§æå‡ã€‚ä¸ºæ­¤ï¼Œç”¨æˆ·éœ€è¦å°†æ–‡æœ¬åˆ—å®šä¹‰ä¸ºâ€œCHARâ€ï¼Œæ¯ä¸ªâ€œCHARâ€åˆ—æ€»æ˜¯æ‹¥æœ‰ç›¸åŒæ•°é‡çš„å­—ç¬¦ã€‚å¦‚æœæ’å…¥çš„å­—ç¬¦å°‘äºå®šä¹‰çš„æ•°é‡ï¼ŒMySQLå°±ä¼šåœ¨åé¢å¡«å……ç©ºæ ¼ï¼Œå¦‚æœæ’å…¥çš„å­—ç¬¦è¶…è¿‡äº†å®šä¹‰çš„æ•°é‡ï¼Œåé¢è¶…å‡ºéƒ¨åˆ†ä¼šè¢«æˆªæ–­ã€‚&lt;/p&gt;
&lt;p&gt;MySQLå¼€å‘è€…åœ¨æœ€å¼€å§‹å°è¯•UTF-8æ—¶ä½¿ç”¨äº†æ¯ä¸ªå­—ç¬¦6ä¸ªå­—èŠ‚ï¼ŒCHAR(1)ä½¿ç”¨6ä¸ªå­—èŠ‚ï¼ŒCHAR(2)ä½¿ç”¨12ä¸ªå­—èŠ‚ï¼Œå¹¶ä»¥æ­¤ç±»æ¨ã€‚&lt;/p&gt;
&lt;p&gt;åº”è¯¥è¯´ï¼Œä»–ä»¬æœ€åˆçš„è¡Œä¸ºæ‰æ˜¯æ­£ç¡®çš„ï¼Œå¯æƒœè¿™ä¸€ç‰ˆæœ¬ä¸€ç›´æ²¡æœ‰å‘å¸ƒã€‚ä½†æ˜¯æ–‡æ¡£ä¸Šå´è¿™ä¹ˆå†™äº†ï¼Œè€Œä¸”å¹¿ä¸ºæµä¼ ï¼Œæ‰€æœ‰äº†è§£UTF-8çš„äººéƒ½è®¤åŒæ–‡æ¡£é‡Œå†™çš„ä¸œè¥¿ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡å¾ˆæ˜¾ç„¶ï¼ŒMySQLå¼€å‘è€…æˆ–å‚å•†æ‹…å¿ƒä¼šæœ‰ç”¨æˆ·åšè¿™ä¸¤ä»¶äº‹ï¼š&lt;/p&gt;
&lt;p&gt;1ã€ä½¿ç”¨CHARå®šä¹‰åˆ—ï¼ˆåœ¨ç°åœ¨çœ‹æ¥ï¼ŒCHARå·²ç»æ˜¯è€å¤è‘£äº†ï¼Œä½†åœ¨é‚£æ—¶ï¼Œåœ¨MySQLä¸­ä½¿ç”¨CHARä¼šæ›´å¿«ï¼Œä¸è¿‡ä»2005å¹´ä»¥åå°±ä¸æ˜¯è¿™æ ·å­äº†ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;2ã€å°†CHARåˆ—çš„ç¼–ç è®¾ç½®ä¸ºâ€œutf8â€ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘çš„çŒœæµ‹æ˜¯MySQLå¼€å‘è€…æœ¬æ¥æƒ³å¸®åŠ©é‚£äº›å¸Œæœ›åœ¨ç©ºé—´å’Œé€Ÿåº¦ä¸ŠåŒèµ¢çš„ç”¨æˆ·ï¼Œä½†ä»–ä»¬æç ¸äº†â€œutf8â€ç¼–ç ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ç»“æœå°±æ˜¯æ²¡æœ‰èµ¢å®¶ã€‚é‚£äº›å¸Œæœ›åœ¨ç©ºé—´å’Œé€Ÿåº¦ä¸ŠåŒèµ¢çš„ç”¨æˆ·ï¼Œå½“ä»–ä»¬åœ¨ä½¿ç”¨â€œutf8â€çš„CHARåˆ—æ—¶ï¼Œå®é™…ä¸Šä½¿ç”¨çš„ç©ºé—´æ¯”é¢„æœŸçš„æ›´å¤§ï¼Œé€Ÿåº¦ä¹Ÿæ¯”é¢„æœŸçš„æ…¢ã€‚è€Œæƒ³è¦æ­£ç¡®æ€§çš„ç”¨æˆ·ï¼Œå½“ä»–ä»¬ä½¿ç”¨â€œutf8â€ç¼–ç æ—¶ï¼Œå´æ— æ³•ä¿å­˜åƒâ€œâ€è¿™æ ·çš„å­—ç¬¦ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªä¸åˆæ³•çš„å­—ç¬¦é›†å‘å¸ƒäº†ä¹‹åï¼ŒMySQLå°±æ— æ³•ä¿®å¤å®ƒï¼Œå› ä¸ºè¿™æ ·éœ€è¦è¦æ±‚æ‰€æœ‰ç”¨æˆ·é‡æ–°æ„å»ºä»–ä»¬çš„æ•°æ®åº“ã€‚æœ€ç»ˆï¼ŒMySQLåœ¨2010å¹´é‡æ–°å‘å¸ƒäº†â€œutf8mb4â€æ¥æ”¯æŒçœŸæ­£çš„UTF-8ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆè¿™ä»¶äº‹æƒ…ä¼šè®©äººå¦‚æ­¤æŠ“ç‹‚ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å› ä¸ºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æ•´æ•´æŠ“ç‹‚äº†ä¸€ä¸ªç¤¼æ‹œã€‚æˆ‘è¢«â€œutf8â€æ„šå¼„äº†ï¼ŒèŠ±äº†å¾ˆå¤šæ—¶é—´æ‰æ‰¾åˆ°è¿™ä¸ªbugã€‚ä½†æˆ‘ä¸€å®šä¸æ˜¯å”¯ä¸€çš„ä¸€ä¸ªï¼Œç½‘ç»œä¸Šå‡ ä¹æ‰€æœ‰çš„æ–‡ç« éƒ½æŠŠâ€œutf8â€å½“æˆæ˜¯çœŸæ­£çš„UTF-8ã€‚&lt;br&gt;
â€œutf8â€åªèƒ½ç®—æ˜¯ä¸ªä¸“æœ‰çš„å­—ç¬¦é›†ï¼Œå®ƒç»™æˆ‘ä»¬å¸¦æ¥äº†æ–°é—®é¢˜ï¼Œå´ä¸€ç›´æ²¡æœ‰å¾—åˆ°è§£å†³ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ç»“&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ åœ¨ä½¿ç”¨MySQLæˆ–MariaDBï¼Œä¸è¦ç”¨â€œutf8â€ç¼–ç ï¼Œæ”¹ç”¨â€œutf8mb4â€ã€‚è¿™é‡Œï¼ˆhttps://mathiasbynens.be/notes/mysql-utf8mb4#utf8-to-utf8mb4ï¼‰æä¾›äº†ä¸€ä¸ªæŒ‡å—ç”¨äºå°†ç°æœ‰æ•°æ®åº“çš„å­—ç¬¦ç¼–ç ä»â€œutf8â€è½¬æˆâ€œutf8mb4â€ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç¼–å·3722ï¼Œè¾“å…¥ç¼–å·ç›´è¾¾æœ¬æ–‡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¾“å…¥mè·å–æ–‡ç« ç›®å½•&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä¸ªäººæ€»ç»“&#34;&gt;ä¸ªäººæ€»ç»“&lt;/h2&gt;
&lt;p&gt;å¯¹äºä½œè€…è¯´çš„ä¸è¦å†ä½¿ç”¨utf-8ï¼Œæœ¬äººä¸å®Œå…¨è®¤åŒï¼Œå®Œå…¨å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™æ‰ä½¿ç”¨utf8mb4ï¼ˆæ¯•ç«Ÿutf-8æ›´çœç©ºé—´ï¼‰åƒå¾®ä¿¡å°ç¨‹åºï¼Œç¼–ç çš„å‘å¤§å®¶åº”è¯¥éƒ½è¸©è¿‡ï¼Œå¯æ˜¯é™¤äº†è¿™ä¸ªå¤–ï¼Œä¼¼ä¹ä¹Ÿæ²¡é‡åˆ°è¿‡ä»€ä¹ˆé—®é¢˜ã€‚æ‰€ä»¥äº†è§£è¿™ä¹ˆä¸€ä¸ªé—®é¢˜åï¼Œä»¥åå®Œå…¨å¯ä»¥æŒ‰éœ€è¦æ¥ç¡®å®šä½¿ç”¨ä½•ç§ç¼–ç ã€‚&lt;/p&gt;
">Mysql UTF-8 ç¼–ç æ³¨æ„äº‹é¡¹</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/wNJouB2lg/"" data-c="
          &lt;blockquote&gt;
&lt;p&gt;æœ‰ä¸€æ¬¡æˆ‘çš„é¡¹ç›®ä¸­é‡‡ç”¨äº†å‰åç«¯åˆ†ç¦»çš„æ¨¡å¼ï¼Œå¼•èµ·äº†è·¨åŸŸé—®é¢˜ï¼Œæœ¬æ–‡å°†ä»‹ç»æˆ‘æ‰€é‡‡ç”¨çš„è·¨åŸŸè§£å†³æ–¹æ³•ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é¦–å…ˆè¦äº†è§£äº§ç”Ÿè·¨åŸŸçš„æœ¬è´¨ï¼Œä¹Ÿå°±æ˜¯åŒæºç­–ç•¥çš„é™åˆ¶ï¼Œæºæ˜¯æŒ‡åŸŸåã€ç«¯å£å·ã€åè®®ï¼Œæœ‰ä¸€è€…ä¸ç›¸åŒå°†è¢«æµè§ˆå™¨æ‹’ç»æ¥å—å“åº”ä¿¡æ¯ï¼Œï¼ˆè¯·æ±‚å¯ä»¥å‘é€å‡ºå»ï¼Œä½†æ˜¯æµè§ˆå™¨ä¸æ¥å—å“åº”ï¼‰ã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;è§£å†³æ–¹æ³•&#34;&gt;è§£å†³æ–¹æ³•ï¼š&lt;/h2&gt;
&lt;h3 id=&#34;1-jsonp&#34;&gt;1. jsonp&lt;/h3&gt;
&lt;p&gt;jsonpçš„åŸç†çš„ src=&amp;quot;&amp;quot; å±æ€§ä¸å—åŒæºç­–ç•¥çš„é™åˆ¶ï¼ŒåŠ¨æ€åˆ›å»ºä¸€ä¸ªcallbackå›è°ƒå‡½æ•°ï¼ŒæœåŠ¡å™¨è°ƒç”¨å›è°ƒå‡½æ•°æŠŠæ•°æ®æ”¾è¿›å»ï¼Œå…·ä½“çš„ç»†èŠ‚æ‰“ç®—ä»¥ååšä¸€ä¸ªä¸“é—¨è®²è§£ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œç»™ä¸€ä¸ªæ¨¡ç‰ˆ:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;            $.ajax({
             type: &amp;quot;get&amp;quot;,               //jsonpåªèƒ½ä½¿ç”¨get
             async: false,
             url: &amp;quot;&amp;quot;
             dataType: &amp;quot;jsonp&amp;quot;,
             jsonp: &amp;quot;callback&amp;quot;,        
             jsonpCallback:&amp;quot;message&amp;quot;,       //æ³¨æ„è¿™é‡Œç»™å›è°ƒå‡½æ•°èµ·çš„åå­—
                 success: function(json){
                 
                }
            })
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚æœè¿™é‡Œä½ çš„å›è°ƒå‡½æ•°èµ·åä¸ºmessageï¼Œé‚£ä¹ˆä½ åœ¨åç«¯è¿”å›jsonçš„æ—¶å€™ï¼Œä¹Ÿè¦æ³¨æ„åœ¨æœ€å¤–é¢åŒ…ä¸€å±‚message{}ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œjsonpçš„ç¼ºç‚¹ä¹Ÿå¯ä»¥æ˜æ˜¾çš„çœ‹å‡ºï¼Œåªæ”¯æŒgetè¯·æ±‚ï¼ŒåŸå› å°±æ˜¯å› ä¸ºé€šè¿‡src=â€œâ€å‘é€è¯·æ±‚ï¼Œæ‰€ä»¥å¯ä»¥çŸ¥é“æ˜¯urlä¼ å‚ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆjsonpçš„å¥½å¤„æ˜¯ä»€ä¹ˆå‘¢ï¼Œå…¼å®¹æ€§ï¼Œå‡ ä¹æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒï¼ˆåŒ…æ‹¬ä¸€äº›ç‰ˆæœ¬æ¯”è¾ƒè€çš„ï¼‰ï¼Œä¸éœ€è¦XMLHttpRequestæˆ–ActiveXçš„æ”¯æŒã€‚&lt;/p&gt;
&lt;h3 id=&#34;2-cors&#34;&gt;2. cors&lt;/h3&gt;
&lt;p&gt;åˆç§°è·¨åŸŸè®¿é—®ï¼Œæµè§ˆå™¨å°†corsè¯·æ±‚åˆ†ä¸ºç®€å•è¯·æ±‚å’Œéç®€å•è¯·æ±‚ï¼Œå› ä¸ºæœ¬æ–‡ä¸»è¦è®²è§£å…·ä½“çš„æ–¹æ³•ï¼Œæ‰€ä»¥å…³äºç»†èŠ‚éƒ¨åˆ†æœ‰å…´è¶£å¯ä»¥å»çœ‹å…¶ä»–åšå®¢æˆ–è€…æˆ‘ä»¥åå†åšä¸€ç¯‡å…·ä½“çš„è®²è§£ï¼ˆå’Œjsonpä¸€èµ·ï¼‰ã€‚åœ¨springbootä¸­ï¼Œå®˜æ–¹å·²ç»æä¾›äº†æ”¯æŒã€‚ç›´æ¥è´´ä»£ç ï¼š&lt;/p&gt;
&lt;h3 id=&#34;æ–¹å¼ä¸€å…¨å±€å®šä¹‰&#34;&gt;æ–¹å¼ä¸€ï¼šå…¨å±€å®šä¹‰&lt;/h3&gt;
&lt;p&gt;æ³¨æ„@Orderè¿™ä¸ªæ³¨è§£ï¼Œä¸åŠ çš„è¯å¾ˆå¤§å¯èƒ½å¯¼è‡´é…ç½®å¤±æ•ˆ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;    @Component
    @Order(Ordered.HIGHEST_PRECEDENCE)
    public class CorsFilter implements Filter {
        @Override
        public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) throws IOException, ServletException {
            HttpServletResponse response = (HttpServletResponse) res;
            HttpServletRequest request = (HttpServletRequest) req;
            response.setHeader(&amp;quot;Access-Control-Allow-Origin&amp;quot;, &amp;quot;*&amp;quot;);
            response.setHeader(&amp;quot;Access-Control-Allow-Credentials&amp;quot;, &amp;quot;true&amp;quot;);
            response.setHeader(&amp;quot;Access-Control-Allow-Methods&amp;quot;,
                    &amp;quot;ACL, CANCELUPLOAD, CHECKIN, CHECKOUT, COPY, DELETE, GET, HEAD, LOCK, MKCALENDAR, MKCOL, MOVE, OPTIONS, POST, PROPFIND, PROPPATCH, PUT, REPORT, SEARCH, UNCHECKOUT, UNLOCK, UPDATE, VERSION-CONTROL&amp;quot;);
            response.setHeader(&amp;quot;Access-Control-Max-Age&amp;quot;, &amp;quot;3600&amp;quot;);
            response.setHeader(&amp;quot;Access-Control-Allow-Headers&amp;quot;,
                    &amp;quot;Origin, X-Requested-With, Content-Type, Accept, x-userId&amp;quot;);

            if (&amp;quot;OPTIONS&amp;quot;.equalsIgnoreCase(request.getMethod())) {
                response.setStatus(HttpServletResponse.SC_OK);
            } else {
                chain.doFilter(req, res);
            }
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æ–¹å¼äºŒå±€éƒ¨å®šä¹‰&#34;&gt;æ–¹å¼äºŒï¼šå±€éƒ¨å®šä¹‰&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;        @CrossOrigin(origins = &amp;quot;*&amp;quot;,allowCredentials=&amp;quot;true&amp;quot;,allowedHeaders = &amp;quot;&amp;quot;,methods = {})
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç›´æ¥åœ¨éœ€è¦è·¨åŸŸçš„æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£,ååˆ†æ–¹ä¾¿ã€‚ä¹Ÿå¯ä»¥åœ¨ç±»ä¸Šä½¿ç”¨è¯¥æ³¨è§£.&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“ï¼š&lt;/h2&gt;
&lt;p&gt;ä¸ªäººæ¨èä½¿ç”¨corsï¼Œå¦‚æœå› ä¸ºå…¼å®¹æ€§é—®é¢˜ä¸å¾—ä¸ä½¿ç”¨jsonpé‚£ä¹Ÿæ²¡åŠæ³•ã€‚ç„¶åå¦‚æœæ˜¯å‰åç«¯åˆ†ç¦»çš„æ¨¡å¼ä¸‹ï¼Œå¯¹äºç”¨æˆ·æƒé™éªŒè¯è¿™ä¸€å—ä¹Ÿæ˜¯ä¸€ä¸ªéœ€è¦æ³¨æ„ç‚¹ï¼Œå¦‚æœä½¿ç”¨cookie-sessionï¼Œè·¨åŸŸä¼šå¯¼è‡´åå°è·å–ä¸åˆ°sessionï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨tokençš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æ‰“ç®—ä»¥åä»‹ç»ä¸€ä¸‹jwtï¼ˆJson web Tokenï¼‰æ¥å®ç°ç”¨æˆ·è®¤è¯ã€‚&lt;/p&gt;
">SpringBoot è·¨åŸŸ Jsonp å’Œ Cors</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/gei-xue-di-men-fen-xi-wireshark/"" data-c="
          &lt;blockquote&gt;
&lt;p&gt;å‰ä¸€é˜µå­è¦ç»™å®éªŒå®¤çš„å­¦å¼Ÿä»¬æŠ€æœ¯åˆ†äº«ï¼Œå½“æ—¶æ”¶åˆ°å»ºè®®ç»™ä»–ä»¬æ™®åŠä¸€äº›è®¡ç®—æœºç½‘ç»œçš„çŸ¥è¯†ï¼Œå¯æ˜¯å…³&lt;br&gt;
æœ‰ç†è®ºçŸ¥è¯†è®²è¯¾è‚¯å®šä¸å¤Ÿå¸å¼•äººï¼Œäºæ˜¯ä¾¿ä¸€è¾¹å­¦ä¹ Wiresharkä¸€è¾¹åšPPTä¸€è¾¹å†™è®²ç¨¿ã€‚å¿™ç¢Œäº†ä¸¤ä¸ªæ˜ŸæœŸåï¼Œåˆ†äº«ä¼šåè¿˜æ˜¯å¾—åˆ°äº†ä¸é”™çš„çš„è¯„ä»·ğŸ˜ï¼Œæˆ‘ä¹Ÿåœ¨åšå®¢ä¸­æ€»ç»“ä¸‹ä¸€äº›ä½¿ç”¨æŠ€å·§ï¼Œå†…å®¹ä¸»è¦é¢å‘æ–°æ‰‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;1-wiresharkçš„ç”¨é€”&#34;&gt;1. WireSharkçš„ç”¨é€”&lt;/h2&gt;
&lt;h3 id=&#34;ç”¨é€”ä¸€-å­¦ä¹ ç½‘ç»œçŸ¥è¯†æä¾›å®é™…æ“ä½œ&#34;&gt;ç”¨é€”ä¸€ï¼š å­¦ä¹ ç½‘ç»œçŸ¥è¯†ï¼Œæä¾›å®é™…æ“ä½œ&lt;/h3&gt;
&lt;p&gt;åœ¨æˆ‘å¤§äºŒå­¦ä¹ è®¡ç®—æœºç½‘ç»œçš„æ—¶å€™ï¼Œè€å¸ˆä¸Šè¯¾åªè´Ÿè´£ä¹¦æœ¬çš„è®²è§£ï¼Œå¯¼è‡´æˆ‘äº§ç”Ÿäº†è®¡ç®—æœºç½‘ç»œå¾ˆæ— èŠçš„é”™è§‰ï¼Œæ‰€ä»¥é‚£æ—¶å€™ä¹Ÿæ²¡å¤ªè®¤çœŸçš„å­¦ä¹ è¿™é—¨è¯¾ç¨‹ã€‚ä½†æ˜¯åæ¥å½“æˆ‘è‡ªå·±è¾¹æŠ“åŒ…è¾¹æ¸©ä¹ è®¡ç½‘çŸ¥è¯†çš„æ—¶å€™ï¼Œæ‰å‘ç°æ˜¯å¦‚æ­¤çš„æœ‰è¶£ã€‚è€Œåœ¨æŠ“åŒ…å·¥å…·ä¸­ï¼Œæˆ‘ä½¿ç”¨è¿‡å°èŠ±ç“¶ï¼ˆcharlesï¼‰å’Œå°é²¨é±¼ï¼ˆwiresharkï¼‰ï¼Œæˆ‘æ¨èå°é²¨é±¼ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿˜æœ‰ä¸€æ¬¾æ¯”è¾ƒæµè¡Œï¼Œå«fiddlerï¼Œå› ä¸ºæœ¬äººä½¿ç”¨macï¼Œfiddleræœªæ¨å‡ºmacç‰ˆï¼Œæ‰€ä»¥æœªæ¥è§¦è¿‡å®ƒ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;ç”¨é€”äºŒ-è·å–ç½‘ç»œèµ„æºä¿¡æ¯&#34;&gt;ç”¨é€”äºŒï¼š è·å–ç½‘ç»œèµ„æºä¿¡æ¯&lt;/h3&gt;
&lt;p&gt;é€šä¿—ç‚¹è®²å°±æ˜¯æŠ“åŒ…ï¼Œwiresharkå¯ä»¥æŠ“çš„è¯·æ±‚ç±»å‹éå¸¸å¤šï¼Œæ–°æ‰‹å¸¸è§çš„åƒhttpã€httpsï¼ˆéœ€è¦ä¸‹è½½è¡¥ä¸ï¼‰ã€tcpã€udpã€arpç­‰ç­‰éƒ½å¯ä»¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç”¨é€”ä¸‰è¿›è¡Œç½‘ç»œçŠ¶å†µåˆ†æ&#34;&gt;ç”¨é€”ä¸‰ï¼šè¿›è¡Œç½‘ç»œçŠ¶å†µåˆ†æ&lt;/h3&gt;
&lt;p&gt;æ¯”å¦‚ç½‘ç»œæ•…éšœæ’æŸ¥ï¼Œå› ä¸ºæœ¬äººä¹Ÿæ²¡åˆ©ç”¨wiresharkåˆ†æè¿‡ï¼Œæ‰€ä»¥å°±ä¸è¯¯å¯¼å¤§å®¶äº†ï¼Œä¸è¿‡æˆ‘æ¨èä¸€æœ¬ä¹¦ï¼Œä¹Ÿæ˜¯æˆ‘å­¦ä¹ wiresharkçš„ä¸€æœ¬ä¹¦ã€‚&lt;br&gt;
&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b034e550e178ea~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ä½œè€…çš„é£æ ¼çœŸçš„å¾ˆé£è¶£ï¼Œè¯»èµ·æ¥å°±åƒå°è¯´ä¸€æ ·ï¼ŒæŒ‡ä¸å®šå“ªä¸ªåœ°æ–¹å°±ä¼šå·å·å†’å‡ºä¸€æ®µç¬‘è¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2-æŠ“åŒ…å‰çš„å‡†å¤‡å·¥ä½œ&#34;&gt;2. æŠ“åŒ…å‰çš„å‡†å¤‡å·¥ä½œ&lt;/h2&gt;
&lt;h3 id=&#34;1-ä¿®æ”¹ç€è‰²è§„åˆ™&#34;&gt;1. ä¿®æ”¹ç€è‰²è§„åˆ™&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„é€‚åˆï¼Œæ˜¾ç¤ºçš„ç•Œé¢å¯èƒ½åƒè¿™æ ·&lt;br&gt;
&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/14/16f04764d3d10a9f~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ä¸€ç‰‡ç™½çš„ï¼Œå¯¹äºæˆ‘ä»¬å¿«é€Ÿåˆ†è¾¨ä¸åŒè¯·æ±‚ç±»å‹æ˜¯æœ‰å¦¨ç¢çš„ï¼Œæ‰€ä»¥ç®€å•æ“ä½œä¸‹ï¼š&lt;/p&gt;
&lt;h4 id=&#34;1-æ‰“å¼€è§†å›¾é€‰é¡¹æ‰¾åˆ°ç€è‰²è§„åˆ™å°±åƒ&#34;&gt;1ï¼‰ï¼š æ‰“å¼€è§†å›¾é€‰é¡¹ï¼Œæ‰¾åˆ°ç€è‰²è§„åˆ™ï¼Œå°±åƒ&lt;/h4&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b03844f45a802a~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h4 id=&#34;2-ä¿®æ”¹èƒŒæ™¯é…è‰²&#34;&gt;2ï¼‰ï¼š ä¿®æ”¹èƒŒæ™¯é…è‰²&lt;/h4&gt;
&lt;p&gt;æˆ‘ä»¬æ ¹æ®è‡ªå·±çš„é¢œè‰²åå¥½ï¼Œè®¾ç½®ä¸åŒçš„é…è‰²ï¼ˆæƒ³è¦æ­é…å‡ºä¸€å¥—å…»çœ¼çš„é…è‰²çœŸçš„æ˜¯ä¸€ä»¶è´¹åŠ›çš„äº‹ï¼‰ï¼Œæˆ‘è¿™é‡Œä¸»è¦ä¿®æ”¹&lt;strong&gt;SYNæŠ¥æ–‡&lt;/strong&gt;ï¼ˆ&lt;strong&gt;ç»¿è‰²&lt;/strong&gt;ï¼‰å’Œ&lt;strong&gt;FINæŠ¥æ–‡&lt;/strong&gt;ï¼ˆ&lt;strong&gt;ç°è‰²&lt;/strong&gt;ï¼‰ï¼Œé…å®Œåï¼Œå°±å¯ä»¥å‘ç°ç•Œé¢äººæ€§åŒ–è®¸å¤šï¼Œè¿™ä¸‹ä¸€çœ¼å°±å¯ä»¥çŸ¥é“tcpæ¡æ‰‹å’ŒæŒ¥æ‰‹çš„è¯·æ±‚å•¦ï½&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b03873fb04efdf~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;2-åªæŠ“åŒ…å¤´&#34;&gt;2. åªæŠ“åŒ…å¤´&lt;/h3&gt;
&lt;p&gt;ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸€ä¸ªæ•°æ®å¸§æ˜¯ç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆï¼Œå¯¹äºæˆ‘ä»¬æ‰€è¦è·å–çš„æ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿåªè¦å‰é¢éƒ¨åˆ†å³å¯ã€‚å•å‡»èœå•æ ä¸Šçš„Capture--&amp;gt;Optionsï¼Œç„¶ååœ¨å¼¹å‡ºçš„çª—å£ä¸Šå®šä¹‰â€œLimit each packet toâ€çš„å€¼å³å¯ã€‚ä¸€èˆ¬å¯ä»¥è®¾ç½®ä¸€ä¸ªåå¤§ä¸€ç‚¹çš„æ•°å­—ï¼š80å­—èŠ‚ï¼Œè¿™æ ·å°±å¯ä»¥åªæŠ“å‰80å­—èŠ‚äº†ã€‚è¿™æ ·çš„è¯ï¼ŒTCPå±‚ã€ç½‘ç»œå±‚å’Œæ•°æ®é“¾è·¯å±‚çš„ä¿¡æ¯éƒ½å¯ä»¥åŒ…æ‹¬åœ¨å†…äº†ã€‚æˆ‘æ¨èè®¾ç½®200å­—èŠ‚ï¼Œè¿™æ ·å¯ä»¥è·å–åˆ°httpã€tcpã€ç½‘ç»œå±‚åè®®çš„æ•°æ®äº†ã€‚&lt;/p&gt;
&lt;!--![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b038b192f25302~tplv-t2oaga2asx-image.image)--&gt;
&lt;h3 id=&#34;3-è®¤è¯†ä¸‹åˆ†å±‚&#34;&gt;3. è®¤è¯†ä¸‹åˆ†å±‚&lt;/h3&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/14/16f047976a357b7f~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;æ³¨æ„ï¼šåœ¨è¿™é‡Œç½‘ç»œå±‚å¯¹åº”Ipv4ï¼Œä¼ è¾“å±‚å¯¹åº”tcpï¼Œåº”ç”¨å±‚å¯¹åº”httpã€‚å¦‚æœæ˜¯udpï¼Œé•¿è¿™æ ·â¬‡&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;4&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b0397dc455cff5~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;4-æ•°æ®è¿‡æ»¤æŠ€å·§&#34;&gt;4. æ•°æ®è¿‡æ»¤æŠ€å·§&lt;/h3&gt;
&lt;p&gt;è¿™ä¹Ÿæ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªå°æŠ€å·§ï¼Œä¼šä½¿ç”¨è¿‡æ»¤å™¨çš„è¯å¯¹äºå¿«é€Ÿå®šä½è¿˜æ˜¯æœ‰å¾ˆå¤§å¸®åŠ©çš„ï¼Œæˆ‘è¿™é‡Œåˆ—å‡ºä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„æŠ€å·§ï¼Œä¸€é€šåˆ™ç™¾é€šã€‚&lt;/p&gt;
&lt;h4 id=&#34;1åè®®è¿‡æ»¤&#34;&gt;1ï¼‰åè®®è¿‡æ»¤&lt;/h4&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;5&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039b2a5642e35~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;6&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039b40ea70225~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;7&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039b515b268f2~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h4 id=&#34;2-ç«¯å£è¿‡æ»¤&#34;&gt;2ï¼‰ ç«¯å£è¿‡æ»¤&lt;/h4&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;8&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039b9b618a472~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;9&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039bab4fddc54~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;10&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039bbc3d5152a~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h4 id=&#34;3ipè¿‡æ»¤&#34;&gt;3ï¼‰Ipè¿‡æ»¤&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039c72b129565~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039c8a6e3c3ec~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039c9eb316c96~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039d555376068~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;4æ ‡è¯†ç¬¦è¿‡æ»¤&#34;&gt;4ï¼‰æ ‡è¯†ç¬¦è¿‡æ»¤&lt;/h4&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;11&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039db9dd136f4~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h4 id=&#34;5é•¿åº¦è¿‡æ»¤&#34;&gt;5ï¼‰é•¿åº¦è¿‡æ»¤&lt;/h4&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;12&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039df7abb24f7~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;å…ˆåˆ†äº«åˆ°è¿™é‡Œï¼Œè¿™å‡ å¤©åœ¨å¿™ç€å†™å¾®ä¿¡å°ç¨‹åºï¼Œè¿‡å‡ å¤©é€šè¿‡wiresharkåˆ†æä¸‹tcp3æ¬¡æ¡æ‰‹å’Œ4æ¬¡æŒ¥æ‰‹æ¥å®æˆ˜æ“ä½œä¸‹ï½ å¦‚æœå“ªé‡Œæœ‰é”™è¯¯ï¼Œè¿˜æ³è¯·å¤§å®¶æŒ‡å‡ºã€‚&lt;/p&gt;
">ç»™å­¦å¼Ÿä»¬åˆ†æ WireShark</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/hwe1uEAHe/"" data-c="
          &lt;p&gt;æˆ‘ä»¬åœ¨å†™å°ç¨‹åºçš„æ—¶å€™ï¼Œæ‰‹æœºç«¯é¢„è§ˆå‘ç°è·å–ä¸åˆ°åå°æ•°æ®ï¼Œåªèƒ½ç”¨çœŸæœºè°ƒè¯•æ‰å¯ä»¥ï¼Œå¯æ˜¯macç«¯çš„å¼€å‘è€…å·¥å…·å¯¹äºçœŸæœºè°ƒè¯•çš„ä½“éªŒè‹¦ä¸å ªè¨€ï¼Œå„ç§bugï¼ˆå®˜æ–¹bugï¼‰ã€‚æ‰€ä»¥æˆ‘æƒ³æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•ç›´æ¥ä½¿ç”¨é¢„è§ˆä¹Ÿå¯ä»¥ä¸€æ ·è·å–åˆ°æ•°æ®å‘¢ã€‚èŠ±äº†ä¸€å¤©çš„æ—¶é—´ï¼Œç»ˆäºæ˜¯æˆåŠŸäº†ã€‚psï¼šæˆ‘å®¤å‹é¢„è§ˆçš„æ—¶å€™ä¸€æ ·å¯ä¹Ÿä»¥æœ‰æ•°æ®ã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;å…³é”®ç‚¹&#34;&gt;å…³é”®ç‚¹ï¼š&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;æ‰‹æœºï¼ŒæœåŠ¡å™¨ï¼Œä¿æŒåŒä¸€å±€åŸŸç½‘ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬ä¸€æ­¥å¼€å¯å±€åŸŸç½‘&#34;&gt;ç¬¬ä¸€æ­¥ï¼šå¼€å¯å±€åŸŸç½‘&lt;/h2&gt;
&lt;h3 id=&#34;æ–¹æ³•1ä½¿ç”¨ç”µè„‘å¼€å¯å…±äº«wifiæ‰‹æœºè¿æ¥æ­¤wifi-ä¸è¿‡è¿™é‡Œå› ä¸ºæˆ‘ä»¬å­¦æ ¡å†…éƒ¨ç½‘éœ€è¦è´¦å·ç™»é™†æ‰€ä»¥æˆ‘æ²¡é‡‡ç”¨è¿™ç§æ–¹æ³•ä¸è¿‡è¿™ç§æ–¹æ³•çš„åç»­æµç¨‹å’Œç¬¬äºŒç§æ–¹æ³•å·®ä¸å¤š&#34;&gt;æ–¹æ³•1ï¼‰&lt;strong&gt;ä½¿ç”¨ç”µè„‘å¼€å¯å…±äº«wifiï¼Œæ‰‹æœºè¿æ¥æ­¤wifi&lt;/strong&gt;ã€‚ä¸è¿‡è¿™é‡Œå› ä¸ºæˆ‘ä»¬å­¦æ ¡å†…éƒ¨ç½‘éœ€è¦è´¦å·ç™»é™†ï¼Œæ‰€ä»¥æˆ‘æ²¡é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œä¸è¿‡è¿™ç§æ–¹æ³•çš„åç»­æµç¨‹å’Œç¬¬äºŒç§æ–¹æ³•å·®ä¸å¤šã€‚&lt;/h3&gt;
&lt;h3 id=&#34;æ–¹æ³•2æ‰‹æœºå¼€å¯çƒ­ç‚¹ç”µè„‘è¿æ¥æ­¤çƒ­ç‚¹&#34;&gt;æ–¹æ³•2ï¼‰&lt;strong&gt;æ‰‹æœºå¼€å¯çƒ­ç‚¹ï¼Œç”µè„‘è¿æ¥æ­¤çƒ­ç‚¹&lt;/strong&gt;ã€‚&lt;/h3&gt;
&lt;h4 id=&#34;1è¿æ¥åé¦–å…ˆæ‰¾åˆ°åˆ†é…ç»™ç”µè„‘çš„ip-macè·å–ipåœ¨è®¾ç½®-ç½‘ç»œé‡Œé¢å°±å¯ä»¥çœ‹åˆ°&#34;&gt;1ï¼‰è¿æ¥åï¼Œé¦–å…ˆæ‰¾åˆ°åˆ†é…ç»™ç”µè„‘çš„IPã€‚macè·å–IPåœ¨è®¾ç½®-&amp;gt;ç½‘ç»œï¼Œé‡Œé¢å°±å¯ä»¥çœ‹åˆ°ã€‚&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b071a3d75c0c24~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æˆ–è€…åœ¨ç»ˆç«¯è¾“å…¥&lt;strong&gt;ifconfig&lt;/strong&gt;ï¼Œå¯ä»¥æ‰¾åˆ°&lt;br&gt;
&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b071e4ad724f4e~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬äºŒæ­¥ä¿®æ”¹æœåŠ¡å™¨åœ°å€&#34;&gt;ç¬¬äºŒæ­¥ï¼šä¿®æ”¹æœåŠ¡å™¨åœ°å€&lt;/h2&gt;
&lt;p&gt;æˆ‘åå°ä½¿ç”¨çš„SpringBootï¼Œåœ¨propertiesé‡Œé¢ç›´æ¥ä¿®æ”¹&lt;br&gt;
&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0720284e518d4~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬ä¸‰æ­¥ä¿®æ”¹urlåœ°å€&#34;&gt;ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹urlåœ°å€ï¼š&lt;/h2&gt;
&lt;p&gt;ä¹‹å‰ä½¿ç”¨çš„urlåœ°å€ç±»ä¼¼äºï¼š&lt;strong&gt;http://localhost:8080/user/login/&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¿®æ”¹åæœåŠ¡å™¨åœ°å€ååŒä¸€ä¿®æ”¹ä¸ºï¼š&lt;strong&gt;http://172.20.10.2:8080/user/login/&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é‡å¯åå°ï¼Œç„¶ååœ¨postmanæµ‹è¯•ä¸€ä¸‹ï¼š&lt;br&gt;
&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b07252a4316a41~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
okï¼Œå¯ä»¥è·å–åˆ°æ•°æ®ã€‚&lt;br&gt;
ç„¶åæˆ‘ä»¬æŠŠå°ç¨‹åºé‡Œçš„requesté‡Œçš„urlå…¨éƒ¨ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b072a3158b4750~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
é‡æ–°ç¼–è¯‘åï¼Œæµ‹è¯•ä¸€ä¸‹å¯ä¸å¯ä»¥è·å–åˆ°æ•°æ®ï¼Œå¦‚æœä¹‹å‰æ­¥éª¤æ²¡é”™ï¼Œè‚¯å®šæ²¡é—®é¢˜çš„ã€‚&lt;br&gt;
æˆ‘ä»¬ç›´æ¥ä½¿ç”¨é¢„è§ˆï¼Œä¹Ÿæ˜¯ä¸€æ ·å¯ä»¥è·å–åˆ°æ•°æ®çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ³¨æ„ç‚¹&#34;&gt;æ³¨æ„ç‚¹ï¼š&lt;/h2&gt;
&lt;p&gt;1ï¼‰ åœ¨åå°ä¿®æ”¹äº†åœ°å€åï¼Œä»¥åå¿…é¡»åœ¨çƒ­ç‚¹ç¯å¢ƒä¸‹è¿è¡Œé¡¹ç›®ï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚ï¼ˆæˆ‘å°±æ˜¯æœ‰ä¸€æ¬¡å¿˜è®°è¿çƒ­ç‚¹ï¼Œç»“æœä¸€ç›´å¯åŠ¨å¤±è´¥ï¼Œæˆ‘è¿˜ä»¥ä¸ºæ˜¯8080ç«¯å£å ç”¨é—®é¢˜ï¼‰&lt;/p&gt;
&lt;p&gt;2ï¼‰å¦‚æœè¦åˆ«äººé¢„è§ˆä½ çš„å°ç¨‹åºï¼Œå¾—å…ˆè¿æ¥ä½ çš„çƒ­ç‚¹ï¼Œæ‰èƒ½è·å–åˆ°æ•°æ®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“ï¼š&lt;/h2&gt;
&lt;p&gt;å¯¹äº†ï¼Œå¦‚æœä½ è¿˜æœ‰äº†ç½‘é¡µï¼Œé‚£ä¹ˆä¸€æ ·å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•åœ¨æ‰‹æœºä¸Šè®¿é—®ä½ çš„ç•Œé¢çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å°ç¨‹åºæˆªå›¾ï¼š&lt;/strong&gt;&lt;br&gt;
&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0739305696dd0~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç½‘é¡µæ‰‹æœºæˆªå›¾ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b073aa9f2958a9~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
">å¾®ä¿¡å°ç¨‹åºï¼šé¢„è§ˆé¡µå®ç°ä¸åå°é€šä¿¡</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://zexho994.github.io/blog.zexho.life/post/dU5Kti6_I/"" data-c="
          &lt;blockquote&gt;
&lt;p&gt;æœ€è¿‘åœ¨å­¦ä¹ å¾®ä¿¡å°ç¨‹åºï¼Œé‡åˆ°äº†ä¸€äº›å‘ï¼Œæœ‰äº›é—®é¢˜æˆ‘çœ‹å®˜ç½‘æˆ–è€…å…¶ä»–åšå®¢ï¼Œå¯èƒ½è®²çš„ä¸æ˜¯é‚£ä¹ˆæ˜“æ‡‚ï¼Œæ‰€ä»¥è‡ªå·±æ‰¾åˆ°è§£å†³æ–¹æ³•åï¼Œå†™ä¸‹æ¥ä¾›å¤§å®¶å‚è€ƒï¼Œå¦‚æœ‰ä¸å¯¹æŒ‡å‡ºï¼Œè¿˜æ³è¯·å¤§å®¶æŒ‡å‡ºï½&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- more --&gt;
&lt;p&gt;æ¯”å¦‚åœ¨å®ç°è´­ç‰©è½¦æ‰¹é‡è´­ä¹°çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å‘åå°è¯·æ±‚ä¸€ä¸ªlistï¼ŒåŒ…å«æ‰€æœ‰å‹¾é€‰çš„ç‰©å“ä¿¡æ¯ï¼Œåœ¨å¾®ä¿¡å°ç¨‹åºé‡Œï¼Œpageé‡Œçš„dataæ˜¯è¿™æ ·å®šä¹‰&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;        data {  
            ordersï¼š[]  
        }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬ç»™å®ƒèµ‹å€¼åï¼Œæ•°æ®ç±»ä¼¼äº&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/28/16afc450f3dd4a23~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬åˆ©ç”¨wx.requestæŠŠè¿™ä¸ªlistå‘é€çš„æ—¶å€™ï¼Œæ ¹æ®å¾®ä¿¡å®˜æ–¹æ–‡æ¡£çš„è§£é‡Šï¼š&lt;/p&gt;
&lt;!--![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/28/16afc476b45019b8~tplv-t2oaga2asx-image.image)--&gt;
&lt;p&gt;&lt;strong&gt;data å‚æ•°è¯´æ˜&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æœ€ç»ˆå‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®æ˜¯ String ç±»å‹ï¼Œå¦‚æœä¼ å…¥çš„ data ä¸æ˜¯ String ç±»å‹ï¼Œä¼šè¢«è½¬æ¢æˆ String ã€‚è½¬æ¢è§„åˆ™å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äº GET æ–¹æ³•çš„æ•°æ®ï¼Œä¼šå°†æ•°æ®è½¬æ¢æˆ query stringï¼ˆencodeURIComponent(k)=encodeURIComponent(v)&amp;amp;encodeURIComponent(k)=encodeURIComponent(v)...ï¼‰&lt;/li&gt;
&lt;li&gt;å¯¹äº POST æ–¹æ³•ä¸” header[&#39;content-type&#39;] ä¸º application/json çš„æ•°æ®ï¼Œä¼šå¯¹æ•°æ®è¿›è¡Œ JSON åºåˆ—åŒ–&lt;/li&gt;
&lt;li&gt;å¯¹äº POST æ–¹æ³•ä¸” header[&#39;content-type&#39;] ä¸º application/x-www-form-urlencoded çš„æ•°æ®ï¼Œä¼šå°†æ•°æ®è½¬æ¢æˆ query string ï¼ˆencodeURIComponent(k)=encodeURIComponent(v)&amp;amp;encodeURIComponent(k)=encodeURIComponent(v)...ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html&#34;&gt;å¾®ä¿¡å¯¹äºè¯¥éƒ¨ä½è§£é‡Šå®˜ç½‘æ–‡æ¡£åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ„æ€å°±æ˜¯æ‰€æœ‰çš„dataæ•°æ®éƒ½ä¼šä»¥Stringç±»å‹å‘é€ã€‚æ‰€ä»¥å¾ˆå¤šæœ‹å‹å¯èƒ½åˆšå¼€å§‹å’Œæˆ‘ä¸€æ ·ï¼Œè¯·æ±‚æ€»æ˜¯é”™è¯¯ï¼Œæˆ–è€…åå°æ¥æ”¶äº†è¯·æ±‚ï¼Œå¯æ˜¯å€¼å´æ˜¯nullã€‚è®¸å¤šåšå®¢ç»™çš„æ–¹æ³•æ¯”å¦‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;        header: {
        &#39;content-type&#39;: &#39;application/json&#39;
      },
      æ”¹ä¸º
      header: {
          &#39;content-type&#39;: &#39;application/x-www-form-urlencoded&#39;
        },
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆ‘å°è¯•ä¹‹åå‘ç°è¯·æ±‚è¿˜æ˜¯æŠ¥é”™ï¼Œä¸‹é¢ç»™å‡ºæˆ‘çš„è§£å†³æ–¹æ³•ï¼š&lt;/p&gt;
&lt;h2 id=&#34;å¾®ä¿¡å°ç¨‹åº&#34;&gt;å¾®ä¿¡å°ç¨‹åºï¼š&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;        wx.request({
          url: &#39;http://172.20.10.2:8080/order/wx/buy&#39;,
          header: {
               &#39;content-type&#39;: &#39;application/json&#39;
            },
          method: &amp;quot;POST&amp;quot;,
          data:{
            buyGoodsDTOS:this.data.orders,
            user_id:this.data.user_info.user_id
        },
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;dataé‡Œé¢æœ‰åˆ—è¡¨ç±»å‹çš„ordersï¼Œä»¥åŠä¸€ä¸ªç”¨æˆ·IDï¼Œ&lt;br&gt;
æˆ‘ä»¬å°±è¿™ç›´æ¥è¿™æ ·å‘èµ·è¯·æ±‚ï¼Œorderså’Œuser_idéƒ½ä¼šè¢«åºåˆ—åŒ–ä¸ºjson&lt;/p&gt;
&lt;h2 id=&#34;åå°æ¥æ”¶&#34;&gt;åå°æ¥æ”¶&lt;/h2&gt;
&lt;p&gt;åˆ©ç”¨é˜¿é‡Œçš„&lt;strong&gt;fastjson&lt;/strong&gt;ï¼Œæˆ‘ä½¿ç”¨çš„&lt;strong&gt;SpringBoot&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;pomxmlé‡Œæ·»åŠ &#34;&gt;pom.xmlé‡Œæ·»åŠ ï¼š&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;com.alibaba&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;fastjson&amp;lt;/artifactId&amp;gt;
            &amp;lt;version&amp;gt;1.2.46&amp;lt;/version&amp;gt;
        &amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;controlleré‡Œé¢&#34;&gt;Controlleré‡Œé¢ï¼š&lt;/h3&gt;
&lt;p&gt;åˆ©ç”¨&lt;strong&gt;fastjson&lt;/strong&gt;çš„&lt;strong&gt;JSONObject&lt;/strong&gt;æ¥æ”¶wxåºåˆ—åŒ–åçš„jsonæ•°æ®&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/28/16afc9d899d22dda~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;é€šè¿‡JSONObjectç±»çš„æºç ï¼Œå¯ä»¥å‘ç°ä»–å®ç°ç±»Mapæ¥å£&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;        public class JSONObject extends JSON implements Map&amp;lt;String, Object&amp;gt;,ã€‚ã€‚ã€‚
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çŸ¥é“ï¼Œå®ƒæ˜¯åˆ©ç”¨é”®å€¼å¯¹å­˜å‚¨å¾®ä¿¡å°ç¨‹åºå‘é€çš„jsonæ•°æ®ï¼Œå­˜å‚¨æ–¹å¼ç±»ä¼¼äº&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/28/16afc685bf16f9d4~tplv-t2oaga2asx-image.image&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ä¸‹åˆ’çº¿éƒ¨åˆ†ä¸ºkeyï¼Œåç§°ç›¸åŒï¼Œvalueå°±æ˜¯ä¼ è¿‡æ¥çš„æ•°æ®ã€‚&lt;br&gt;
å¯¹äºé‡Œé¢jsonDataé‡Œé¢ordersæ•°æ®ï¼ˆlistï¼‰çš„è·å–ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;        JSONArray jsonArray = jsonData.getJSONArray(&amp;quot;buyGoodsDTOS&amp;quot;);    //æ ¹æ®keyåè·å–
        List&amp;lt;BuyGoodsDTO&amp;gt; list = jsonArray.toJavaList(BuyGoodsDTO.class); //å°†æ•°ç»„å¯¹è±¡è½¬åŒ–ä¸ºlistï¼ŒBuyGoodsDTOæ˜¯ä¸ordersé‡Œé¢å¯¹è±¡è¦å¯¹åº”
        
        String user_id = jsonData.get(&amp;quot;user_id&amp;quot;).toString();    //è·å–user_id
        Integer id = Integer.parseInt(user_id);         //è½¬åŒ–ç±»å‹
```j
è¿™æ ·æ‰€æœ‰çš„æ•°æ®éƒ½è·å–åˆ°å•¦ï½



&lt;/code&gt;&lt;/pre&gt;
">å¾®ä¿¡å°ç¨‹åºï¼šPOST ä¼ è¾“ List æ•°æ®</a>
      </div>
      
    </div>
  </div>
</div>
<script>
  // var escape = "[{&#34;content&#34;:&#34;&lt;p&gt;æœ€è¿‘åœ¨æ¢³ç†æˆ‘ä»¬ç³»ç»Ÿæ¶æ„çš„æ—¶å€™ï¼Œæƒ³ä»åˆ†å¸ƒå¼é¢†åŸŸçš„è§’åº¦æ¥åˆ†ææ¶æ„è®¾è®¡ï¼Œä½†æ˜¯ç”±äºä¹‹å‰æ²¡ç³»ç»Ÿæ€§æ¥è§¦è¿‡åˆ†å¸ƒå¼ç›¸å…³çš„çŸ¥è¯†ï¼Œæ­£å¥½å€Ÿæ­¤æœºä¼šæ¥å­¦ä¹ åˆ†å¸ƒå¼ç›¸å…³çš„çŸ¥è¯†ï¼Œå¹¶è¿›è¡Œè‡ªå·±çš„æ€»ç»“ã€‚æœ¬æ–‡çš„ç›®çš„æ˜¯ææ¸…æ¥šä»€ä¹ˆæ˜¯CAPã€‚&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;åˆ†å¸ƒå¼ç³»ç»Ÿçš„æœ€å¤§éš¾ç‚¹ï¼Œå°±æ˜¯å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€å¦‚ä½•åŒæ­¥&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;å†å²èƒŒæ™¯\&#34;&gt;å†å²èƒŒæ™¯&lt;/h1&gt;\n&lt;p&gt;æ—¶é—´å›åˆ° 1985 å¹´ï¼Œå½¼æ—¶ï¼Œåæ¥è¯æ˜äº† CAP ç†è®ºçš„ Lynch æ•™æˆæ­¤æ—¶ç»™å½“æ—¶çš„ IT ç•Œæ¥äº†ä¸€è®°æƒŠé›·ï¼šå¥¹é€šè¿‡ä¸å¯è¾©é©³çš„è¯æ˜å‘Šè¯‰ä¸šç•Œçš„å·¥ç¨‹å¸ˆä»¬ï¼Œå¦‚æœåœ¨ä¸€ä¸ªä¸ç¨³å®šï¼ˆæ¶ˆæ¯è¦ä¹ˆä¹±åºè¦ä¹ˆä¸¢äº†ï¼‰çš„ç½‘ç»œç¯å¢ƒé‡Œï¼ˆåˆ†å¸ƒå¼å¼‚æ­¥æ¨¡å‹ï¼‰ï¼Œæƒ³å§‹ç»ˆä¿æŒæ•°æ®ä¸€è‡´æ˜¯ä¸å¯èƒ½çš„ã€‚è¿™æ˜¯ä¸ªä»€ä¹ˆæ¦‚å¿µå‘¢ï¼Ÿå°±æ˜¯å¥¹æ‰“ç ´äº†é‚£äº›æ—¢æƒ³æä¾›è¶…é«˜è´¨é‡æœåŠ¡ï¼Œåˆæƒ³æä¾›è¶…é«˜æ€§èƒ½æœåŠ¡çš„æŠ€æœ¯äººå‘˜çš„å¹»æƒ³ã€‚è¿™æœ¬è´¨æ˜¯åœ¨å‘Šè¯‰å¤§å®¶ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œï¼Œéœ€è¦å¦¥åã€‚&lt;br&gt;\nè¿‡äº†15å¹´ï¼Œåœ¨2000 å¹´æ—¶ï¼ŒEric Brewer æ•™æˆåœ¨ PODC ä¼šè®®ä¸Šæå‡ºäº† CAP ç†è®ºï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰è¢«è¯æ˜è¿‡ï¼Œæ‰€ä»¥ï¼Œå½“æ—¶åªèƒ½è¢«ç§°ä¸º CAP çŒœæƒ³ã€‚è¿™ä¸ªçŒœæƒ³å¼•èµ·äº†å·¨å¤§çš„åå“ï¼Œå› ä¸º CAP å¾ˆç¬¦åˆäººä»¬å¯¹è®¾è®¡çº²é¢†çš„é¢„æœŸã€‚åœ¨ 2002 å¹´åï¼Œç»è¿‡ Seth Gilbert å’Œ Nancy Lynch ä»ç†è®ºä¸Šè¯æ˜äº† CAP çŒœæƒ³åï¼ŒCAP ç†è®ºæ­£å¼æˆä¸ºäº†åˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºçš„åŸºçŸ³ä¹‹ä¸€ã€‚&lt;/p&gt;\n&lt;h1 id=\&#34;æ¦‚å¿µè§£é‡Š\&#34;&gt;æ¦‚å¿µè§£é‡Š&lt;/h1&gt;\n&lt;p&gt;è¦å‡†ç¡®çš„ç†è§£CAPï¼Œé¦–å…ˆå¿…é¡»æ˜ç™½CAPä¸­3ä¸ªæ¦‚å¿µçš„å‡†ç¡®å®šä¹‰ï¼Œ3ä¸ªæ¦‚å¿µåˆ†åˆ«å¯¹åº”CAPçš„3ä¸ªç¼©å†™ Consistencyã€Availabilityã€Partition Toleranceã€‚&lt;br&gt;\n&lt;img src=\&#34;https://tva1.sinaimg.cn/large/e6c9d24egy1h0iegjbmz8j20u00u0gno.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;consistency-ä¸€è‡´æ€§\&#34;&gt;Consistency ä¸€è‡´æ€§&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;all nodes see the same data at the same time&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;åœ¨æœåŠ¡èŠ‚ç‚¹è¿›è¡Œæ›´æ–°æ“ä½œåï¼Œæ‰€æœ‰èŠ‚ç‚¹åŒä¸€æ—¶é—´çš„æ•°æ®å®Œå…¨ä¸€è‡´ï¼Œä¹Ÿç§°æ•°æ®ä¸€è‡´æ€§ã€‚&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://tva1.sinaimg.cn/large/e6c9d24egy1h0iegrn0bdj20lu0i00tb.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;åœ¨DB1æ›´æ–°å®Œæˆåï¼Œæ­¥éª¤3çš„æŸ¥è¯¢ç»“æœä¸€å®šæ˜¯æœ€æ–°çš„æ•°æ®ï¼Œé‚£ä¹ˆæ­¥éª¤4çš„æŸ¥è¯¢ç»“æœå¿…é¡»è¦å’Œ3ä¸€æ ·ï¼Œä¸ç„¶å°±æ˜¯æ•°æ®ä¸ä¸€è‡´ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;availability-å¯é æ€§\&#34;&gt;Availability å¯é æ€§&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;Reads and writes always succeed&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;åœ¨é¢„æœŸçš„å“åº”æ—¶é—´å†…ï¼Œå¿…é¡»è¿”å›ç»“æœï¼ˆéå¼‚å¸¸çš„ï¼‰ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªæ¦‚å¿µï¼Œä¸€ä¸ªæ˜¯é¢„æœŸå“åº”æ—¶é—´ï¼Œä¸€ä¸ªæ˜¯éå¼‚å¸¸çš„ç»“æœã€‚&lt;/p&gt;\n&lt;p&gt;é¢„æœŸå“åº”æ—¶é—´åº”è¯¥æ˜¯æ—©åœ¨ç³»ç»Ÿè®¾è®¡æ—¶å°±å®šä¹‰å¥½çš„ï¼Œè¦ç»“åˆä¸šåŠ¡åœºæ™¯çš„è€ƒè™‘ï¼Œä¾‹å¦‚æˆ‘ä»¬googleæœç´¢è¦åœ¨0.5så†…è¿”å›æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œé‚£ä¹ˆ0.5å°±æ˜¯å®šä¹‰å¥½çš„ç»“æœï¼Œ&lt;/p&gt;\n&lt;p&gt;ä¸€ä¸ªæ–‡ä»¶è½¬æ¢çš„æœåŠ¡ï¼Œé¢„æœŸå“åº”æ—¶é—´å¯èƒ½ä¼šæ˜¯æ•°åç§’ç”šè‡³ä»¥åˆ†é’Ÿè®¡ç®—ã€‚åªè¦èƒ½åœ¨é¢„æœŸå“åº”æ—¶é—´å†…è¿”å›ï¼Œéƒ½å¯ä»¥ç®—ä½œæœªè¶…æ—¶çš„ã€‚&lt;/p&gt;\n&lt;p&gt;éå¼‚å¸¸çš„ç»“æœæ˜¯æŒ‡èƒ½è¢«å®¢æˆ·ç«¯æ¥æ”¶å¹¶è¿›è¡Œæ­£å¸¸åç»­å¤„ç†çš„ï¼Œ12306æŠ¢ç¥¨æ—¶åˆ·æ–°åçœ‹åˆ°æœ‰ç¥¨ï¼Œç‚¹å‡»è´­ä¹°åˆå‘ŠçŸ¥æ²¡ç¥¨äº†ï¼Œåˆ·æ–°åçœ‹åˆ°çš„æ˜¯æ—§æ•°æ®ï¼Œä½†æ•´ä¸ªæµç¨‹æ˜¯æ²¡æœ‰å‘ç”Ÿå¼‚å¸¸ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å¯é æ€§ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;partition-tolerance-åˆ†åŒºå®¹é”™æ€§\&#34;&gt;Partition Tolerance åˆ†åŒºå®¹é”™æ€§&lt;/h2&gt;\n&lt;p&gt;åˆ†å¸ƒå¼åœºæ™¯ä¸‹èŠ‚ç‚¹é—´éƒ½æ˜¯é€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡çš„ï¼Œç½‘ç»œè‚¯å®šä¸æ˜¯100%å¯é çš„ï¼Œä¹Ÿä¼šæœ‰å¼‚å¸¸çš„æ—¶å€™ã€‚&lt;/p&gt;\n&lt;p&gt;å½“ä¸¤ä¸ªèŠ‚ç‚¹é—´å‘ç”Ÿäº†å¼‚å¸¸ä¸èƒ½æ­£å¸¸é€šä¿¡äº†ï¼Œå°±å¯ä»¥è¯´è¿™ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´å‘ç”Ÿ&lt;strong&gt;åˆ†åŒº&lt;/strong&gt;äº†ã€‚&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://tva1.sinaimg.cn/large/e6c9d24egy1h0iehceicrj20zq0muta5.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;é‚£ä¹ˆå¯¹äºAæœåŠ¡è€Œè¨€ï¼Œå‡è®¾Bå‘ç”Ÿå¼‚å¸¸äº†ï¼ŒAæ˜¯å¦è¦å®¹å¿è¿™ç§æƒ…å†µå‘¢ï¼Ÿé€‰æ‹©ä¸å®¹å¿ï¼Œé‚£ä¹ˆå¯¹åº”çš„æªæ–½å°±æ˜¯Aé©¬ä¸Šå¯¹å¤–åœæ­¢æœåŠ¡ã€‚è¿™å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ç»å¯¹æ˜¯ä¸èƒ½æ¥å—çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å®¹å¿ç½‘ç»œåˆ†åŒºçš„å‘ç”Ÿï¼Œå³ä½¿ç›¸å…³æœåŠ¡å‘ç”Ÿäº†å¼‚å¸¸ï¼ŒæœåŠ¡ä¹Ÿä¸èƒ½åœæ­¢è¿è¡Œã€‚&lt;br&gt;\nè¿™ä¹ˆçœ‹æ¥CAPä¸­Pæ˜¯å¿…é¡»è¦çš„ï¼ŒåŒæ—¶ä¹ŸçŸ¥é“CAP3è¿™ä¸èƒ½åŒæ—¶æ»¡è¶³ï¼Œç°åœ¨çš„éš¾é¢˜å°±æ˜¯Cå’ŒAä¸­å¦‚ä½•è¿›è¡Œå–èˆ&lt;/p&gt;\n&lt;h1 id=\&#34;ä¸ºä»€ä¹ˆcå’Œaä¸èƒ½åŒæ—¶å­˜åœ¨\&#34;&gt;ä¸ºä»€ä¹ˆCå’ŒAä¸èƒ½åŒæ—¶å­˜åœ¨&lt;/h1&gt;\n&lt;p&gt;å‡å¦‚å¿…é¡»è¦æ»¡è¶³ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆæ•°æ®ä¸­å¿ƒåªèƒ½æœ‰ä¸€ä¸ªï¼Œè¿™æ ·æ‰€æœ‰çš„èŠ‚ç‚¹æ‹¿åˆ°çš„æ•°æ®è‚¯å®šéƒ½æ˜¯æœ€æ–°çš„äº†ã€‚&lt;/p&gt;\n&lt;p&gt;é‚£å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ•°æ®ä¸­å¿ƒä¸€æ—¦å‘ç”Ÿç½‘ç»œåˆ†åŒºï¼Œå°±å¯¼è‡´æ‰€æœ‰èŠ‚ç‚¹æ— æ³•å¤„ç†è¯·æ±‚ï¼Œè¿™æ ·å¯é æ€§å¿…ç„¶ä¸èƒ½ä¿è¯ã€‚&lt;/p&gt;\n&lt;p&gt;å‡å¦‚å¿…é¡»è¦æ»¡è¶³å¯é æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é‡‡ç”¨å¤šæ•°æ®ä¸­å¿ƒçš„æ–¹å¼ï¼Œè¿™æ ·å³ä½¿ä¸ªåˆ«èŠ‚ç‚¹å‘ç”Ÿç½‘ç»œåˆ†åŒºï¼Œä¹Ÿä¸ä¼šå¯¼è‡´æ•´ä¸ªæœåŠ¡ä¸å¯ç”¨ã€‚å¯æ˜¯è¿™å°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæœ€æ–°çš„æ•°æ®æ— æ³•åŒæ­¥ç»™å…¶ä»–åˆ†åŒºçš„èŠ‚ç‚¹ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€ä¸‹çš„å¯èƒ½ã€‚&lt;/p&gt;\n&lt;h1 id=\&#34;å¦‚ä½•å–èˆcå’Œa\&#34;&gt;å¦‚ä½•å–èˆCå’ŒA&lt;/h1&gt;\n&lt;p&gt;åœ¨æ²¡æœ‰å‘ç”Ÿç½‘ç»œåˆ†åŒºçš„æ—¶å€™ï¼ŒCAPä¸‰è€…éƒ½æ˜¯æ»¡è¶³çš„ï¼Œåªæœ‰å½“å‘ç”Ÿç½‘ç»œåˆ†åŒºè¿™ç§å°æ¦‚ç‡äº‹ä»¶çš„æ—¶å€™ã€‚&lt;br&gt;\nå…ˆçœ‹ä¸€äº›å¼€æºæ¡†æ¶æ˜¯å¦‚ä½•è¿›è¡Œè®¾è®¡çš„&lt;br&gt;\ncp - Zookeeperï¼ŒRedisï¼šå½“zookeeperå’Œredisä¼šä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä¿è¯ä»»ä½•æ—¶å€™è·å–åˆ°çš„æ•°æ®éƒ½æ˜¯æœ€æ–°çš„ã€‚&lt;br&gt;\nca - Mysqlï¼ŒRocketMQ:  åœ¨Mysqlå’ŒRocketMQçš„ä¸»ä»æ¶æ„ä¸­ï¼Œå½“ä¸»ä»ä¹‹é—´å‘ç”Ÿç½‘ç»œåˆ†åŒºæ—¶&lt;br&gt;\nï¼Œä»ä»åº“è·å–åˆ°çš„æ•°æ®å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ã€‚&lt;/p&gt;\n&lt;p&gt;è¯´åˆ°åº•ï¼Œè¿˜æ˜¯çœ‹ä¸šåŠ¡åœºæ™¯ã€‚ä¾‹å¦‚æ¶‰åŠåˆ°é’±çš„ç³»ç»Ÿï¼Œé‚£ä¹ˆä¸€è‡´æ€§æ˜¯è‚¯å®šè¦ä¿è¯çš„ï¼Œé“¶è¡Œç³»ç»Ÿå“ªæ€•åœæ­¢æœåŠ¡ä¹Ÿè¦ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚ç”¨è¿‡12306ï¼Œè‚¯å®šé‡åˆ°è¿‡é¡µé¢åˆ·æ–°ååŒä¸€è½¦æ¬¡æœ‰æ—¶å€™æœ‰ç¥¨æœ‰æ—¶å€™æ²¡ç¥¨çš„æƒ…å†µï¼Œè¿™å°±æ˜¯ä¸ºäº†æé«˜å¯ç”¨æ€§ï¼Œä¿è¯åˆ·æ–°æ“ä½œæˆåŠŸï¼Œä½†æ˜¯ä¸€è‡´æ€§å°±æ— æ³•å¾—åˆ°ä¿è¯äº†ã€‚&lt;/p&gt;\n&lt;h1 id=\&#34;å‚è€ƒ\&#34;&gt;å‚è€ƒ&lt;/h1&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;https://mp.weixin.qq.com/s/6PgqyigrgVICl0JiI73oNg\&#34;&gt;https://mp.weixin.qq.com/s/6PgqyigrgVICl0JiI73oNg&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;https://www.zhihu.com/question/54105974/answer/1643846752\&#34;&gt;https://www.zhihu.com/question/54105974/answer/1643846752&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;https://www.hollischuang.com/archives/666\&#34;&gt;https://www.hollischuang.com/archives/666&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&#34;,&#34;fileName&#34;:&#34;wo-li-jie-de-cap&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;æœ€è¿‘åœ¨æ¢³ç†æˆ‘ä»¬ç³»ç»Ÿæ¶æ„çš„æ—¶å€™ï¼Œæƒ³ä»åˆ†å¸ƒå¼é¢†åŸŸçš„è§’åº¦æ¥åˆ†ææ¶æ„è®¾è®¡ï¼Œä½†æ˜¯ç”±äºä¹‹å‰æ²¡ç³»ç»Ÿæ€§æ¥è§¦è¿‡åˆ†å¸ƒå¼ç›¸å…³çš„çŸ¥è¯†ï¼Œæ­£å¥½å€Ÿæ­¤æœºä¼šæ¥å­¦ä¹ åˆ†å¸ƒå¼ç›¸å…³çš„çŸ¥è¯†ï¼Œå¹¶è¿›è¡Œè‡ªå·±çš„æ€»ç»“ã€‚æœ¬æ–‡çš„ç›®çš„æ˜¯ææ¸…æ¥šä»€ä¹ˆæ˜¯CAPã€‚&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;åˆ†å¸ƒå¼ç³»ç»Ÿçš„æœ€å¤§éš¾ç‚¹ï¼Œå°±æ˜¯å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€å¦‚ä½•åŒæ­¥&lt;/p&gt;\n&lt;/blockquote&gt;\n&#34;,&#34;title&#34;:&#34;æˆ‘ç†è§£çš„CAP&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;å­¦ä¹ å½’çº³&#34;,&#34;slug&#34;:&#34;xue-xi-gui-na&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/xue-xi-gui-na/&#34;},{&#34;name&#34;:&#34;åˆ†å¸ƒå¼&#34;,&#34;slug&#34;:&#34;fen-bu-shi&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/fen-bu-shi/&#34;}],&#34;date&#34;:&#34;2022-03-20 17:50:28&#34;,&#34;dateFormat&#34;:&#34;2022-03-20 05:50:28&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/wo-li-jie-de-cap/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;6 min read&#34;,&#34;time&#34;:307000,&#34;words&#34;:1455,&#34;minutes&#34;:6},&#34;description&#34;:&#34;æœ€è¿‘åœ¨æ¢³ç†æˆ‘ä»¬ç³»ç»Ÿæ¶æ„çš„æ—¶å€™ï¼Œæƒ³ä»åˆ†å¸ƒå¼é¢†åŸŸçš„è§’åº¦æ¥åˆ†ææ¶æ„è®¾è®¡ï¼Œä½†æ˜¯ç”±äºä¹‹å‰æ²¡ç³»ç»Ÿæ€§æ¥è§¦è¿‡åˆ†å¸ƒå¼ç›¸å…³çš„çŸ¥è¯†ï¼Œæ­£å¥½å€Ÿæ­¤æœºä¼šæ¥å­¦ä¹ åˆ†å¸ƒå¼ç›¸å…³çš„çŸ¥è¯†ï¼Œå¹¶è¿›è¡Œè‡ªå·±çš„æ€»ç»“ã€‚æœ¬æ–‡çš„ç›®çš„æ˜¯ææ¸…æ¥šä»€ä¹ˆæ˜¯CAPã€‚\n\nåˆ†å¸ƒå¼ç³»ç»Ÿçš„æœ€å¤§éš¾ç‚¹ï¼Œå°±æ˜¯å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8E%86%E5%8F%B2%E8%83%8C%E6%99%AF\&#34;&gt;å†å²èƒŒæ™¯&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A6%82%E5%BF%B5%E8%A7%A3%E9%87%8A\&#34;&gt;æ¦‚å¿µè§£é‡Š&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#consistency-%E4%B8%80%E8%87%B4%E6%80%A7\&#34;&gt;Consistency ä¸€è‡´æ€§&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#availability-%E5%8F%AF%E9%9D%A0%E6%80%A7\&#34;&gt;Availability å¯é æ€§&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#partition-tolerance-%E5%88%86%E5%8C%BA%E5%AE%B9%E9%94%99%E6%80%A7\&#34;&gt;Partition Tolerance åˆ†åŒºå®¹é”™æ€§&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%B8%BA%E4%BB%80%E4%B9%88c%E5%92%8Ca%E4%B8%8D%E8%83%BD%E5%90%8C%E6%97%B6%E5%AD%98%E5%9C%A8\&#34;&gt;ä¸ºä»€ä¹ˆCå’ŒAä¸èƒ½åŒæ—¶å­˜åœ¨&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%A6%82%E4%BD%95%E5%8F%96%E8%88%8Dc%E5%92%8Ca\&#34;&gt;å¦‚ä½•å–èˆCå’ŒA&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8F%82%E8%80%83\&#34;&gt;å‚è€ƒ&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;åœ¨JDK8ä¹‹åï¼ŒLambdaè¡¨è¾¾å¼çš„åŠŸèƒ½ä¸ºæ—¥å¸¸å¼€å‘æä¾›äº†å¾ˆå¤šä¾¿æ·çš„æ“ä½œï¼Œä½†æ˜¯æ²¡æ¥è§¦è¿‡çš„äººä¼šå¯¹è¿™ç§è¡¨è¾¾å¼æœ‰å¾ˆå¤§çš„ç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·è¡¨ç¤ºï¼Ÿæˆ‘è¦æ€ä¹ˆå†™å‡ºLambdaé£æ ¼çš„ä»£ç ï¼Ÿæœ¬æ–‡æ—¨åœ¨å¿«é€Ÿç†è§£lambdaã€‚&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;p&gt;å…ˆçœ‹ä¸‹lambdaè¡¨è¾¾å¼æ˜¯ä»€ä¹ˆã€‚åœ¨JDK8ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¥å£æ·»åŠ ä¸€ä¸ªæ³¨è§£&lt;code&gt;@FunctionalInterface&lt;/code&gt;,æˆ‘ä»¬çœ‹ä¸‹JDKä¸­&lt;code&gt;Runnalble&lt;/code&gt;æ¥å£&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@FunctionalInterface\npublic interface Runnable {\n    \n    void run();\n    \n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;æ¥å£å†…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•&lt;code&gt;run()&lt;/code&gt;ï¼Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå·±è¦å®ç°ä¸€ä¸ªlambdaæ¥å£ï¼Œé‚£ä¹ˆæ¥å£å†…æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼ˆ&lt;code&gt;default&lt;/code&gt;ä¿®é¥°çš„ä¸ç®—ï¼‰ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆé™åˆ¶ï¼Ÿçœ‹å®Œåæ–‡å°±çŸ¥é“äº†ã€‚&lt;/p&gt;\n&lt;p&gt;ä¸&lt;code&gt;Runnable&lt;/code&gt;å¸¸å¸¸ä¸€èµ·å‡ºç°çš„æ˜¯&lt;code&gt;Thread&lt;/code&gt;ç±»ï¼Œçœ‹ä¸‹Threadä¸­æ˜¯å¦‚ä½•ä½¿ç”¨&lt;code&gt;Runnable&lt;/code&gt;çš„&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public Thread(Runnable target) {\n    init(null, target, &amp;quot;Thread-&amp;quot; + nextThreadNum(), 0);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;æ„é€ æ–¹æ³•ä¸­å¯ä»¥ä¼ å…¥ä¸€ä¸ª&lt;code&gt;Runnable&lt;/code&gt;å¯¹è±¡ï¼Œåœ¨JDK8ä¹‹å‰å¯ä»¥ä½¿ç”¨åŒ¿åç±»çš„æ–¹å¼&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;Thread thread = new Thread(new Runnable() {\n    @Override\n    public void run() {\n        // ç¼–å†™è¿è¡Œé€»è¾‘\n    }\n});\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;è¿™å°±ç›¸å½“äºä¼ å…¥äº†ä¸€ä¸ªRunnalbleå®ä¾‹å¯¹è±¡äº†ã€‚&lt;/p&gt;\n&lt;p&gt;ç°åœ¨æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘ä»¬çŸ¥é“æ¥å£çš„å‚æ•°å¯¹è±¡æ˜¯Runnableï¼ŒçŸ¥åˆ°Runnableä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼ˆä¸Šæ–‡æåˆ°çš„é™åˆ¶ï¼‰ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ç®€åŒ–è¿™ä¸ªè¡¨è¾¾å¼å—ï¼Ÿ&lt;/p&gt;\n&lt;p&gt;å°è¯•å»æ‰å¤šä½™çš„å‚æ•°å£°æ˜è¯­å¥&lt;/p&gt;\n&lt;p&gt;&lt;img src=\&#34;https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d806efa7ee00439bacd42920b680277c~tplv-k3u1fbpfcp-watermark.image?\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\næ¥ç€å»æ‰å¤šä½™çš„æ–¹æ³•å£°æ˜è¯­å¥&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/32b0646872074fac998da89e8225d212~tplv-k3u1fbpfcp-watermark.image?\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;æ˜¯çš„ï¼Œæœ€åå‰©ä¸‹çš„å°±æ˜¯å®é™…æœ‰æ•ˆçš„éƒ¨åˆ†ï¼Œæ–¹æ³•çš„å‚æ•°å’Œæ–¹æ³•çš„é€»è¾‘ã€‚&lt;/p&gt;\n&lt;p&gt;æœ€åæˆ‘ä»¬åŠ ä¸ªç®­å¤´&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2af1d6ea86aa4f34982b8b8040fb658c~tplv-k3u1fbpfcp-watermark.image?\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;æ²¡é”™ï¼Œè¿™ä¸ªå°±æ˜¯lambdaè¡¨è¾¾å¼äº†ï¼Œå°±æ˜¯è¿™ä¹ˆå˜åŒ–è¿‡æ¥çš„ã€‚&lt;/p&gt;\n&lt;p&gt;è€ƒè™‘æœ‰å‚æ•°çš„æƒ…å†µï¼ŒåŠ å…¥Runnableæ¥å£çš„runæ–¹æ³•æ˜¯æœ‰å‚æ•°çš„ï¼Œä¾‹å¦‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@FunctionalInterface\npublic interface Runnable {\n    \n    void run(String key,int val);\n    \n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;é‚£ä¹ˆå¯¹åº”ï¼Œlambdaè¡¨è¾¾å¼å°±å˜æˆ&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;new Thread((&amp;quot;hello&amp;quot;,20) -&amp;gt; {\n    String k = key; // k == &amp;quot;hello&amp;quot;\n    int v = val;    // v == 20\n});\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å¦‚æœæ–¹æ³•çš„ä»£ç åªæœ‰ä¸€è¡Œï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥ä¸­æ‹¬å·&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;new Thread((&amp;quot;hello&amp;quot;,20) -&amp;gt; log.info(&amp;quot;key = {}&amp;quot;,key));\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;kuai-su-kan-qing-lambda-de-ben-zhi&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;åœ¨JDK8ä¹‹åï¼ŒLambdaè¡¨è¾¾å¼çš„åŠŸèƒ½ä¸ºæ—¥å¸¸å¼€å‘æä¾›äº†å¾ˆå¤šä¾¿æ·çš„æ“ä½œï¼Œä½†æ˜¯æ²¡æ¥è§¦è¿‡çš„äººä¼šå¯¹è¿™ç§è¡¨è¾¾å¼æœ‰å¾ˆå¤§çš„ç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·è¡¨ç¤ºï¼Ÿæˆ‘è¦æ€ä¹ˆå†™å‡ºLambdaé£æ ¼çš„ä»£ç ï¼Ÿæœ¬æ–‡æ—¨åœ¨å¿«é€Ÿç†è§£lambdaã€‚&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;å¿«é€Ÿçœ‹æ¸…lambdaçš„æœ¬è´¨&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Java&#34;,&#34;slug&#34;:&#34;6j9B3b2nb&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/6j9B3b2nb/&#34;}],&#34;date&#34;:&#34;2022-02-11 19:13:57&#34;,&#34;dateFormat&#34;:&#34;2022-02-11 07:13:57&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/kuai-su-kan-qing-lambda-de-ben-zhi/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:116000,&#34;words&#34;:504,&#34;minutes&#34;:2},&#34;description&#34;:&#34;åœ¨JDK8ä¹‹åï¼ŒLambdaè¡¨è¾¾å¼çš„åŠŸèƒ½ä¸ºæ—¥å¸¸å¼€å‘æä¾›äº†å¾ˆå¤šä¾¿æ·çš„æ“ä½œï¼Œä½†æ˜¯æ²¡æ¥è§¦è¿‡çš„äººä¼šå¯¹è¿™ç§è¡¨è¾¾å¼æœ‰å¾ˆå¤§çš„ç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·è¡¨ç¤ºï¼Ÿæˆ‘è¦æ€ä¹ˆå†™å‡ºLambdaé£æ ¼çš„ä»£ç ï¼Ÿæœ¬æ–‡æ—¨åœ¨å¿«é€Ÿç†è§£lambdaã€‚\n\nå…ˆçœ‹ä¸‹lambdaè¡¨è¾¾å¼æ˜¯ä»€ä¹ˆã€‚åœ¨J...&#34;,&#34;toc&#34;:&#34;&#34;},{&#34;content&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;å‡è®¾å·²ç»äº†è§£ä¸€è‡´æ€§Hashçš„ç›¸å…³çŸ¥è¯†ï¼Œå¦‚æœä¸äº†è§£å¯ä»¥å…ˆçœ‹&lt;a href=\&#34;https://www.zsythink.net/archives/1182\&#34;&gt;https://www.zsythink.net/archives/1182&lt;/a&gt;&lt;br&gt;\nä»£ç åœ°å€ï¼š&lt;a href=\&#34;https://github.com/zexho994/ConsistentHash\&#34;&gt;https://github.com/zexho994/ConsistentHash&lt;/a&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;æˆ‘ä»¬çŸ¥é“ä¸€è‡´æ€§hashçš„æ ¸å¿ƒæ€æƒ³æ˜¯å¯¹2^32è¿›è¡Œå–æ¨¡ï¼Œç„¶åä¿å­˜åˆ°ä¸€ä¸ªHashç¯ä¸Š:&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/20726d0655964e89a79dbb2f4d91e809~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;è¦å®ç°ä¸€è‡´æ€§Hashï¼Œå…ˆè§£å†³å‡ ä¸ªé—®é¢˜ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;å¦‚ä½•è¡¨ç¤ºè¿™ä¸ªç¯ï¼Ÿ&lt;/li&gt;\n&lt;li&gt;å¦‚ä½•åœ¨ç¯ä¸Šæ’å…¥èŠ‚ç‚¹ã€åˆ é™¤èŠ‚ç‚¹ã€æŸ¥æ‰¾æœ€è¿‘çš„èŠ‚ç‚¹ï¼Ÿ&lt;/li&gt;\n&lt;li&gt;è™šæ‹ŸèŠ‚ç‚¹å¦‚ä½•è¡¨ç¤ºï¼Œæ€ä¹ˆæ’å…¥åˆ°ç¯ä¸­ï¼Ÿ&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;hashç¯\&#34;&gt;Hashç¯&lt;/h2&gt;\n&lt;p&gt;æ€è€ƒä¸‹è¿™ä¸ªhashç¯çš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬çš„èŠ‚ç‚¹è¦æ’å…¥åˆ°å“ªä¸ªä½ç½®ç”±èŠ‚ç‚¹çš„hashå€¼å†³å®šï¼Œç°åœ¨åŠ å…¥æœ‰ä¸¤ä¸ªèŠ‚ç‚¹Aå’ŒBï¼Œ&lt;code&gt;A.hashcode = 50&lt;/code&gt;,&lt;code&gt;B.hashcode = 100&lt;/code&gt;,ç”±äºç¯æ˜¯æŒ‰é¡ºæ—¶é’ˆæ–¹å‘æŸ¥æ‰¾ï¼Œé‚£ä¹ˆæŸ¥æ‰¾çš„é€»è¾‘å°±æ˜¯:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;[0,50] , (50,2^32] çš„æ•°æ®ä¼šæ‰¾åˆ°A&lt;/li&gt;\n&lt;li&gt;(50,100] çš„æ•°æ®ä¼šæ‰¾åˆ°B&lt;br&gt;\nå¯ä»¥å‘ç°ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯è¦æœ‰åºï¼Œä»¥åŠå¯ä»¥æ”¯æŒå¿«é€Ÿæ‰¾åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ&lt;code&gt;TreeMap&lt;/code&gt;å°±ååˆ†å¥‘åˆ, æ¯ä¸ªèŠ‚ç‚¹çš„å³å­æ ‘å°±æ˜¯æœ€å°çš„æœ€è¿‘çš„å¤§äºæŸä¸ªhashcodeçš„èŠ‚ç‚¹ã€‚&lt;br&gt;\n&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f70674010c44788ba3189a9a3522965~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\næ•´ä¸ªç®—æ³•æ ¸å¿ƒçš„éƒ¨åˆ†ä¹Ÿæ˜¯åŸºäº&lt;code&gt;TreeMap&lt;/code&gt;å®ç°çš„ï¼Œé¦–å…ˆå£°æ˜&lt;code&gt;ring&lt;/code&gt;ï¼Œåé¢æ‰€æœ‰çš„èŠ‚ç‚¹æ•°æ®éƒ½å°†å­˜å‚¨åˆ°ringä¸Šã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class ConsistentHashManager {\n\n    private final SortedMap&amp;lt;Integer/*ç´¢å¼•å¤§å°*/, Node/*èŠ‚ç‚¹*/&amp;gt; ring = new TreeMap();\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;code&gt;ring&lt;/code&gt;ä¸­&lt;code&gt;key&lt;/code&gt;å­˜å‚¨çš„èŠ‚ç‚¹çš„&lt;code&gt;ç´¢å¼•&lt;/code&gt;å€¼ï¼ˆåé¢ä¼šè®²è®¡ç®—æ–¹å¼ï¼‰ï¼Œ&lt;code&gt;val&lt;/code&gt;ä¸­å­˜å‚¨èŠ‚ç‚¹å¯¹è±¡å®ä¾‹&lt;code&gt;Node&lt;/code&gt;ï¼Œå…¶ä¸­&lt;code&gt;Node&lt;/code&gt;æ˜¯æ¨¡æ‹Ÿè¡¨ç¤ºç°å®æœåŠ¡å™¨ä¿¡æ¯çš„å¯¹è±¡ï¼Œéœ€è¦é‡å†™&lt;code&gt;equals()&lt;/code&gt;å’Œ&lt;code&gt;hashcode()&lt;/code&gt;æ–¹æ³•ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class Node {\n\n    //æœåŠ¡å™¨åç§°\n    private String name;\n    //æœåŠ¡å™¨åŸŸå\n    private String host;\n    //æœåŠ¡å™¨ç«¯å£\n    private Integer port;\n\n    public Node(String name, String host, int port) {\n        this.name = name;\n        this.host = host;\n        this.port = port;\n    }\n\n    @Override\n    public boolean equals(Object o) {\n        if (this == o) return true;\n        if (!(o instanceof Node)) return false;\n        Node node = (Node) o;\n        return getPort() == node.getPort() &amp;amp;&amp;amp; getName().equals(node.getName()) &amp;amp;&amp;amp; getHost().equals(node.getHost());\n    }\n\n    @Override\n    public int hashCode() {\n        return Objects.hash(getName(), getHost(), getPort());\n    }\n    \n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;æ·»åŠ æ–°èŠ‚ç‚¹\&#34;&gt;æ·»åŠ æ–°èŠ‚ç‚¹&lt;/h2&gt;\n&lt;p&gt;è¦å°†ä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨åˆ°ç¯ä¸Šï¼Œé¦–å…ˆæ˜¯è¦çŸ¥é“å­˜å‚¨åˆ°å“ªä¸ªä½ç½®ä¸Šï¼Œä½ç½®ç”±ç´¢å¼•çš„å¤§å°å†³å®šï¼Œè¿™å°±éœ€è¦è®¡ç®—&lt;code&gt;Nodeå¯¹è±¡&lt;/code&gt;çš„ç´¢å¼•å€¼&lt;br&gt;\n&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/349fd9c6f8ca43268c9abdaf5e1d92c5~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\nå…ˆå£°æ˜ä¸€ä¸ªæ¥å£å¯¹è±¡ï¼Œå› ä¸ºä»¥åå¯èƒ½ä¼šæœ‰å„ç§è®¡ç®—æ–¹å¼ï¼Œé‚£ä¹ˆä¼šæœ‰å„ç§ä¸åŒçš„å…·ä½“å®ç°ç±»ï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨åŸºäºæ¥å£è€Œéå®ä¾‹çš„æ–¹å¼ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public interface HashUtil {\n\n    int hash(String key);\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ä¸‹é¢æ˜¯ä½¿ç”¨MD5çš„æ–¹å¼ï¼Œè¿™è‚¯å®šä¸æ˜¯æœ€å¥½çš„æ–¹æ³•ï¼Œé‡ç‚¹æ˜¯è¡¨è¾¾&lt;code&gt;hash()&lt;/code&gt;çš„ä½œç”¨&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class Md5HashUtil implements HashUtil {\n\n    private MessageDigest messageDigest;\n\n    public Md5HashUtil() {\n        try {\n            this.messageDigest = MessageDigest.getInstance(&amp;quot;MD5&amp;quot;);\n        } catch (NoSuchAlgorithmException e) {\n            e.printStackTrace();\n        }\n    }\n\n    @Override\n    public int hash(String key) {\n        this.messageDigest.update(String.valueOf(key).getBytes();\n        byte[] digest = this.messageDigest.digest();\n        int h = 0;\n        for (int i = 0; i &amp;lt; 4; i++) {\n            h |= ((int) digest[i]) &amp;amp; 0xFF;\n            // å¾ªç¯4æ¬¡ï¼Œæ¯æ¬¡ç§»åŠ¨8ä½ï¼Œæ­£å¥½32æ¬¡\n            h &amp;lt;&amp;lt;= 8;\n        }\n        return h;\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;æœ‰äº†&lt;code&gt;hash()&lt;/code&gt;æ–¹æ³•ï¼Œå¯ä»¥çŸ¥é“èŠ‚ç‚¹çš„ç´¢å¼•å€¼äº†ï¼Œå°±å¯ä»¥å°†Nodeå­˜å‚¨åˆ°ringä¸­äº†&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public void addNode(Node node) {\n    ring.put(hashUtil.hash(node.getKey()), node);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;é‚£ä¹ˆè¿™æ—¶å€™è¿˜æœ‰ä¸€ä»¶äº‹è¦åšï¼Œå¦‚ä½•æ·»åŠ è™šæ‹ŸèŠ‚ç‚¹å‘¢ï¼Ÿåˆšå¼€å§‹çš„æ—¶å€™æˆ‘è®¤ä¸ºä¸ºäº†ä¿è¯å¹³å‡åˆ†å¸ƒï¼Œé‚£ä¹ˆè™šæ‹ŸèŠ‚ç‚¹çš„åˆ†å¸ƒç‰¹å¾åº”è¯¥å¦‚ä¸‹ï¼š&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/07ff31e6502b4cc195d50224ce7951a7~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;ä½†æ˜¯ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œè¦ç»§ç»­å¢åŠ æ›´å¤šç‰©ç†èŠ‚ç‚¹æ—¶ï¼Œå¦‚ä½•ç»§ç»­ä¿æŒå¹³å‡åˆ†å¸ƒï¼Ÿè¿™å¾ˆéš¾å®ç°ï¼Œä»å¦ä¸€ä¸ªæ–¹é¢å†æƒ³ï¼Œè™šæ‹ŸèŠ‚ç‚¹çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯ä¸ºäº†è®©åˆ†é…æ›´å¹³å‡ï¼Œé˜²æ­¢è¡€å´©çš„æ¦‚ç‡ï¼Œå…¶å®å“ªæ€•è¿™äº›è™šæ‹ŸèŠ‚ç‚¹çš„ä½ç½®éƒ½æ˜¯éšæœºçš„ï¼Œåªè¦èŠ‚ç‚¹æ•°é‡å¤Ÿå¤šï¼Œå°±å·²ç»è¾¾åˆ°äº†ç›®çš„ã€‚&lt;/p&gt;\n&lt;p&gt;å®Œå–„ä¸€ä¸‹&lt;code&gt;addNode()&lt;/code&gt;æ–¹æ³•&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public void addNode(Node node) {\n    ring.put(hashUtil.hash(node.getKey()), node);\n    for (int i = 0; i &amp;lt; this.virNodeCount; i++) {\n        this.ring.put(hashUtil.hash(node.getKey() + i), node);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;åˆ é™¤èŠ‚ç‚¹\&#34;&gt;åˆ é™¤èŠ‚ç‚¹&lt;/h2&gt;\n&lt;p&gt;&lt;code&gt;ring&lt;/code&gt;ä¸­å­˜å‚¨çš„valæ˜¯Nodeï¼Œè¿™æ ·åœ¨éå†ringçš„åŒ¹é…nodeè¿›è¡Œåˆ é™¤å³å¯&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public void removeNote(Node node) {\n    ring.entrySet().removeIf(next -&amp;gt; next.getValue().equals(node));\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;è·å–ä¸‹ä¸€ä¸ªèŠ‚ç‚¹\&#34;&gt;è·å–ä¸‹ä¸€ä¸ªèŠ‚ç‚¹&lt;/h2&gt;\n&lt;p&gt;è¿™éƒ¨åˆ†çœ‹ä»£ç äº†è§£ä¸‹&lt;code&gt;TreeMap&lt;/code&gt;çš„&lt;code&gt;api&lt;/code&gt;å°±å¯ä»¥ç†è§£ï¼Œæ²¡ä»€ä¹ˆéš¾åº¦&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public Node getNextNode(String key) {\n    SortedMap&amp;lt;Integer, Node&amp;gt; longNodeSortedMap = ring.tailMap(hashUtil.hash(key));\n    if (longNodeSortedMap.isEmpty()) {\n        return ring.get(ring.firstKey());\n    }\n    return longNodeSortedMap.get(longNodeSortedMap.firstKey());\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;æµ‹è¯•\&#34;&gt;æµ‹è¯•&lt;/h1&gt;\n&lt;h2 id=\&#34;è´Ÿè½½å‡è¡¡\&#34;&gt;è´Ÿè½½å‡è¡¡&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Test\nvoid loadBalancingTest() {\n    ConsistentHashManager consistentHashManager = new ConsistentHashManager();\n    // æ·»åŠ å››ä¸ªèŠ‚ç‚¹\n    consistentHashManager.addNode(new Node(&amp;quot;node1&amp;quot;, &amp;quot;192.0.0.1&amp;quot;, 8080));\n    consistentHashManager.addNode(new Node(&amp;quot;node2&amp;quot;, &amp;quot;192.0.0.2&amp;quot;, 8080));\n    consistentHashManager.addNode(new Node(&amp;quot;node3&amp;quot;, &amp;quot;192.0.0.3&amp;quot;, 8080));\n    consistentHashManager.addNode(new Node(&amp;quot;node4&amp;quot;, &amp;quot;192.0.0.4&amp;quot;, 8080));\n\n    String preKey = &amp;quot;Data_&amp;quot;;\n    // mapç”¨æ¥è®°å½•æ¯ä¸ªèŠ‚ç‚¹å‘½ä¸­çš„æ¬¡æ•°\n    Map&amp;lt;String, Integer&amp;gt; map = new HashMap&amp;lt;&amp;gt;(200000);\n    map.put(&amp;quot;node1&amp;quot;, 0);\n    map.put(&amp;quot;node2&amp;quot;, 0);\n    map.put(&amp;quot;node3&amp;quot;, 0);\n    map.put(&amp;quot;node4&amp;quot;, 0);\n    // å‡è®¾æœ‰20wä¸ªæ•°æ®\n    for (int i = 0; i &amp;lt; 200000; i++) {\n        Node nextNote = consistentHashManager.getNextNote(preKey + i);\n        // ç´¯åŠ å‘½ä¸­æ¬¡æ•°\n        map.computeIfPresent(nextNote.getName(), (k, v) -&amp;gt; v + 1);\n    }\n    // æ‰“å°\n    map.entrySet().forEach(System.out::println);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;3\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/88147670d09b40c8aab81a41269e700d~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;æ•´ä½“çš„æ¯”ä¾‹æ˜¯ &lt;code&gt;5 : 6 : 4.5 : 4.5&lt;/code&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;åˆ é™¤èŠ‚ç‚¹åçš„å‘½ä¸­ç‡\&#34;&gt;åˆ é™¤èŠ‚ç‚¹åçš„å‘½ä¸­ç‡&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Test\nvoid removeNodeTest() {\n    // çœç•¥æ·»åŠ èŠ‚ç‚¹çš„ä»£ç  ...\n    \n    // ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹\n    consistentHashManager.removeNote(node4);\n    // æµ‹è¯•ä¸‹ç§»é™¤èŠ‚ç‚¹åçš„å‘½ä¸­ç‡\n    AtomicInteger n1 = new AtomicInteger(0);\n    AtomicInteger n2 = new AtomicInteger(0);\n    AtomicInteger n3 = new AtomicInteger(0);\n    for (int i = 0; i &amp;lt; 200000; i++) {\n        Node nextNode = consistentHashManager.getNextNode(preKey + i);\n        if (nextNode.getName().equals(&amp;quot;node1&amp;quot;)) {\n            n1.incrementAndGet();\n        } else if (nextNode.getName().equals(&amp;quot;node2&amp;quot;)) {\n            n2.incrementAndGet();\n        } else if (nextNode.getName().equals(&amp;quot;node3&amp;quot;)) {\n            n3.incrementAndGet();\n        } else {\n            throw new RuntimeException(&amp;quot;node4 æœªæ¸…ç†å¹²å‡€&amp;quot;);\n        }\n    }\n\n    // æ‰“å°å‘½ä¸­ç‡, åŸæœ¬çš„æ¬¡æ•°/åˆ é™¤åçš„æ¬¡æ•°\n    statistic.forEach((key, value) -&amp;gt; {\n        if (key.equals(&amp;quot;node1&amp;quot;)) {\n            System.out.println(&amp;quot;Node1,æ€»è®¿é—®æ¬¡æ•°=&amp;quot; + n1 + &amp;quot;,æœ‰æ•ˆè®¿é—® &amp;quot; + value + &amp;quot; å‘½ä¸­ç‡ = &amp;quot; + (double) (value) / n1.get());\n        } else if (key.equals(&amp;quot;node2&amp;quot;)) {\n            System.out.println(&amp;quot;Node2,æ€»è®¿é—®æ¬¡æ•°=&amp;quot; + n2 + &amp;quot;,æœ‰æ•ˆè®¿é—® &amp;quot; + value + &amp;quot; å‘½ä¸­ç‡ = &amp;quot; + (double) (value) / n2.get());\n        } else if (key.equals(&amp;quot;node3&amp;quot;)) {\n            System.out.println(&amp;quot;Node3,æ€»è®¿é—®æ¬¡æ•°=&amp;quot; + n3 + &amp;quot;,æœ‰æ•ˆè®¿é—® &amp;quot; + value + &amp;quot; å‘½ä¸­ç‡ = &amp;quot; + (double) (value) / n3.get());\n        }\n    });\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;4\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f72b63651f134c3eade1c41a75fdd122~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&#34;,&#34;fileName&#34;:&#34;shi-xian-yi-zhi-xing-hash-suan-fa&#34;,&#34;abstract&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;å‡è®¾å·²ç»äº†è§£ä¸€è‡´æ€§Hashçš„ç›¸å…³çŸ¥è¯†ï¼Œå¦‚æœä¸äº†è§£å¯ä»¥å…ˆçœ‹&lt;a href=\&#34;https://www.zsythink.net/archives/1182\&#34;&gt;https://www.zsythink.net/archives/1182&lt;/a&gt;&lt;br&gt;\nä»£ç åœ°å€ï¼š&lt;a href=\&#34;https://github.com/zexho994/ConsistentHash\&#34;&gt;https://github.com/zexho994/ConsistentHash&lt;/a&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;æˆ‘ä»¬çŸ¥é“ä¸€è‡´æ€§hashçš„æ ¸å¿ƒæ€æƒ³æ˜¯å¯¹2^32è¿›è¡Œå–æ¨¡ï¼Œç„¶åä¿å­˜åˆ°ä¸€ä¸ªHashç¯ä¸Š:&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;å®ç°ä¸€è‡´æ€§Hashç®—æ³•&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;åˆ†å¸ƒå¼&#34;,&#34;slug&#34;:&#34;fen-bu-shi&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/fen-bu-shi/&#34;},{&#34;name&#34;:&#34;é€ è½®å­&#34;,&#34;slug&#34;:&#34;KrLfgh9WlS&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/KrLfgh9WlS/&#34;}],&#34;date&#34;:&#34;2022-02-02 15:12:22&#34;,&#34;dateFormat&#34;:&#34;2022-02-02 03:12:22&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/shi-xian-yi-zhi-xing-hash-suan-fa/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;7 min read&#34;,&#34;time&#34;:392000,&#34;words&#34;:1449,&#34;minutes&#34;:7},&#34;description&#34;:&#34;\nå‡è®¾å·²ç»äº†è§£ä¸€è‡´æ€§Hashçš„ç›¸å…³çŸ¥è¯†ï¼Œå¦‚æœä¸äº†è§£å¯ä»¥å…ˆçœ‹https://www.zsythink.net/archives/1182\nä»£ç åœ°å€ï¼šhttps://github.com/zexho994/ConsistentHash\n\næˆ‘ä»¬çŸ¥...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#hash%E7%8E%AF\&#34;&gt;Hashç¯&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%B7%BB%E5%8A%A0%E6%96%B0%E8%8A%82%E7%82%B9\&#34;&gt;æ·»åŠ æ–°èŠ‚ç‚¹&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9\&#34;&gt;åˆ é™¤èŠ‚ç‚¹&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%8E%B7%E5%8F%96%E4%B8%8B%E4%B8%80%E4%B8%AA%E8%8A%82%E7%82%B9\&#34;&gt;è·å–ä¸‹ä¸€ä¸ªèŠ‚ç‚¹&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%B5%8B%E8%AF%95\&#34;&gt;æµ‹è¯•&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1\&#34;&gt;è´Ÿè½½å‡è¡¡&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9%E5%90%8E%E7%9A%84%E5%91%BD%E4%B8%AD%E7%8E%87\&#34;&gt;åˆ é™¤èŠ‚ç‚¹åçš„å‘½ä¸­ç‡&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;å‰æï¼šæœ¬æ–‡å‡è®¾ä½ å·²ç»äº†è§£AOPåˆ‡é¢ç¼–ç¨‹çš„åŸºç¡€æ¦‚å¿µ&lt;br&gt;\né¡¹ç›®åœ°å€ï¼š&lt;a href=\&#34;https://github.com/zexho994/IOC-AOP\&#34;&gt;https://github.com/zexho994/IOC-AOP&lt;/a&gt;&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;aopçš„é€»è¾‘\&#34;&gt;AOPçš„é€»è¾‘&lt;/h1&gt;\n&lt;p&gt;é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè¢«ä»£ç†ç±»&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Bean\npublic class A interface I{\n\n    public void print() {\n        System.out.println(&amp;quot;aaa&amp;quot;);\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å®šä¹‰åˆ‡ç‚¹å’Œåˆ‡é¢&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Bean\n@Aspect\npublic class AdviceSample {\n\n    @Before\n    @Pointcut(beanName = &amp;quot;A&amp;quot;)\n    public void enhance2Before() {\n        System.out.println(&amp;quot;before&amp;quot;);\n    }\n\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;åç»­æˆ‘ä»¬ä½¿ç”¨Açš„æ—¶å€™ï¼Œéƒ½ä¼šå…ˆæ‰“å°åˆ‡é¢çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;before\naaa\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/83758a4da5594e43aee236ff3ba476df~tplv-k3u1fbpfcp-watermark.image?\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;å¦‚ä½•å°†åˆ‡é¢çš„å†…å®¹æ·»åŠ åˆ°ä»£ç†çš„æ–¹æ³•é‡Œé¢å»å‘¢ï¼Ÿ&lt;/p&gt;\n&lt;h1 id=\&#34;åˆ‡é¢åˆ‡å…¥å®ç°\&#34;&gt;åˆ‡é¢åˆ‡å…¥å®ç°&lt;/h1&gt;\n&lt;h2 id=\&#34;jdkåŠ¨æ€ä»£ç†å®ç°\&#34;&gt;JDKåŠ¨æ€ä»£ç†å®ç°&lt;/h2&gt;\n&lt;p&gt;æåˆ°ä»£ç†ï¼Œæœ€å…ˆæƒ³åˆ°çš„æ˜¯JDKæä¾›çš„åŠ¨æ€ä»£ç†ç±»&lt;code&gt;InvocationHandler&lt;/code&gt;ï¼Œä¸‹é¢å°è¯•ä½¿ç”¨JDKåŠ¨æ€ä»£ç†å®ç° ï¼Œåˆ‡å…¥çš„æ–¹å¼å‡è®¾ä½¿ç”¨&lt;code&gt;before&lt;/code&gt;ï¼Œè€Œ&lt;code&gt;after&lt;/code&gt;å’Œ&lt;code&gt;around&lt;/code&gt;çœ‹å®Œå°±æ‡‚å¦‚ä½•å®ç°äº†ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class JDKDynamicProxy implements InvocationHandler {\n    \n    private Method before = null;\n    private Object beforeObj = null;\n\n    \n    /**\n     * @param proxy  ä»£ç†çš„çœŸå®å¯¹è±¡\n     * @param method è¦è°ƒç”¨çš„çœŸå®å¯¹è±¡çš„æ–¹æ³•\n     * @param args   æ–¹æ³•çš„å‚æ•°\n     */\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n\t\t// æ‰§è¡Œbeforeæ–¹æ³•\n        if (before != null) {\n            before.invoke(beforeObj);\n        }\n\n        // æ‰§è¡Œæœ¬ä½“æ–¹æ³•\n        Object invoke = method.invoke(target, args);\n\n        return invoke;\n    }\n    \n    /**\n     * è·å–åŠ¨æ€ä»£ç†å¯¹è±¡\n     *\n     * @param obj è¢«ä»£ç†ç±»\n     * @return objçš„çˆ¶æ¥å£å®ç°å­ç±», å› ä¸ºè¿”å›çš„æ˜¯Tçˆ¶æ¥å£é‡å†™çš„ç±»\n     */\n    @SuppressWarnings(&amp;quot;unchecked&amp;quot;)\n    public &amp;lt;T&amp;gt; T getDynamicProxyImpl(T obj,Method before, Object beforeObj) {\n        assert obj != null;\n        this.before = before;\n        this.beforeObj = beforeObj;\n\n        // newProxyInstance() ä¼šåˆ›å»ºç±»$Aï¼Œ$Aå®ç°äº†objçš„çˆ¶æ¥å£ï¼Œæ‰€æœ‰æ¥å£æ–¹æ³•å†…å®¹éƒ½ä¸º {@link #invoke()} ã€‚\n        return (T) newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(), this);\n    }\n    \n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ç»Ÿä¸€è°ƒç”¨&lt;code&gt;getDynamicProxyImpl()&lt;/code&gt;æ¥è·å–æ–°çš„ä»£ç†ç±»ï¼Œå‚æ•°é‡Œé¢ä¼ å…¥beforeçš„Methodå¯¹è±¡ï¼Œ&lt;code&gt;invoke()&lt;/code&gt;æ–¹æ³•å®šä¹‰äº†åœ¨æ‰§è¡Œæœ¬ä½“æ–¹æ³•ä¹‹å‰æ‰§è¡Œ&lt;code&gt;before&lt;/code&gt;æ–¹æ³•ï¼Œè¿™æ ·æ–°çš„ä»£ç†ç±»éƒ½ä¼šå…ˆæ‰§è¡Œ&lt;code&gt;before&lt;/code&gt;æ–¹æ³•å†æ‰§è¡Œæœ¬ä½“æ–¹æ³•äº†ã€‚&lt;/p&gt;\n&lt;p&gt;å®ç°éå¸¸ç®€å•æ˜“æ‡‚ï¼Œé‚£ä¹ˆè¦å®ç°&lt;code&gt;after&lt;/code&gt;æ–¹æ³•å°±æ˜¯å¯ä»¥ä¼ å…¥afterçš„&lt;code&gt;Method&lt;/code&gt;å¯¹è±¡ï¼Œç„¶ååœ¨&lt;code&gt;invoke()&lt;/code&gt;çš„æœ¬ä½“æ–¹æ³•ä¹‹åæ‰§è¡Œï¼Œ&lt;code&gt;around&lt;/code&gt;çš„å®ç°ä¸ç”¨å†å¢åŠ æ–°çš„é€»è¾‘äº†ï¼Œåªè¦åŒæ—¶ä¼ å…¥&lt;code&gt;before&lt;/code&gt;å’Œ&lt;code&gt;after&lt;/code&gt;çš„&lt;code&gt;Method&lt;/code&gt;å¯¹è±¡ï¼Œè¿™æ ·æ–°çš„ä»£ç†ç±»å°±ä¼šåŒæ—¶æ‰§è¡Œ&lt;code&gt;before()&lt;/code&gt;å’Œ&lt;code&gt;after()&lt;/code&gt;äº†ã€‚&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/72e5dca4c4a049519f0edaa0986605f5~tplv-k3u1fbpfcp-watermark.image?\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h2 id=\&#34;cglibå®ç°\&#34;&gt;Cglibå®ç°&lt;/h2&gt;\n&lt;p&gt;JDKåŠ¨æ€ä»£ç†å¯ä»¥å®ç°ï¼Œä½†æ˜¯æœ‰çº¦æŸæ¡ä»¶å°±æ˜¯è¢«ä»£ç†ç±»å¿…é¡»è¦æœ‰çˆ¶æ¥å£ï¼Œå› ä¸ºJDKåŠ¨æ€å®ç°çš„åŸç†å°±æ˜¯å®ç°æ¥å£ç”Ÿæˆå¢å¼ºçš„å­ç±»ã€‚é‚£ä¹ˆå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰çˆ¶æ¥å£è¯¥å¦‚ä½•è¿›è¡Œåˆ‡é¢å¢å¼ºå‘¢ï¼Ÿ&lt;code&gt;Spring&lt;/code&gt;ä¸­ä½¿ç”¨äº†&lt;code&gt;cglib&lt;/code&gt;è¿™ä¸ªåº“æ¥å®ç°ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class CglibProxy implements MethodInterceptor {\n\n    public static final Enhancer ENHANCER = new Enhancer();\n\n    private Method before = null;\n    private Object beforeObj = null;\n\n    private Method after = null;\n    private Object afterObj = null;\n\n    /**\n     * @param obj         cglibåŠ¨æ€ä»£ç†ç”Ÿæˆçš„å®ä¾‹\n     * @param method      è¢«è°ƒç”¨çš„æ–¹æ³•çš„å¼•ç”¨\n     * @param params      å‚æ•°åˆ—è¡¨\n     * @param methodProxy ä»£ç†ç±»å¯¹æ–¹æ³•çš„ä»£ç†å¼•ç”¨\n     */\n    @Override\n    public Object intercept(Object obj, Method method, Object[] params, MethodProxy methodProxy) throws Throwable {\n        if (before != null) {\n            before.invoke(beforeObj);\n        }\n        Object result = methodProxy.invokeSuper(obj, params);\n        if (after != null) {\n            after.invoke(afterObj);\n        }\n        return result;\n    }\n\n    public void setBefore(Method before, Object beforeObj) {\n        this.before = before;\n        this.beforeObj = beforeObj;\n    }\n\n    public void setAfter(Method after, Object afterObj) {\n        this.after = after;\n        this.afterObj = afterObj;\n    }\n\n    @SuppressWarnings(&amp;quot;unchecked&amp;quot;)\n    public static &amp;lt;T&amp;gt; T getProxy(T target, Method before, Object beforeObj, Method after, Object afterObj) {\n        ENHANCER.setSuperclass(target.getClass());\n        CglibProxy cglibProxy = new CglibProxy();\n        cglibProxy.setBefore(before, beforeObj);\n        cglibProxy.setAfter(after, afterObj);\n\n        ENHANCER.setCallback(cglibProxy);\n        return (T) ENHANCER.create();\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å®ç°çš„æ€è·¯å’ŒJDKåŠ¨æ€ä»£ç†å‡ ä¹ä¸€è‡´ï¼Œé€šè¿‡è°ƒç”¨&lt;code&gt;getProxy()&lt;/code&gt;æ–¹æ³•ä¼ å…¥&lt;code&gt;before()&lt;/code&gt;æˆ–&lt;code&gt;after()&lt;/code&gt;æ–¹æ³•å°±å¯ä»¥è·å¾—ä»£ç†ç±»äº†ã€‚&lt;/p&gt;\n&lt;p&gt;ä¸ºä»€ä¹ˆcglibçš„å®ç°ä¸éœ€è¦æ¥å£å‘¢ï¼Ÿcglibçš„å®ç°åŸç†æ˜¯ä¸ºè¢«ä»£ç†ç±»åˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œç„¶åå°†åˆ‡é¢é€šè¿‡ASMæä¾›çš„å­—èŠ‚ç æŠ€æœ¯ç»‡å…¥åˆ°ç›®æ ‡æ–¹æ³•ä¸­ï¼Œè¿™æ ·å­ç±»çš„æ–¹æ³•å°±åŒ…å«äº†æœ¬ä½“å’Œåˆ‡é¢çš„é€»è¾‘äº†ã€‚&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;3\&#34;&gt;&lt;img src=\&#34;https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d8116c3d61d4f8d8b72d525d210355d~tplv-k3u1fbpfcp-watermark.image?\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&#34;,&#34;fileName&#34;:&#34;li-yong-cglib-he-jdk-dong-tai-dai-li-shi-xian-aop&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;å‰æï¼šæœ¬æ–‡å‡è®¾ä½ å·²ç»äº†è§£AOPåˆ‡é¢ç¼–ç¨‹çš„åŸºç¡€æ¦‚å¿µ&lt;br&gt;\né¡¹ç›®åœ°å€ï¼š&lt;a href=\&#34;https://github.com/zexho994/IOC-AOP\&#34;&gt;https://github.com/zexho994/IOC-AOP&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;åˆ©ç”¨Cglibå’ŒJDKåŠ¨æ€ä»£ç†å®ç°AOP&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Java&#34;,&#34;slug&#34;:&#34;6j9B3b2nb&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/6j9B3b2nb/&#34;},{&#34;name&#34;:&#34;é€ è½®å­&#34;,&#34;slug&#34;:&#34;KrLfgh9WlS&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/KrLfgh9WlS/&#34;}],&#34;date&#34;:&#34;2021-11-11 19:11:07&#34;,&#34;dateFormat&#34;:&#34;2021-11-11 07:11:07&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/li-yong-cglib-he-jdk-dong-tai-dai-li-shi-xian-aop/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;4 min read&#34;,&#34;time&#34;:233000,&#34;words&#34;:900,&#34;minutes&#34;:4},&#34;description&#34;:&#34;å‰æï¼šæœ¬æ–‡å‡è®¾ä½ å·²ç»äº†è§£AOPåˆ‡é¢ç¼–ç¨‹çš„åŸºç¡€æ¦‚å¿µ\né¡¹ç›®åœ°å€ï¼šhttps://github.com/zexho994/IOC-AOP\n\nAOPçš„é€»è¾‘\né¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè¢«ä»£ç†ç±»\n@Bean\npublic class A interface I{...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#aop%E7%9A%84%E9%80%BB%E8%BE%91\&#34;&gt;AOPçš„é€»è¾‘&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%87%E9%9D%A2%E5%88%87%E5%85%A5%E5%AE%9E%E7%8E%B0\&#34;&gt;åˆ‡é¢åˆ‡å…¥å®ç°&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#jdk%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%AE%9E%E7%8E%B0\&#34;&gt;JDKåŠ¨æ€ä»£ç†å®ç°&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#cglib%E5%AE%9E%E7%8E%B0\&#34;&gt;Cglibå®ç°&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;ä½•ä¸ºè·¯ç”±ä¸­å¿ƒï¼Ÿ&lt;br&gt;\nåœ¨é€šå¸¸çš„ç†è§£ä¸­ï¼Œæåˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæœ€ç®€å•çš„æ¨¡å‹å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9f71895f47ec4236a5bea69b046546dc~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;å¾ˆå¥½ç†è§£ï¼Œç”Ÿäº§è€…åªè¦çŸ¥é“æ¶ˆæ¯é˜Ÿåˆ—çš„ç½‘ç»œåœ°å€ï¼Œç„¶åå‘é€æ¶ˆæ¯åˆ°è¿™ä¸ªç½‘ç»œåœ°å€ä¸Šã€‚ä½†æ˜¯å®é™…å¾€å¾€ä¸æ˜¯è¿™ä¹ˆç®€å•ï¼Œå› ä¸ºæ¶ˆæ¯é˜Ÿåˆ—ä¸€èˆ¬æ˜¯é›†ç¾¤æ¨¡å¼ï¼Œå†å¦‚ä¸‹å›¾ï¼Œ4ä¸ªå®ä¾‹ç»„æˆé›†ç¾¤ï¼š&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/506c5a983c63464da45316ec8e8d91ae~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;å‡å¦‚ç°åœ¨ç»§ç»­é‡‡ç”¨ç”Ÿäº§è€…/æ¶ˆè´¹è€…ç›´æ¥è®°å½•4ä¸ªå®ä¾‹ç½‘ç»œåœ°å€çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯å¯ä»¥å®ç°çš„ã€‚éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œéœ€è¦å¯¹é˜Ÿåˆ—è¿›è¡Œæ°´å¹³æ‰©å±•ï¼Œè¦å°†4å°å®ä¾‹ä¸´æ—¶æ‰©å±•åˆ°6å°ï¼Œé‚£ä¹ˆç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ˜¯ä¸çŸ¥é“æ–°å¢çš„ä¸¤ä¸ªå®ä¾‹ç½‘ç»œåœ°å€çš„ï¼Œè¿™æ—¶åªèƒ½é‡å¯ï¼Œè®°å½•ä¸¤ä¸ªæ–°å®ä¾‹çš„ç½‘ç»œåœ°å€å†é‡å¯ã€‚è¿™æ˜¯ä¸æ˜¯éå¸¸éº»çƒ¦ï¼Ÿé’ˆå¯¹è¿™ä¸ªé—®é¢˜å¯ä»¥æ€è€ƒä¸‹ï¼š&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;å¯¹äºé›†ç¾¤æ¨¡å¼çš„æœåŠ¡ï¼Œæœ‰æ²¡æœ‰æ›´å¥½æ›´çµæ´»çš„æ–¹å¼å»è®°å½•è·¯ç”±ä¿¡æ¯ï¼Ÿ&lt;/li&gt;\n&lt;li&gt;å½“é›†ç¾¤å®ä¾‹æ•°é‡å¢åŠ æˆ–è€…å‡å°‘æ—¶ï¼Œæ€ä¹ˆè®©å…¶ä»–æœåŠ¡å¯ä»¥çŸ¥é“ï¼Ÿå¹¶ä¸”ä¸ç”¨åšä»»ä½•æ“ä½œã€‚&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;è¿™æ—¶å¦‚æœæˆ‘ä»¬æ–°å¢ä¸€ä¸ªè·¯ç”±ä¸­å¿ƒç³»ç»Ÿï¼Œè´Ÿè´£ä¸¤ä»¶äº‹ï¼š&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;æ‰€æœ‰æœåŠ¡å¯ä»¥å»è·¯ç”±ä¸­å¿ƒä¸ŠæŠ¥è‡ªå·±çš„ç½‘ç»œåœ°å€ã€‚&lt;/li&gt;\n&lt;li&gt;æ‰€æœ‰æœåŠ¡å¯ä»¥å»è·¯ç”±ä¸­å¿ƒè·å–å…¶ä»–æœåŠ¡çš„ç½‘ç»œåœ°å€ã€‚&lt;/li&gt;\n&lt;/ol&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;3\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5e6aa125536e4dfb83330ef43de7e9d7~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;è¿™æ ·æˆ‘ä»¬ç³»ç»Ÿæœ‰å¤šå°‘çš„ä¸šåŠ¡ç³»ç»Ÿï¼Œæˆ‘ä»¬åªè¦çŸ¥é“è·¯ç”±ä¸­å¿ƒçš„åœ°å€å°±å¯ä»¥äº†ã€‚&lt;/p&gt;\n&lt;p&gt;é‚£ä¹ˆè·¯ç”±ä¸­å¿ƒæ€ä¹ˆæ„ŸçŸ¥å®ä¾‹æ•°é‡çš„å˜åŒ–å‘¢ï¼Ÿæœ€æœ´ç´ çš„æ‰‹æ®µå°±æ˜¯å¿ƒè·³ï¼Œè·¯ç”±ä¸­å¿ƒå®šæœŸå‘æ‰€æœ‰ä¸ŠæŠ¥çš„ç³»ç»Ÿå‘é€å¿ƒè·³åŒ…ï¼Œå¦‚æœå¿ƒè·³åŒ…æ²¡æœ‰å“åº”åˆ™è¯´æ˜å®ä¾‹å·²ç»åœæ­¢è¿è¡Œäº†ï¼Œåœ¨è·¯ç”±è®°å½•ä¸­å‰”é™¤è¯¥æœåŠ¡åœ°å€å°±å¯ä»¥äº†ã€‚&lt;/p&gt;\n&lt;p&gt;å…¶å®è¿™ä¸¤ä¸ªæ­¥éª¤éƒ½æœ‰ä¸“é—¨åç§°ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;æœåŠ¡æ³¨å†Œï¼šå°†æŸä¸ªæœåŠ¡è°ƒç”¨ä¿¡æ¯è®°å½•åˆ°ä¸€ä¸ªå…¬å…±ç»„ä»¶ä¸­&lt;/li&gt;\n&lt;li&gt;æœåŠ¡å‘ç°ï¼šå½“æœåŠ¡æ–°å¢/å‡å°‘ï¼Œè¦èƒ½è¢«å…¶ä»–è°ƒç”¨è€…è‡ªåŠ¨å‘ç°ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;å¸‚é¢ä¸Šå·²æœ‰çš„ä»£è¡¨æ€§äº§å“æœ‰ï¼šzookeeperã€consulã€etcdã€‚&lt;/p&gt;\n&lt;h1 id=\&#34;rocketmqä¸­çš„namesrv\&#34;&gt;RocketMQä¸­çš„Namesrv&lt;/h1&gt;\n&lt;p&gt;å›¾ä¸­å±•ç¤ºäº†Namesrvçš„3ä¸ªåŠŸèƒ½ï¼Œä¹Ÿæ˜¯æ ¸å¿ƒçš„3ä¸ªåŠŸèƒ½ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;æ³¨å†Œbroker&lt;/li&gt;\n&lt;li&gt;è·å–è·¯ç”±ä¿¡æ¯&lt;/li&gt;\n&lt;/ul&gt;\n&lt;!----&gt;\n&lt;ul&gt;\n&lt;li&gt;å®šæ—¶å¿ƒè·³æ£€æµ‹&lt;/li&gt;\n&lt;/ul&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;4\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8c54c19fc50942ddbdd8bc47e62990b1~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;æ¥ä¸‹æ¥çœ‹çœ‹rocketmqçš„æºç æ˜¯å¦‚ä½•å®ç°è¿™3ä¸ªåŠŸèƒ½çš„&lt;/p&gt;\n&lt;h1 id=\&#34;è·¯ç”±å…ƒä¿¡æ¯\&#34;&gt;è·¯ç”±å…ƒä¿¡æ¯&lt;/h1&gt;\n&lt;p&gt;namesrvä½œä¸ºè·¯ç”±ä¿¡æ¯çš„ç®¡ç†è€…ï¼Œæœ¬è´¨ä¸Šå¯ä»¥è¿™ä¹ˆå¯¹namesrvè¿›è¡Œç†è§£ï¼š&lt;strong&gt;ä¿å­˜è·¯ç”±ä¿¡æ¯çš„æ•°æ®ç»“æ„ + æ“ä½œæ•°æ®ç»“æ„çš„ç®—æ³•&lt;/strong&gt;ï¼Œè·¯ç”±å…ƒä¿¡æ¯ä¾¿æ˜¯ç¬¬ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥å…ˆçœ‹çœ‹namesrvä¿å­˜è·¯ç”±ä¿¡æ¯çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ&lt;/p&gt;\n&lt;p&gt;åœ¨&lt;code&gt;namesrv/src/main/java/org/apache/rocketmq/namesrv/routeinfo/RouteInfoManager.java&lt;/code&gt;ç±»ä¸‹ï¼ŒåŒ…å«äº†æ‰€æœ‰çš„è·¯ç”±å…ƒä¿¡æ¯&lt;/p&gt;\n&lt;h3 id=\&#34;topicqueuetable\&#34;&gt;topicQueueTable&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;    /**\n     * ä¿å­˜Topicå’Œé˜Ÿåˆ—çš„ä¿¡æ¯ï¼Œä¹Ÿå«çœŸæ­£çš„è·¯ç”±ä¿¡æ¯ã€‚\n     * ä¸€ä¸ªTopicçš„queueå¯èƒ½åˆ†å¸ƒåœ¨ä¸åŒçš„brokerä¸­ï¼Œä¹Ÿæœ‰å¯èƒ½åˆ†å¸ƒåœ¨åŒä¸€ä¸ªbrokerä¸­ã€‚\n     * key:topic . val:QueueData\n     */\n    private final HashMap&amp;lt;String, List&amp;lt;QueueData&amp;gt;&amp;gt; topicQueueTable;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;5\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6a9e4c5596d5446c904f294c0309bc2c~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;brokeraddrtable\&#34;&gt;brokerAddrTable&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;    /**\n     * BrokeråŸºç¡€ä¿¡æ¯ï¼Œbrokeråç§°å’Œbrokerä¿¡æ¯çš„å¯¹åº”ä¿¡æ¯\n     * key:broker name . val:broker data\n     */\n    private final HashMap&amp;lt;String, BrokerData&amp;gt; brokerAddrTable;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;6\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ddec0178522a42d791986edd1daf1756~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;clusteraddrtable\&#34;&gt;clusterAddrTable&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;    /**\n     * Brokeré›†ç¾¤ä¿¡æ¯,é›†ç¾¤ä¸­æ‰€æœ‰Brokeråç§°\n     * key: cluster name . val:set&amp;lt;broker name&amp;gt;\n     */\n    private final HashMap&amp;lt;String, Set&amp;lt;String&amp;gt;&amp;gt; clusterAddrTable;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;7\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2ac1bd42e6464d548a8df4725b37a8ab~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;brokerlivetable\&#34;&gt;brokerLiveTable&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;    /**\n     * BrokerçŠ¶æ€ä¿¡æ¯ï¼ŒNameServeræ¯æ¬¡æ”¶å¿ƒè·³åŒ…éƒ½ä¼šæ›¿æ¢è¯¥ä¿¡æ¯\n     * key: broker addr . val:broker live info\n     */\n    private final HashMap&amp;lt;String, BrokerLiveInfo&amp;gt; brokerLiveTable;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;8\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/24bca7def87a46868684c025076f71cd~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;filterservertable\&#34;&gt;filterServerTable&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;    /**\n     * ç”¨äºç±»æ¨¡å¼æ¶ˆæ¯è¿‡æ»¤\n     * key:broker addr . val:filter server\n     */\n    private final HashMap&amp;lt;String, List&amp;lt;String&amp;gt;&amp;gt; filterServerTable;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;çŸ¥é“äº†è·¯ç”±å…ƒä¿¡æ¯çš„æ•°æ®ç»“æ„ï¼Œå†çœ‹çœ‹è·¯ç”±ä¿¡æ¯æ˜¯å¦‚ä½•ä¿å­˜åˆ°è¿™äº›mapä¸­çš„ä»¥åŠå¦‚ä½•æŸ¥è¯¢çš„ã€‚&lt;/p&gt;\n&lt;h1 id=\&#34;æœåŠ¡æ³¨å†Œ\&#34;&gt;æœåŠ¡æ³¨å†Œ&lt;/h1&gt;\n&lt;p&gt;æ³¨å†Œbrokerå’Œè·å–è·¯ç”±ä¿¡æ¯æ˜¯namesrvæä¾›çš„APIï¼Œä½äº&lt;code&gt;namesrv/src/main/java/org/apache/rocketmq/namesrv/processor/DefaultRequestProcessor.java&lt;/code&gt;ç±»ä¸‹çš„&lt;code&gt;processRequest()&lt;/code&gt;ï¼Œæ ¹æ®è¯·æ±‚çš„codeåˆ¤æ–­è¯·æ±‚çš„ç±»å‹ã€‚ä¸‹é¢åŒ…å«äº†namesrvæ‰€æœ‰çš„å¯¹å¤–æ¥å£APIã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;switch (request.getCode()) {\n    case RequestCode.PUT_KV_CONFIG:\n        // æ·»åŠ é…ç½®\n        return this.putKVConfig(ctx, request);\n    case RequestCode.GET_KV_CONFIG:\n        // è·å–é…ç½®\n        return this.getKVConfig(ctx, request);\n    case RequestCode.DELETE_KV_CONFIG:\n        // åˆ é™¤é…ç½®\n        return this.deleteKVConfig(ctx, request);\n    case RequestCode.QUERY_DATA_VERSION:\n        return queryBrokerTopicConfig(ctx, request);\n    case RequestCode.REGISTER_BROKER:\n        // æ³¨å†Œbroker\n        Version brokerVersion = MQVersion.value2Version(request.getVersion());\n        if (brokerVersion.ordinal() &amp;gt;= MQVersion.Version.V3_0_11.ordinal()) {\n            // 3.0.11ä¹‹å\n            return this.registerBrokerWithFilterServer(ctx, request);\n        } else {\n            // 3.0.11ä¹‹å‰\n            return this.registerBroker(ctx, request);\n        }\n    case RequestCode.UNREGISTER_BROKER:\n        // æ³¨é”€broker\n        return this.unregisterBroker(ctx, request);\n    case RequestCode.GET_ROUTEINFO_BY_TOPIC:\n        // æ ¹æ®topicè·å–è·¯ç”±ä¿¡æ¯\n        return this.getRouteInfoByTopic(ctx, request);\n    case RequestCode.GET_BROKER_CLUSTER_INFO:\n        // è·å–brokeré›†ç¾¤ä¿¡æ¯\n        return this.getBrokerClusterInfo(ctx, request);\n    case RequestCode.WIPE_WRITE_PERM_OF_BROKER:\n        // åˆ é™¤Brokerçš„å†™æƒé™\n        return this.wipeWritePermOfBroker(ctx, request);\n    case RequestCode.GET_ALL_TOPIC_LIST_FROM_NAMESERVER:\n        // è·å–å…¨éƒ¨Topicä¿¡æ¯\n        return getAllTopicListFromNameserver(ctx, request);\n    case RequestCode.DELETE_TOPIC_IN_NAMESRV:\n        // åˆ é™¤Topicä¿¡æ¯\n        return deleteTopicInNamesrv(ctx, request);\n    case RequestCode.GET_KVLIST_BY_NAMESPACE:\n        // è·å–kvåˆ—è¡¨\n        return this.getKVListByNamespace(ctx, request);\n    case RequestCode.GET_TOPICS_BY_CLUSTER:\n        // è·å–topicæ ¹æ®é›†ç¾¤\n        return this.getTopicsByCluster(ctx, request);\n\t..\n    default:\n        break;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å…¶ä¸­æœåŠ¡æ³¨å†Œå¯¹åº”çš„æ˜¯codeæ˜¯&lt;code&gt;REGISTER_BROKER&lt;/code&gt;ï¼Œä¸‹é¢çœ‹åˆ°æ ¹æ®ç‰ˆæœ¬çš„ä¸åŒåˆ†ä¸º&lt;code&gt;registerBrokerWithFilterServer()&lt;/code&gt;å’Œ&lt;code&gt;registerBroker()&lt;/code&gt;ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯v4.9.1ï¼Œæ‰€ä»¥çœ‹çœ‹&lt;code&gt;registerBrokerWithFilterServer()&lt;/code&gt;çš„å®ç°&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public RemotingCommand registerBrokerWithFilterServer(ChannelHandlerContext ctx, RemotingCommand request) throws RemotingCommandException {\n\t...çœç•¥...        \n        \n    // æ³¨å†Œçš„æ–¹æ³•\n\tRegisterBrokerResult result = this.namesrvController.getRouteInfoManager().registerBroker(...);\n\n    ...çœç•¥...\n    \n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;æ ¸å¿ƒçš„æ³¨å†Œé€»è¾‘åœ¨&lt;code&gt;registerBroker()&lt;/code&gt;ä¸­ ,ç»§ç»­çœ‹ä¸‹&lt;code&gt;registerBroker()&lt;/code&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public RegisterBrokerResult registerBroker(final String clusterName, final String brokerAddr, final String brokerName, final long brokerId, final String haServerAddr, final TopicConfigSerializeWrapper topicConfigWrapper, final List&amp;lt;String&amp;gt; filterServerList, final Channel channel) {\n    RegisterBrokerResult result = new RegisterBrokerResult();\n    try {\n        try {\n            this.lock.writeLock().lockInterruptibly();\n\n            // step1\n            // æ ¹æ®é›†ç¾¤åç§°è·å– broker name é›†åˆ\n            Set&amp;lt;String&amp;gt; brokerNames = this.clusterAddrTable.get(clusterName);\n            if (null == brokerNames) {\n                brokerNames = new HashSet&amp;lt;&amp;gt;();\n                this.clusterAddrTable.put(clusterName, brokerNames);\n            }\n            // æ·»åŠ broker name åˆ°é›†åˆä¸­\n            brokerNames.add(brokerName);\n\n            // æ˜¯å¦ç¬¬ä¸€æ¬¡æ³¨å†Œ\n            boolean registerFirst = false;\n\n            // step2\n            // å¦‚æœ broker table é‡Œæ²¡æœ‰æ•°æ®ï¼Œåˆ™è¡¨ç¤ºbrokerä¸ºç¬¬ä¸€æ¬¡æ³¨å†Œ\n            BrokerData brokerData = this.brokerAddrTable.get(brokerName);\n            if (null == brokerData) {\n                registerFirst = true;\n                brokerData = new BrokerData(clusterName, brokerName, new HashMap&amp;lt;&amp;gt;());\n                this.brokerAddrTable.put(brokerName, brokerData);\n            }\n            Map&amp;lt;Long, String&amp;gt; brokerAddrsMap = brokerData.getBrokerAddrs();\n            //Switch slave to master: first remove &amp;lt;1, IP:PORT&amp;gt; in namesrv, then add &amp;lt;0, IP:PORT&amp;gt;\n            //The same IP:PORT must only have one record in brokerAddrTable\n            brokerAddrsMap.entrySet().removeIf(item -&amp;gt; null != brokerAddr &amp;amp;&amp;amp; brokerAddr.equals(item.getValue()) &amp;amp;&amp;amp; brokerId != item.getKey());\n\n            String oldAddr = brokerAddrsMap.put(brokerId, brokerAddr);\n            registerFirst = registerFirst || (null == oldAddr);\n\n            // step3\n            // å¦‚æœ topic ä¿¡æ¯ä¸ä¸ºç©ºï¼Œè€Œä¸”æ˜¯ master\n            if (null != topicConfigWrapper &amp;amp;&amp;amp; MixAll.MASTER_ID == brokerId) {\n                // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ³¨å†Œï¼Œæˆ–è€… broker topic ä¿¡æ¯å‘ç”Ÿå˜åŠ¨è¿‡\n                if (this.isBrokerTopicConfigChanged(brokerAddr, topicConfigWrapper.getDataVersion()) || registerFirst) {\n                    // è·å– topic info åˆ—è¡¨\n                    ConcurrentMap&amp;lt;String, TopicConfig&amp;gt; tcTable = topicConfigWrapper.getTopicConfigTable();\n                    if (tcTable != null) {\n                        for (Map.Entry&amp;lt;String, TopicConfig&amp;gt; entry : tcTable.entrySet()) {\n                            this.createAndUpdateQueueData(brokerName, entry.getValue());\n                        }\n                    }\n                }\n            }\n\n            // step4\n            BrokerLiveInfo prevBrokerLiveInfo = this.brokerLiveTable.put(brokerAddr, new BrokerLiveInfo(System.currentTimeMillis(), topicConfigWrapper.getDataVersion(), channel, haServerAddr));\n            if (null == prevBrokerLiveInfo) {\n                log.info(&amp;quot;new broker registered, {} HAServer: {}&amp;quot;, brokerAddr, haServerAddr);\n            }\n\n            // step5\n            if (filterServerList != null) {\n                if (filterServerList.isEmpty()) {\n                    this.filterServerTable.remove(brokerAddr);\n                } else {\n                    this.filterServerTable.put(brokerAddr, filterServerList);\n                }\n            }\n\n            // å¦‚æœbrokerçš„èº«ä»½æ˜¯slave\n            if (MixAll.MASTER_ID != brokerId) {\n                String masterAddr = brokerData.getBrokerAddrs().get(MixAll.MASTER_ID);\n                if (masterAddr != null) {\n                    BrokerLiveInfo brokerLiveInfo = this.brokerLiveTable.get(masterAddr);\n                    if (brokerLiveInfo != null) {\n                        // åœ¨è¿”å›ç»“æœä¸­ï¼Œæºå¸¦masterçš„åœ°å€ï¼Œä¸»ä»åŒæ­¥æ­¥éª¤éœ€è¦ã€‚\n                        result.setHaServerAddr(brokerLiveInfo.getHaServerAddr());\n                        result.setMasterAddr(masterAddr);\n                    }\n                }\n            }\n        } finally {\n            this.lock.writeLock().unlock();\n        }\n    } catch (Exception e) {\n        log.error(&amp;quot;registerBroker Exception&amp;quot;, e);\n    }\n\n    return result;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ä»£ç æ³¨é‡Šä¸­ä½¿ç”¨step1 ~ step5å¯¹5ä¸ªä¸åŒé˜¶æ®µè¿›è¡Œæ ‡è®°ï¼Œè¿™5ä¸ªé˜¶æ®µçš„ä½œç”¨å¯ä»¥è¿™ä¹ˆç†è§£&lt;br&gt;\n&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c3b53e34de8e48ca8e5adcbb371babcd~tplv-k3u1fbpfcp-watermark.image?\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/p&gt;\n&lt;h1 id=\&#34;è·¯ç”±å‰”é™¤\&#34;&gt;è·¯ç”±å‰”é™¤&lt;/h1&gt;\n&lt;p&gt;namesrvè¦åˆ é™¤ä¸€ä¸ªbrokerçš„è·¯ç”±ä¿¡æ¯çš„åªæœ‰ä¸€ä¸ªï¼šè¿™ä¸ªbrokerç›®å‰ä¸èƒ½æ­£å¸¸æä¾›æœåŠ¡äº†ã€‚è¿™ä¹Ÿå¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µ&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;brokeræ­£å¸¸åœæ­¢ã€‚&lt;/li&gt;\n&lt;li&gt;brokerå‘ç”Ÿå¼‚å¸¸ã€‚&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h2 id=\&#34;broker-æ­£å¸¸åœæ­¢\&#34;&gt;Broker æ­£å¸¸åœæ­¢&lt;/h2&gt;\n&lt;p&gt;brokeråœ¨åœæ­¢çš„æ—¶å€™ä¼šç»™namesrvå‘é€ä¸€ä¸ª&lt;code&gt;unregisterBroker&lt;/code&gt;ç±»å‹çš„æ¶ˆæ¯ï¼Œå‘é€ä»£ç éƒ¨åˆ†åœ¨&lt;code&gt;broker/src/main/java/org/apache/rocketmq/broker/out/BrokerOuterAPI.java&lt;/code&gt;ç±»çš„&lt;code&gt;unregisterBrokerAll()&lt;/code&gt;ï¼Œnamesrvå¤„ç†è¿™ä¸ªæ¶ˆæ¯çš„å…¥å£ä¸Šæ–‡æœåŠ¡æ³¨å†Œéƒ¨åˆ†æåˆ°è¿‡ï¼Œä»£ç çš„é€»è¾‘å¾ˆç›´ç™½ï¼Œå°±æ˜¯ä»&lt;code&gt;topicQueueTable&lt;/code&gt; ã€&lt;code&gt;brokerAddrTable&lt;/code&gt; ã€&lt;code&gt;brokerLiveTable&lt;/code&gt; ã€&lt;code&gt;filterServerTable&lt;/code&gt; åˆ é™¤ä¸è¯¥Brokerç›¸å…³çš„ä¿¡æ¯ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;broker-å¼‚å¸¸\&#34;&gt;Broker å¼‚å¸¸&lt;/h2&gt;\n&lt;p&gt;brokerå¼‚å¸¸çš„æ—¶å€™ï¼Œè‚¯å®šæ˜¯æ— æ³•ä¸»åŠ¨å‘namesrvå‘é€æ³¨é”€æ¶ˆæ¯çš„ï¼Œæ‰€ä»¥éœ€è¦namesrvä¸»åŠ¨å»å‘ç°å“ªäº›å¼‚å¸¸çš„brokerã€‚æŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œå¯ä»¥æƒ³åˆ°ä¸¤ç§å®ç°æ‰‹æ®µï¼š&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;æ–¹æ¡ˆä¸€ï¼š&lt;/strong&gt; namesrvå¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œç„¶åå‘æ‰€æœ‰brokerå‘é€å¿ƒè·³è¯·æ±‚ï¼Œæ— æ³•å“åº”çš„brokerå¯ä»¥æ€€ç–‘æ˜¯å‘ç”Ÿäº†å¼‚å¸¸äº†ã€‚&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;æ–¹æ¡ˆäºŒï¼š&lt;/strong&gt; è®°å½•brokerå‘namesrvæœ€åå‘é€å¿ƒè·³æ¶ˆæ¯çš„æ—¶é—´ï¼Œnamesrvå¯åŠ¨å®šæ—¶ä»»åŠ¡ï¼Œåˆ¤æ–­æ¯ä¸ªæœ€åå¿ƒè·³æ—¶é—´ä¸å½“å‰çš„æ—¶é—´æ˜¯å¦è¶…æ—¶ï¼Œè¶…æ—¶è¯´æ˜brokerå¼‚å¸¸å¯¼è‡´æ— æ³•å‘é€å¿ƒè·³åŒ…&lt;/p&gt;\n&lt;p&gt;RocketMQçš„è®¾è®¡æ€è·¯å’Œæ–¹æ¡ˆäºŒç±»ä¼¼ã€‚&lt;/p&gt;\n&lt;h3 id=\&#34;å¯åŠ¨å®šæ—¶ä»»åŠ¡\&#34;&gt;å¯åŠ¨å®šæ—¶ä»»åŠ¡&lt;/h3&gt;\n&lt;p&gt;&lt;code&gt;namesrv/src/main/java/org/apache/rocketmq/namesrv/NamesrvController#initailize()&lt;/code&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public boolean initialize() {\n    //...ç•¥\n    \n    this.scheduledExecutorService.scheduleAtFixedRate(NamesrvController.this.routeInfoManager::scanNotActiveBroker, 5, 10, TimeUnit.SECONDS);\n    \n\t//... ç•¥\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;code&gt;namesrv/src/main/java/org/apache/rocketmq/namesrv/routeinfo/RouteInfoManager#scanNotActiveBroker()&lt;/code&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public void scanNotActiveBroker() {\n    // ä»å­˜æ´»åˆ—è¡¨é‡Œè·å–brokeræ•°æ®\n    Iterator&amp;lt;Entry&amp;lt;String, BrokerLiveInfo&amp;gt;&amp;gt; it = this.brokerLiveTable.entrySet().iterator();\n    while (it.hasNext()) {\n        Entry&amp;lt;String, BrokerLiveInfo&amp;gt; next = it.next();\n        long last = next.getValue().getLastUpdateTimestamp();\n        // åˆ¤æ–­æ¶ˆæ¯å‘é€é—´éš”\n        if ((last + BROKER_CHANNEL_EXPIRED_TIME) &amp;lt; System.currentTimeMillis()) {\n            RemotingUtil.closeChannel(next.getValue().getChannel());\n\t\t\t// ç§»é™¤è¯¥brokerä¿¡æ¯\n            it.remove();\n            log.warn(&amp;quot;The broker channel expired, {} {}ms&amp;quot;, next.getKey(), BROKER_CHANNEL_EXPIRED_TIME);\n            this.onChannelDestroy(next.getKey(), next.getValue().getChannel());\n        }\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;rocketmq491-yuan-ma-fen-xi-namesrv-fu-wu-zhu-ce-andlu-you-fa-xian&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;ä½•ä¸ºè·¯ç”±ä¸­å¿ƒï¼Ÿ&lt;br&gt;\nåœ¨é€šå¸¸çš„ç†è§£ä¸­ï¼Œæåˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæœ€ç®€å•çš„æ¨¡å‹å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;RocketMQ4.9.1æºç åˆ†æ-NamesrvæœåŠ¡æ³¨å†Œ&amp;è·¯ç”±å‘ç°&#34;,&#34;tags&#34;:[{&#34;index&#34;:-1,&#34;name&#34;:&#34;RocketMQ&#34;,&#34;slug&#34;:&#34;_Ywd8fi71&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/_Ywd8fi71/&#34;},{&#34;name&#34;:&#34;æºç &#34;,&#34;slug&#34;:&#34;yuan-ma&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/yuan-ma/&#34;}],&#34;date&#34;:&#34;2021-10-27 22:09:19&#34;,&#34;dateFormat&#34;:&#34;2021-10-27 10:09:19&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/rocketmq491-yuan-ma-fen-xi-namesrv-fu-wu-zhu-ce-andlu-you-fa-xian/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;10 min read&#34;,&#34;time&#34;:562000,&#34;words&#34;:2159,&#34;minutes&#34;:10},&#34;description&#34;:&#34;ä½•ä¸ºè·¯ç”±ä¸­å¿ƒï¼Ÿ\nåœ¨é€šå¸¸çš„ç†è§£ä¸­ï¼Œæåˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæœ€ç®€å•çš„æ¨¡å‹å¦‚ä¸‹å›¾ï¼š\n\n\nå¾ˆå¥½ç†è§£ï¼Œç”Ÿäº§è€…åªè¦çŸ¥é“æ¶ˆæ¯é˜Ÿåˆ—çš„ç½‘ç»œåœ°å€ï¼Œç„¶åå‘é€æ¶ˆæ¯åˆ°è¿™ä¸ªç½‘ç»œåœ°å€ä¸Šã€‚ä½†æ˜¯å®é™…å¾€å¾€ä¸æ˜¯è¿™ä¹ˆç®€å•ï¼Œå› ä¸ºæ¶ˆæ¯é˜Ÿåˆ—ä¸€èˆ¬æ˜¯é›†ç¾¤æ¨¡å¼ï¼Œå†å¦‚ä¸‹å›¾ï¼Œ4ä¸ªå®ä¾‹ç»„æˆé›†ç¾¤ï¼š\n\nå‡å¦‚ç°åœ¨...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#rocketmq%E4%B8%AD%E7%9A%84namesrv\&#34;&gt;RocketMQä¸­çš„Namesrv&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%B7%AF%E7%94%B1%E5%85%83%E4%BF%A1%E6%81%AF\&#34;&gt;è·¯ç”±å…ƒä¿¡æ¯&lt;/a&gt;&lt;br&gt;\n*\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#topicqueuetable\&#34;&gt;topicQueueTable&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#brokeraddrtable\&#34;&gt;brokerAddrTable&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#clusteraddrtable\&#34;&gt;clusterAddrTable&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#brokerlivetable\&#34;&gt;brokerLiveTable&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#filterservertable\&#34;&gt;filterServerTable&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C\&#34;&gt;æœåŠ¡æ³¨å†Œ&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%B7%AF%E7%94%B1%E5%89%94%E9%99%A4\&#34;&gt;è·¯ç”±å‰”é™¤&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#broker-%E6%AD%A3%E5%B8%B8%E5%81%9C%E6%AD%A2\&#34;&gt;Broker æ­£å¸¸åœæ­¢&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#broker-%E5%BC%82%E5%B8%B8\&#34;&gt;Broker å¼‚å¸¸&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%90%AF%E5%8A%A8%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1\&#34;&gt;å¯åŠ¨å®šæ—¶ä»»åŠ¡&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;æ¥ç€ä¸Šä¸€ç¯‡ [RocketMQv4.9.1æºç åˆ†æ-HAä¸»ä» Masterè¯»å†™å¤„ç†] è§£ç­”äº†Masterç›¸å…³çš„é—®é¢˜ï¼Œè¿™ç¯‡æ–‡ç« å›´ç»•Slaveç›¸å…³çš„ä¸€äº›é—®é¢˜ç»§ç»­çœ‹ä»£ç ã€‚&lt;/p&gt;\n&lt;p&gt;å¯¹äºslaveï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹ä¸€äº›ç–‘æƒ‘ï¼š&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;code&gt;slave&lt;/code&gt;å¦‚ä½•è·å–&lt;code&gt;master&lt;/code&gt;çš„è·¯ç”±ä¿¡æ¯&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;slave&lt;/code&gt;å¦‚ä½•å‘&lt;code&gt;master&lt;/code&gt;æŠ¥å‘Š&lt;code&gt;offset&lt;/code&gt;çš„&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;slave&lt;/code&gt;å¦‚ä½•å¤„ç†&lt;code&gt;master&lt;/code&gt;åŒæ­¥çš„æ•°æ®&lt;/li&gt;\n&lt;/ol&gt;\n&lt;!-- more --&gt;\n&lt;p&gt;åœ¨æ•´ä½“çš„ç±»å›¾å¸ƒå±€ä¸­ï¼Œslaveç›¸å…³çš„ä»£ç éƒ½åœ¨HAClientç±»ä¸­&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ed3a2d9fc0214105b8bbf8f96114a677~tplv-k3u1fbpfcp-watermark.image?\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h2 id=\&#34;haclient\&#34;&gt;HAClient&lt;/h2&gt;\n&lt;p&gt;HAClientéƒ¨åˆ†æ˜¯Slaveå¤„ç†çš„æ ¸å¿ƒï¼Œå…¶ä¸­åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼š&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;slaveä¸masterå»ºç«‹è¿æ¥&lt;/li&gt;\n&lt;li&gt;slaveå‘masteræ±‡æŠ¥åŒæ­¥è¿›åº¦&lt;/li&gt;\n&lt;li&gt;slaveæ¥æ”¶masterçš„åŒæ­¥æ•°æ®å¹¶å¤„ç†&lt;/li&gt;\n&lt;/ol&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/49ce7b1d1f3a4b6bb097e0aef244cc56~tplv-k3u1fbpfcp-watermark.image?\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;haclient-å¯åŠ¨\&#34;&gt;HAClient å¯åŠ¨&lt;/h3&gt;\n&lt;p&gt;ä¹‹å‰æåˆ°äº†ï¼ŒHAClientå¯åŠ¨çš„è§¦å‘æ—¶æœºæ˜¯HAServiceå¯åŠ¨çš„æ–¹æ³•ä¸­ï¼Œåœ¨&lt;code&gt;store/src/main/java/org/apache/rocketmq/store/ha/HAService.start()&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;// HAService å¯åŠ¨\npublic void start() throws Exception {\n    this.acceptSocketService.beginAccept();\n    this.acceptSocketService.start();\n    this.groupTransferService.start();\n    this.haClient.start();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;HAClientçš„å¯åŠ¨ä»£ç åœ¨&lt;code&gt;store/src/main/java/org/apache/rocketmq/store/ha/HAService$HAClient.run()&lt;/code&gt;è·¯å¾„ä¸‹ã€‚&lt;/p&gt;\n&lt;p&gt;å…¶ä¸­3ä¸ªæ ¸å¿ƒçš„æ­¥éª¤åœ¨ä»£ç æ³¨é‡Šä¸­æœ‰è¿›è¡Œæ ‡è®°&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Override\npublic void run() {\n    log.info(this.getServiceName() + &amp;quot; service started&amp;quot;);\n\n    while (!this.isStopped()) {\n        try {\n            // æ­¥éª¤ä¸€ï¼šè¿æ¥åˆ°master\n            if (this.connectMaster()) {\n                // æ­¥éª¤äºŒï¼šå¦‚æœè·ç¦»ä¸Šæ¬¡æŠ¥å‘Šçš„æ—¶é—´é—´éš”åˆ°äº†æœ€å¤§ç­‰å¾…æ—¶é—´,ç«‹åˆ»æ‰§è¡Œä¸€æ¬¡æŠ¥å‘Š\n                if (this.isTimeToReportOffset()) {\n                    // æŠ¥å‘Šslave offset\n                    boolean result = this.reportSlaveMaxOffset(this.currentReportedOffset);\n                    if (!result) {\n                        this.closeMaster();\n                    }\n                }\n                // æ£€æŸ¥æ˜¯å¦æœ‰è¯»äº‹ä»¶\n                this.selector.select(1000);\n                //æ­¥éª¤ä¸‰ï¼šå¤„ç†masterè¿”å›çš„æ¶ˆæ¯\n                boolean ok = this.processReadEvent();\n                if (!ok) {\n                    this.closeMaster();\n                }\n                // å¤„ç†å®Œè¯»äº‹ä»¶åï¼Œå¦‚æœslave offsetæ›´æ–°ï¼Œéœ€è¦å†æ¬¡å‘é€æ–°çš„slave offset\n                if (!reportSlaveMaxOffsetPlus()) {\n                    continue;\n                }\n\n                long interval = HAService.this.getDefaultMessageStore().getSystemClock().now() - this.lastWriteTimestamp;\n                if (interval &amp;gt; HAService.this.getDefaultMessageStore().getMessageStoreConfig().getHaHousekeepingInterval()) {\n                    log.warn(&amp;quot;HAClient, housekeeping, found this connection[&amp;quot; + this.masterAddress + &amp;quot;] expired, &amp;quot; + interval);\n                    this.closeMaster();\n                    log.warn(&amp;quot;HAClient, master not response some time, so close connection&amp;quot;);\n                }\n            } else {\n                this.waitForRunning(1000 * 5);\n            }\n        } catch (Exception e) {\n            log.warn(this.getServiceName() + &amp;quot; service has exception. &amp;quot;, e);\n            this.waitForRunning(1000 * 5);\n        }\n    }\n\n    log.info(this.getServiceName() + &amp;quot; service end&amp;quot;);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;slaveè¿æ¥master\&#34;&gt;Slaveè¿æ¥Master&lt;/h3&gt;\n&lt;p&gt;&lt;code&gt;connectMaster()&lt;/code&gt;æ–¹æ³•çš„ç›®çš„æ˜¯ä¸masterè¿›è¡Œè¿æ¥ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;// master åœ°å€(masterçš„åœ°å€åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®)\nprivate final AtomicReference&amp;lt;String&amp;gt; masterAddress = new AtomicReference&amp;lt;&amp;gt;();\n\nprivate boolean connectMaster() throws ClosedChannelException {\n    if (null == socketChannel) {\n        String addr = this.masterAddress.get();\n        if (addr != null) {\n            SocketAddress socketAddress = RemotingUtil.string2SocketAddress(addr);\n            if (socketAddress != null) {\n                this.socketChannel = RemotingUtil.connect(socketAddress);\n                if (this.socketChannel != null) {\n                    // è¯»äº‹ä»¶,ç”¨äºç›‘å¬masterçš„è¿”å›æ¶ˆæ¯\n                    this.socketChannel.register(this.selector, SelectionKey.OP_READ);\n                }\n            }\n        }\n        // è®¾ç½®ä¸ºå½“å‰commitlogçš„åç§»é‡\n        this.currentReportedOffset = HAService.this.defaultMessageStore.getMaxPhyOffset();\n        this.lastWriteTimestamp = System.currentTimeMillis();\n    }\n\n    return this.socketChannel != null;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;æœ‰ä¸€ä¸ªç‚¹å…³æ³¨ä¸‹ï¼Œå°±æ˜¯&lt;code&gt;currentReportedOffset&lt;/code&gt;å­—æ®µï¼Œè¿™ä¸ªå­—æ®µçš„ç›®çš„æ˜¯è¡¨ç¤ºå½“å‰slaveå·²åŒæ­¥çš„è¿›åº¦ï¼Œåç»­åœ¨å‘masterè¿›è¡Œæ±‡æŠ¥æ—¶ä¹Ÿæ˜¯ä½¿ç”¨è¯¥å­—æ®µçš„å€¼ã€‚è¿™é‡Œè¿›è¡Œåˆå§‹åŒ–çš„æ—¶å€™ç›´æ¥è®¾ç½®ä¸ºcommitlogæ–‡ä»¶çš„æœ€å¤§åç§»é‡ï¼Œå¦‚æœæ²¡æœ‰commitlogæ–‡ä»¶åˆ™ä¸º0ã€‚&lt;/p&gt;\n&lt;h3 id=\&#34;slaveæ±‡æŠ¥offset\&#34;&gt;Slaveæ±‡æŠ¥offset&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;// æ­¥éª¤äºŒï¼šå¦‚æœè·ç¦»ä¸Šæ¬¡æŠ¥å‘Šçš„æ—¶é—´é—´éš”åˆ°äº†æœ€å¤§ç­‰å¾…æ—¶é—´,ç«‹åˆ»æ‰§è¡Œä¸€æ¬¡æŠ¥å‘Š\nif (this.isTimeToReportOffset()) {\n    // æŠ¥å‘Šslave offset\n    boolean result = this.reportSlaveMaxOffset(this.currentReportedOffset);\n    if (!result) {\n        this.closeMaster();\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;code&gt;isTimeToReportOffset()&lt;/code&gt;çš„ä½œç”¨æ˜¯åˆ¤æ–­ä¸Šä¸€æ¬¡è¿›è¡Œæ±‡æŠ¥çš„æ—¶é—´ä¸å½“å‰æ—¶é—´å·®æ˜¯å¦å¤§äºæœ€å¤§ç­‰å¾…é—´éš”ï¼ˆé»˜è®¤5sï¼‰ï¼Œè¿™æ„å‘³ç€å³ä½¿5sæ²¡æœ‰æ”¶åˆ°masterçš„ä»»ä½•æ¶ˆæ¯ï¼Œslaveä¹Ÿä¼šå‘é€ä¸€ä¸ªæ±‡æŠ¥è¯·æ±‚ç»™masterï¼Œä½œç”¨ç›¸å¯¹äºä¸€ä¸ªå¿ƒè·³åŒ…ã€‚&lt;/p&gt;\n&lt;p&gt;çœ‹ä¸‹&lt;code&gt;reportSlaveMaxOffset()&lt;/code&gt;æ–¹æ³•ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;private boolean reportSlaveMaxOffset(final long maxOffset) {\n    // å†™ä½ç½®è®¾ä¸º0\n    this.reportOffset.position(0);\n    // å¯å†™é•¿åº¦ä¸º8å­—èŠ‚\n    this.reportOffset.limit(8);\n    // æ•°æ®å†…å®¹ä¸ºslaveå½“å‰çš„offset\n    this.reportOffset.putLong(maxOffset);\n    // å†™æ¨¡å¼åˆ‡æ¢åˆ°æ¨¡å¼\n    // å°†è¯»ä½ç½®è®¾ä¸º0\n    this.reportOffset.position(0);\n    // å¯è¯»é•¿åº¦ä¸º8å­—èŠ‚\n    this.reportOffset.limit(8);\n\n    for (int i = 0; i &amp;lt; 3 &amp;amp;&amp;amp; this.reportOffset.hasRemaining(); i++) {\n        try {\n            // å°†æ•°æ®å†™å…¥channelä¸­\n            this.socketChannel.write(this.reportOffset);\n        } catch (IOException e) {\n            log.error(this.getServiceName() + &amp;quot;reportSlaveMaxOffset this.socketChannel.write exception&amp;quot;, e);\n            return false;\n        }\n    }\n\n    lastWriteTimestamp = HAService.this.defaultMessageStore.getSystemClock().now();\n    return !this.reportOffset.hasRemaining();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å¯ä»¥çŸ¥é“slaveçš„æ±‡æŠ¥è¯·æ±‚çš„æ•°æ®åŒ…å†…å®¹å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ª8å­—èŠ‚å¤§å°çš„offsetæ•°æ®ã€‚&lt;/p&gt;\n&lt;p&gt;è¿™é‡Œä»£ç ä¸­æœ‰ä¸€ä¸ªç»†èŠ‚ï¼Œrocketmqçš„ä½œç”¨å†è¿›è¡Œå†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼æ—¶æ²¡æœ‰ä½¿ç”¨&lt;code&gt;flip()&lt;/code&gt;æ–¹æ³•ï¼Œè€Œæ˜¯æ‰‹åŠ¨è®¾ç½®&lt;code&gt;position&lt;/code&gt;å’Œ&lt;code&gt;limit&lt;/code&gt;,è¿™æ˜¯ç”±äºNIOæ˜¯ä¸€ä¸ªéé˜»å¡IOï¼Œwriteæ–¹æ³•ä¸ä¸€å®šä¼šä¸€æ¬¡å°†ByteBufferçš„æ•°æ®å…¨éƒ¨å†™å…¥ã€‚&lt;/p&gt;\n&lt;h3 id=\&#34;slaveå¤„ç†åŒæ­¥æ•°æ®\&#34;&gt;Slaveå¤„ç†åŒæ­¥æ•°æ®&lt;/h3&gt;\n&lt;p&gt;æ­¥éª¤ä¸‰ä¸­ï¼Œè°ƒç”¨&lt;code&gt;processReadEvent()&lt;/code&gt;å¯¹masterè¿”å›çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œçœ‹ä»£ç å‰ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“masterè¿”å›çš„æ•°æ®æ˜¯æœªåŒæ­¥çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆslaveè¦åšçš„äº‹æƒ…æ˜¯ä»€ä¹ˆï¼Ÿå½“ç„¶å°±æ˜¯æŠŠè¿™ä¸ªæœªåŒæ­¥çš„æ•°æ®ä¿å­˜åˆ°æœ¬åœ°çš„commitlogæ–‡ä»¶ä¸­ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;private boolean processReadEvent() {\n    // è¿ç»­è¯»å–åˆ°æ•°æ®å¤§å°ä¸º0çš„æ¬¡æ•°\n    int readSizeZeroTimes = 0;\n    // ä¸€ç›´è¯»å–ç¼“å†²åŒºçš„æ•°æ®ï¼Œç›´åˆ°æ²¡æœ‰å‰©ä½™\n    while (this.byteBufferRead.hasRemaining()) {\n        try {\n            int readSize = this.socketChannel.read(this.byteBufferRead);\n            if (readSize &amp;gt; 0) {\n                readSizeZeroTimes = 0;\n                boolean result = this.dispatchReadRequest();\n                if (!result) {\n                    log.error(&amp;quot;HAClient, dispatchReadRequest error&amp;quot;);\n                    return false;\n                }\n            } else if (readSize == 0) {\n                // å¦‚æœè¿ç»­ä¸‰æ¬¡è¯»åˆ°ä¸ºç©º,åˆ™è·³å‡ºæ–¹æ³•,è¿™é‡Œçš„ä½œç”¨ï¼Ÿ\n                if (++readSizeZeroTimes &amp;gt;= 3) {\n                    break;\n                }\n            } else {\n                log.info(&amp;quot;HAClient, processReadEvent read socket &amp;lt; 0&amp;quot;);\n                return false;\n            }\n        } catch (IOException e) {\n            log.info(&amp;quot;HAClient, processReadEvent read socket exception&amp;quot;, e);\n            return false;\n        }\n    }\n\n    return true;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ä»£ç é‡Œè°ƒç”¨äº†&lt;code&gt;dispatchReadRequest()&lt;/code&gt;æ–¹æ³•è¿›è¡Œè¯·æ±‚çš„å¤„ç†ï¼Œçœ‹ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;private boolean dispatchReadRequest() {\n    final int msgHeaderSize = 8 + 4; // phyoffset + size\n\n    while (true) {\n        int diff = this.byteBufferRead.position() - this.dispatchPosition;\n        if (diff &amp;gt;= msgHeaderSize) {\n            // master commitlog åç§»é‡\n            long masterPhyOffset = this.byteBufferRead.getLong(this.dispatchPosition);\n            // æ¶ˆæ¯å¤§å°\n            int bodySize = this.byteBufferRead.getInt(this.dispatchPosition + 8);\n            // æœ¬åœ°  commitlog åç§»é‡\n            long slavePhyOffset = HAService.this.defaultMessageStore.getMaxPhyOffset();\n            if (slavePhyOffset != 0) {\n                // å¦‚æœslaveçš„offsetå’Œmasterçš„offsetä¸ä¸€æ ·ï¼Œè¯´æ˜æ•°æ®åŒæ­¥è¿‡ç¨‹å‘ç”Ÿäº†é—®é¢˜ï¼Œä¸å†ç»§ç»­åŒæ­¥ã€‚\n                if (slavePhyOffset != masterPhyOffset) {\n                    log.error(&amp;quot;master pushed offset not equal the max phy offset in slave, SLAVE: &amp;quot; + slavePhyOffset + &amp;quot; MASTER: &amp;quot; + masterPhyOffset);\n                    return false;\n                }\n            }\n\n            // å‰©ä½™ç©ºé—´å¤Ÿç”¨,å°†æ¶ˆæ¯è¿½åŠ åˆ°commitlogä¸­\n            if (diff &amp;gt;= (msgHeaderSize + bodySize)) {\n                // æ¶ˆæ¯æ•°ç»„\n                byte[] bodyData = byteBufferRead.array();\n                // æ¶ˆæ¯çš„\n                int dataStart = this.dispatchPosition + msgHeaderSize;\n                // æ·»åŠ æ•°æ®åˆ°æœ¬åœ°commitlogä¸­\n                HAService.this.defaultMessageStore.appendToCommitLog(masterPhyOffset, bodyData, dataStart, bodySize);\n                this.dispatchPosition += msgHeaderSize + bodySize;\n\n                if (!reportSlaveMaxOffsetPlus()) {\n                    return false;\n                }\n\n                continue;\n            }\n        }\n\n        if (!this.byteBufferRead.hasRemaining()) {\n            this.reallocateByteBuffer();\n        }\n\n        break;\n    }\n\n    return true;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;æ•´ä½“çš„é€»è¾‘å¯ä»¥åˆ†ä¸ºä¿©éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯è§£æè¯·æ±‚åŒ…ï¼Œè·å–æ¶ˆæ¯æ•°æ®ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯æŠŠæ¶ˆæ¯æ•°æ®å†™å…¥åˆ°commitlogæ–‡ä»¶ä¸­ã€‚&lt;/p&gt;\n&lt;p&gt;è¿™ä¸¤éƒ¨åˆ†ä»£ç å·²ç»å†™çš„å¾ˆæ¸…æ¥šäº†ï¼Œæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå°±ä¸å†èµ˜è¿°ã€‚&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;rocketmq491-yuan-ma-jie-xi-ha-mo-kuai-zhu-cong-slave-shang-bao-yu-xiao-xi-chu-li&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;æ¥ç€ä¸Šä¸€ç¯‡ [RocketMQv4.9.1æºç åˆ†æ-HAä¸»ä» Masterè¯»å†™å¤„ç†] è§£ç­”äº†Masterç›¸å…³çš„é—®é¢˜ï¼Œè¿™ç¯‡æ–‡ç« å›´ç»•Slaveç›¸å…³çš„ä¸€äº›é—®é¢˜ç»§ç»­çœ‹ä»£ç ã€‚&lt;/p&gt;\n&lt;p&gt;å¯¹äºslaveï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹ä¸€äº›ç–‘æƒ‘ï¼š&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;code&gt;slave&lt;/code&gt;å¦‚ä½•è·å–&lt;code&gt;master&lt;/code&gt;çš„è·¯ç”±ä¿¡æ¯&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;slave&lt;/code&gt;å¦‚ä½•å‘&lt;code&gt;master&lt;/code&gt;æŠ¥å‘Š&lt;code&gt;offset&lt;/code&gt;çš„&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;slave&lt;/code&gt;å¦‚ä½•å¤„ç†&lt;code&gt;master&lt;/code&gt;åŒæ­¥çš„æ•°æ®&lt;/li&gt;\n&lt;/ol&gt;\n&#34;,&#34;title&#34;:&#34;RocketMQ4.9.1æºç è§£æ-(HAæ¨¡å—)ä¸»ä»Slaveä¸ŠæŠ¥ä¸æ¶ˆæ¯å¤„ç†&#34;,&#34;tags&#34;:[{&#34;index&#34;:-1,&#34;name&#34;:&#34;RocketMQ&#34;,&#34;slug&#34;:&#34;_Ywd8fi71&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/_Ywd8fi71/&#34;},{&#34;name&#34;:&#34;æºç &#34;,&#34;slug&#34;:&#34;yuan-ma&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/yuan-ma/&#34;}],&#34;date&#34;:&#34;2021-10-14 23:07:58&#34;,&#34;dateFormat&#34;:&#34;2021-10-14 11:07:58&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/rocketmq491-yuan-ma-jie-xi-ha-mo-kuai-zhu-cong-slave-shang-bao-yu-xiao-xi-chu-li/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;7 min read&#34;,&#34;time&#34;:401000,&#34;words&#34;:1500,&#34;minutes&#34;:7},&#34;description&#34;:&#34;æ¥ç€ä¸Šä¸€ç¯‡ [RocketMQv4.9.1æºç åˆ†æ-HAä¸»ä» Masterè¯»å†™å¤„ç†] è§£ç­”äº†Masterç›¸å…³çš„é—®é¢˜ï¼Œè¿™ç¯‡æ–‡ç« å›´ç»•Slaveç›¸å…³çš„ä¸€äº›é—®é¢˜ç»§ç»­çœ‹ä»£ç ã€‚\nå¯¹äºslaveï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹ä¸€äº›ç–‘æƒ‘ï¼š\n\nslaveå¦‚ä½•è·å–masterçš„è·¯...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#haclient\&#34;&gt;HAClient&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#haclient-%E5%90%AF%E5%8A%A8\&#34;&gt;HAClient å¯åŠ¨&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#slave%E8%BF%9E%E6%8E%A5master\&#34;&gt;Slaveè¿æ¥Master&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#slave%E6%B1%87%E6%8A%A5offset\&#34;&gt;Slaveæ±‡æŠ¥offset&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#slave%E5%A4%84%E7%90%86%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE\&#34;&gt;Slaveå¤„ç†åŒæ­¥æ•°æ®&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;ä»æœ€æŠ½è±¡çš„è§’åº¦çœ‹ï¼Œä¸»ä»åŒæ­¥æµç¨‹å¯ä»¥åˆ†ä¸º3ä¸ªæ­¥éª¤:&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;masterå¯åŠ¨&lt;/li&gt;\n&lt;li&gt;slaveçš„å¯åŠ¨&lt;/li&gt;\n&lt;li&gt;m/s æ•°æ®åŒæ­¥&lt;/li&gt;\n&lt;/ol&gt;\n&lt;!-- more --&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0f4040fe9fe04d9b877449592aaa9770~tplv-k3u1fbpfcp-watermark.image?\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;é’ˆå¯¹ä¸Šè¿°æ­¥éª¤ï¼Œç»“åˆrocketmqçš„è®¾è®¡ï¼Œå¯ä»¥å…ˆæä¸€äº›é—®é¢˜ã€‚&lt;/p&gt;\n&lt;h1 id=\&#34;ç–‘é—®ç‚¹\&#34;&gt;ç–‘é—®ç‚¹&lt;/h1&gt;\n&lt;h2 id=\&#34;master\&#34;&gt;Master&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;code&gt;master&lt;/code&gt;å¦‚ä½•æ¥å—&lt;code&gt;slave&lt;/code&gt;çš„è¯·æ±‚ï¼Ÿ&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;master&lt;/code&gt;å¤„ç†&lt;code&gt;slave&lt;/code&gt;è¯·æ±‚æ—¶ï¼Œå¦‚ä½•åˆ¤æ–­å“ªäº›æ•°æ®éœ€è¦åŒæ­¥ï¼Ÿ&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;master&lt;/code&gt;å¦‚ä½•ä¿è¯å‘é€çš„æ•°æ®åŒæ­¥æˆåŠŸçš„ï¼Ÿ&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h2 id=\&#34;slave\&#34;&gt;Slave&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;code&gt;slave&lt;/code&gt;å¦‚ä½•è·å–&lt;code&gt;master&lt;/code&gt;çš„è·¯ç”±ä¿¡æ¯&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;slave&lt;/code&gt;å¦‚ä½•å‘&lt;code&gt;master&lt;/code&gt;æŠ¥å‘Š&lt;code&gt;offset&lt;/code&gt;çš„&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;slave&lt;/code&gt;å¦‚ä½•å¤„ç†&lt;code&gt;master&lt;/code&gt;åŒæ­¥çš„æ•°æ®&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h2 id=\&#34;é«˜çº§\&#34;&gt;é«˜çº§&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;strong&gt;åŒæ­¥é€šçŸ¥&lt;/strong&gt;å’Œ&lt;strong&gt;å¼‚æ­¥é€šçŸ¥&lt;/strong&gt;æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ&lt;/li&gt;\n&lt;li&gt;RocketMQçš„&lt;strong&gt;è¯»å†™åˆ†ç¦»&lt;/strong&gt;æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;æœ¬æ–‡å…ˆå¯¹Masterçš„éƒ¨åˆ†è¿›è¡Œè§£æï¼š&lt;/p&gt;\n&lt;h1 id=\&#34;haç±»\&#34;&gt;HAç±»&lt;/h1&gt;\n&lt;p&gt;ä¸»ä»ç›¸å…³çš„ä»£ç ä½äº &lt;code&gt;store/src/main/java/org/apache/rocketmq/store/ha/&lt;/code&gt;è·¯å¾„ä¸‹ï¼Œå…¶ä¸­ä¸»è¦ä¸ºä¸¤ä¸ªç±»&lt;code&gt;HAService&lt;/code&gt;å’Œ&lt;code&gt;HAConnection&lt;/code&gt;ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;haç±»è¯´æ˜\&#34;&gt;HAç±»è¯´æ˜&lt;/h2&gt;\n&lt;ul&gt;\n&lt;li&gt;HAService: RocketMQ ä¸»ä»åŒæ­¥æ ¸å¿ƒå®ç°ç±»&lt;/li&gt;\n&lt;li&gt;HAService$AcceptSocketService: Master ç›‘å¬å®¢æˆ·ç«¯è¿æ¥&lt;/li&gt;\n&lt;li&gt;HAService$GroupTransferService: ä¸»ä»åŒæ­¥é€šçŸ¥&lt;/li&gt;\n&lt;li&gt;HAService$HAClient: Client ç«¯&lt;/li&gt;\n&lt;li&gt;HAConnection: M/Sé—´Channelçš„å°è£…ï¼ŒåŒæ—¶è´Ÿè´£MSæ•°æ®åŒæ­¥é€»è¾‘ã€‚&lt;/li&gt;\n&lt;li&gt;HAConnection$ReadSocketServiceï¼š Master ç½‘ç»œè¯»å®ç°ç±»&lt;/li&gt;\n&lt;li&gt;HAConnection$WriteSocketServiceï¼šMaster ç½‘ç»œå†™å®ç°ç±»&lt;/li&gt;\n&lt;/ul&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f9f4b11e8cac44a3940e929af0f2f839~tplv-k3u1fbpfcp-watermark.image?\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h1 id=\&#34;æºç éƒ¨åˆ†\&#34;&gt;æºç éƒ¨åˆ†&lt;/h1&gt;\n&lt;h2 id=\&#34;haservice-æ¨¡å—å¯åŠ¨\&#34;&gt;HAService æ¨¡å—å¯åŠ¨&lt;/h2&gt;\n&lt;p&gt;HAæ¨¡å—çš„å¯åŠ¨è·¯å¾„åœ¨&lt;code&gt;store/src/main/java/org/apache/rocketmq/store/ha/HAService#start()&lt;/code&gt;ä¸‹&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;// HAService å¯åŠ¨\npublic void start() throws Exception {\n    // masterç›¸å…³\n    this.acceptSocketService.beginAccept();\n    this.acceptSocketService.start();\n    this.groupTransferService.start();  // åŒæ­¥æ¨¡å¼çš„å®ç°\n    \n    //slaveç›¸å…³\n    this.haClient.start();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;acceptSocketService.beginAccept() : å¯åŠ¨slaveçš„ç›‘å¬æœåŠ¡&lt;/li&gt;\n&lt;li&gt;acceptSocketService.start(): å¤„ç†slaveçš„è¿æ¥äº‹ä»¶&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;acceptsocketservicebeginaccept\&#34;&gt;acceptSocketService.beginAccept()&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public void beginAccept() throws Exception {\n    // åˆ›å»º channel\n    this.serverSocketChannel = ServerSocketChannel.open();\n    // åˆ›å»º selector\n    this.selector = RemotingUtil.openSelector();\n    // è®¾ç½® TCP reuseAddress\n    this.serverSocketChannel.socket().setReuseAddress(true);\n    // ç»‘å®šç›‘å¬ç«¯å£,é»˜è®¤10912\n    this.serverSocketChannel.socket().bind(this.socketAddressListen);\n    // è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼\n    this.serverSocketChannel.configureBlocking(false);\n    // æ³¨å†ŒOP_ACCEPT(è¿æ¥äº‹ä»¶)\n    this.serverSocketChannel.register(this.selector, SelectionKey.OP_ACCEPT);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;acceptsocketservicestart\&#34;&gt;acceptSocketService.start()&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Override\npublic void run() {\n    log.info(this.getServiceName() + &amp;quot; service started&amp;quot;);\n\n    while (!this.isStopped()) {\n        try {\n            // æ¯1sé’Ÿå¤„ç†ä¸€æ¬¡slaveè¿æ¥äº‹ä»¶\n            this.selector.select(1000);\n            Set&amp;lt;SelectionKey&amp;gt; selected = this.selector.selectedKeys();\n\n            if (selected != null) {\n                for (SelectionKey k : selected) {\n                    if ((k.readyOps() &amp;amp; SelectionKey.OP_ACCEPT) != 0) {\n                        // slaveçš„è¿æ¥channel\n                        SocketChannel sc = ((ServerSocketChannel) k.channel()).accept();\n\n                        if (sc != null) {\n                            HAService.log.info(&amp;quot;HAService receive new connection, &amp;quot; + sc.socket().getRemoteSocketAddress());\n\n                            try {\n                                // åˆ›å»ºä¸€ä¸ªHAConnectionå¯¹è±¡ï¼Œä¿å­˜slaveçš„Channel\n                                HAConnection conn = new HAConnection(HAService.this, sc);\n                                // å¯åŠ¨HAConnection\n                                conn.start();\n                                // ä¿å­˜HAConnectionåˆ°connectionListä¸­\n                                HAService.this.addConnection(conn);\n                            } catch (Exception e) {\n                                log.error(&amp;quot;new HAConnection exception&amp;quot;, e);\n                                sc.close();\n                            }\n                        }\n                    } else {\n                        log.warn(&amp;quot;Unexpected ops in select &amp;quot; + k.readyOps());\n                    }\n                }\n\n                selected.clear();\n            }\n        } catch (Exception e) {\n            log.error(this.getServiceName() + &amp;quot; service has exception.&amp;quot;, e);\n        }\n    }\n\n    log.info(this.getServiceName() + &amp;quot; service end&amp;quot;);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å½“æœ‰æ–°çš„è¿æ¥æ—¶ï¼Œä¼šå°†è¯¥è¿æ¥å°è£…æˆä¸€ä¸ª&lt;code&gt;HAConnection&lt;/code&gt;å¯¹è±¡ï¼Œè°ƒç”¨&lt;code&gt;HAConnection.start()&lt;/code&gt;æ–¹æ³•ï¼Œç„¶åå°†è¿æ¥ä¿å­˜åˆ°è¿æ¥åˆ—è¡¨ä¸­ã€‚&lt;/p&gt;\n&lt;p&gt;masterå¦‚ä½•å¤„ç†slaveçš„è¯·æ±‚ä»¥åŠå¦‚ä½•å‘slaveå‘é€æ¶ˆæ¯çš„é€»è¾‘å…¨éƒ¨åœ¨&lt;code&gt;HAConnection&lt;/code&gt;å¯¹è±¡é‡Œï¼Œç»§ç»­è¿½è¸ª&lt;code&gt;HAConnection#start()&lt;/code&gt;ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;haconnectionå¯åŠ¨\&#34;&gt;HAConnectionå¯åŠ¨&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public void start() {\n    // masterå¤„ç†slaveçš„æ¶ˆæ¯éƒ¨åˆ†\n    this.readSocketService.start();\n    // mastgerå‘slaveå‘é€æ¶ˆæ¯éƒ¨åˆ†\n    this.writeSocketService.start();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;è¿™é‡Œåˆ†ä¸º&lt;code&gt;readSocketService&lt;/code&gt;å’Œ&lt;code&gt;writeSocketService&lt;/code&gt;ï¼Œé¡¾åæ€ä¹‰ï¼Œä¸€ä¸ªå¤„ç†slaveçš„è¯»äº‹ä»¶ï¼Œä¸€ä¸ªå¤„ç†å†™äº‹ä»¶&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;readSocketService : å¤„ç†æ¥æ”¶åˆ°çš„slaveçš„è¯·æ±‚&lt;/li&gt;\n&lt;li&gt;writeSocketService: è´Ÿè´£masterå‘slaveåŒæ­¥æ•°æ®çš„é€»è¾‘&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;masterå¤„ç†slaveè¯·æ±‚\&#34;&gt;Masterå¤„ç†slaveè¯·æ±‚&lt;/h3&gt;\n&lt;p&gt;åœ¨ &lt;code&gt;store/src/main/java/org/apache/rocketmq/store/ha/HAConnection.run()&lt;/code&gt;ä¸­ï¼Œä¸»è¦å…³æ³¨è¿™éƒ¨åˆ†é€»è¾‘:&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;while (!this.isStopped()) {\n    try {\n        // 1sæ£€æŸ¥ä¸€æ¬¡è¯»è¯·æ±‚\n        this.selector.select(1000);\n        // å¤„ç†è¯»äº‹ä»¶\n        boolean ok = this.processReadEvent();\n        if (!ok) {\n            HAConnection.log.error(&amp;quot;processReadEvent error&amp;quot;);\n            break;\n        }\n\n        // ä¸¤æ¬¡è¯»äº‹ä»¶çš„é—´éš”è¶…è¿‡äº†æ—¢å®šçš„å€¼ï¼Œåˆ™masterå’Œslaveçš„è¿æ¥å¤±æ•ˆï¼Œè·³å‡ºå¾ªç¯ã€‚\n        long interval = HAConnection.this.haService.getDefaultMessageStore().getSystemClock().now() - this.lastReadTimestamp;\n        if (interval &amp;gt; HAConnection.this.haService.getDefaultMessageStore().getMessageStoreConfig().getHaHousekeepingInterval()) {\n            log.warn(&amp;quot;ha housekeeping, found this connection[&amp;quot; + HAConnection.this.clientAddr + &amp;quot;] expired, &amp;quot; + interval);\n            break;\n        }\n    } catch (Exception e) {\n        HAConnection.log.error(this.getServiceName() + &amp;quot; service has exception.&amp;quot;, e);\n        break;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å¤„ç†è¯»äº‹ä»¶çš„ä»£ç ï¼š&lt;/p&gt;\n&lt;p&gt;slaveå‘é€çš„æ¶ˆæ¯å†…å®¹ä¸ºè¦æ‹‰å–çš„æ•°æ®çš„offsetï¼Œè€Œmasteræ¥æ”¶è¦è¿™ä¸ªoffsetåï¼Œå«ä¹‰æœ‰ä¸¤å±‚&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;è¿™ä¸ªoffsetè¡¨ç¤ºslaveè¿™æ¬¡è¦æ‹‰å–çš„ä½ç½®ï¼Œç»™masteræä¾›å‚è€ƒã€‚&lt;/li&gt;\n&lt;li&gt;è¿™ä¸ªoffsetä¹Ÿè¡¨ç¤ºslaveä»¥åŠåŒæ­¥åˆ°çš„ä½ç½®ï¼Œå¯ä»¥å½“ä½œä¸€ä¸ªackåŒ…çš„ä½œç”¨ã€‚&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;private boolean processReadEvent() {\n    int readSizeZeroTimes = 0;\n\n    // è‹¥byteBufferReadæ²¡æœ‰å‰©ä½™\n    if (!this.byteBufferRead.hasRemaining()) {\n        this.byteBufferRead.flip();\n        this.processPosition = 0;\n    }\n\n    while (this.byteBufferRead.hasRemaining()) {\n        try {\n            int readSize = this.socketChannel.read(this.byteBufferRead);\n            if (readSize &amp;gt; 0) {\n                readSizeZeroTimes = 0;\n                this.lastReadTimestamp = HAConnection.this.haService.getDefaultMessageStore().getSystemClock().now();\n                // è¶…è¿‡8å­—èŠ‚å°±å¤„ç†,å› ä¸ºslaveå‘é€çš„å¿ƒè·³åŒ…å°±æ˜¯8å­—èŠ‚çš„offset\n                if ((this.byteBufferRead.position() - this.processPosition) &amp;gt;= 8) {\n                    // è·å–ç¦»byteBufferRead.position()æœ€è¿‘çš„8çš„æ•´æ•°\n                    int pos = this.byteBufferRead.position() - (this.byteBufferRead.position() % 8);\n                    long readOffset = this.byteBufferRead.getLong(pos - 8);\n                    this.processPosition = pos;\n                    // æ›´æ–°slave å·²æ‹‰å–çš„ offset\n                    HAConnection.this.slaveAckOffset = readOffset;\n                    // å‡å¦‚æ˜¯ç¬¬ä¸€æ¬¡æ‹‰å–çš„æƒ…å†µ\n                    if (HAConnection.this.slaveRequestOffset &amp;lt; 0) {\n                        HAConnection.this.slaveRequestOffset = readOffset;\n                        log.info(&amp;quot;slave[&amp;quot; + HAConnection.this.clientAddr + &amp;quot;] request offset &amp;quot; + readOffset);\n                    }\n                    // é€šçŸ¥slaveå·²ç»æ›´æ–°ï¼Œæ›´æ–°push2SlaveMaxOffsetå­—æ®µ\n                    HAConnection.this.haService.notifyTransferSome(HAConnection.this.slaveAckOffset);\n                }\n            } else if (readSize == 0) {\n                if (++readSizeZeroTimes &amp;gt;= 3) {\n                    break;\n                }\n            } else {\n                log.error(&amp;quot;read socket[&amp;quot; + HAConnection.this.clientAddr + &amp;quot;] &amp;lt; 0&amp;quot;);\n                return false;\n            }\n        } catch (IOException e) {\n            log.error(&amp;quot;processReadEvent exception&amp;quot;, e);\n            return false;\n        }\n    }\n\n    return true;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;masterè·å–åˆ°offsetåï¼Œæ›´æ–°&lt;code&gt;push2SlavemaxOffset&lt;/code&gt;å­—æ®µï¼Œè¿™ä¸ªå­—æ®µçš„ä½œç”¨æ˜¯è¡¨ç¤ºå½“å‰M/Sä¹‹é—´å·²æˆåŠŸåŒæ­¥çš„ä½ç½®ï¼Œåœ¨masterå‘slaveå‘é€æ•°æ®æ—¶éœ€è¦ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;masterä¼ è¾“æ•°æ®\&#34;&gt;Masterä¼ è¾“æ•°æ®&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;while (!this.isStopped()) {\n    try {\n        this.selector.select(1000);\n\n        if (-1 == HAConnection.this.slaveRequestOffset) {\n            Thread.sleep(10);\n            continue;\n        }\n\n        // æ˜¯å¦ç¬¬ä¸€æ¬¡è¿›è¡Œä¼ è¾“\n        if (-1 == this.nextTransferFromWhere) {\n            // requestä¸º0\n            if (0 == HAConnection.this.slaveRequestOffset) {\n                long masterOffset = HAConnection.this.haService.getDefaultMessageStore().getCommitLog().getMaxOffset();\n                masterOffset = masterOffset - (masterOffset % HAConnection.this.haService.getDefaultMessageStore().getMessageStoreConfig().getMappedFileSizeCommitLog());\n\n                if (masterOffset &amp;lt; 0) {\n                    masterOffset = 0;\n                }\n\n                this.nextTransferFromWhere = masterOffset;\n            } else {\n                // slaveRequestOffset != 0\n                this.nextTransferFromWhere = HAConnection.this.slaveRequestOffset;\n            }\n\n            log.info(&amp;quot;master transfer data from &amp;quot; + this.nextTransferFromWhere + &amp;quot; to slave[&amp;quot; + HAConnection.this.clientAddr + &amp;quot;], and slave request &amp;quot; + HAConnection.this.slaveRequestOffset);\n        }\n\n        // ä¸Šæ¬¡ä¼ è¾“æ˜¯å¦æˆåŠŸ\n        if (this.lastWriteOver) {\n            // è·ç¦»ä¸Šæ¬¡å†™çš„æ—¶é—´é—´éš”\n            long interval = HAConnection.this.haService.getDefaultMessageStore().getSystemClock().now() - this.lastWriteTimestamp;\n            // å¦‚æœç­‰å¾…æ—¶é—´é—´éš” &amp;gt; haå¿ƒè·³æ—¶é—´é—´éš”\n            if (interval &amp;gt; HAConnection.this.haService.getDefaultMessageStore().getMessageStoreConfig().getHaSendHeartbeatInterval()) {\n                // Build Header\n                this.byteBufferHeader.position(0);\n                this.byteBufferHeader.limit(headerSize);\n                this.byteBufferHeader.putLong(this.nextTransferFromWhere);\n                this.byteBufferHeader.putInt(0);\n                this.byteBufferHeader.flip();\n                this.lastWriteOver = this.transferData();\n                if (!this.lastWriteOver) continue;\n            }\n        } else {\n            //ä¸Šæ¬¡å¤±è´¥ï¼Œéœ€è¦è¿›è¡Œé‡æ–°ä¼ è¾“\n            this.lastWriteOver = this.transferData();\n            if (!this.lastWriteOver) continue;\n        }\n\n        // æ ¹æ®nextTransferFromWhereè·å–commitlogæ•°æ®\n        SelectMappedBufferResult selectResult = HAConnection.this.haService.getDefaultMessageStore().getCommitLogData(this.nextTransferFromWhere);\n        if (selectResult != null) {\n            int size = selectResult.getSize();\n            if (size &amp;gt; HAConnection.this.haService.getDefaultMessageStore().getMessageStoreConfig().getHaTransferBatchSize()) {\n                size = HAConnection.this.haService.getDefaultMessageStore().getMessageStoreConfig().getHaTransferBatchSize();\n            }\n\n            long thisOffset = this.nextTransferFromWhere;\n            this.nextTransferFromWhere += size;\n\n            selectResult.getByteBuffer().limit(size);\n            this.selectMappedBufferResult = selectResult;\n\n            // Build Header\n            this.byteBufferHeader.position(0);\n            this.byteBufferHeader.limit(headerSize);\n            this.byteBufferHeader.putLong(thisOffset);\n            this.byteBufferHeader.putInt(size);\n            this.byteBufferHeader.flip();\n\n            this.lastWriteOver = this.transferData();\n        } else {\n\n            HAConnection.this.haService.getWaitNotifyObject().allWaitForRunning(100);\n        }\n    } catch (Exception e) {\n\n        HAConnection.log.error(this.getServiceName() + &amp;quot; service has exception.&amp;quot;, e);\n        break;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;3\&#34;&gt;&lt;img src=\&#34;https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/438c5aae0acf4ea3b06b92a35b010648~tplv-k3u1fbpfcp-watermark.image?\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h1 id=\&#34;æ€»ç»“\&#34;&gt;æ€»ç»“&lt;/h1&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;code&gt;master&lt;/code&gt;å¦‚ä½•æ¥å—&lt;code&gt;slave&lt;/code&gt;çš„è¯·æ±‚ï¼Ÿ&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;ç­”ï¼šåœ¨readSocketServiceç±»ä¸­è¿›è¡ŒOP_READäº‹ä»¶å¤„ç†ã€‚masteræ”¶åˆ°slaveå‘é€çš„çš„offsetï¼Œè¡¨ç¤ºslaveå½“å‰åŒæ­¥çš„ä½ç½®ï¼Œmasterä¿å­˜è¯¥offsetã€‚&lt;/p&gt;\n&lt;ol start=\&#34;2\&#34;&gt;\n&lt;li&gt;&lt;code&gt;master&lt;/code&gt;å¤„ç†&lt;code&gt;slave&lt;/code&gt;è¯·æ±‚æ—¶ï¼Œå¦‚ä½•åˆ¤æ–­å“ªäº›æ•°æ®éœ€è¦åŒæ­¥ï¼Ÿ&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;ç­”ï¼šslaveçš„è¯·æ±‚ä¼šæºå¸¦åŒæ­¥å®Œçš„offsetï¼Œmasteråœ¨readSocketServiceä¸­ä¿å­˜äº†è¯¥offsetï¼Œåç»­writeSocketServiceåœ¨æ‰§è¡ŒOP_WRITEäº‹ä»¶æ—¶ï¼Œä¼šä¸ masterçš„offsetè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœ‰æ–°çš„æ•°æ®åˆ™å‘é€ç»™slaveã€‚&lt;/p&gt;\n&lt;ol start=\&#34;3\&#34;&gt;\n&lt;li&gt;&lt;code&gt;master&lt;/code&gt;å¦‚ä½•ä¿è¯å‘é€çš„æ•°æ®åŒæ­¥æˆåŠŸçš„ï¼Ÿ&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;ç­”ï¼šackæœºåˆ¶ï¼Œslave -&amp;gt; master å‘é€çš„è¯·æ±‚ä¸­çš„offsetå³ä»£è¡¨slaveå·²åŒæ­¥å®Œæˆçš„è¿›åº¦ï¼Œå‡å¦‚slaveåœ¨åŒæ­¥æ“ä½œæ—¶å‘é€å¼‚å¸¸ï¼Œé‚£ä¹ˆæœªåŒæ­¥æˆåŠŸçš„æ•°æ®ä¸‹ä¸€æ¬¡masterä¼šå†å‘é€è¿‡æ¥ã€‚&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;å…³äºslaveäºé«˜çº§éƒ¨åˆ†åœ¨åç»­æ–‡ç« ä¸­æ›´æ–°ã€‚&lt;/p&gt;\n&lt;/blockquote&gt;\n&#34;,&#34;fileName&#34;:&#34;rocketmq491-yuan-ma-fen-xi-ha-mo-kuai-master-du-xie-chu-li&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;ä»æœ€æŠ½è±¡çš„è§’åº¦çœ‹ï¼Œä¸»ä»åŒæ­¥æµç¨‹å¯ä»¥åˆ†ä¸º3ä¸ªæ­¥éª¤:&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;masterå¯åŠ¨&lt;/li&gt;\n&lt;li&gt;slaveçš„å¯åŠ¨&lt;/li&gt;\n&lt;li&gt;m/s æ•°æ®åŒæ­¥&lt;/li&gt;\n&lt;/ol&gt;\n&#34;,&#34;title&#34;:&#34;RocketMQ4.9.1æºç åˆ†æ(HAæ¨¡å—) Masterè¯»å†™å¤„ç†&#34;,&#34;tags&#34;:[{&#34;index&#34;:-1,&#34;name&#34;:&#34;RocketMQ&#34;,&#34;slug&#34;:&#34;_Ywd8fi71&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/_Ywd8fi71/&#34;},{&#34;name&#34;:&#34;æºç &#34;,&#34;slug&#34;:&#34;yuan-ma&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/yuan-ma/&#34;}],&#34;date&#34;:&#34;2021-10-08 01:06:31&#34;,&#34;dateFormat&#34;:&#34;2021-10-08 01:06:31&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/rocketmq491-yuan-ma-fen-xi-ha-mo-kuai-master-du-xie-chu-li/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;9 min read&#34;,&#34;time&#34;:483000,&#34;words&#34;:1720,&#34;minutes&#34;:9},&#34;description&#34;:&#34;ä»æœ€æŠ½è±¡çš„è§’åº¦çœ‹ï¼Œä¸»ä»åŒæ­¥æµç¨‹å¯ä»¥åˆ†ä¸º3ä¸ªæ­¥éª¤:\n\nmasterå¯åŠ¨\nslaveçš„å¯åŠ¨\nm/s æ•°æ®åŒæ­¥\n\n\n\né’ˆå¯¹ä¸Šè¿°æ­¥éª¤ï¼Œç»“åˆrocketmqçš„è®¾è®¡ï¼Œå¯ä»¥å…ˆæä¸€äº›é—®é¢˜ã€‚\nç–‘é—®ç‚¹\nMaster\n\nmasterå¦‚ä½•æ¥å—slaveçš„è¯·æ±‚ï¼Ÿ\nm...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%96%91%E9%97%AE%E7%82%B9\&#34;&gt;ç–‘é—®ç‚¹&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#master\&#34;&gt;Master&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#slave\&#34;&gt;Slave&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%AB%98%E7%BA%A7\&#34;&gt;é«˜çº§&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#ha%E7%B1%BB\&#34;&gt;HAç±»&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#ha%E7%B1%BB%E8%AF%B4%E6%98%8E\&#34;&gt;HAç±»è¯´æ˜&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%BA%90%E7%A0%81%E9%83%A8%E5%88%86\&#34;&gt;æºç éƒ¨åˆ†&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#haservice-%E6%A8%A1%E5%9D%97%E5%90%AF%E5%8A%A8\&#34;&gt;HAService æ¨¡å—å¯åŠ¨&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#acceptsocketservicebeginaccept\&#34;&gt;acceptSocketService.beginAccept()&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#acceptsocketservicestart\&#34;&gt;acceptSocketService.start()&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#haconnection%E5%90%AF%E5%8A%A8\&#34;&gt;HAConnectionå¯åŠ¨&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#master%E5%A4%84%E7%90%86slave%E8%AF%B7%E6%B1%82\&#34;&gt;Masterå¤„ç†slaveè¯·æ±‚&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#master%E4%BC%A0%E8%BE%93%E6%95%B0%E6%8D%AE\&#34;&gt;Masterä¼ è¾“æ•°æ®&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%80%BB%E7%BB%93\&#34;&gt;æ€»ç»“&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;halfæ¶ˆæ¯å±äºRocketMQäº‹åŠ¡å¤„ç†çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œå¯ä»¥åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼š&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;producer -&amp;gt; broker å‘é€halfæ¶ˆæ¯&lt;/li&gt;\n&lt;li&gt;broker å¤„ç†halfæ¶ˆæ¯&lt;/li&gt;\n&lt;/ol&gt;\n&lt;!-- more --&gt;\n&lt;p&gt;å¯¹åº”å›¾ä¸­çš„æ­¥éª¤1ã€2ã€‚&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7bd34b7c086149a298df6672e9c5dda2~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;å¸¦ç€é—®é¢˜çœ‹æºç , å…ˆæå‡ ä¸ªé—®é¢˜ï¼š&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;producer å¦‚ä½•å‘é€ half æ¶ˆæ¯çš„ï¼Ÿ&lt;/li&gt;\n&lt;li&gt;broker åˆæ˜¯å¦‚ä½•åŒºåˆ†æ™®é€šæ¶ˆæ¯å’Œäº‹åŠ¡æ¶ˆæ¯çš„&lt;/li&gt;\n&lt;/ol&gt;\n&lt;!----&gt;\n&lt;ol start=\&#34;3\&#34;&gt;\n&lt;li&gt;halfæ¶ˆæ¯ä¸ä¼šè¢«Consumeræ¶ˆè´¹ï¼Œæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;çœ‹å®Œå°±æœ‰ç­”æ¡ˆäº†ã€‚&lt;/p&gt;\n&lt;h1 id=\&#34;producer-half-æ¶ˆæ¯å‘é€\&#34;&gt;Producer Half æ¶ˆæ¯å‘é€&lt;/h1&gt;\n&lt;p&gt;é¦–å…ˆç”Ÿäº§è€…çš„ä½¿ç”¨ä»£ç å¦‚ä¸‹ï¼Œè¦ä½¿ç”¨äº‹åŠ¡æ¶ˆæ¯çš„åŠŸèƒ½ï¼Œç”Ÿäº§è€…å¯¹è±¡è¦ä½¿ç”¨&lt;code&gt;TransactionMQProducer&lt;/code&gt;è¿›è¡Œå£°æ˜ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public static void main(String[] args) throws MQClientException {\n    // åˆ›å»º TransactionMQProducer å®ä¾‹ï¼Œå¹¶è®¾ç½®ç”Ÿäº§è€…ç»„å\n    TransactionMQProducer producer = new TransactionMQProducer(&amp;quot;transactionGroup&amp;quot;);\n    // è®¾ç½® NameServer åœ°å€\n    producer.setNamesrvAddr(&amp;quot;127.0.0.1:9876&amp;quot;);\n\n    // æ·»åŠ äº‹åŠ¡ç›‘å¬å™¨\n    producer.setTransactionListener(new TransactionListener() {\n        /**\n         * æ‰§è¡Œæœ¬åœ°äº‹åŠ¡çš„æ–¹æ³•\n         */\n        @Override\n        public LocalTransactionState executeLocalTransaction(Message message, Object o) {\n            // æ‰§è¡Œæœ¬åœ°äº‹åŠ¡\n            doXXX();\n            // è¿”å›æ‰§è¡Œç»“æœ\n            return LocalTransactionState.xxx;\n        }\n\n        /**\n         * æ¶ˆæ¯å›æŸ¥æ‰§è¡Œçš„æ–¹æ³•\n         */\n        @Override\n        public LocalTransactionState checkLocalTransaction(MessageExt messageExt) {\n\t\t\t// å›æŸ¥äº‹åŠ¡çŠ¶æ€\n            findxxx();\n            // æ¶ˆæ¯æ¥å›æŸ¥çš„æ—¶å€™ï¼Œè¿›è¡Œæäº¤äº‹åŠ¡\n            return LocalTransactionState.xxx;\n        }\n    });\n\n    // å¯åŠ¨producer\n    producer.start();\n}\n\n// å‘é€æ¶ˆæ¯\nSendResult result = producer.sendMessageInTransaction(msg, null);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å’Œæ™®é€šæ¶ˆæ¯ä¸åŒï¼Œåœ¨37è¡Œä¸­ä½¿ç”¨&lt;code&gt;sendMessageIntransaction()&lt;/code&gt;æ–¹æ³•å‘é€äº‹åŠ¡æ–¹æ³•ï¼Œé‚£ä¹ˆå‘é€çš„é€»è¾‘è‚¯å®šéƒ½åœ¨è¿™ä¸ªæ–¹æ³•ä¸‹ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Override\npublic TransactionSendResult sendMessageInTransaction(final Message msg, final Object arg) throws MQClientException {\n    // æœ¬åœ°äº‹åŠ¡å¤„ç†é€»è¾‘å¿…é¡»è¦å…ˆå®šä¹‰å¥½\n    if (null == this.transactionListener) {\n        throw new MQClientException(&amp;quot;TransactionListener is null&amp;quot;, null);\n    }\n\n    // å¯¹topicè¿›è¡ŒåŒ…è£…,é™„å¸¦å»¶è¿Ÿã€é‡è¯•æ ‡è®°\n    msg.setTopic(NamespaceUtil.wrapNamespace(this.getNamespace(), msg.getTopic()));\n    return this.defaultMQProducerImpl.sendMessageInTransaction(msg, null, arg);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;è¿›å…¥&lt;code&gt;sendMessageInTransaction()&lt;/code&gt;æ–¹æ³•, æˆ‘ä»¬ä¸»è¦å…³æ³¨æ–¹æ³•çš„å‰åŠéƒ¨åˆ†ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public TransactionSendResult sendMessageInTransaction(final Message msg, final LocalTransactionExecuter localTransactionExecuter, final Object arg) throws MQClientException {\n    TransactionListener transactionListener = getCheckListener();\n    if (null == localTransactionExecuter &amp;amp;&amp;amp; null == transactionListener) {\n        throw new MQClientException(&amp;quot;tranExecutor is null&amp;quot;, null);\n    }\n\n    // ignore DelayTimeLevel parameter\n    if (msg.getDelayTimeLevel() != 0) {\n        MessageAccessor.clearProperty(msg, MessageConst.PROPERTY_DELAY_TIME_LEVEL);\n    }\n    Validators.checkMessage(msg, this.defaultMQProducer);\n\n    SendResult sendResult;\n    // ç»™æ¶ˆæ¯æ‰“ä¸ŠTRAN_MSGæ ‡è®°,æ ‡è®°ä¸ºäº‹åŠ¡æ¶ˆæ¯\n    MessageAccessor.putProperty(msg, MessageConst.PROPERTY_TRANSACTION_PREPARED, &amp;quot;true&amp;quot;);\n    // æ ‡è®°ç”Ÿäº§è€…ç»„çš„ç›®çš„æ˜¯brokerè¿›è¡Œå›æŸ¥æ—¶éœ€è¦\n    MessageAccessor.putProperty(msg, MessageConst.PROPERTY_PRODUCER_GROUP, this.defaultMQProducer.getProducerGroup());\n    try {\n        // å‘é€halfæ¶ˆæ¯\n        sendResult = this.send(msg);\n    } catch (Exception e) {\n        throw new MQClientException(&amp;quot;send message Exception&amp;quot;, e);\n    }\n    \n    // ç•¥\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å¯ä»¥çœ‹åˆ°ä»£ç é‡Œç»™æ¶ˆæ¯æ·»åŠ äº†ä¸¤ä¸ªå±æ€§ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;PROPERTY_TRANSACTION_PREPARED : æ ‡è®°ä¸ºäº‹åŠ¡æ¶ˆæ¯ï¼Œbrokerå¯ä»¥æ ¹æ®msgæ˜¯å¦æœ‰è¯¥å­—æ®µæ¥åˆ¤æ–­æ˜¯å¦æ˜¯äº‹åŠ¡æ¶ˆæ¯ã€‚&lt;/li&gt;\n&lt;li&gt;PROPERTY_PRODUCER_GROUP : ç”Ÿäº§è€…ç»„ï¼Œè¿™ä¸ªåœ¨brokerè¿›è¡Œäº‹åŠ¡ç»“æœå›æŸ¥æ—¶å€™éœ€è¦ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;åœ¨å¯¹æ¶ˆæ¯è¿›è¡Œç‰¹æ®ŠåŒ…è£…å˜æˆäº‹åŠ¡æ¶ˆæ¯åï¼Œè°ƒç”¨çš„&lt;code&gt;send()&lt;/code&gt;æ–¹æ³•å°±æ˜¯é€šç”¨çš„æ¶ˆæ¯å‘é€æ–¹æ³•äº†ï¼Œæ‰€æœ‰æ¶ˆæ¯éƒ½æ˜¯é€šè¿‡è¿™ä¸ªæ–¹æ³•è¿›è¡Œå‘é€çš„ã€‚&lt;/p&gt;\n&lt;h1 id=\&#34;broker-å¤„ç†-half-æ¶ˆæ¯\&#34;&gt;Broker å¤„ç† Half æ¶ˆæ¯&lt;/h1&gt;\n&lt;p&gt;åœ¨ broker/src/main/java/org/apache/rocketmq/broker/processor/SendMessageProcessor.java ç±»ä¸­ï¼Œ&lt;code&gt;asyncSendMessage()&lt;/code&gt;æ–¹æ³•ä¸­æœ‰ä¸€æ®µä»£ç ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;...\n// è·å–äº‹åŠ¡å±æ€§å­—æ®µ\nString transFlag = origProps.get(MessageConst.PROPERTY_TRANSACTION_PREPARED);\n// åˆ¤æ–­æ˜¯å¦ä¸ºç©º &amp;amp;&amp;amp; å€¼ä¸ºtrue\nif (transFlag != null &amp;amp;&amp;amp; Boolean.parseBoolean(transFlag)) {\n  if (this.brokerController.getBrokerConfig().isRejectTransactionMessage()) {\n    response.setCode(ResponseCode.NO_PERMISSION);\n    response.setRemark(&amp;quot;the broker[&amp;quot; + this.brokerController.getBrokerConfig().getBrokerIP1() + &amp;quot;] sending transaction message is forbidden&amp;quot;);\n    return CompletableFuture.completedFuture(response);\n  }\n  // å­˜å‚¨prepareæ¶ˆæ¯\n  putMessageResult = this.brokerController.getTransactionalMessageService().asyncPrepareMessage(msgInner);\n} else {\n  // å­˜å‚¨æ™®é€šæ¶ˆæ¯\n  putMessageResult = this.brokerController.getMessageStore().asyncPutMessage(msgInner);\n}\n...\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;çœ‹çœ‹å¦‚æœå¤„ç†prepareæ¶ˆæ¯çš„ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Override\npublic CompletableFuture&amp;lt;PutMessageResult&amp;gt; asyncPrepareMessage(MessageExtBrokerInner messageInner) {\n    return transactionalMessageBridge.asyncPutHalfMessage(messageInner);  //1 è°ƒç”¨asyncPutHalfMessage()æ–¹æ³•\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;code&gt;asyncPrepareMessage()&lt;/code&gt;è°ƒç”¨&lt;code&gt;asyncPutHalfMessage()&lt;/code&gt;æ–¹æ³•&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public CompletableFuture&amp;lt;PutMessageResult&amp;gt; asyncPutHalfMessage(MessageExtBrokerInner messageInner) {\n    return store.asyncPutMessage(parseHalfMessageInner(messageInner));\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;code&gt;store.asyncPutMessage()&lt;/code&gt;å°±æ˜¯é€šç”¨çš„æ–¹æ³•ï¼Œæ™®é€šæ¶ˆæ¯çš„å­˜å‚¨ä¹Ÿæ˜¯ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥halfæ¶ˆæ¯çš„ç‰¹æ®Šå¤„ç†åœ¨&lt;code&gt;parseHalfMessageInner()&lt;/code&gt;ä¸­&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;private MessageExtBrokerInner parseHalfMessageInner(MessageExtBrokerInner msgInner) {\n    // å¤‡ä»½æ¶ˆæ¯çš„åŸä¸»é¢˜å’ŒåŸé˜Ÿåˆ—ID\n    MessageAccessor.putProperty(msgInner, MessageConst.PROPERTY_REAL_TOPIC, msgInner.getTopic());\n    MessageAccessor.putProperty(msgInner, MessageConst.PROPERTY_REAL_QUEUE_ID, String.valueOf(msgInner.getQueueId()));\n    msgInner.setSysFlag(MessageSysFlag.resetTransactionValue(msgInner.getSysFlag(), MessageSysFlag.TRANSACTION_NOT_TYPE));\n    // äº‹åŠ¡æ¶ˆæ¯çš„topicå’ŒqueueIDæ˜¯å†™æ­»å›ºå®šçš„\n    msgInner.setTopic(TransactionalMessageUtil.buildHalfTopic());\n    msgInner.setQueueId(0);\n    msgInner.setPropertiesString(MessageDecoder.messageProperties2String(msgInner.getProperties()));\n    return msgInner;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;åˆ†ä¸ºä¸¤éƒ¨åˆ†é€»è¾‘&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;å¤‡ä»½åŸæœ‰çš„topicå’ŒqueueIdï¼Œå°†æ¶ˆæ¯çœŸæ­£çš„topicæ”¾åœ¨&lt;code&gt;REAL_TOPIC&lt;/code&gt;å±æ€§ä¸­ï¼ŒqueueIdæ”¾åœ¨&lt;code&gt;REAL_QID&lt;/code&gt;å±æ€§ä¸­&lt;/li&gt;\n&lt;li&gt;ä½¿ç”¨äº‹åŠ¡ä¸“ç”¨çš„topicå’ŒqueueIdè¦†ç›–æ—§å€¼ï¼Œtopic = &lt;code&gt;RMQ_SYS_TRANS_HALF_TOPIC&lt;/code&gt;,queueId = 0ã€‚è¿™æ ·æ„å‘³ç€æ‰€æœ‰çš„halfæ¶ˆæ¯éƒ½ä¼šå­˜åœ¨åŒä¸€ä¸ªtopicé˜Ÿåˆ—ä¸­ã€‚&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h1 id=\&#34;ç–‘é—®è§£ç­”\&#34;&gt;ç–‘é—®è§£ç­”&lt;/h1&gt;\n&lt;p&gt;ç°åœ¨å¯ä»¥å›ç­”ä¹‹å‰çš„ç–‘æƒ‘äº†&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;producer å¦‚ä½•å‘é€ half æ¶ˆæ¯çš„ï¼Ÿ&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;ç­”ï¼šRocketMQå¯¹äºäº‹åŠ¡æ¶ˆæ¯ï¼Œä½¿ç”¨äº†ä¸“é—¨çš„Producerå¯¹è±¡&lt;code&gt;TransactionMQProducer&lt;/code&gt;ï¼Œè¿™ä¸ªproducerçš„å‘é€æ¶ˆæ¯çš„æ–¹æ³•æŠŠæ¶ˆæ¯åŒ…è£…æˆäº‹åŠ¡æ¶ˆæ¯ã€‚&lt;/p&gt;\n&lt;ol start=\&#34;2\&#34;&gt;\n&lt;li&gt;broker åˆæ˜¯å¦‚ä½•åŒºåˆ†æ™®é€šæ¶ˆæ¯å’Œäº‹åŠ¡æ¶ˆæ¯çš„&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;ç­”ï¼šåœ¨æ¶ˆæ¯å‘é€çš„æ—¶å€™ï¼Œåœ¨æ¶ˆæ¯çš„ &lt;code&gt;property&lt;/code&gt;é‡Œæ·»åŠ &lt;code&gt;PROPERTY_TRANSACTION_PREPARED&lt;/code&gt;æ ‡è®°ï¼Œbrokeræ ¹æ®å’Œè¿™ä¸ªæ ‡è®°æ¥åŒºåˆ†æ™®é€šæ¶ˆæ¯å’Œäº‹åŠ¡æ¶ˆæ¯ã€‚&lt;/p&gt;\n&lt;ol start=\&#34;3\&#34;&gt;\n&lt;li&gt;halfæ¶ˆæ¯ä¸ä¼šè¢«Consumeræ¶ˆè´¹ï¼Œæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;ç­”ï¼šæ¶ˆæ¯ç»è¿‡ç‰¹æ®Šå¤„ç†ï¼Œéƒ½è¢«åˆ†é…åˆ°ç‰¹æœ‰çš„topicé˜Ÿåˆ—ä¸­ï¼Œè¢«éš”ç¦»äº†ã€‚è¿™æ ·æ¶ˆè´¹è€…å°±æ— æ³•è·å–åˆ°è¿™äº›æ¶ˆæ¯äº†ã€‚&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;rocketmq491-yuan-ma-fen-xi-_shi-wu-half-ban-xiao-xi-chu-li&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;halfæ¶ˆæ¯å±äºRocketMQäº‹åŠ¡å¤„ç†çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œå¯ä»¥åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼š&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;producer -&amp;gt; broker å‘é€halfæ¶ˆæ¯&lt;/li&gt;\n&lt;li&gt;broker å¤„ç†halfæ¶ˆæ¯&lt;/li&gt;\n&lt;/ol&gt;\n&#34;,&#34;title&#34;:&#34;RocketMQ4.9.1æºç åˆ†æ_(äº‹åŠ¡) HalfåŠæ¶ˆæ¯å¤„ç†&#34;,&#34;tags&#34;:[{&#34;index&#34;:-1,&#34;name&#34;:&#34;RocketMQ&#34;,&#34;slug&#34;:&#34;_Ywd8fi71&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/_Ywd8fi71/&#34;},{&#34;name&#34;:&#34;æºç &#34;,&#34;slug&#34;:&#34;yuan-ma&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/yuan-ma/&#34;}],&#34;date&#34;:&#34;2021-10-05 20:04:53&#34;,&#34;dateFormat&#34;:&#34;2021-10-05 08:04:53&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/rocketmq491-yuan-ma-fen-xi-_shi-wu-half-ban-xiao-xi-chu-li/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;6 min read&#34;,&#34;time&#34;:301000,&#34;words&#34;:1167,&#34;minutes&#34;:6},&#34;description&#34;:&#34;halfæ¶ˆæ¯å±äºRocketMQäº‹åŠ¡å¤„ç†çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œå¯ä»¥åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼š\n\nproducer -&amp;gt; broker å‘é€halfæ¶ˆæ¯\nbroker å¤„ç†halfæ¶ˆæ¯\n\n\nå¯¹åº”å›¾ä¸­çš„æ­¥éª¤1ã€2ã€‚\n\nå¸¦ç€é—®é¢˜çœ‹æºç , å…ˆæå‡ ä¸ªé—®é¢˜ï¼š\n\npro...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#producer-half-%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81\&#34;&gt;Producer Half æ¶ˆæ¯å‘é€&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#broker-%E5%A4%84%E7%90%86-half-%E6%B6%88%E6%81%AF\&#34;&gt;Broker å¤„ç† Half æ¶ˆæ¯&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%96%91%E9%97%AE%E8%A7%A3%E7%AD%94\&#34;&gt;ç–‘é—®è§£ç­”&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h1 id=\&#34;å¯åŠ¨ä»»åŠ¡\&#34;&gt;å¯åŠ¨ä»»åŠ¡&lt;/h1&gt;\n&lt;p&gt;broker/src/main/java/org/apache/rocketmq/broker/transaction/queue/TransactionalMessageServiceImpl.javaç±»ä¸­ã€‚&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Override\npublic void run() {\n    log.info(&amp;quot;Start transaction check service thread!&amp;quot;);\n    long checkInterval = brokerController.getBrokerConfig().getTransactionCheckInterval();  // é»˜è®¤å€¼ä¸º60000ï¼Œå³60s\n    while (!this.isStopped()) {\n        this.waitForRunning(checkInterval);\n    }\n    log.info(&amp;quot;End transaction check service thread!&amp;quot;);\n}\n\n@Override\nprotected void onWaitEnd() {\n    long timeout = brokerController.getBrokerConfig().getTransactionTimeOut();\n    int checkMax = brokerController.getBrokerConfig().getTransactionCheckMax();\n    long begin = System.currentTimeMillis();\n    log.info(&amp;quot;Begin to check prepare message, begin time:{}&amp;quot;, begin);\n    // è°ƒç”¨chekcæ–¹æ³•\n    this.brokerController.getTransactionalMessageService().check(timeout, checkMax, this.brokerController.getTransactionalMessageCheckListener());\n    log.info(&amp;quot;End to check prepare message, consumed time:{}&amp;quot;, System.currentTimeMillis() - begin);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;è¿™é‡Œé‡‡ç”¨äº†æ¨¡æ¿è®¾è®¡æ¨¡å¼ï¼Œé‡å†™äº†&lt;code&gt;run()&lt;/code&gt;å’Œ&lt;code&gt;onWaitEnd()&lt;/code&gt;ä¸¤ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­å¯ä»¥çœ‹åˆ°&lt;code&gt;onWaitEnd()&lt;/code&gt;æ–¹æ³•ä¸­è°ƒç”¨äº†&lt;code&gt;check()&lt;/code&gt;æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨å“ªé‡Œè°ƒç”¨äº†è¿™ä¸ªonWaitEnd()æ–¹æ³•å‘¢ï¼Ÿçœ‹ä¸‹&lt;code&gt;waitForRunning()&lt;/code&gt;æ–¹æ³•ï¼Œåœ¨&lt;code&gt;src/main/java/org/apache/rocketmq/common/ServiceThread.java&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;protected void waitForRunning(long interval) {\n    if (hasNotified.compareAndSet(true, false)) {\n        // è°ƒç”¨å­ç±»é‡å†™çš„é€»è¾‘\n        this.onWaitEnd();\n        return;\n    }\n\n    //entry to wait\n    waitPoint.reset();\n\n    try {\n        // ç­‰å¾…\n        waitPoint.await(interval, TimeUnit.MILLISECONDS);\n    } catch (InterruptedException e) {\n        log.error(&amp;quot;Interrupted&amp;quot;, e);\n    } finally {\n        hasNotified.set(false);\n        this.onWaitEnd();\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;æ€»ç»“å°±æ˜¯ä»¥é»˜è®¤60sçš„é—´éš”æ‰§è¡Œä¸€æ¬¡check()æ–¹æ³•ï¼Œcheck()æ–¹æ³•å°±æ˜¯å®šæ—¶å›æŸ¥æ–¹æ³•ï¼Œä¸‹é¢çœ‹ä¸‹ã€‚&lt;/p&gt;\n&lt;h1 id=\&#34;check-æµç¨‹\&#34;&gt;check æµç¨‹&lt;/h1&gt;\n&lt;p&gt;broker/src/main/java/org/apache/rocketmq/broker/transaction/queue/TransactionalMessageServiceImpl.javaç±»ä¸­,å…ˆçœ‹ä¸‹å…¨éƒ¨çš„ä»£ç ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Override\n    public void check(long transactionTimeout, int transactionCheckMax, AbstractTransactionalMessageCheckListener listener) {\n        try {\n            // å®šä¹‰topicä¸º&amp;quot;RMQ_SYS_TRANS_HALF_TOPIC&amp;quot;\n            String topic = TopicValidator.RMQ_SYS_TRANS_HALF_TOPIC;\n            // è·å–halfé˜Ÿåˆ—\n            Set&amp;lt;MessageQueue&amp;gt; msgQueues = transactionalMessageBridge.fetchMessageQueues(topic);\n            if (msgQueues == null || msgQueues.size() == 0) {\n                log.warn(&amp;quot;The queue of topic is empty :&amp;quot; + topic);\n                return;\n            }\n            log.debug(&amp;quot;Check topic={}, queues={}&amp;quot;, topic, msgQueues);\n            for (MessageQueue messageQueue : msgQueues) {\n                long startTime = System.currentTimeMillis();\n                // è·å–opQueue\n                MessageQueue opQueue = getOpQueue(messageQueue);\n                // è·å–halfé˜Ÿåˆ—çš„æ¶ˆè´¹offset\n                long halfOffset = transactionalMessageBridge.fetchConsumeOffset(messageQueue);\n                // è·å–opé˜Ÿåˆ—çš„offset\n                long opOffset = transactionalMessageBridge.fetchConsumeOffset(opQueue);\n                log.info(&amp;quot;Before check, the queue={} msgOffset={} opOffset={}&amp;quot;, messageQueue, halfOffset, opOffset);\n                if (halfOffset &amp;lt; 0 || opOffset &amp;lt; 0) {\n                    log.error(&amp;quot;MessageQueue: {} illegal offset read: {}, op offset: {},skip this queue&amp;quot;, messageQueue, halfOffset, opOffset);\n                    continue;\n                }\n\n                List&amp;lt;Long/*å¤„ç†è¿‡å¾—opQueueçš„offset*/&amp;gt; doneOpOffset = new ArrayList&amp;lt;&amp;gt;();\n                HashMap&amp;lt;Long/*halfQueue offset*/, Long/*opQueue offset*/&amp;gt; removeMap = new HashMap&amp;lt;&amp;gt;();  //å­˜å‚¨å·²ç»å¤„ç†è¿‡,ä½†è¿˜æœªæ·»åŠ åˆ°doneOpOffsetä¸­çš„æ¶ˆæ¯\n                // å°†å·²å¤„ç†ä½†æœªæ›´æ–°çš„æ¶ˆæ¯ä¿å­˜åˆ°removeMapä¸­ï¼Œåç»­è¿›è¡Œåˆ¤æ–­æ—¶éœ€è¦\n                PullResult pullResult = fillOpRemoveMap(removeMap, opQueue, opOffset, halfOffset, doneOpOffset);\n                if (null == pullResult) {\n                    log.error(&amp;quot;The queue={} check msgOffset={} with opOffset={} failed, pullResult is null&amp;quot;, messageQueue, halfOffset, opOffset);\n                    continue;\n                }\n                int getMessageNullCount = 1;  //è·å–ç©ºæ¶ˆæ¯çš„æ¬¡æ•°\n                long newOffset = halfOffset;  //å½“å‰å¤„ç†halfé˜Ÿåˆ—çš„æœ€æ–°è¿›åº¦\n                long i = halfOffset; //å½“å‰å¤„ç†æ¶ˆæ¯çš„halfé˜Ÿåˆ—åç§»é‡\n                while (true) {\n                    // æ£€æŸ¥å½“å‰ä»»åŠ¡çš„æ—¶é—´ç‰‡æ˜¯å¦ç”¨å®Œ\n                    if (System.currentTimeMillis() - startTime &amp;gt; MAX_PROCESS_TIME_LIMIT) {\n                        log.info(&amp;quot;Queue={} process time reach max={}&amp;quot;, messageQueue, MAX_PROCESS_TIME_LIMIT);\n                        break;\n                    }\n                    // å¦‚æœhalfæ¶ˆæ¯å·²ç»è¢«å¤„ç†è¿‡,ç»§ç»­å¤„ç†ä¸‹ä¸€æ¡æ¶ˆæ¯\n                    if (removeMap.containsKey(i)) {\n                        log.debug(&amp;quot;Half offset {} has been committed/rolled back&amp;quot;, i);\n                        Long removedOpOffset = removeMap.remove(i);\n                        doneOpOffset.add(removedOpOffset);\n                    } else {\n                        // æ ¹æ®halfé˜Ÿåˆ—æ¶ˆè´¹offsetè·å–æ¶ˆæ¯\n                        GetResult getResult = getHalfMsg(messageQueue, i);\n                        MessageExt msgExt = getResult.getMsg();\n                        if (msgExt == null) {\n                            // æ˜¯å¦æœ€å¤§é‡è¯•æ¬¡æ•°\n                            if (getMessageNullCount++ &amp;gt; MAX_RETRY_COUNT_WHEN_HALF_NULL) {\n                                break;\n                            }\n                            if (getResult.getPullResult().getPullStatus() == PullStatus.NO_NEW_MSG) {\n                                log.debug(&amp;quot;No new msg, the miss offset={} in={}, continue check={}, pull result={}&amp;quot;, i, messageQueue, getMessageNullCount, getResult.getPullResult());\n                                break;\n                            } else {\n                                log.info(&amp;quot;Illegal offset, the miss offset={} in={}, continue check={}, pull result={}&amp;quot;, i, messageQueue, getMessageNullCount, getResult.getPullResult());\n                                i = getResult.getPullResult().getNextBeginOffset();\n                                newOffset = i;\n                                continue;\n                            }\n                        }\n\n                        // å¦‚æœè¶…è¿‡å­˜å‚¨æ—¶é—´(é»˜è®¤3å¤©)æˆ–è€…è¶…è¿‡å›æŸ¥æ—¶é—´(é»˜è®¤15æ¬¡)\n                        if (needDiscard(msgExt, transactionCheckMax) || needSkip(msgExt)) {\n                            listener.resolveDiscardMsg(msgExt);\n                            newOffset = i + 1;\n                            i++;\n                            continue;\n                        }\n\n                        // å¦‚æœå­˜å‚¨æ—¶é—´å¤§äºå¼€å§‹æ—¶é—´ï¼Œä¸å¤„ç†\n                        if (msgExt.getStoreTimestamp() &amp;gt;= startTime) {\n                            log.debug(&amp;quot;Fresh stored. the miss offset={}, check it later, store={}&amp;quot;, i, new Date(msgExt.getStoreTimestamp()));\n                            break;\n                        }\n\n                        long valueOfCurrentMinusBorn = System.currentTimeMillis() - msgExt.getBornTimestamp();  //æ¶ˆæ¯å·²å­˜å‚¨æ—¶é—´\n                        long checkImmunityTime = transactionTimeout; //ç«‹å³æ£€æµ‹äº‹åŠ¡æ¶ˆæ¯çš„æ—¶é—´\n                        String checkImmunityTimeStr = msgExt.getUserProperty(MessageConst.PROPERTY_CHECK_IMMUNITY_TIME_IN_SECONDS); //è·å–æ¶ˆæ¯çš„æœ€æ™šå›æŸ¥æ—¶é—´\n                        if (null != checkImmunityTimeStr) {\n                            checkImmunityTime = getImmunityTime(checkImmunityTimeStr, transactionTimeout);\n                            // å¦‚æœæœªåˆ°å›æŸ¥æ—¶é—´ï¼Œä¸å¤„ç†\n                            if (valueOfCurrentMinusBorn &amp;lt; checkImmunityTime) {\n                                if (checkPrepareQueueOffset(removeMap, doneOpOffset, msgExt)) {\n                                    newOffset = i + 1;\n                                    i++;\n                                    continue;\n                                }\n                            }\n                        } else {\n                            if ((0 &amp;lt;= valueOfCurrentMinusBorn) &amp;amp;&amp;amp; (valueOfCurrentMinusBorn &amp;lt; checkImmunityTime)) {\n                                log.debug(&amp;quot;New arrived, the miss offset={}, check it later checkImmunity={}, born={}&amp;quot;, i, checkImmunityTime, new Date(msgExt.getBornTimestamp()));\n                                break;\n                            }\n                        }\n\n                        // è·å–æ¶ˆæ¯åˆ—è¡¨\n                        List&amp;lt;MessageExt&amp;gt; opMsg = pullResult.getMsgFoundList();\n                        // åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œå›æŸ¥\n                        boolean isNeedCheck = (opMsg == null &amp;amp;&amp;amp; valueOfCurrentMinusBorn &amp;gt; checkImmunityTime) || (opMsg != null &amp;amp;&amp;amp; (opMsg.get(opMsg.size() - 1).getBornTimestamp() - startTime &amp;gt; transactionTimeout)) || (valueOfCurrentMinusBorn &amp;lt;= -1);\n                        if (isNeedCheck) {\n                            // æ¶ˆæ¯é‡æ–°putåˆ°halfQueueä¸­\n                            if (!putBackHalfMsgQueue(msgExt, i)) {\n                                continue;\n                            }\n                            // æ‰§è¡Œå›æŸ¥\n                            listener.resolveHalfMsg(msgExt);\n                        } else {\n                            pullResult = fillOpRemoveMap(removeMap, opQueue, pullResult.getNextBeginOffset(), halfOffset, doneOpOffset);\n                            log.debug(&amp;quot;The miss offset:{} in messageQueue:{} need to get more opMsg, result is:{}&amp;quot;, i, messageQueue, pullResult);\n                            continue;\n                        }\n                    }\n                    newOffset = i + 1;\n                    i++;\n                }\n                if (newOffset != halfOffset) {\n                    // æ›´æ–°halfQueueæ¶ˆè´¹è¿›åº¦\n                    transactionalMessageBridge.updateConsumeOffset(messageQueue, newOffset);\n                }\n                long newOpOffset = calculateOpOffset(doneOpOffset, opOffset);\n                if (newOpOffset != opOffset) {\n                    // æ›´æ–°opQueueæ¶ˆè´¹è¿›åº¦\n                    transactionalMessageBridge.updateConsumeOffset(opQueue, newOpOffset);\n                }\n            }\n        } catch (Throwable e) {\n            log.error(&amp;quot;Check error&amp;quot;, e);\n        }\n\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ä»£ç å¤ªå¤šäº†ï¼Œä¸€ä¸ªä¸ªæ‹†è§£åˆ†æï¼š&lt;/p&gt;\n&lt;h2 id=\&#34;è·å–halfé˜Ÿåˆ—\&#34;&gt;è·å–halfé˜Ÿåˆ—&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;// å®šä¹‰topicä¸º&amp;quot;RMQ_SYS_TRANS_HALF_TOPIC&amp;quot;\nString topic = TopicValidator.RMQ_SYS_TRANS_HALF_TOPIC;\n// è·å–halfé˜Ÿåˆ—\nSet&amp;lt;MessageQueue&amp;gt; msgQueues = transactionalMessageBridge.fetchMessageQueues(topic);\nif (msgQueues == null || msgQueues.size() == 0) {\n    log.warn(&amp;quot;The queue of topic is empty :&amp;quot; + topic);\n    return;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;åœ¨rocketmqä¸­ï¼Œæ‰€æœ‰äº‹åŠ¡æ¶ˆæ¯ä¼šä¿å­˜åœ¨ä¸¤ä¸ªtopicé˜Ÿåˆ—ä¸­ï¼Œåˆ†åˆ«æ˜¯&lt;code&gt;RMQ_SYS_TRANS_HALF_TOPIC&lt;/code&gt;ï¼ˆç®€ç§°halfQueueï¼‰å’Œ&lt;code&gt;RMQ_SYS_TRANS_OP _HALF _TOPIC&lt;/code&gt;ï¼ˆç®€ç§°opQueueï¼‰&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;RMQ_SYS_TRANS _HALF _TOPIC : ä¿å­˜ half æ¶ˆæ¯&lt;/li&gt;\n&lt;li&gt;RMQ_SYS_TRANS_OP _HALF _TOPIC : å½“ halfæ¶ˆæ¯æ”¶åˆ° commit/rollback åï¼Œä¼šä¿å­˜åˆ°opQueueä¸­&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;å®šä¹‰åç§»é‡\&#34;&gt;å®šä¹‰åç§»é‡&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;// å¼€å§‹æ—¶é—´\nlong startTime = System.currentTimeMillis();\n// è·å–opQueue\nMessageQueue opQueue = getOpQueue(messageQueue);\n// è·å–halfé˜Ÿåˆ—çš„æ¶ˆè´¹offset\nlong halfOffset = transactionalMessageBridge.fetchConsumeOffset(messageQueue);\n// è·å–opé˜Ÿåˆ—çš„offset\nlong opOffset = transactionalMessageBridge.fetchConsumeOffset(opQueue);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;startTime : ä½œç”¨æ˜¯è®°å½•å½“å‰æ—¶é—´ï¼Œåç»­åœ¨åˆ¤æ–­ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´æ—¶éœ€è¦&lt;/li&gt;\n&lt;li&gt;opQueue : å³&lt;code&gt;RMQ_SYS_TRANS_OP_HALF_TOPIC&lt;/code&gt;é˜Ÿåˆ—ï¼Œä¿å­˜å·²å¤„ç†è¿‡çš„æ¶ˆæ¯ã€‚&lt;/li&gt;\n&lt;li&gt;halfOffset ï¼š halfQueue ä¸­çš„æ¶ˆè´¹è®°å½•ä½ç½®ï¼Œå¯ä»¥ä¿è¯çš„halfOffsetä¹‹åçš„æ¶ˆæ¯æ‰éœ€è¦è¿›è¡Œå›æŸ¥æ“ä½œ&lt;/li&gt;\n&lt;li&gt;opOffset : opQueueä¸­çš„æ¶ˆè´¹è®°å½•ï¼Œå¤§äºopOffsetçš„æ¶ˆæ¯å°±æ˜¯è·ç¦»ä¸Šæ¬¡å®šæ—¶å›æŸ¥ä»»åŠ¡ç»“æŸåï¼Œè¿™æ®µæ—¶é—´æ–°å¢çš„æ¶ˆæ¯ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;æ ‡è®°å·²å¤„ç†æ¶ˆæ¯\&#34;&gt;æ ‡è®°å·²å¤„ç†æ¶ˆæ¯&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;List&amp;lt;Long/*å¤„ç†è¿‡å¾—opQueueçš„offset*/&amp;gt; doneOpOffset = new ArrayList&amp;lt;&amp;gt;();\nHashMap&amp;lt;Long/*halfQueue offset*/, Long/*opQueue offset*/&amp;gt; removeMap = new HashMap&amp;lt;&amp;gt;();  //å­˜å‚¨å·²ç»å¤„ç†è¿‡,ä½†è¿˜æœªæ·»åŠ åˆ°doneOpOffsetä¸­çš„æ¶ˆæ¯\n// å°†å·²å¤„ç†ä½†æœªæ›´æ–°çš„æ¶ˆæ¯ä¿å­˜åˆ°removeMapä¸­ï¼Œåç»­è¿›è¡Œåˆ¤æ–­æ—¶éœ€è¦\nPullResult pullResult = fillOpRemoveMap(removeMap, opQueue, opOffset, halfOffset, doneOpOffset);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;doneOpOffset: ä¿å­˜opQueueä¸­å·²ç»å¤„ç†è¿‡å¾—æ¶ˆæ¯çš„offsetï¼Œåç»­æ›´æ–°opQueueçš„offsetæ—¶å€™è¦ä½¿ç”¨&lt;/li&gt;\n&lt;li&gt;removeMap : ä¿å­˜å·²ç»ä¿å­˜åˆ°opQueueä¸­ï¼Œä½†ä»åœ¨halfQueueä¸­çš„æ¶ˆæ¯ï¼Œåç»­åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦éœ€è¦å›æŸ¥æ—¶çš„ä¾æ®ä¹‹ä¸€ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;fillopremove\&#34;&gt;fillOpRemove()&lt;/h3&gt;\n&lt;p&gt;æ–¹æ³•çš„ç›®çš„å°±æ˜¯å¡«å……å·²å¤„ç†çš„æ¶ˆæ¯åˆ° removeMap&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;private PullResult fillOpRemoveMap(HashMap&amp;lt;Long, Long&amp;gt; removeMap, MessageQueue opQueue, long pullOffsetOfOp, long miniOffset, List&amp;lt;Long&amp;gt; doneOpOffset) {\n    // step1 : è·å–opæ¶ˆæ¯,æ‹‰å–32æ¡æ¶ˆæ¯\n    PullResult pullResult = pullOpMsg(opQueue, pullOffsetOfOp, 32);\n    if (null == pullResult) {\n        return null;\n    }\n    // step2 : åˆ¤æ–­çŠ¶æ€\n    if (pullResult.getPullStatus() == PullStatus.OFFSET_ILLEGAL || pullResult.getPullStatus() == PullStatus.NO_MATCHED_MSG) {\n        log.warn(&amp;quot;The miss op offset={} in queue={} is illegal, pullResult={}&amp;quot;, pullOffsetOfOp, opQueue, pullResult);\n        transactionalMessageBridge.updateConsumeOffset(opQueue, pullResult.getNextBeginOffset());\n        return pullResult;\n    } else if (pullResult.getPullStatus() == PullStatus.NO_NEW_MSG) { //æ²¡æœ‰æ–°æ¶ˆæ¯\n        log.warn(&amp;quot;The miss op offset={} in queue={} is NO_NEW_MSG, pullResult={}&amp;quot;, pullOffsetOfOp, opQueue, pullResult);\n        return pullResult;\n    }\n    List&amp;lt;MessageExt&amp;gt; opMsg = pullResult.getMsgFoundList();\n    if (opMsg == null) {\n        log.warn(&amp;quot;The miss op offset={} in queue={} is empty, pullResult={}&amp;quot;, pullOffsetOfOp, opQueue, pullResult);\n        return pullResult;\n    }\n    // step3 : éå†æ‰€æœ‰æ¶ˆæ¯\n    for (MessageExt opMessageExt : opMsg) {\n        // è·å–opQueueçš„offset\n        Long queueOffset = getLong(new String(opMessageExt.getBody(), TransactionalMessageUtil.charset));\n        log.debug(&amp;quot;Topic: {} tags: {}, OpOffset: {}, HalfOffset: {}&amp;quot;, opMessageExt.getTopic(), opMessageExt.getTags(), opMessageExt.getQueueOffset(), queueOffset);\n        if (TransactionalMessageUtil.REMOVETAG.equals(opMessageExt.getTags())) {\n            if (queueOffset &amp;lt; miniOffset) {\n                // æ­£å¸¸æƒ…å†µï¼ŒopQueueé‡Œçš„æ¶ˆæ¯åœ¨halfQueueä¸­offsetè¦å°äºå½“å‰halfQueueçš„offset\n                doneOpOffset.add(opMessageExt.getQueueOffset());\n            } else {\n                // æ¶ˆæ¯å·²ç»å­˜å‚¨åˆ°opQueueä¸­ï¼Œä½†æ˜¯halfQueueä¸­çš„offsetè¿˜æ²¡æœ‰æ›´æ–°\n                // ä¿å­˜åˆ°removeMapä¸­ï¼Œé˜²æ­¢åç»­é‡å¤è¿›è¡Œå›æŸ¥æ“ä½œ\n                removeMap.put(queueOffset, opMessageExt.getQueueOffset());\n            }\n        } else {\n            log.error(&amp;quot;Found a illegal tag in opMessageExt= {} &amp;quot;, opMessageExt);\n        }\n    }\n    log.debug(&amp;quot;Remove map: {}&amp;quot;, removeMap);\n    log.debug(&amp;quot;Done op list: {}&amp;quot;, doneOpOffset);\n    return pullResult;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;å®šä¹‰å˜é‡\&#34;&gt;å®šä¹‰å˜é‡&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;int getMessageNullCount = 1;  //è·å–ç©ºæ¶ˆæ¯çš„æ¬¡æ•°\nlong newOffset = halfOffset;  //å½“å‰å¤„ç†halfé˜Ÿåˆ—çš„æœ€æ–°è¿›åº¦\nlong i = halfOffset; //å½“å‰å¤„ç†æ¶ˆæ¯çš„halfé˜Ÿåˆ—åç§»é‡\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;getMessageNullCount : rocketMQå…è®¸è¿›è¡Œé‡è¯•ï¼Œè¯¥å­—æ®µæ˜¯é‡è¯•æ¬¡æ•°åˆ¤æ–­çš„ä¾æ®&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;åˆ¤æ–­æ˜¯å¦æ»¡è¶³å›æŸ¥æ¡ä»¶\&#34;&gt;åˆ¤æ–­æ˜¯å¦æ»¡è¶³å›æŸ¥æ¡ä»¶&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;// æ£€æŸ¥å½“å‰ä»»åŠ¡çš„æ—¶é—´ç‰‡æ˜¯å¦ç”¨å®Œ\nif (System.currentTimeMillis() - startTime &amp;gt; MAX_PROCESS_TIME_LIMIT) {\n    log.info(&amp;quot;Queue={} process time reach max={}&amp;quot;, messageQueue, MAX_PROCESS_TIME_LIMIT);\n    break;\n}\n// å¦‚æœhalfæ¶ˆæ¯å·²ç»è¢«å¤„ç†è¿‡,ç»§ç»­å¤„ç†ä¸‹ä¸€æ¡æ¶ˆæ¯\nif (removeMap.containsKey(i)) {\n    log.debug(&amp;quot;Half offset {} has been committed/rolled back&amp;quot;, i);\n    Long removedOpOffset = removeMap.remove(i);\n    doneOpOffset.add(removedOpOffset);\n} else {\n    // æ ¹æ®halfé˜Ÿåˆ—æ¶ˆè´¹offsetè·å–æ¶ˆæ¯\n    GetResult getResult = getHalfMsg(messageQueue, i);\n    MessageExt msgExt = getResult.getMsg();\n    if (msgExt == null) {\n        // æ˜¯å¦æœ€å¤§é‡è¯•æ¬¡æ•°\n        if (getMessageNullCount++ &amp;gt; MAX_RETRY_COUNT_WHEN_HALF_NULL) {\n            break;\n        }\n        if (getResult.getPullResult().getPullStatus() == PullStatus.NO_NEW_MSG) {\n            log.debug(&amp;quot;No new msg, the miss offset={} in={}, continue check={}, pull result={}&amp;quot;, i, messageQueue, getMessageNullCount, getResult.getPullResult());\n            break;\n        } else {\n            log.info(&amp;quot;Illegal offset, the miss offset={} in={}, continue check={}, pull result={}&amp;quot;, i, messageQueue, getMessageNullCount, getResult.getPullResult());\n            i = getResult.getPullResult().getNextBeginOffset();\n            newOffset = i;\n            continue;\n        }\n    }\n\n    // å¦‚æœè¶…è¿‡å­˜å‚¨æ—¶é—´(é»˜è®¤3å¤©)æˆ–è€…è¶…è¿‡å›æŸ¥æ—¶é—´(é»˜è®¤15æ¬¡)\n    if (needDiscard(msgExt, transactionCheckMax) || needSkip(msgExt)) {\n        listener.resolveDiscardMsg(msgExt);\n        newOffset = i + 1;\n        i++;\n        continue;\n    }\n\n    // å¦‚æœå­˜å‚¨æ—¶é—´å¤§äºå¼€å§‹æ—¶é—´ï¼Œä¸å¤„ç†\n    if (msgExt.getStoreTimestamp() &amp;gt;= startTime) {\n        log.debug(&amp;quot;Fresh stored. the miss offset={}, check it later, store={}&amp;quot;, i, new Date(msgExt.getStoreTimestamp()));\n        break;\n    }\n\n    long valueOfCurrentMinusBorn = System.currentTimeMillis() - msgExt.getBornTimestamp();  //æ¶ˆæ¯å·²å­˜å‚¨æ—¶é—´\n    long checkImmunityTime = transactionTimeout; //ç«‹å³æ£€æµ‹äº‹åŠ¡æ¶ˆæ¯çš„æ—¶é—´\n    String checkImmunityTimeStr = msgExt.getUserProperty(MessageConst.PROPERTY_CHECK_IMMUNITY_TIME_IN_SECONDS); //è·å–æ¶ˆæ¯çš„æœ€æ™šå›æŸ¥æ—¶é—´\n    if (null != checkImmunityTimeStr) {\n        checkImmunityTime = getImmunityTime(checkImmunityTimeStr, transactionTimeout);\n        // å¦‚æœæœªåˆ°å›æŸ¥æ—¶é—´ï¼Œä¸å¤„ç†\n        if (valueOfCurrentMinusBorn &amp;lt; checkImmunityTime) {\n            if (checkPrepareQueueOffset(removeMap, doneOpOffset, msgExt)) {\n                newOffset = i + 1;\n                i++;\n                continue;\n            }\n        }\n    } else {\n        if ((0 &amp;lt;= valueOfCurrentMinusBorn) &amp;amp;&amp;amp; (valueOfCurrentMinusBorn &amp;lt; checkImmunityTime)) {\n            log.debug(&amp;quot;New arrived, the miss offset={}, check it later checkImmunity={}, born={}&amp;quot;, i, checkImmunityTime, new Date(msgExt.getBornTimestamp()));\n            break;\n        }\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ä»»åŠ¡æ—¶é—´ç‰‡æœºåˆ¶ï¼šåœ¨rocketmqä¸­ï¼Œæœ‰ä¸€ç§é€šç”¨çš„è®¾è®¡æ–¹æ¡ˆå°±æ˜¯ç»™ä»»åŠ¡åˆ†é…æ—¶é—´ç‰‡ï¼Œ å¦‚æœæ—¶é—´ç‰‡ç”¨å®Œåˆ™ç›´æ¥é€€å‡ºã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;æ‰§è¡Œå›æŸ¥\&#34;&gt;æ‰§è¡Œå›æŸ¥&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;// è·å–æ¶ˆæ¯åˆ—è¡¨\nList&amp;lt;MessageExt&amp;gt; opMsg = pullResult.getMsgFoundList();\n// åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œå›æŸ¥\nboolean isNeedCheck = (opMsg == null &amp;amp;&amp;amp; valueOfCurrentMinusBorn &amp;gt; checkImmunityTime) || (opMsg != null &amp;amp;&amp;amp; (opMsg.get(opMsg.size() - 1).getBornTimestamp() - startTime &amp;gt; transactionTimeout)) || (valueOfCurrentMinusBorn &amp;lt;= -1);\nif (isNeedCheck) {\n    // æ¶ˆæ¯é‡æ–°putåˆ°halfQueueä¸­\n    if (!putBackHalfMsgQueue(msgExt, i)) {\n        continue;\n    }\n    // æ‰§è¡Œå›æŸ¥\n    listener.resolveHalfMsg(msgExt);\n} else {\n    pullResult = fillOpRemoveMap(removeMap, opQueue, pullResult.getNextBeginOffset(), halfOffset, doneOpOffset);\n    log.debug(&amp;quot;The miss offset:{} in messageQueue:{} need to get more opMsg, result is:{}&amp;quot;, i, messageQueue, pullResult);\n    continue;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å…¶ä¸­æ¯”è¾ƒé‡è¦çš„ä¸¤ä¸ªéƒ¨åˆ†ï¼Œ&lt;code&gt;putBackHalfMsgQueue()&lt;/code&gt;å’Œ&lt;code&gt;resolveHalfMsg()&lt;/code&gt;&lt;/p&gt;\n&lt;h3 id=\&#34;putbackhalfmsgqueue\&#34;&gt;putBackHalfMsgQueue()&lt;/h3&gt;\n&lt;p&gt;è¿™é‡Œæ¶ˆæ¯ä¼šé‡å†™è¿½åŠ åˆ°commitlogä¸­ï¼Œè®¾è®¡å·§å¦™ä¹‹å¤„ï¼š&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;å‘é€å›æŸ¥çš„æ¥å£æ˜¯å¼‚æ­¥çš„ï¼Œå°†æ¶ˆæ¯é‡å†™è¿½åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œä¸‹ä¸€æ¬¡å›æŸ¥çš„æ—¶å€™è¿˜èƒ½è·å–åˆ°è¯¥æ¶ˆæ¯ã€‚å¦‚æœå›æŸ¥æœ‰ç»“æœï¼Œæ¶ˆæ¯å°±ä¼šä¿å­˜åˆ°opQueueä¸­ï¼Œè¿™æ ·ä¹Ÿä¼šåœ¨fillOpRemove()ä¸­è¢«è¿‡æ»¤æ‰ï¼Œä¸å½±å“ã€‚&lt;/li&gt;\n&lt;li&gt;æ¯æ¬¡è¿›è¡Œå›æŸ¥æ¶ˆæ¯éƒ½è¦ä¿®æ”¹æ¶ˆæ¯çš„å›æŸ¥æ¬¡æ•°å±æ€§ï¼Œä½¿ç”¨é¡ºåºå†™çš„æ€§èƒ½è¦é«˜äºä¿®æ”¹å·²å­˜å‚¨æ¶ˆæ¯çš„æ€§èƒ½ã€‚&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;private boolean putBackHalfMsgQueue(MessageExt msgExt, long offset) {\n    // å†æ¬¡å°†æ¶ˆæ¯å­˜å‚¨åˆ°commitlogä¸­\n    PutMessageResult putMessageResult = putBackToHalfQueueReturnResult(msgExt);\n    // å­˜å‚¨æˆåŠŸä¿®æ”¹æ¶ˆæ¯çš„å±æ€§\n    if (putMessageResult != null &amp;amp;&amp;amp; putMessageResult.getPutMessageStatus() == PutMessageStatus.PUT_OK) {\n        // è®¾ç½®æ–°çš„æ¶ˆè´¹é˜Ÿåˆ—é€»è¾‘offset\n        msgExt.setQueueOffset(putMessageResult.getAppendMessageResult().getLogicsOffset());\n        // è®¾ç½®æ–°çš„commitlogçš„offset\n        msgExt.setCommitLogOffset(putMessageResult.getAppendMessageResult().getWroteOffset());\n        // è®¾ç½®æ–°çš„msgId\n        msgExt.setMsgId(putMessageResult.getAppendMessageResult().getMsgId());\n        log.debug(&amp;quot;Send check message, the offset={} restored in queueOffset={} &amp;quot; + &amp;quot;commitLogOffset={} &amp;quot; + &amp;quot;newMsgId={} realMsgId={} topic={}&amp;quot;, offset, msgExt.getQueueOffset(), msgExt.getCommitLogOffset(), msgExt.getMsgId(), msgExt.getUserProperty(MessageConst.PROPERTY_UNIQ_CLIENT_MESSAGE_ID_KEYIDX), msgExt.getTopic());\n        return true;\n    } else {\n        log.error(&amp;quot;PutBackToHalfQueueReturnResult write failed, topic: {}, queueId: {}, &amp;quot; + &amp;quot;msgId: {}&amp;quot;, msgExt.getTopic(), msgExt.getQueueId(), msgExt.getMsgId());\n        return false;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;æ›´æ–°ç´¢å¼•\&#34;&gt;æ›´æ–°ç´¢å¼•&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;if (newOffset != halfOffset) {\n    // æ›´æ–°halfQueueæ¶ˆè´¹è¿›åº¦\n    transactionalMessageBridge.updateConsumeOffset(messageQueue, newOffset);\n}\n// æ ¹æ®doneOpOffset åˆ—è¡¨è·å–opQueueçš„offset\nlong newOpOffset = calculateOpOffset(doneOpOffset, opOffset);\nif (newOpOffset != opOffset) {\n    // æ›´æ–°opQueueæ¶ˆè´¹è¿›åº¦\n    transactionalMessageBridge.updateConsumeOffset(opQueue, newOpOffset);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;code&gt;calculateOpOffset()&lt;/code&gt;æ–¹æ³•ç®€å•è¯´è¿”å›å°±æ˜¯doneOffsetåˆ—è¡¨ä¸­æœ€åä¸€ä¸ªå€¼ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;private long calculateOpOffset(List&amp;lt;Long&amp;gt; doneOffset, long oldOffset) {\n    Collections.sort(doneOffset);\n    long newOffset = oldOffset;\n    for (int i = 0; i &amp;lt; doneOffset.size(); i++) {\n        if (doneOffset.get(i) == newOffset) {\n            newOffset++;\n        } else {\n            break;\n        }\n    }\n    return newOffset;\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c075a3fc1d8440d5abf8ad13e2622179~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&#34;,&#34;fileName&#34;:&#34;rocketmq491-yuan-ma-fen-xi-_shi-wu-broker-ding-shi-hui-cha&#34;,&#34;abstract&#34;:&#34;&lt;h1 id=\&#34;å¯åŠ¨ä»»åŠ¡\&#34;&gt;å¯åŠ¨ä»»åŠ¡&lt;/h1&gt;\n&lt;p&gt;broker/src/main/java/org/apache/rocketmq/broker/transaction/queue/TransactionalMessageServiceImpl.javaç±»ä¸­ã€‚&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;RocketMQ4.9.1æºç åˆ†æ_(äº‹åŠ¡)brokerå®šæ—¶å›æŸ¥&#34;,&#34;tags&#34;:[{&#34;index&#34;:-1,&#34;name&#34;:&#34;RocketMQ&#34;,&#34;slug&#34;:&#34;_Ywd8fi71&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/_Ywd8fi71/&#34;},{&#34;name&#34;:&#34;æºç &#34;,&#34;slug&#34;:&#34;yuan-ma&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/yuan-ma/&#34;}],&#34;date&#34;:&#34;2021-10-01 21:02:08&#34;,&#34;dateFormat&#34;:&#34;2021-10-01 09:02:08&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/rocketmq491-yuan-ma-fen-xi-_shi-wu-broker-ding-shi-hui-cha/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;14 min read&#34;,&#34;time&#34;:805000,&#34;words&#34;:2731,&#34;minutes&#34;:14},&#34;description&#34;:&#34;å¯åŠ¨ä»»åŠ¡\nbroker/src/main/java/org/apache/rocketmq/broker/transaction/queue/TransactionalMessageServiceImpl.javaç±»ä¸­ã€‚\n\n@Overrid...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%90%AF%E5%8A%A8%E4%BB%BB%E5%8A%A1\&#34;&gt;å¯åŠ¨ä»»åŠ¡&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#check-%E6%B5%81%E7%A8%8B\&#34;&gt;check æµç¨‹&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%8E%B7%E5%8F%96half%E9%98%9F%E5%88%97\&#34;&gt;è·å–halfé˜Ÿåˆ—&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%9A%E4%B9%89%E5%81%8F%E7%A7%BB%E9%87%8F\&#34;&gt;å®šä¹‰åç§»é‡&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A0%87%E8%AE%B0%E5%B7%B2%E5%A4%84%E7%90%86%E6%B6%88%E6%81%AF\&#34;&gt;æ ‡è®°å·²å¤„ç†æ¶ˆæ¯&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#fillopremove\&#34;&gt;fillOpRemove()&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F\&#34;&gt;å®šä¹‰å˜é‡&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E6%BB%A1%E8%B6%B3%E5%9B%9E%E6%9F%A5%E6%9D%A1%E4%BB%B6\&#34;&gt;åˆ¤æ–­æ˜¯å¦æ»¡è¶³å›æŸ¥æ¡ä»¶&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%89%A7%E8%A1%8C%E5%9B%9E%E6%9F%A5\&#34;&gt;æ‰§è¡Œå›æŸ¥&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#putbackhalfmsgqueue\&#34;&gt;putBackHalfMsgQueue()&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9B%B4%E6%96%B0%E7%B4%A2%E5%BC%95\&#34;&gt;æ›´æ–°ç´¢å¼•&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;é¡¹ç›®åœ°å€ï¼š&lt;a href=\&#34;https://github.com/zexho994/River\&#34;&gt;https://github.com/zexho994/River&lt;/a&gt;&lt;br&gt;\nå®ç°ç›®æ ‡ï¼šæ”¯æŒå’ŒJDK Streamä¸€æ ·çš„åŠŸèƒ½, æä¾›ä¸Streamä¸€æ ·çš„APIï¼Œåç»­ä¼šè¿›è¡Œæ›´å¤šçš„APIæ‰©å±•ã€‚&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;table&gt;\n&lt;thead&gt;\n&lt;tr&gt;\n&lt;th&gt;ç±»å‹&lt;/th&gt;\n&lt;th&gt;æ–¹æ³•&lt;/th&gt;\n&lt;/tr&gt;\n&lt;/thead&gt;\n&lt;tbody&gt;\n&lt;tr&gt;\n&lt;td&gt;åˆ›å»ºæ“ä½œ&lt;/td&gt;\n&lt;td&gt;of(T...t)&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td&gt;ä¸­é—´æ“ä½œ&lt;/td&gt;\n&lt;td&gt;map()limit()sort()peek()skip()filter()distinct()&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td&gt;ç»ˆç»“æ“ä½œ&lt;/td&gt;\n&lt;td&gt;toArray()reduce()collect()max()anyMatch()findFirst()ç­‰&lt;/td&gt;\n&lt;/tr&gt;\n&lt;/tbody&gt;\n&lt;/table&gt;\n&lt;p&gt;åŒæ—¶Riverè¿˜éœ€è¦å…·å¤‡å»¶è¿Ÿå¤„ç†ï¼ˆé‡åˆ°ç»ˆç»“æ“ä½œæ‰è§¦å‘ï¼‰çš„ç‰¹æ€§ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;é¡¶å±‚æ¥å£-river\&#34;&gt;é¡¶å±‚æ¥å£-River&lt;/h2&gt;\n&lt;p&gt;åœ¨riveræ¥å£ä¸­å®šä¹‰å¥½æ‰€æœ‰éœ€è¦æ”¯æŒçš„æ–¹æ³•api&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public interface River&amp;lt;E&amp;gt; {\n\n    //===============================åˆ›å»ºæ“ä½œ=====================================\n\n    @SafeVarargs\n    static &amp;lt;T&amp;gt; River&amp;lt;T&amp;gt; of(T... t) {\n        return RiverGenerator.create(t);\n    }\n\n    static &amp;lt;T&amp;gt; River&amp;lt;T&amp;gt; of(Collection&amp;lt;T&amp;gt; collection) {\n        return RiverGenerator.create(collection);\n    }\n\n    //===============================ä¸­é—´æ“ä½œ=====================================\n\n    /**\n     * å°†æµè½¬æ¢ä¸ºå¹¶è¡Œæµ\n     *\n     * @return River\n     */\n    River&amp;lt;E&amp;gt; parallel();\n\n    /**\n     * å°†æµè½¬æ¢ä¸ºä¸²è¡Œæµ\n     *\n     * @return River\n     */\n    River&amp;lt;E&amp;gt; sequential();\n\n    /**\n     * è¿‡æ»¤æ“ä½œ\n     *\n     * @param predicate è¿‡æ»¤çš„è¡¨è¾¾å¼\n     * @return è¿‡æ»¤åçš„River\n     */\n    River&amp;lt;E&amp;gt; filter(Predicate&amp;lt;E&amp;gt; predicate);\n\n    /**\n     * å…ƒç´ å»é‡æ“ä½œ\n     *\n     * @return å»é‡åçš„River\n     */\n    River&amp;lt;E&amp;gt; distinct();\n\n    /**\n     * é™åˆ¶Riverçš„å…ƒç´ æ•°é‡\n     *\n     * @param size å…ƒç´ çš„æœ€å¤§æ•°é‡\n     * @return River\n     */\n    River&amp;lt;E&amp;gt; limit(int size);\n\n    /**\n     * æ’åº\n     *\n     * @param comparable æ¯”è¾ƒå™¨\n     * @return æ·»åŠ æ’åºåçš„River\n     */\n    River&amp;lt;E&amp;gt; sort(Comparator&amp;lt;E&amp;gt; comparable);\n\n    /**\n     * å¯¹å…ƒç´ è¿›è¡Œé¢„æ“ä½œ\n     *\n     * @param consumer æ‰§è¡Œçš„æ“ä½œ\n     * @return æ–°River\n     */\n    River&amp;lt;E&amp;gt; peek(Consumer&amp;lt;E&amp;gt; consumer);\n\n    /**\n     * è·³è¿‡æŒ‡å®šæ•°é‡çš„å…ƒç´ \n     *\n     * @param size è¦è·³è¿‡çš„å…ƒç´ æ•°\n     * @return new River\n     */\n    River&amp;lt;E&amp;gt; skip(int size);\n\n    /**\n     * å…ƒç´ è½¬æ¢æ˜ å°„\n     *\n     * @param function æ˜ å°„æ‰§è¡Œé€»è¾‘\n     * @return new River\n     */\n    &amp;lt;E_OUT&amp;gt; River&amp;lt;E_OUT&amp;gt; map(Function&amp;lt;? super E, ? extends E_OUT&amp;gt; function);\n\n    //===============================ç»ˆç»“æ“ä½œ=====================================\n\n    /**\n     * éå†Riveræ‰€æœ‰å…ƒç´ \n     *\n     * @param consumer è¡¨è¾¾å¼\n     */\n    void forEach(Consumer&amp;lt;E&amp;gt; consumer);\n\n    /**\n     * è¾“å‡ºä¸€ä¸ªæ•°ç»„\n     *\n     * @return Eç±»å‹çš„æ•°ç»„\n     */\n    Object[] toArray();\n\n    /**\n     * è¾“å‡ºå…ƒç´ åˆ°å‚æ•°æ•°ç»„ä¸­\n     *\n     * @param e æ‰¿è½½å…ƒç´ çš„æ•°ç»„\n     */\n    void toArray(E[] e);\n\n    /**\n     * è®¡ç®—å…ƒç´ çš„æ•°é‡\n     *\n     * @return Riverä¸­å…ƒç´ çš„æ•°é‡\n     */\n    long count();\n\n    /**\n     * æ“ä½œ\n     *\n     * @param identity    åˆå§‹å€¼\n     * @param accumulator æ“ä½œå‡½æ•°\n     * @return reduce result\n     */\n    E reduce(E identity, BinaryOperator&amp;lt;E&amp;gt; accumulator);\n\n    /**\n     * æ‰§è¡Œæ“ä½œ\n     *\n     * @param collector æ‰§è¡Œæ“ä½œçš„æ”¶é›†å™¨\n     * @param &amp;lt;R&amp;gt;       ç»“æœç±»å‹\n     * @param &amp;lt;A&amp;gt;       ä¸­é—´ç´¯åŠ ç±»å‹\n     * @return æ‰§è¡Œç»“æœ\n     */\n    &amp;lt;R, A&amp;gt; R collect(Collector&amp;lt;? super E, A, R&amp;gt; collector);\n\n    /**\n     * è·å–æ¯”è¾ƒåï¼Œæœ€å°çš„å…ƒç´ \n     *\n     * @param comparator æ¯”è¾ƒå™¨\n     * @return æœ€å°çš„å…ƒç´ \n     */\n    Optional&amp;lt;E&amp;gt; min(Comparator&amp;lt;? super E&amp;gt; comparator);\n\n    /**\n     * è·å–æ¯”è¾ƒåï¼Œæœ€å¤§çš„å…ƒç´ \n     *\n     * @param comparator æ¯”è¾ƒå™¨\n     * @return æœ€å¤§çš„å…ƒç´ \n     */\n    Optional&amp;lt;E&amp;gt; max(Comparator&amp;lt;? super E&amp;gt; comparator);\n\n    /**\n     * åˆ¤æ–­åŒ¹é…ï¼Œä»»æ„å³å¯\n     *\n     * @param predicate\n     * @return true:match success\n     */\n    boolean anyMatch(Predicate&amp;lt;? super E&amp;gt; predicate);\n\n    /**\n     * åˆ¤æ–­åŒ¹é…ï¼Œæ‰€æœ‰éƒ½è¦åŒ¹é…\n     *\n     * @param predicate\n     * @return\n     */\n    boolean allMatch(Predicate&amp;lt;? super E&amp;gt; predicate);\n\n    /**\n     * åˆ¤æ–­åŒ¹é…ï¼Œéƒ½ä¸è¦åŒ¹é…ä¸Š\n     *\n     * @param predicate\n     * @return\n     */\n    boolean noneMatch(Predicate&amp;lt;? super E&amp;gt; predicate);\n\n    /**\n     * è·å–ç¬¬ä¸€ä¸ªå…ƒç´ \n     *\n     * @return\n     */\n    Optional&amp;lt;E&amp;gt; findFirst();\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;riverå®ç°ç±»-abstractriverpipeline\&#34;&gt;Riverå®ç°ç±» - AbstractRiverPipeline&lt;/h2&gt;\n&lt;p&gt;Riveræ¥å£çš„å®ç°ä¸»è¦éƒ½åœ¨&lt;code&gt;AbstractRiverPipeline&lt;/code&gt;ç±»ä¸­, ä»¥&lt;code&gt;filter()&lt;/code&gt;ä¸ºä¾‹ï¼Œè¿”å›äº†ä¸€ä¸ªæ–°çš„Riverå¯¹è±¡ï¼Œå…¸å‹çš„æµå¼ç¼–ç¨‹çš„å®ç°æ–¹å¼ã€‚&lt;/p&gt;\n&lt;p&gt;æ–¹æ³•äº‹æƒ…ä¸»è¦ä¸¤ä¸ªï¼š&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;newä¸€ä¸ªæ–°çš„Riverçš„å®ç°ç±»ã€‚&lt;/li&gt;\n&lt;li&gt;åœ¨&lt;code&gt;accept()&lt;/code&gt;æ–¹æ³•ä¸­å®ç°&lt;code&gt;wrapSink()&lt;/code&gt;,è¿™ä¸ªæ–¹æ³•åœ¨åç»­æ„å»º&lt;code&gt;SinkChain&lt;/code&gt;æ—¶å€™éœ€è¦è°ƒç”¨ã€‚&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class AbstractRiverPipeline&amp;lt;I, O&amp;gt;\n        extends Pipeline&amp;lt;I, O&amp;gt; implements River&amp;lt;O&amp;gt; {\n    \n    //å­˜å‚¨å…ƒç´ çš„spliteratorå¯¹è±¡å¼•ç”¨\n    protected Spliterator sourceSpliterator;\n\n    ...\n        \n    /**\n     * è¿½åŠ filteræ“ä½œ\n     * åˆ›å»ºä¸€ä¸ªfilterçš„{@link PipelineStage},ç„¶åå°†è¯¥stageè¿½åˆ°åˆ°Pipelineçš„å°¾éƒ¨\n     *\n     * @param predicate è¿‡æ»¤çš„è¡¨è¾¾å¼\n     * @return æ–°å¢çš„filterå¯¹è±¡\n     */\n    @Override\n    public River&amp;lt;O&amp;gt; filter(Predicate&amp;lt;O&amp;gt; predicate) {\n        return new PipelineStage&amp;lt;O, O&amp;gt;(this) {\n            @Override\n            public SinkChain&amp;lt;O, O&amp;gt; wrapSink(SinkChain&amp;lt;O, ?&amp;gt; sink) {\n                SinkChain&amp;lt;O, O&amp;gt; sinkChain = new SinkChain&amp;lt;O, O&amp;gt;() {\n                    @Override\n                    public void accept(O t) {\n                        if (!predicate.test(t)) {\n                            return;\n                        }\n                        getNext().accept(t);\n                    }\n                };\n                sinkChain.setNext(sink);\n                return sinkChain;\n            }\n        };\n    }\n    \n    ...\n        \n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;è¿”å›çš„å¯¹è±¡æ˜¯&lt;code&gt;PipelineStage&lt;/code&gt;ï¼Œæ˜¯Riverçš„å­ç±»ï¼Œæ‰©å±•äº†ä¸€äº›äºSinkç›¸å…³çš„æ–¹æ³•ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;é˜¶æ®µå°è£…-pipelinestage\&#34;&gt;é˜¶æ®µå°è£…-PipelineStage&lt;/h2&gt;\n&lt;p&gt;&lt;code&gt;PipelineStage&lt;/code&gt;è¡¨ç¤ºä¸€ä¸ªé˜¶æ®µï¼Œä»€ä¹ˆæ˜¯é˜¶æ®µï¼Ÿè°ƒç”¨filter()åï¼Œå°±ç›¸å½“æ•´ä¸ªé“¾ä¸­æ·»åŠ äº†ä¸€ä¸ªé˜¶æ®µï¼Œå¯ä»¥ç†è§£ä¸ºé“¾è¡¨ä¸­çš„èŠ‚ç‚¹ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class PipelineStage&amp;lt;I, O&amp;gt; extends AbstractRiverPipeline&amp;lt;I, O&amp;gt; {\n\n    public PipelineStage(Spliterator&amp;lt;I&amp;gt; spliterator) {\n        this.setSourceSpliterator(spliterator);\n        this.isParallel = false;\n    }\n\n    /**\n     * @param river ä¸Šä¸€ä¸ªstage\n     */\n    public PipelineStage(AbstractRiverPipeline&amp;lt;?, I&amp;gt; river) {\n        previous = river;\n        isParallel = river.isParallel;\n        sourceSpliterator = river.sourceSpliterator;\n    }\n\n    public Object[] getArray() {\n        throw new UnsupportedOperationException(&amp;quot;to override&amp;quot;);\n    }\n\n    public Object getState() {\n        throw new UnsupportedOperationException(&amp;quot;to override&amp;quot;);\n    }\n\n    public void setState(O s) {\n    }\n\n    @Override\n    public PipelineStage&amp;lt;I, O&amp;gt; clone() {\n        throw new UnsupportedOperationException(&amp;quot;to override&amp;quot;);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ä¸è¿‡stageä¸­åŸºäºå‰é©±æŒ‡é’ˆpreviousé“¾æ¥çš„ï¼Œæ‰€ä»¥åç»­wrapSinkæ—¶å€™ä¹Ÿæ˜¯ï¼Œä¹Ÿæ˜¯ä»å°¾åˆ°å¤´çš„æ–¹å¼ã€‚&lt;/p&gt;\n&lt;p&gt;å‡è®¾æˆ‘ä»¬çš„ä»£ç æ˜¯è¿™æ ·&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;River.of(1,2,3).filter().distinct()\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;of()æ“ä½œç”Ÿæˆç¬¬ä¸€ä¸ªstageï¼Œfilter()æ“ä½œç”Ÿæˆç¬¬äºŒä¸ªstageï¼Œdistinct()æ“ä½œç”Ÿæˆç¬¬ä¸‰ä¸ªstageã€‚æ•´ä½“çœ‹ä¸‹æ¥å°±æ˜¯è¿™æ ·ï¼š&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f92d0302e7b640c9a65d8ad5b70fdaab~tplv-k3u1fbpfcp-watermark.image?\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h2 id=\&#34;headé˜¶æ®µç”Ÿæˆ-rivergenerator\&#34;&gt;Headé˜¶æ®µç”Ÿæˆ-RiverGenerator&lt;/h2&gt;\n&lt;p&gt;headæ˜¯æŒ‡ç¬¬ä¸€ä¸ªRiverå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸ºstage0ã€‚Riveræ¥å£ä¸­é»˜è®¤å®ç°äº†of()æ–¹æ³•ï¼Œè°ƒç”¨çš„å°±æ˜¯&lt;code&gt;RiverGenerator.create()&lt;/code&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public static &amp;lt;E&amp;gt; River&amp;lt;E&amp;gt; create(E... e) {\n    Spliterator&amp;lt;E&amp;gt; spliterator = Arrays.spliterator(e);\n    PipelineStage&amp;lt;E, E&amp;gt; head = new PipelineStage&amp;lt;E, E&amp;gt;(spliterator) {\n        @Override\n        public SinkChain&amp;lt;E, E&amp;gt; wrapSink(SinkChain&amp;lt;E, ?&amp;gt; sink) {\n            SinkChain&amp;lt;E, E&amp;gt; sinkChain = new SinkChain&amp;lt;E, E&amp;gt;() {\n                @Override\n                public void accept(E t) {\n                    next.accept(t);\n                }\n            };\n            sinkChain.setNext(sink);\n            return sinkChain;\n        }\n    };\n    head.setSourceSpliterator(spliterator);\n    return head;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;æµçš„å¤„ç†é“¾-sinkchain\&#34;&gt;æµçš„å¤„ç†é“¾-SinkChain&lt;/h2&gt;\n&lt;p&gt;ä»»ä½•æ—¶å€™ï¼Œåœ¨è°ƒç”¨ç»ˆç»“æ“ä½œä¹‹å‰ï¼Œä¸€åˆ‡æ“ä½œéƒ½åªæ˜¯é€šè¿‡stageé“¾è¿æ¥åœ¨ä¸€èµ·ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œä»»ä½•å®é™…çš„å¤„ç†æ“ä½œï¼Œè¿™å°±éœ€è¦ä¸€ä¸ªå¼€å…³æ¥å¯åŠ¨æµï¼Œè¿™ä¸ªå¼€å…³æ”¾åœ¨äº†æ‰€æœ‰ç»ˆç»“æ“ä½œä¸­,çœ‹ä¸‹&lt;code&gt;AbstractRiverPipeline.forEach()&lt;/code&gt;æ–¹æ³•&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Override\n    public void forEach(Consumer&amp;lt;O&amp;gt; consumer) {\n        PipelineStage&amp;lt;O, O&amp;gt; stage = new PipelineStage&amp;lt;O, O&amp;gt;(this) {\n            @Override\n            public SinkChain&amp;lt;O, O&amp;gt; wrapSink(SinkChain&amp;lt;O, ?&amp;gt; sink) {\n                return new SinkChain&amp;lt;O, O&amp;gt;() {\n                    @Override\n                    public void accept(O t) {\n                        consumer.accept(t);\n                    }\n                };\n            }\n        };\n        // å¯åŠ¨æµçš„å¼€å…³\n        evaluate(stage);\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;code&gt;evaluate()&lt;/code&gt;ä¸»è¦åšä¸¤ä»¶äº‹ï¼š&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;å°†æ‰€æœ‰stageåŒ…è£…æˆ&lt;code&gt;SinkChain&lt;/code&gt;ã€‚ï¼ˆå¯¹ç›¸å…³åè¯æ¦‚å¿µä¸æ¸…æ¥šçš„å¯ä»¥çœ‹ä¹‹å‰çš„Streamæºç è§£ææ–‡ç« ï¼‰&lt;/li&gt;\n&lt;li&gt;å¯åŠ¨æµï¼Œå¯¹æ‰€æœ‰å…ƒç´ è¿›è¡Œå¤„ç†ã€‚&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;private void evaluate(PipelineStage&amp;lt;?, O&amp;gt; stage) {\n    //æ„å»ºå¤„ç†é“¾\n    SinkChain&amp;lt;O, O&amp;gt; sinkHead = warpPipeline(stage);\n\n    //å¼€å§‹å¤„ç†\n    sinkHead.begin(-1);\n    //éå†å…ƒç´ \n    sinkHead.getSourceSpliterator().forEachRemaining(sinkHead);\n    sinkHead.end();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;åŒ…è£…-wrappipeline\&#34;&gt;åŒ…è£… - wrapPipeline&lt;/h3&gt;\n&lt;p&gt;é¡ºåºæ˜¯ä»å°¾åˆ°å¤´è¿›è¡Œçš„ï¼Œè¿”å›çš„sinkæ˜¯ç¬¬ä¸€ä¸ªé˜¶æ®µã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;private SinkChain&amp;lt;O, O&amp;gt; warpPipeline(AbstractRiverPipeline river) {\n    SinkChain&amp;lt;O, O&amp;gt; sink = null;\n    for (; river != null; river = river.previous) {\n        sink = river.wrapSink(sink);\n    }\n    return sink;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;è¿™é‡Œçš„&lt;code&gt;wrapSink()&lt;/code&gt;çš„é€»è¾‘å¯¹åº”çš„å°±æ˜¯&lt;code&gt;AbstractRiverPipeline&lt;/code&gt;ä¸­é‡å†™çš„é€»è¾‘&lt;/p&gt;\n&lt;p&gt;è¿™æ ·è¿”å›çš„å¯¹è±¡å°±æ˜¯ä¸€æ¡sinké“¾äº†ï¼Œå¹¶ä¸”é“¾ä¸­æ¯ä¸€ä¸ªsinkéƒ½æœ‰è‡ªå·±çš„&lt;code&gt;begin()&lt;/code&gt;ã€&lt;code&gt;accept()&lt;/code&gt;ã€&lt;code&gt;end()&lt;/code&gt;æ–¹æ³•ã€‚&lt;/p&gt;\n&lt;h3 id=\&#34;æµçš„è¿è¡Œæµç¨‹\&#34;&gt;æµçš„è¿è¡Œæµç¨‹&lt;/h3&gt;\n&lt;p&gt;evaluateç¬¬äºŒéƒ¨åˆ†çš„å·¥ä½œæ˜¯è¿è¡Œæµ&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;é¦–å…ˆè°ƒç”¨&lt;code&gt;begin()&lt;/code&gt;æ–¹æ³•ï¼Œä»å¤´åˆ°å°¾æ‰§è¡Œä¸€éæ‰€æœ‰å¯¹è±¡çš„&lt;code&gt;begin()&lt;/code&gt;æ–¹æ³•ï¼Œä¸»è¦ä½œç”¨æ˜¯è¿›è¡Œåˆå§‹åŒ–ã€‚&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;forEachRemaining&lt;/code&gt;çš„ä½œç”¨å°±æ˜¯å¯¹æ•°æ®æºspliteratorå…ƒç´ æ‰§è¡Œ&lt;code&gt;accept()&lt;/code&gt;æ–¹æ³•ï¼Œå¯ä»¥ä»å¤´å€’å°¾ä¸€ä¸ªä¸ªæ‰§è¡Œã€‚&lt;/li&gt;\n&lt;li&gt;æœ€åè°ƒç”¨&lt;code&gt;end()&lt;/code&gt;æ–¹æ³•ï¼Œä»å¤´åˆ°å°¾æ‰§è¡Œä¸€éï¼Œä¸»è¦ç›®çš„æ˜¯æ•°æ®çš„æƒ…å†µï¼Œå­—æ®µè®¾ä¸ºnullç­‰ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;ä¾ç„¶ç”¨ä¸Šé¢çš„&lt;code&gt;filter()&lt;/code&gt;æ–¹æ³•å’Œ&lt;code&gt;distinct()&lt;/code&gt;ä¸ºä¾‹:&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Override\npublic River&amp;lt;O&amp;gt; filter(Predicate&amp;lt;O&amp;gt; predicate) {\n    return new PipelineStage&amp;lt;O, O&amp;gt;(this) {\n        @Override\n        public SinkChain&amp;lt;O, O&amp;gt; wrapSink(SinkChain&amp;lt;O, ?&amp;gt; sink) {\n            SinkChain&amp;lt;O, O&amp;gt; sinkChain = new SinkChain&amp;lt;O, O&amp;gt;() {\n                @Override\n                public void accept(O t) {\n                    // å¦‚æœä¸ç¬¦åˆè¦æ±‚ï¼Œä¸å†å‘åä¼ é€’è¯¥å…ƒç´ ï¼Œè¯¥å…ƒç´ çš„å¤„ç†åˆ°æ­¤ä¸ºæ­¢\n                    if (!predicate.test(t)) {\n                        return;\n                    }\n                    //å¦‚ä½•è¦æ±‚åˆ™è°ƒç”¨ä¸‹ä¸€ä¸ªsinkçš„accept()æ–¹æ³•\n                    getNext().accept(t);\n                }\n            };\n            sinkChain.setNext(sink);\n            return sinkChain;\n        }\n    };\n}\n\n@Override\npublic River&amp;lt;O&amp;gt; distinct() {\n    return new PipelineStage&amp;lt;O, O&amp;gt;(this) {\n        @Override\n        public SinkChain&amp;lt;O, O&amp;gt; wrapSink(SinkChain&amp;lt;O, ?&amp;gt; sink) {\n            SinkChain&amp;lt;O, O&amp;gt; sinkChain = new SinkChain&amp;lt;O, O&amp;gt;() {\n                private HashSet&amp;lt;O&amp;gt; set;\n\n                @Override\n                public void begin(int n) {\n                    //æ‰§è¡Œåˆå§‹åŒ–å·¥ä½œ\n                    this.set = new HashSet&amp;lt;&amp;gt;(n &amp;gt; 0 ? n : 16);\n                    //è°ƒç”¨ä¸‹ä¸€ä¸ªsinkçš„begin()æ–¹æ³•\n                    super.begin(n);\n                }\n\n                @Override\n                public void end() {\n                    this.set = null;\n                    super.end();\n                }\n\n                @Override\n                public void accept(O t) {\n                    if (!set.add(t)) {\n                        return;\n                    }\n                    getNext().accept(t);\n                }\n            };\n            sinkChain.setNext(sink);\n            return sinkChain;\n        }\n    };\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;æ€»ç»“\&#34;&gt;æ€»ç»“&lt;/h2&gt;\n&lt;p&gt;æ–‡ç« åªæ˜¯åˆ—ä¸¾äº†ä¸€äº›å…³é”®æ­¥éª¤çš„è®¾è®¡ä¸å®ç°ï¼Œè®¾è®¡çš„æ€è·¯å¤§å¤šæ•°æ¥æºäºJDK Streamçš„æºç ï¼Œå¦‚ä½•å®ç°ä¸€ä¸ªStreamï¼Œä¸»è¦çš„ç›®çš„æ˜¯å¯ä»¥æ›´å¥½çš„ç†è§£Streamä¸€äº›åœ°æ–¹ä¸ºä»€ä¹ˆè¦é‚£ä¹ˆè®¾è®¡ï¼Œå› ä¸ºåªæœ‰åœ¨è‡ªå·±å¼€å‘çš„æ—¶å€™æ‰èƒ½ä½“ä¼šåˆ°è®¾è®¡çš„ç²¾å¦™ã€‚&lt;/p&gt;\n&lt;p&gt;é¡¹ç›®çš„æºç åœ¨githubï¼Œæµ‹è¯•ä»£ç åœ¨teståŒ…ä¸‹ï¼Œç›®å‰åªæ”¯æŒä¸²è¡Œæµï¼Œåç»­ä¼šæ·»åŠ å¹¶è¡Œæµçš„æ”¯æŒï¼Œå¹¶ä¸”æä¾›æ›´å¤šçš„APIï¼Œè®©Riverå¯ä»¥è¿›è¡Œæ›´å¤šæ›´å¼ºå¤§çš„æ“ä½œã€‚&lt;/p&gt;\n&lt;p&gt;é¡¹ç›®åœ°å€ï¼š&lt;a href=\&#34;https://github.com/zexho994/River\&#34;&gt;https://github.com/zexho994/River&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;shou-xie-shi-xian-java-stream&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;é¡¹ç›®åœ°å€ï¼š&lt;a href=\&#34;https://github.com/zexho994/River\&#34;&gt;https://github.com/zexho994/River&lt;/a&gt;&lt;br&gt;\nå®ç°ç›®æ ‡ï¼šæ”¯æŒå’ŒJDK Streamä¸€æ ·çš„åŠŸèƒ½, æä¾›ä¸Streamä¸€æ ·çš„APIï¼Œåç»­ä¼šè¿›è¡Œæ›´å¤šçš„APIæ‰©å±•ã€‚&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;æ‰‹å†™å®ç° Java Stream&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;é€ è½®å­&#34;,&#34;slug&#34;:&#34;KrLfgh9WlS&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/KrLfgh9WlS/&#34;}],&#34;date&#34;:&#34;2021-09-10 21:59:28&#34;,&#34;dateFormat&#34;:&#34;2021-09-10 09:59:28&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/shou-xie-shi-xian-java-stream/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;10 min read&#34;,&#34;time&#34;:573000,&#34;words&#34;:2075,&#34;minutes&#34;:10},&#34;description&#34;:&#34;é¡¹ç›®åœ°å€ï¼šhttps://github.com/zexho994/River\nå®ç°ç›®æ ‡ï¼šæ”¯æŒå’ŒJDK Streamä¸€æ ·çš„åŠŸèƒ½, æä¾›ä¸Streamä¸€æ ·çš„APIï¼Œåç»­ä¼šè¿›è¡Œæ›´å¤šçš„APIæ‰©å±•ã€‚\n\n\n\n\nç±»å‹\næ–¹æ³•\n\n\n\n\nåˆ›å»ºæ“ä½œ\nof(T.....&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%A1%B6%E5%B1%82%E6%8E%A5%E5%8F%A3-river\&#34;&gt;é¡¶å±‚æ¥å£-River&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#river%E5%AE%9E%E7%8E%B0%E7%B1%BB-abstractriverpipeline\&#34;&gt;Riverå®ç°ç±» - AbstractRiverPipeline&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%98%B6%E6%AE%B5%E5%B0%81%E8%A3%85-pipelinestage\&#34;&gt;é˜¶æ®µå°è£…-PipelineStage&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#head%E9%98%B6%E6%AE%B5%E7%94%9F%E6%88%90-rivergenerator\&#34;&gt;Headé˜¶æ®µç”Ÿæˆ-RiverGenerator&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%B5%81%E7%9A%84%E5%A4%84%E7%90%86%E9%93%BE-sinkchain\&#34;&gt;æµçš„å¤„ç†é“¾-SinkChain&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8C%85%E8%A3%85-wrappipeline\&#34;&gt;åŒ…è£… - wrapPipeline&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%B5%81%E7%9A%84%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B\&#34;&gt;æµçš„è¿è¡Œæµç¨‹&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%80%BB%E7%BB%93\&#34;&gt;æ€»ç»“&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;æå‡ºç–‘é—®\&#34;&gt;æå‡ºç–‘é—®&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;å¦‚ä½•è½¬æ¢æµç±»å‹ï¼Œæ€ä¹ˆå®ç°çš„ï¼Ÿ&lt;/li&gt;\n&lt;li&gt;å¦‚ä½•åˆ‡åˆ†ä»»åŠ¡çš„ï¼Ÿ&lt;/li&gt;\n&lt;li&gt;å¦‚ä½•åˆå¹¶ä»»åŠ¡ç»“æœçš„ï¼Ÿ&lt;/li&gt;\n&lt;/ol&gt;\n&lt;!-- more --&gt;\n&lt;h2 id=\&#34;ä»»åŠ¡åˆ‡åˆ†\&#34;&gt;ä»»åŠ¡åˆ‡åˆ†&lt;/h2&gt;\n&lt;p&gt;å¹¶è¡Œæµçš„åº•å±‚æ‰§è¡Œæ˜¯åŸºäºForkJoinæ¡†æ¶çš„ï¼Œäº†è§£çš„éƒ½çŸ¥é“ForkJoinæ¡†æ¶è¦æ‰§è¡Œçš„ä»»åŠ¡é€»è¾‘éœ€è¦ä½¿ç”¨è€…é‡å†™ï¼Œé‡å†™å†…å®¹åŒ…æ‹¬å¦‚æœåˆ‡åˆ†ä»»åŠ¡ï¼Œæ‰€ä»¥å»çœ‹ForkJoinTaskçš„å®ç°å­ç±»å¦‚ä½•å®ç°Compute()æ–¹æ³•å°±å¯ä»¥çŸ¥é“å¦‚ä½•è¿›è¡Œä»»åŠ¡åˆ‡åˆ†çš„ã€‚&lt;br&gt;\nåœ¨AbstractTaskç±»ä¸­å®ç°äº†æ ¸å¿ƒæ–¹æ³•ã€‚&lt;br&gt;\n&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ec498e18d90a4c11bb046b48ce762f02~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\nå…¶ä¸­æœ€æ ¸å¿ƒçš„æ–¹æ³•æ˜¯compute()æ–¹æ³•ï¼Œå®šä¹‰äº†è®¡ç®—ç®—æ³•çš„é€»è¾‘ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;    /**\n    * å†³å®šæ˜¯å¦è¿›ä¸€æ­¥æ‹†åˆ†ä¸€ä¸ªä»»åŠ¡æˆ–ç›´æ¥è®¡ç®—å®ƒã€‚\n    * å¦‚æœç›´æ¥è®¡ç®—,è°ƒç”¨doLeafå¹¶å°†ç»“æœä¼ é€’ç»™setRawResultã€‚\n    * å¦åˆ™å°±æ‹†åˆ†å­ä»»åŠ¡ï¼Œåˆ†å‰ä¸€ä¸ªï¼Œç»§ç»­ä½œä¸ºå¦ä¸€ä¸ªã€‚\n\t* è¯¥æ–¹æ³•çš„ç»“æ„æ˜¯ä¸ºäº†åœ¨ä¸€ç³»åˆ—çš„ä½¿ç”¨ä¸­èŠ‚çº¦èµ„æºã€‚å¾ªç¯åœ¨åˆ†è£‚æ—¶ç»§ç»­è¿›è¡Œå…¶ä¸­ä¸€ä¸ªå­ä»»åŠ¡ï¼Œ\n    * ä»¥é¿å…æ·±åº¦é€’å½’ã€‚ä¸ºäº†åº”å¯¹å¯èƒ½ç³»ç»Ÿæ€§åœ°åå‘äºå·¦é‡æˆ–å³é‡æ‹†åˆ†çš„æ‹†åˆ†å™¨ï¼Œæˆ‘ä»¬åœ¨å¾ªç¯ä¸­äº¤æ›¿ä½¿ç”¨å“ªä¸ªå­ä»»åŠ¡è¢«åˆ†å‰æˆ–ç»§ç»­ã€‚\n    **/\n    @Override\n    public void compute() {\n        Spliterator&amp;lt;P_IN&amp;gt; rs = spliterator, ls; // right, left spliterators\n        //ä¼°è®¡rsçš„å…ƒç´ æ•°é‡\n        long sizeEstimate = rs.estimateSize();\n        //è·å–å¤§å°é˜ˆå€¼\n        long sizeThreshold = getTargetSize(sizeEstimate);\n        //\n        boolean forkRight = false;\n        @SuppressWarnings(&amp;quot;unchecked&amp;quot;) K task = (K) this;\n        // åˆ¤æ–­æ¡ä»¶\n        // 1. å…ƒç´ æ•°é‡ &amp;gt; é˜ˆå€¼\n        // 2. rså¯ä»¥è¿›è¡Œåˆ‡å‰²\n        while (sizeEstimate &amp;gt; sizeThreshold &amp;amp;&amp;amp; (ls = rs.trySplit()) != null) {\n            K leftChild, rightChild, taskToFork;\n            // ä½¿ç”¨ls,rsæ„é€ ä¸¤ä¸ªæ–°çš„ä»»åŠ¡\n            task.leftChild  = leftChild = task.makeChild(ls);\n            task.rightChild = rightChild = task.makeChild(rs);\n            //è®¾ç½®ç­‰å¾…æ•°é‡ä¸º1\n            task.setPendingCount(1);\n            \n            // è½®æµæ‰§è¡Œå·¦/å³ä¸¤ä¸ªä»»åŠ¡\n            if (forkRight) {\n                forkRight = false;\n                rs = ls;\n                task = leftChild;\n                taskToFork = rightChild;// rightChild.fork()\n            }\n            else { \n                forkRight = true;\n                task = rightChild;\n                taskToFork = leftChild;//leftChild.fork()\n            }\n            // é€’å½’\n            taskToFork.fork();\n            sizeEstimate = rs.estimateSize();\n        }\n        task.setLocalResult(task.doLeaf());\n        task.tryComplete();\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;æœ¬è´¨ä¸Šç†è§£ï¼Œå°±æ˜¯å°†ä¸€ä¸ªSpliteratorè¿›è¡Œåˆ‡åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œç„¶åä¸¤éƒ¨åˆ†å†è¿›è¡Œåˆ‡åˆ†ï¼Œç›´åˆ°while()æ¡ä»¶æ— æ³•å†æ»¡è¶³ï¼Œç„¶åå¯¹è¯¥éƒ¨åˆ†è¿›è¡Œè¿ç®—ï¼Œå°†è¿ç®—ç»“æœä¿å­˜åœ¨èŠ‚ç‚¹çš„LocalResultå­—æ®µä¸Šã€‚è¿™éƒ¨åˆ†å°±æ˜¯åˆ†æ”¯çš„åˆ‡åˆ†é˜¶æ®µã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;ç»“æœåˆå¹¶\&#34;&gt;ç»“æœåˆå¹¶&lt;/h2&gt;\n&lt;p&gt;æµ‹è¯•ä»£ç ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;long count = Stream.of(1, 2, 3, 4, 5).parallel().reduce((x, y) -&amp;gt; x + y + 10).get();\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;code&gt;AbstractPipeline.evaluate()&lt;/code&gt;æ–¹æ³•æ˜¯å¹¶è¡Œæµä¸ä¸²è¡Œæµçš„åˆ†å‰ç‚¹ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;final &amp;lt;R&amp;gt; R evaluate(TerminalOp&amp;lt;E_OUT, R&amp;gt; terminalOp) {\n        assert getOutputShape() == terminalOp.inputShape();\n        if (linkedOrConsumed)\n            throw new IllegalStateException(MSG_STREAM_LINKED);\n        linkedOrConsumed = true;\n\n        return isParallel()\n               ? terminalOp.evaluateParallel(this, sourceSpliterator(terminalOp.getOpFlags()))  //å¹¶è¡Œæµæ‰§è¡Œç‚¹\n               : terminalOp.evaluateSequential(this, sourceSpliterator(terminalOp.getOpFlags()));\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;code&gt;ReduceOps.evaluateParallel()&lt;/code&gt;æ–¹æ³•æ˜¯å…¶å®ç°ä¹‹ä¸€&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Override\npublic &amp;lt;P_IN&amp;gt; R evaluateParallel(PipelineHelper&amp;lt;T&amp;gt; helper,\n                                 Spliterator&amp;lt;P_IN&amp;gt; spliterator) {\n    return new ReduceTask&amp;lt;&amp;gt;(this, helper, spliterator).invoke().get();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;åˆ›å»ºä¸€ä¸ªReduceTaskä»»åŠ¡&lt;/li&gt;\n&lt;li&gt;ä»»åŠ¡è°ƒç”¨invoke()æ‰§è¡Œ&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;åˆ›å»ºçš„é€»è¾‘æ²¡æœ‰é¢å¤–çš„æ“ä½œï¼Œå°±æ˜¯å°†ä¸‰ä¸ªå‚æ•°èµ‹å€¼åˆ°å®ä¾‹å˜é‡ä¸­ã€‚&lt;/p&gt;\n&lt;p&gt;invoke()æ˜¯ForkJoinTaskçš„æ–¹æ³•ï¼Œæ–¹æ³•è¿™é‡Œä¸»è¦å…³æ³¨&lt;code&gt;invoke()&lt;/code&gt;æ–¹æ³•çš„é€»è¾‘ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;/**\n* Commences performing this task, awaits its completion if\n* necessary, and returns its result, or throws an (unchecked)\n* {@code RuntimeException} or {@code Error} if the underlying\n* computation did so.\n*\n* @return the computed result\n*/\npublic final V invoke() {\n    int s;\n    //æ‰§è¡Œä»»åŠ¡\n    if ((s = doInvoke() &amp;amp; DONE_MASK) != NORMAL)\n        reportException(s);\n\n    // è¿™é‡Œæ”¾å›çš„æ˜¯æœ€ç»ˆç»“æœ\n    return getRawResult();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;/**\n* Implementation for invoke, quietlyInvoke.\n*\n* @return status upon completion\n*/\nprivate int doInvoke() {\n    int s; Thread t; ForkJoinWorkerThread wt;\n    return (s = doExec()) &amp;lt; 0 ? s :\n    ((t = Thread.currentThread()) instanceof ForkJoinWorkerThread) ?\n        (wt = (ForkJoinWorkerThread)t).pool.\n        awaitJoin(wt.workQueue, this, 0L) :\n    externalAwaitDone();\n}\n\n==&amp;gt; JDKä»£ç ä¸ºäº†æ€§èƒ½ï¼Œç‰ºç‰²äº†å¯è¯»æ€§ï¼Œè¿™é‡Œæ•´ç†ä¸‹ï¼š\n\nprivate int doInvoke() {\n    s = doExec();\n    if (s &amp;lt; 0) return s;\n    \n\tt = Thread.currentThread();\n    if (t instanceof ForkJoinWorkerThread) {\n    \tForkJoinWorkerThread wt = (ForkJoinWorkerThread)t.pool();\n        return wt.awaitJoin(wt.workQueue,this,0L);\n    }\n    \n    return externalAwaitDone();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;pre&gt;&lt;code&gt;    /**\n     * If the pending count is nonzero, decrements the count;\n     * otherwise invokes {@link #onCompletion(CountedCompleter)}\n     * and then similarly tries to complete this task&#39;s completer,\n     * if one exists, else marks this task as complete.\n     */\n    public final void tryComplte() {\n        CountedCompleter&amp;lt;?&amp;gt; a = this, s = a;\n        for (int c;;) {\n            if ((c = a.pending) == 0) {\n                a.onCompletion(s);\n                if ((a = (s = a).completer) == null) {\n                    s.quietlyComplete();\n                    return;\n                }\n            }\n            else if (U.compareAndSwapInt(a, PENDING, c, c - 1))\n                return;\n        }\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;åœ¨&lt;code&gt;ReduceOps.onCompletion()&lt;/code&gt;çš„é‡å†™æ–¹æ³•ä¸­ï¼Œå¦‚æœæ˜¯ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œåˆ™åˆå¹¶ä¸¤ä¸ªå­èŠ‚ç‚¹çš„ç»“æœï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;@Override\npublic void onCompletion(CountedCompleter&amp;lt;?&amp;gt; caller) {\n    if (!isLeaf()) {\n        //å¦‚æœä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå°†å·¦å³ä¸¤ä¸ªå­èŠ‚ç‚¹çš„ç»“æœåˆå¹¶ã€‚\n        S leftResult = leftChild.getLocalResult();\n        leftResult.combine(rightChild.getLocalResult());\n        setLocalResult(leftResult);\n    }\n    // GC spliterator, left and right child\n    super.onCompletion(caller);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å…³æ³¨é‡Œé¢3ä¸ªæ–¹æ³•:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;isLeaf()&lt;/li&gt;\n&lt;li&gt;combine()&lt;/li&gt;\n&lt;li&gt;super.onCompletion()&lt;br&gt;\nisLeaf()åˆ¤æ–­æ˜¯ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œåªæœ‰éå¶å­èŠ‚ç‚¹æ‰æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œç„¶åæ‰èƒ½è¿›è¡Œåˆå¹¶ä»»åŠ¡ï¼š&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;protected boolean isLeaf() {\n    return leftChild == null;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;èŠ‚ç‚¹åœ¨æ‰§è¡Œå®Œåè°ƒç”¨&lt;code&gt;super.onCompletionc(caller)&lt;/code&gt;æ–¹æ³•, å­—æ®µè®¾ä¸ºnullï¼Œä¸ºäº†gc&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Override\npublic void onCompletion(CountedCompleter&amp;lt;?&amp;gt; caller) {\n    spliterator = null;\n    leftChild = rightChild = null;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ç»ˆç‚¹çœ‹ä¸‹combine()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯å°†ç»“æœç»„åˆ&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Override\npublic void combine(ReducingSink other) {\n    if (!other.empty)\n        accept(other.state);\n}\n\n// å°†æœ¬ç±»çš„stateå’Œå‚æ•°tè¿›è¡Œä¸€æ¬¡è¿ç®—ï¼Œç”±äºtæ˜¯å¦ä¸€ä¸ªéƒ¨åˆ†è¿ç®—çš„ç»“æœ\n// è¿™é‡Œçš„ä½œç”¨å°±æ˜¯ä¸¤éƒ¨åˆ†è¿›è¡Œè¿ç®—æ±‚å‡ºç»“æœ\n@Override\npublic void accept(T t) {\n    if (empty) {\n        empty = false;\n        state = t;\n    } else {\n        state = operator.apply(state, t);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;code&gt;apply(state,t)&lt;/code&gt;è¿ç®—çš„é€»è¾‘æ˜¯ä½¿ç”¨è€…å®šä¹‰çš„ï¼Œå¯¹åº”æˆ‘ä»¬çš„ç¤ºä¾‹å³ &lt;code&gt;.reduce((x, y) -&amp;gt; x + y + 10)&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œå°±å¯ä»¥å¯¹æ‰€æœ‰èŠ‚ç‚¹çš„ç»“æœè¿›è¡Œä¸¤ä¸¤ç»„åˆï¼Œå¾—å‡ºæœ€ç»ˆç»“æœäº†ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;ç–‘é—®è§£ç­”\&#34;&gt;ç–‘é—®è§£ç­”&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;å¦‚ä½•è½¬æ¢æµç±»å‹ï¼Œæ€ä¹ˆå®ç°çš„ï¼Ÿ\n&lt;ul&gt;\n&lt;li&gt;å¯ä»¥ä½¿ç”¨&lt;code&gt;sequential()&lt;/code&gt;æˆ– &lt;code&gt;parallel()&lt;/code&gt;è½¬æ¢æµçš„ç±»å‹ï¼Œæºç ä¸­æ˜¯å¯¹ &lt;code&gt;sourceStage.parallel = true;&lt;/code&gt;è¿›è¡Œæ ‡è®°ï¼Œæœ€ååœ¨å¯åŠ¨æ—¶å€™æ ¹æ®å’Œè¿™ä¸ªæ ‡è®°å†³å®šä¸²è¡Œorå¹¶è¡Œã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;å¦‚ä½•åˆ‡åˆ†ä»»åŠ¡çš„ï¼Ÿ\n&lt;ul&gt;\n&lt;li&gt;åº•å±‚åˆ©ç”¨ForkJoindPoolæ¡†æ¶å®ç°å¯¹ä»»åŠ¡çš„åˆ‡åˆ†å’Œåˆå¹¶ä»»åŠ¡ï¼Œé‡å†™&lt;code&gt;compute()&lt;/code&gt;ï¼Œå¯¹Splitertorè¿›è¡Œæ‹†åˆ†ï¼Œç„¶åé€’å½’è°ƒç”¨&lt;code&gt;compute()&lt;/code&gt;æ–¹æ³•è¿›è¡Œä¸æ–­åˆ‡åˆ†ï¼Œç›´åˆ°Splitertoræ— æ³•å†åˆ‡åˆ†ï¼Œæ‰§è¡Œè¯¥éƒ¨åˆ†ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;å¦‚ä½•åˆå¹¶ä»»åŠ¡ç»“æœçš„ï¼Ÿ\n&lt;ul&gt;\n&lt;li&gt;é‡å†™&lt;code&gt;onCompletionc()&lt;/code&gt;ï¼Œå¯¹æ¯ä¸€ä¸ªéå¶å­èŠ‚ç‚¹ï¼Œéƒ½ä¼šå°†ä¸¤ä¸ªå­èŠ‚ç‚¹çš„ç»“æœé€šè¿‡&lt;code&gt;combine()&lt;/code&gt;æ–¹æ³•è¿›è¡Œç»„åˆï¼Œç„¶åä¸€ç›´å‘ä¸Šä»¿ä½›ï¼ŒçŸ¥é“æ‰€æœ‰èŠ‚ç‚¹ç»“æœéƒ½ç»„åˆï¼Œæœ€åè¿”å›æ ¹èŠ‚ç‚¹çš„ç»“æœã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&#34;,&#34;fileName&#34;:&#34;shen-ru-jie-xi-java-parallel-stream&#34;,&#34;abstract&#34;:&#34;&lt;h2 id=\&#34;æå‡ºç–‘é—®\&#34;&gt;æå‡ºç–‘é—®&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;å¦‚ä½•è½¬æ¢æµç±»å‹ï¼Œæ€ä¹ˆå®ç°çš„ï¼Ÿ&lt;/li&gt;\n&lt;li&gt;å¦‚ä½•åˆ‡åˆ†ä»»åŠ¡çš„ï¼Ÿ&lt;/li&gt;\n&lt;li&gt;å¦‚ä½•åˆå¹¶ä»»åŠ¡ç»“æœçš„ï¼Ÿ&lt;/li&gt;\n&lt;/ol&gt;\n&#34;,&#34;title&#34;:&#34;æ·±å…¥è§£æ Java Parallel Stream&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;æºç &#34;,&#34;slug&#34;:&#34;yuan-ma&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/yuan-ma/&#34;},{&#34;name&#34;:&#34;Java&#34;,&#34;slug&#34;:&#34;6j9B3b2nb&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/6j9B3b2nb/&#34;}],&#34;date&#34;:&#34;2021-08-11 20:56:48&#34;,&#34;dateFormat&#34;:&#34;2021-08-11 08:56:48&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/shen-ru-jie-xi-java-parallel-stream/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;7 min read&#34;,&#34;time&#34;:382000,&#34;words&#34;:1464,&#34;minutes&#34;:7},&#34;description&#34;:&#34;æå‡ºç–‘é—®\n\nå¦‚ä½•è½¬æ¢æµç±»å‹ï¼Œæ€ä¹ˆå®ç°çš„ï¼Ÿ\nå¦‚ä½•åˆ‡åˆ†ä»»åŠ¡çš„ï¼Ÿ\nå¦‚ä½•åˆå¹¶ä»»åŠ¡ç»“æœçš„ï¼Ÿ\n\n\nä»»åŠ¡åˆ‡åˆ†\nå¹¶è¡Œæµçš„åº•å±‚æ‰§è¡Œæ˜¯åŸºäºForkJoinæ¡†æ¶çš„ï¼Œäº†è§£çš„éƒ½çŸ¥é“ForkJoinæ¡†æ¶è¦æ‰§è¡Œçš„ä»»åŠ¡é€»è¾‘éœ€è¦ä½¿ç”¨è€…é‡å†™ï¼Œé‡å†™å†…å®¹åŒ…æ‹¬å¦‚æœåˆ‡åˆ†ä»»åŠ¡ï¼Œæ‰€ä»¥å»çœ‹...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%8F%90%E5%87%BA%E7%96%91%E9%97%AE\&#34;&gt;æå‡ºç–‘é—®&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BB%BB%E5%8A%A1%E5%88%87%E5%88%86\&#34;&gt;ä»»åŠ¡åˆ‡åˆ†&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%BB%93%E6%9E%9C%E5%90%88%E5%B9%B6\&#34;&gt;ç»“æœåˆå¹¶&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%96%91%E9%97%AE%E8%A7%A3%E7%AD%94\&#34;&gt;ç–‘é—®è§£ç­”&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h3 id=\&#34;å‡ ä¸ªç–‘é—®\&#34;&gt;å‡ ä¸ªç–‘é—®&lt;/h3&gt;\n&lt;ol&gt;\n&lt;li&gt;ç»ˆç»“æ–¹æ³•æ˜¯å¦‚ä½•è¿›è¡Œæ“ä½œçš„ï¼Ÿ&lt;/li&gt;\n&lt;li&gt;å¦‚ä½•å®ç°ç”±ç»ˆç»“æ“ä½œè§¦å‘æµçš„è¿ä½œçš„ï¼Ÿ&lt;/li&gt;\n&lt;li&gt;å¦‚ä½•ä¿è¯ä¸€ä¸ªæµä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªç»ˆç»“æ–¹æ³•ï¼Ÿ&lt;/li&gt;\n&lt;/ol&gt;\n&lt;!-- more --&gt;\n&lt;h3 id=\&#34;ä½¿ç”¨æ–¹å¼\&#34;&gt;ä½¿ç”¨æ–¹å¼&lt;/h3&gt;\n&lt;p&gt;åˆ—ä¸¾å››ç§ç»ˆç»“æ“ä½œï¼Œåœ¨Streamæä¾›çš„APIä¸­ï¼Œä¹Ÿæ˜¯å››ç±»ï¼š&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f302257d5bb44e519c5bb32da6fb5daa~tplv-k3u1fbpfcp-watermark.image\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;// è®¡ç®—æµä¸­å…ƒç´ æ•°é‡ï¼ŒFindOP\nlong count = afterLimit.count();\n\n// éå†æ‰€æœ‰å…ƒç´ ,ForEachOp\nafterLimit.forEach(System.out::printl);\n\n// è·å–ç¬¬ä¸€ä¸ªå…ƒç´ ,MatchOp\nOptional&amp;lt;Integer&amp;gt; any = afterLimit.findFirst();\n\n// åˆ¤æ–­æ˜¯å¦,ReduceOp\nboolean flag = afterLimit.anyMatch(i -&amp;gt; i == 1);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;count\&#34;&gt;count()&lt;/h3&gt;\n&lt;p&gt;åœ¨&lt;code&gt;ReferencePipeline&lt;/code&gt;ç±»ä¸­å®ç°&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Override\npublic final long count() {\n \t// è°ƒç”¨mapToLongå°†æ‰€æœ‰å…ƒç´ å˜æˆ1ï¼Œç„¶åè®¡ç®—sum\n    return mapToLong(e -&amp;gt; 1L).sum();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;maotolong\&#34;&gt;maoToLong()&lt;/h4&gt;\n&lt;p&gt;mapToLong()æ–¹æ³•ï¼Œæ˜¯ä¸€ä¸ªä¸­é—´æ“ä½œ&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Override\n    public final LongStream mapToLong(ToLongFunction&amp;lt;? super P_OUT&amp;gt; mapper) {\n        Objects.requireNonNull(mapper);\n        return new LongPipeline.StatelessOp&amp;lt;P_OUT&amp;gt;(this, StreamShape.REFERENCE,\n                                      StreamOpFlag.NOT_SORTED | StreamOpFlag.NOT_DISTINCT) {\n            @Override\n            Sink&amp;lt;P_OUT&amp;gt; opWrapSink(int flags, Sink&amp;lt;Long&amp;gt; sink) {\n                return new Sink.ChainedReference&amp;lt;P_OUT, Long&amp;gt;(sink) {\n                    @Override\n                    public void accept(P_OUT u) {\n                        //\n                        downstream.accept(mapper.applyAsLong(u));\n                    }\n                };\n            }\n        };\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ToLongFunctionæ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ç±», accept()é‡Œçš„é€»è¾‘ä¾¿æ˜¯&lt;code&gt;e -&amp;gt; 1L&lt;/code&gt;.&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@FunctionalInterface\npublic interface ToLongFunction&amp;lt;T&amp;gt; {\n\n    /**\n     * Applies this function to the given argument.\n     *\n     * @param value the function argument\n     * @return the function result\n     */\n    long applyAsLong(T value);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;çœ‹ä¸‹Sum()æ–¹æ³•,åœ¨LongPipelineç±»ä¸­ï¼Œä¼ å…¥å‚æ•°æ˜¯ä¸€ä¸ªLong::sum, sumçš„ä½œç”¨æ˜¯ç›¸åŠ ä¸¤ä¸ªå€¼ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Override\npublic final long sum() {\n    // use better algorithm to compensate for intermediate overflow?\n    return reduce(0, Long::sum);\n}\n\n//public static long sum(long a, long b) {\n//    return a + b;\n//}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;reduce\&#34;&gt;reduce()&lt;/h4&gt;\n&lt;p&gt;reduceæ–¹æ³•,å°†æ“ä½œå‡½æ•°opå°è£…æˆä¸€ä¸ªSinkï¼ŒmakeLong()çš„ä½œç”¨å°±æ˜¯ä¼šç”Ÿäº§ä¸€ä¸ªSink&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Override\npublic final long reduce(long identity, LongBinaryOperator op) {\n    return evaluate(ReduceOps.makeLong(identity, op));\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;    /**\n     * Constructs a {@code TerminalOp} that implements a functional reduce on\n     * {@code long} values.\n     *\n     * @param identity the identity for the combining function\n     * @param operator the combining function\n     * @return a {@code TerminalOp} implementing the reduction\n     */\n    public static TerminalOp&amp;lt;Long, Long&amp;gt;\n    makeLong(long identity, LongBinaryOperator operator) {\n        Objects.requireNonNull(operator);\n        class ReducingSink\n                implements AccumulatingSink&amp;lt;Long, Long, ReducingSink&amp;gt;, Sink.OfLong {\n                \n            //stateæ˜¯ä¸€ä¸ªç”¨ä½œè®°å½•çš„å€¼\n            private long state;\n\n            @Override\n            public void begin(long size) {\n                state = identity;\n            }\n\n\t\t\t//å‚æ•°ä¼ è¿›æ¥çš„å°±æ˜¯sun(),æ‰€ä»¥è¿™é‡Œçš„accept()çš„ä½œç”¨å°±æ˜¯å¯¹stateä¸æ–­è¿›è¡Œç´¯åŠ \n            @Override\n            public void accept(long t) {\n                state = operator.applyAsLong(state, t);\n            }\n\n            @Override\n            public Long get() {\n                return state;\n            }\n\n            @Override\n            public void combine(ReducingSink other) {\n                accept(other.state);\n            }\n        }\n        return new ReduceOp&amp;lt;Long, Long, ReducingSink&amp;gt;(StreamShape.LONG_VALUE) {\n            @Override\n            public ReducingSink makeSink() {\n                return new ReducingSink();\n            }\n        };\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;evaluate\&#34;&gt;evaluate()&lt;/h4&gt;\n&lt;p&gt;çœ‹å›evaluate()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨æ¥æ‰§è¡Œç»ˆç»“æ“ä½œçš„&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;final &amp;lt;R&amp;gt; R evaluate(TerminalOp&amp;lt;E_OUT, R&amp;gt; terminalOp) {\n    assert getOutputShape() == terminalOp.inputShape();\n    //åˆ¤æ–­æµæ˜¯å¦å·²è¢«ä½¿ç”¨\n    if (linkedOrConsumed)\n        throw new IllegalStateException(MSG_STREAM_LINKED);\n    //è®¾ç½®ä½¿ç”¨æ ‡è®°ä¸ºtrue\n    linkedOrConsumed = true;\n\n    //æ ¹æ®æµç±»å‹ï¼Œæ‰§è¡Œç›¸åº”çš„æ¨æ–­æ“ä½œ\n    return isParallel()\n        ? terminalOp.evaluateParallel(this, sourceSpliterator(terminalOp.getOpFlags()))\n        : terminalOp.evaluateSequential(this, sourceSpliterator(terminalOp.getOpFlags()));\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å…³æ³¨æ—¶åºæµçš„æ¨æ–­æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•çš„å®ç°åˆ†ä¸ºå››ç§ï¼Œå¯¹åº”ä¸Šé¢æåˆ°çš„å››ç±»ç±»å‹æ“ä½œï¼Œcountå±äºReduceOpï¼Œè¿›å»çœ‹ä¸‹ã€‚&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/140540bd57794266af310e7c016400f5~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;\n@Override\npublic &amp;lt;P_IN&amp;gt; R evaluateSequential(PipelineHelper&amp;lt;T&amp;gt; helper,\n                                   Spliterator&amp;lt;P_IN&amp;gt; spliterator) {\n    //è°ƒç”¨wrapAndCopyInto()æ–¹æ³•\n    return helper.wrapAndCopyInto(makeSink(), spliterator).get();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;wrapandcopyinto\&#34;&gt;wrapAndCopyInto()&lt;/h4&gt;\n&lt;p&gt;ä¿è¯æ‰€æœ‰stage -&amp;gt; sinké“¾è¡¨ï¼Œç„¶åæ‰§è¡ŒcopyInto()æ–¹æ³•&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;\t@Override\n    final &amp;lt;P_IN, S extends Sink&amp;lt;E_OUT&amp;gt;&amp;gt; S wrapAndCopyInto(S sink, Spliterator&amp;lt;P_IN&amp;gt; spliterator) {\n        copyInto(wrapSink(Objects.requireNonNull(sink)), spliterator);\n        return sink;\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;warpsink\&#34;&gt;warpSink()&lt;/h4&gt;\n&lt;p&gt;å°±æ˜¯åœ¨è¿™é‡Œï¼Œä»åå‘å‰ï¼ŒåŒ…è£…æ‰€æœ‰çš„stageé˜¶æ®µï¼Œå½¢æˆä¸€æ¡sinké“¾è¡¨ã€‚è¿™æ ·å°†ä¹‹å‰ä¸€ä¸ªä¸ªstageçš„é“¾è¡¨ç»“æ„åŒ…è£…æˆä¸€ä¸ªä¸ªSinkã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;\t@Override\n    @SuppressWarnings(&amp;quot;unchecked&amp;quot;)\n    final &amp;lt;P_IN&amp;gt; Sink&amp;lt;P_IN&amp;gt; wrapSink(Sink&amp;lt;E_OUT&amp;gt; sink) {\n        Objects.requireNonNull(sink);\n\t\t\n        //ä»åå‘å‰éå†\n        for ( @SuppressWarnings(&amp;quot;rawtypes&amp;quot;) AbstractPipeline p=AbstractPipeline.this; p.depth &amp;gt; 0; p=p.previousStage) {\n            //æ‰§è¡Œæ¯ä¸ªopWrapSink()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨æ¯ä¸ªæ“ä½œç±»ä¸­éƒ½è¿›è¡Œäº†é‡å†™\n            sink = p.opWrapSink(p.previousStage.combinedFlags, sink);\n        }\n        //è¿”å›å¤´sink\n        return (Sink&amp;lt;P_IN&amp;gt;) sink;\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;copyinto\&#34;&gt;copyInto()&lt;/h4&gt;\n&lt;p&gt;è¿™ä¸ªæ–¹æ³•æ˜¯æ•´ä¸ªæµæ°´çº¿çš„å¯åŠ¨å¼€å…³ï¼Œæµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;è°ƒç”¨ç¬¬ä¸€ä¸ªsinkçš„begin()æ–¹æ³•&lt;/li&gt;\n&lt;li&gt;æ‰§è¡Œæ•°æ®æºçš„spliterator.forEachRemaining(wrappendSink)æ–¹æ³•éå†è°ƒç”¨accept()æ–¹æ³•&lt;/li&gt;\n&lt;li&gt;end() é€šçŸ¥ç»“æŸ&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;\t@Override\n    final &amp;lt;P_IN&amp;gt; void copyInto(Sink&amp;lt;P_IN&amp;gt; wrappedSink, Spliterator&amp;lt;P_IN&amp;gt; spliterator) {\n        Objects.requireNonNull(wrappedSink);\n\n        if (!StreamOpFlag.SHORT_CIRCUIT.isKnown(getStreamAndOpFlags())) {\n            //é€šçŸ¥ç¬¬ä¸€ä¸ªsinkï¼Œåšå¥½å‡†å¤‡æ¥å—æµ\n            wrappedSink.begin(spliterator.getExactSizeIfKnown());\n            //æ‰§è¡Œ\n            spliterator.forEachRemaining(wrappedSink);\n            wrappedSink.end();\n        }\n        else {\n            copyIntoWithCancel(wrappedSink, spliterator);\n        }\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;foreachremaining\&#34;&gt;forEachRemaining()&lt;/h4&gt;\n&lt;p&gt;åœ¨å„ä¸ªå®¹å™¨ä¸­éƒ½æœ‰å®ç°forEachRemaining()è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨ArrayListä¸­:&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public boolean tryAdvance(Consumer&amp;lt;? super E&amp;gt; action) {\n    if (action == null)\n        throw new NullPointerException();\n    int hi = getFence(), i = index;\n    if (i &amp;lt; hi) {\n        index = i + 1;\n        @SuppressWarnings(&amp;quot;unchecked&amp;quot;) E e = (E)list.elementData[i];\n        //æ‰§è¡Œaccept()æ–¹æ³•\n        action.accept(e);\n        if (list.modCount != expectedModCount)\n            throw new ConcurrentModificationException();\n        return true;\n    }\n    return false;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;å…¶ä»–ç»ˆç»“æ“ä½œ\&#34;&gt;å…¶ä»–ç»ˆç»“æ“ä½œ&lt;/h3&gt;\n&lt;h4 id=\&#34;foreach\&#34;&gt;forEach()&lt;/h4&gt;\n&lt;p&gt;åœ¨&lt;code&gt;ReferencePipeline&lt;/code&gt;ç±»ä¸­ï¼Œå®ç°äº†forEach()æ–¹æ³•ï¼Œ&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;// from ReferencePipeline.class\n\n@Override\npublic void forEach(Consumer&amp;lt;? super P_OUT&amp;gt; action) {\n    // ForEachOps..\n    evaluate(ForEachOps.makeRef(action, false));\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;evaluateåé¢çš„é€»è¾‘ä¸countåé¢çš„ä¸€æ ·äº†ï¼Œç•¥ã€‚&lt;/p&gt;\n&lt;h4 id=\&#34;findfirst-anymatch\&#34;&gt;findFirst() anyMatch()&lt;/h4&gt;\n&lt;p&gt;findFirst()å’ŒanyMatch()çš„é€»è¾‘ä¹Ÿä¸å†å¤šè¯´äº†ï¼Œä¸€ä¸ªå¥—è·¯ï¼Œçœ‹ä¸‹å®ç°&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Override\npublic final Optional&amp;lt;P_OUT&amp;gt; findFirst() {\n    return evaluate(FindOps.makeRef(true));\n}\n\n@Override\npublic final boolean anyMatch(Predicate&amp;lt;? super P_OUT&amp;gt; predicate) {\n    return evaluate(MatchOps.makeRef(predicate, MatchOps.MatchKind.ANY));\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;ç–‘é—®è§£ç­”\&#34;&gt;ç–‘é—®è§£ç­”&lt;/h3&gt;\n&lt;ol&gt;\n&lt;li&gt;ç»ˆç»“æ–¹æ³•æ˜¯å¦‚ä½•è¿›è¡Œæ“ä½œçš„ï¼Ÿ\n&lt;ul&gt;\n&lt;li&gt;ç»ˆç»“æ“ä½œçš„å®ç°é‡Œé¢éƒ½æœ‰è°ƒç”¨evaluate()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æœ€åä¼šwarpæ‰€æœ‰æ“ä½œå˜æˆä¸€ä¸²sinkï¼Œç„¶åä»å¤´å¼€å§‹æ‰§è¡Œbegin(),accept(),end()æ–¹æ³•&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;å¦‚ä½•å®ç°ç”±ç»ˆç»“æ“ä½œè§¦å‘æµçš„è¿ä½œçš„ï¼Ÿ\n&lt;ul&gt;\n&lt;li&gt;è§¦å‘çš„å¼€å…³æ˜¯wrapAndCopyInto(),è¿™ä¸ªæ–¹æ³•åªæœ‰åœ¨ç»ˆç»“æ“ä½œä¸­æ‰æœ‰è¢«è°ƒç”¨ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;å¦‚ä½•ä¿è¯ä¸€ä¸ªæµä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªç»ˆç»“æ–¹æ³•ï¼Ÿ\n&lt;ul&gt;\n&lt;li&gt;evaluate()æ–¹æ³•ä¸­æ‰§è¡Œä¸€æ¬¡å&lt;code&gt;linkedOrConsumed&lt;/code&gt;è®¾ä¸ºtrueï¼Œåç»­å†å‡ºå‘evaluate()æ–¹æ³•å°±ä¼šå¼‚å¸¸ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;å‚è€ƒå¼•ç”¨ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;https://colobu.com/2014/11/18/Java-8-Stream/\&#34;&gt;Java 8 Streamæ¢ç§˜ (colobu.com)&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;\&#34;&gt;åŸæ¥ä½ æ˜¯è¿™æ ·çš„ Streamï¼šæµ…æ Java Stream å®ç°åŸç† (https_toutiao.io)&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&#34;,&#34;fileName&#34;:&#34;shen-ru-jie-xi-java-streamxia-zhong-jie-cao-zuo&#34;,&#34;abstract&#34;:&#34;&lt;h3 id=\&#34;å‡ ä¸ªç–‘é—®\&#34;&gt;å‡ ä¸ªç–‘é—®&lt;/h3&gt;\n&lt;ol&gt;\n&lt;li&gt;ç»ˆç»“æ–¹æ³•æ˜¯å¦‚ä½•è¿›è¡Œæ“ä½œçš„ï¼Ÿ&lt;/li&gt;\n&lt;li&gt;å¦‚ä½•å®ç°ç”±ç»ˆç»“æ“ä½œè§¦å‘æµçš„è¿ä½œçš„ï¼Ÿ&lt;/li&gt;\n&lt;li&gt;å¦‚ä½•ä¿è¯ä¸€ä¸ªæµä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªç»ˆç»“æ–¹æ³•ï¼Ÿ&lt;/li&gt;\n&lt;/ol&gt;\n&#34;,&#34;title&#34;:&#34;æ·±å…¥è§£æJava Streamï¼ˆä¸‹ï¼‰ï¼šç»ˆç»“æ“ä½œ&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;æºç &#34;,&#34;slug&#34;:&#34;yuan-ma&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/yuan-ma/&#34;},{&#34;name&#34;:&#34;Java&#34;,&#34;slug&#34;:&#34;6j9B3b2nb&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/6j9B3b2nb/&#34;}],&#34;date&#34;:&#34;2021-08-06 11:13:20&#34;,&#34;dateFormat&#34;:&#34;2021-08-06 11:13:20&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/shen-ru-jie-xi-java-streamxia-zhong-jie-cao-zuo/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;7 min read&#34;,&#34;time&#34;:377000,&#34;words&#34;:1321,&#34;minutes&#34;:7},&#34;description&#34;:&#34;å‡ ä¸ªç–‘é—®\n\nç»ˆç»“æ–¹æ³•æ˜¯å¦‚ä½•è¿›è¡Œæ“ä½œçš„ï¼Ÿ\nå¦‚ä½•å®ç°ç”±ç»ˆç»“æ“ä½œè§¦å‘æµçš„è¿ä½œçš„ï¼Ÿ\nå¦‚ä½•ä¿è¯ä¸€ä¸ªæµä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªç»ˆç»“æ–¹æ³•ï¼Ÿ\n\n\nä½¿ç”¨æ–¹å¼\nåˆ—ä¸¾å››ç§ç»ˆç»“æ“ä½œï¼Œåœ¨Streamæä¾›çš„APIä¸­ï¼Œä¹Ÿæ˜¯å››ç±»ï¼š\n\n// è®¡ç®—æµä¸­å…ƒç´ æ•°é‡ï¼ŒFindOP\nlong...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%87%A0%E4%B8%AA%E7%96%91%E9%97%AE\&#34;&gt;å‡ ä¸ªç–‘é—®&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F\&#34;&gt;ä½¿ç”¨æ–¹å¼&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#count\&#34;&gt;count()&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#maotolong\&#34;&gt;maoToLong()&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#reduce\&#34;&gt;reduce()&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#evaluate\&#34;&gt;evaluate()&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#wrapandcopyinto\&#34;&gt;wrapAndCopyInto()&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#warpsink\&#34;&gt;warpSink()&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#copyinto\&#34;&gt;copyInto()&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#foreachremaining\&#34;&gt;forEachRemaining()&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%B6%E4%BB%96%E7%BB%88%E7%BB%93%E6%93%8D%E4%BD%9C\&#34;&gt;å…¶ä»–ç»ˆç»“æ“ä½œ&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#foreach\&#34;&gt;forEach()&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#findfirst-anymatch\&#34;&gt;findFirst() anyMatch()&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%96%91%E9%97%AE%E8%A7%A3%E7%AD%94\&#34;&gt;ç–‘é—®è§£ç­”&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h3 id=\&#34;å‡ ä¸ªç–‘é—®\&#34;&gt;å‡ ä¸ªç–‘é—®&lt;/h3&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;strong&gt;å„ä¸ªä¸­é—´æ“ä½œæ˜¯å¦‚ä½•è¿›è¡Œå…³è”çš„ï¼Ÿ&lt;/strong&gt;&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;å¦‚ä½•æ‰§è¡Œå®Œä¸€ä¸ªä¸­é—´æ“ä½œï¼Œç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ªï¼Ÿ&lt;/strong&gt;&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;æœ‰çŠ¶æ€çš„ä¸­é—´æ“ä½œæ˜¯æ€ä¹ˆä¿å­˜çŠ¶æ€çš„ï¼Ÿ&lt;/strong&gt;&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;æ‡’åŠ è½½å¦‚ä½•å®ç°çš„&lt;/strong&gt;&lt;/li&gt;\n&lt;/ol&gt;\n&lt;!-- more --&gt;\n&lt;h3 id=\&#34;ä½¿ç”¨æ–¹å¼\&#34;&gt;ä½¿ç”¨æ–¹å¼&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;Stream&amp;lt;Integer&amp;gt; st = headStream.filter(e-&amp;gt; e=1).distinct().sort();\n//ç­‰åŒäº\nStream&amp;lt;Integer&amp;gt; afterFilter = headStream.filter(e -&amp;gt; e != 2);\nStream&amp;lt;Integer&amp;gt; afterDistinct = afterFilter.distinct();\nStream&amp;lt;Integer&amp;gt; afterSort = afterDistinct.sort();\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;filter\&#34;&gt;Filter&lt;/h3&gt;\n&lt;p&gt;æ‰§è¡Œfilter(op)ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;Stream&amp;lt;Integer&amp;gt; afterFilter = head.filter(e -&amp;gt; e = 1);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;filter()æ–¹æ³•å®šä¹‰åœ¨&lt;code&gt;Stream&lt;/code&gt;ç±»ï¼Œå®ç°åœ¨&lt;code&gt;ReferencePipeline&lt;/code&gt;ç±»ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;//ReferencePipeline.class\n\n@Override\npublic final Stream&amp;lt;P_OUT&amp;gt; filter(Predicate&amp;lt;? super P_OUT&amp;gt; predicate) {\n    Objects.requireNonNull(predicate);\n\n    // è¿”å›ä¸€ä¸ªStatelessOpç±»\n    // æ„é€ å‡½æ•°å‚æ•°ä¸º(this,)\n    return new StatelessOp&amp;lt;P_OUT, P_OUT&amp;gt;(this, StreamShape.REFERENCE,\n                                         StreamOpFlag.NOT_SIZED) {\n        @Override\n        Sink&amp;lt;P_OUT&amp;gt; opWrapSink(int flags, Sink&amp;lt;P_OUT&amp;gt; sink) {\n            return new Sink.ChainedReference&amp;lt;P_OUT, P_OUT&amp;gt;(sink) {\n                @Override\n                public void begin(long size) {\n                    downstream.begin(-1);\n                }\n\n                @Override\n                public void accept(P_OUT u) {\n                    if (predicate.test(u))\n                        downstream.accept(u);\n                }\n            };\n        }\n    };\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;è¿”å›ä¸€ä¸ª&lt;code&gt;StatelessOp&lt;/code&gt;ç±»(å› ä¸ºfilteræ˜¯ä¸€ä¸ªæ— çŠ¶æ€æ“ä½œ)ï¼Œçœ‹ä¸‹&lt;code&gt;StatelessOp&lt;/code&gt;ç±»,æ˜¯ä¸€ä¸ªé™æ€æŠ½è±¡å†…éƒ¨ç±»ï¼Œç»§æ‰¿äº†&lt;code&gt;ReferencePipeline&lt;/code&gt;ç±»ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;//ReferencePipeline.class\n\n    /**\n     * Base class for a stateless intermediate stage of a Stream.\n     *\n     * @param &amp;lt;E_IN&amp;gt; type of elements in the upstream source\n     * @param &amp;lt;E_OUT&amp;gt; type of elements in produced by this stage\n     * @since 1.8\n     */\n    abstract static class StatelessOp&amp;lt;E_IN, E_OUT&amp;gt;\n            extends ReferencePipeline&amp;lt;E_IN, E_OUT&amp;gt; {\n        /**\n         * Construct a new Stream by appending a stateless intermediate\n         * operation to an existing stream.\n         *\n         * @param upstream The upstream pipeline stage\n         * @param inputShape The stream shape for the upstream pipeline stage\n         * @param opFlags Operation flags for the new stage\n         */\n        StatelessOp(AbstractPipeline&amp;lt;?, E_IN, ?&amp;gt; upstream,\n                    StreamShape inputShape,\n                    int opFlags) {\n            super(upstream, opFlags);\n            assert upstream.getOutputShape() == inputShape;\n        }\n\n        @Override\n        final boolean opIsStateful() {\n            return false;\n        }\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ä¸­é—´super()ä¼šæ‰§è¡Œ&lt;code&gt;AbstractPipeline&lt;/code&gt;ç±»çš„æ„é€ æ–¹æ³•, è¿æ¥stageä¹‹é—´çš„å…³ç³»&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;//AbstractPipeline.class\n\n    /**\n     * Constructor for appending an intermediate operation stage onto an\n     * existing pipeline.\n     *\n     * @param previousStage the upstream pipeline stage\n     * @param opFlags the operation flags for the new stage, described in\n     * {@link StreamOpFlag}\n     */\n    AbstractPipeline(AbstractPipeline&amp;lt;?, E_IN, ?&amp;gt; previousStage, int opFlags) {\n        if (previousStage.linkedOrConsumed)\n            throw new IllegalStateException(MSG_STREAM_LINKED);\n        previousStage.linkedOrConsumed = true;\n        previousStage.nextStage = this;\n\n        this.previousStage = previousStage;\n        this.sourceOrOpFlags = opFlags &amp;amp; StreamOpFlag.OP_MASK;\n        this.combinedFlags = StreamOpFlag.combineOpFlags(opFlags, previousStage.combinedFlags);\n        this.sourceStage = previousStage.sourceStage;\n        if (opIsStateful())\n            sourceStage.sourceAnyStateful = true;\n        this.depth = previousStage.depth + 1;\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f83eb7d9726541b5826f8d5bcfef7538~tplv-k3u1fbpfcp-watermark.image\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;distinct\&#34;&gt;Distinct&lt;/h3&gt;\n&lt;p&gt;ç¤ºä¾‹&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;Stream&amp;lt;Integer&amp;gt; afterDistinct = afterFilter.distinct();\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;distinctçš„æ–¹æ³•å®ç°åœ¨&lt;code&gt;ReferencePipeline&lt;/code&gt;ç±»ä¸‹&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Override\npublic final Stream&amp;lt;P_OUT&amp;gt; distinct() {\n    return DistinctOps.makeRef(this);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;è°ƒç”¨DistinctOpsç±»çš„makeRef()æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªStatefulOpç±»ï¼Œå¹¶é‡å†™äº†4ä¸ªæ–¹æ³•ï¼Œå®ç°é€»è¾‘åœ¨opWrapSink()ä¸­:&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;    /**\n     * Appends a &amp;quot;distinct&amp;quot; operation to the provided stream, and returns the\n     * new stream.\n     *\n     * @param &amp;lt;T&amp;gt; the type of both input and output elements\n     * @param upstream a reference stream with element type T\n     * @return the new stream\n     */\n    static &amp;lt;T&amp;gt; ReferencePipeline&amp;lt;T, T&amp;gt; makeRef(AbstractPipeline&amp;lt;?, T, ?&amp;gt; upstream) {\n        // è¿”å›ä¸€ä¸ªStatefulOpç±»\n        return new ReferencePipeline.StatefulOp&amp;lt;T, T&amp;gt;(upstream, StreamShape.REFERENCE,\n                                                      StreamOpFlag.IS_DISTINCT | StreamOpFlag.NOT_SIZED) {\n\n            // é‡å†™äº†ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼Œå†…å®¹çœç•¥...\n            &amp;lt;P_IN&amp;gt; Node&amp;lt;T&amp;gt; reduce(PipelineHelper&amp;lt;T&amp;gt; helper, Spliterator&amp;lt;P_IN&amp;gt; spliterator) {...}\n\n            @Override\n            &amp;lt;P_IN&amp;gt; Node&amp;lt;T&amp;gt; opEvaluateParallel(PipelineHelper&amp;lt;T&amp;gt; helper,\n                                              Spliterator&amp;lt;P_IN&amp;gt; spliterator,\n                                              IntFunction&amp;lt;T[]&amp;gt; generator) {...}\n\n            @Override\n            &amp;lt;P_IN&amp;gt; Spliterator&amp;lt;T&amp;gt; opEvaluateParallelLazy(PipelineHelper&amp;lt;T&amp;gt; helper, Spliterator&amp;lt;P_IN&amp;gt; spliterator) {...}\n\n            @Override\n            Sink&amp;lt;T&amp;gt; opWrapSink(int flags, Sink&amp;lt;T&amp;gt; sink) {\n                Objects.requireNonNull(sink);\n\n                if (StreamOpFlag.DISTINCT.isKnown(flags)) {\n                    ...\n                } else if (StreamOpFlag.SORTED.isKnown(flags)) {\n                    ...\n                } else {\n                    // è¿”å›ä¸€ä¸ªSinkChainedReferenceç±»\n                    return new Sink.ChainedReference&amp;lt;T, T&amp;gt;(sink) {\n                        //ä½¿ç”¨ä¸€ä¸ªSetç¼“å­˜æ•°æ®ï¼Œè¿›è¡Œå»é‡\n                        Set&amp;lt;T&amp;gt; seen;\n\n                        //å½“ä¸Šæ¸¸é€šçŸ¥beginçš„æ—¶å€™ï¼Œåˆå§‹åŒ–Set\n                        @Override\n                        public void begin(long size) {\n                            seen = new HashSet&amp;lt;&amp;gt;();\n                            downstream.begin(-1);\n                        }\n\n                        //ç•¥\n                        @Override\n                        public void end() {\n                            seen = null;\n                            downstream.end();\n                        }\n\n                        //å¦‚æœå·²ç»å­˜åœ¨ï¼Œä¹‹é—´æŠ›å¼ƒ\n                        @Override\n                        public void accept(T t) {\n                            if (!seen.contains(t)) {\n                                seen.add(t);\n                                downstream.accept(t);\n                            }\n                        }\n                    };\n                }\n            }\n        };\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;StatefulOpç±»ä¸StatelessOpç±»ç›¸ä¼¼,éƒ½æ˜¯ç»§æ‰¿äº†&lt;code&gt;ReferencePipeline&lt;/code&gt;ç±»ï¼Œç„¶åä¸­é—´super()é¡µä¼šæ‰§è¡Œ&lt;code&gt;AbstractPipeline&lt;/code&gt;ç±»çš„æ„é€ æ–¹æ³•, è¿æ¥stageä¹‹é—´çš„å…³ç³»&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;    /**\n     * Base class for a stateful intermediate stage of a Stream.\n     *\n     * @param &amp;lt;E_IN&amp;gt; type of elements in the upstream source\n     * @param &amp;lt;E_OUT&amp;gt; type of elements in produced by this stage\n     * @since 1.8\n     */\n    abstract static class StatefulOp&amp;lt;E_IN, E_OUT&amp;gt; extends ReferencePipeline&amp;lt;E_IN, E_OUT&amp;gt; {\n \t\t//çœç•¥\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6c1bb602651a41efb5b38673063b1523~tplv-k3u1fbpfcp-watermark.image\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;è‡³äºå…¶ä»–çš„ä¸­é—´æ“ä½œï¼Œå¥—è·¯éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œæ“ä½œé€»è¾‘å°è£…åœ¨&lt;code&gt;opWrapSink()&lt;/code&gt;æ–¹æ³•é‡Œ, å¯ä»¥æ…¢æ…¢çš„çœ‹ã€‚&lt;/p&gt;\n&lt;h3 id=\&#34;ç–‘é—®è§£ç­”\&#34;&gt;ç–‘é—®è§£ç­”&lt;/h3&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;strong&gt;å„ä¸ªä¸­é—´æ“ä½œæ˜¯å¦‚ä½•è¿›è¡Œå…³è”çš„ï¼Ÿ&lt;/strong&gt;\n&lt;ul&gt;\n&lt;li&gt;ä¸€ä¸ªä¸ªçš„æ“ä½œå°è£…æˆäº†ä¸€ä¸ªä¸ªçš„&lt;code&gt;statelessOp&lt;/code&gt;æˆ–&lt;code&gt;stateFulOp&lt;/code&gt;å¯¹è±¡ï¼Œä»¥åŒå‘é“¾è¡¨çš„æ–¹æ³•ä¸²èµ·æ¥ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;å¦‚ä½•æ‰§è¡Œå®Œä¸€ä¸ªä¸­é—´æ“ä½œï¼Œç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ªï¼Ÿ&lt;/strong&gt;\n&lt;ul&gt;\n&lt;li&gt;Sinkç±»è´Ÿè´£æµæ°´çº¿æ“ä½œçš„æ‰¿æ¥ä¸Šä¸‹æ¸¸å’Œæ‰§è¡Œæ“ä½œçš„ä»»åŠ¡ï¼Œæ ¸å¿ƒæ–¹æ³•ä¸ºbegain()ã€accept()ã€end()ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;æœ‰çŠ¶æ€çš„ä¸­é—´æ“ä½œæ˜¯æ€ä¹ˆä¿å­˜çŠ¶æ€çš„ï¼Ÿ&lt;/strong&gt;\n&lt;ul&gt;\n&lt;li&gt;æœ‰çŠ¶æ€çš„ä¸­é—´æ“ä½œå°è£…æˆ&lt;code&gt;stateFulOp&lt;/code&gt;å¯¹è±¡ï¼Œå„è‡ªéƒ½æœ‰ç‹¬ç«‹çš„é€»è¾‘ï¼Œå…·ä½“çš„å‚è€ƒ&lt;code&gt;sort()&lt;/code&gt;çš„å®ç°é€»è¾‘ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;æ‡’åŠ è½½å¦‚ä½•å®ç°çš„&lt;/strong&gt;\n&lt;ul&gt;\n&lt;li&gt;æ¯ä¸ªä¸­é—´æ“ä½œè°ƒç”¨åï¼Œåªæ˜¯appendåœ¨æµç¨‹çš„å°¾éƒ¨ï¼Œä¿å­˜äº†å…³è”å…³ç³»è€Œå·²ã€‚&lt;/li&gt;\n&lt;li&gt;æµæ°´çº¿æ“ä½œçš„å¯åŠ¨ï¼Œè¦äº¤ç»™wrapAndCopyInto()æ–¹æ³•è°ƒç”¨Headçš„Sink()æ“ä½œï¼Œè€ŒwrapAndCopyInto()æ–¹æ³•éƒ½éœ€è¦ç”±ç»ˆç»“æ“ä½œè¿›è¡Œè§¦å‘ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&#34;,&#34;fileName&#34;:&#34;shen-ru-jie-xi-java-streamzhong-op-cao-zuo-liu&#34;,&#34;abstract&#34;:&#34;&lt;h3 id=\&#34;å‡ ä¸ªç–‘é—®\&#34;&gt;å‡ ä¸ªç–‘é—®&lt;/h3&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;strong&gt;å„ä¸ªä¸­é—´æ“ä½œæ˜¯å¦‚ä½•è¿›è¡Œå…³è”çš„ï¼Ÿ&lt;/strong&gt;&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;å¦‚ä½•æ‰§è¡Œå®Œä¸€ä¸ªä¸­é—´æ“ä½œï¼Œç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ªï¼Ÿ&lt;/strong&gt;&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;æœ‰çŠ¶æ€çš„ä¸­é—´æ“ä½œæ˜¯æ€ä¹ˆä¿å­˜çŠ¶æ€çš„ï¼Ÿ&lt;/strong&gt;&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;æ‡’åŠ è½½å¦‚ä½•å®ç°çš„&lt;/strong&gt;&lt;/li&gt;\n&lt;/ol&gt;\n&#34;,&#34;title&#34;:&#34;æ·±å…¥è§£æJava Streamï¼ˆä¸­ï¼‰ï¼šOPæ“ä½œæµ&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Java&#34;,&#34;slug&#34;:&#34;6j9B3b2nb&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/6j9B3b2nb/&#34;}],&#34;date&#34;:&#34;2021-07-22 18:09:33&#34;,&#34;dateFormat&#34;:&#34;2021-07-22 06:09:33&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/shen-ru-jie-xi-java-streamzhong-op-cao-zuo-liu/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;6 min read&#34;,&#34;time&#34;:342000,&#34;words&#34;:1152,&#34;minutes&#34;:6},&#34;description&#34;:&#34;å‡ ä¸ªç–‘é—®\n\nå„ä¸ªä¸­é—´æ“ä½œæ˜¯å¦‚ä½•è¿›è¡Œå…³è”çš„ï¼Ÿ\nå¦‚ä½•æ‰§è¡Œå®Œä¸€ä¸ªä¸­é—´æ“ä½œï¼Œç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ªï¼Ÿ\næœ‰çŠ¶æ€çš„ä¸­é—´æ“ä½œæ˜¯æ€ä¹ˆä¿å­˜çŠ¶æ€çš„ï¼Ÿ\næ‡’åŠ è½½å¦‚ä½•å®ç°çš„\n\n\nä½¿ç”¨æ–¹å¼\nStream&amp;lt;Integer&amp;gt; st = headStream.filte...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%87%A0%E4%B8%AA%E7%96%91%E9%97%AE\&#34;&gt;å‡ ä¸ªç–‘é—®&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F\&#34;&gt;ä½¿ç”¨æ–¹å¼&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#filter\&#34;&gt;Filter&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#distinct\&#34;&gt;Distinct&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%96%91%E9%97%AE%E8%A7%A3%E7%AD%94\&#34;&gt;ç–‘é—®è§£ç­”&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;äº†è§£Streamä¸­Sinkå’ŒPiplineçš„æ¦‚å¿µï¼Œä»¥åŠå‰–æStreamæ˜¯å¦‚ä½•åˆ›å»ºã€‚&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;!-- more --&gt;\n&lt;h2 id=\&#34;ç±»å›¾\&#34;&gt;ç±»å›¾&lt;/h2&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1fccb594381b4b488f58abd47d935f06~tplv-k3u1fbpfcp-watermark.image\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h2 id=\&#34;æ¦‚å¿µè§£é‡Š\&#34;&gt;æ¦‚å¿µè§£é‡Š&lt;/h2&gt;\n&lt;h3 id=\&#34;piplineå’Œstage\&#34;&gt;Piplineå’ŒStage&lt;/h3&gt;\n&lt;p&gt;Piplineæ˜¯æµæ°´çº¿ï¼Œè¡¨ç¤ºä¸€æ•´ä¸ªæµç¨‹ã€‚Stageè¡¨ç¤ºæµæ°´çº¿çš„å…¶ä¸­ä¸€ä¸ªé˜¶æ®µã€‚æ˜¯ä¸€ä¸ªæ¯”è¾ƒæŠ½è±¡å±‚é¢çš„æè¿°ï¼Œå› ä¸ºstageä¸»è¦è¡¨ç¤ºä¸€ç§é€»è¾‘ä¸Šçš„é¡ºåºå…³ç³»ï¼Œè€Œå…·ä½“æ¯ä¸€ä¸ªé˜¶æ®µè¦å¹²å˜›ã€æ€ä¹ˆå¹²ï¼Œä½¿ç”¨Sinkæ¥è¿›è¡Œæè¿°ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;new stream          //stage 0\n    .filter()       //stage 1\n    .sort()         //stage 2\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/37dd9b847b014b8c9ae5710c0be1907c~tplv-k3u1fbpfcp-watermark.image\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;sink\&#34;&gt;Sink&lt;/h3&gt;\n&lt;p&gt;ç›´è¯‘ä¸ºæ°´æ§½ï¼Œç”Ÿæ´»ä¸­æ°´æ§½çš„ä½œç”¨æ— é&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;æ‰“å¼€æ°´é¾™å¤´ï¼ŒçŸ¥é“æœ‰æ°´è¦æ¥&lt;/li&gt;\n&lt;li&gt;æ°´åœ¨æ°´æ§½é‡Œ, å¯ä»¥è¿›è¡Œä¸€äº›æ“ä½œ&lt;/li&gt;\n&lt;li&gt;æ‰“å¼€æ°´é—¸ï¼Œæ”¾æ°´&lt;br&gt;\nJavaä¸­çš„Sinkæ ¸å¿ƒåŠŸèƒ½ä¸ºï¼š&lt;/li&gt;\n&lt;li&gt;begin(): å‘Šè¯‰è¯¥æ°´æ§½æ°´æµè¦æ¥äº†ï¼Œå¯ä»¥è¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œ&lt;/li&gt;\n&lt;li&gt;accept()ï¼šæ¥å—æ°´æµï¼Œç„¶åè¿›è¡Œæ“ä½œ&lt;/li&gt;\n&lt;li&gt;end()ï¼šæ°´æµå…¨éƒ¨å¤„ç†å®Œäº†ã€‚&lt;br&gt;\nçœ‹ä¸€ä¸ªsort()çš„ç¤ºä¾‹,sortè¿™ä¸ªstageçš„ç›®çš„å°±æ˜¯å¯¹æ‰€æœ‰æ°´æµè¿›è¡Œæ’åºï¼Œç„¶åå†æµåˆ°ä¸‹æ¸¸ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;private static final class SizedRefSortingSink&amp;lt;T&amp;gt; extends AbstractRefSortingSink&amp;lt;T&amp;gt; {\n        private T[] array;  //è¦è¿›è¡Œæ’åºï¼Œéœ€è¦ä¸€ä¸ªæ•°ç»„è¿›è¡Œç¼“å­˜\n        private int offset; \n\n        SizedRefSortingSink(Sink&amp;lt;? super T&amp;gt; sink, Comparator&amp;lt;? super T&amp;gt; comparator) {\n            super(sink, comparator);\n        }\n\n        @Override\n        @SuppressWarnings(&amp;quot;unchecked&amp;quot;)\n        public void begin(long size) {\n            if (size &amp;gt;= Nodes.MAX_ARRAY_SIZE)\n                throw new IllegalArgumentException(Nodes.BAD_SIZE);\n            //ä¸Šæ¸¸è°ƒç”¨begin(),é€šçŸ¥sortè¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œç”Ÿäº§ä¸€ä¸ªæ•°ç»„\n            array = (T[]) new Object[(int) size];\n        }\n\n    \t//ä¸Šæ¸¸è°ƒç”¨end()æ–¹æ³•ï¼Œå‘Šè¯‰sortæ°´å·²ç»å…¨éƒ¨æµè¿‡æ¥äº†ã€‚sortå¼€å§‹æ‰§è¡Œæ“ä½œ\n        @Override\n        public void end() {\n            //æ“ä½œ\n            Arrays.sort(array, 0, offset, comparator);\n            //å‘Šè¯‰sortçš„ä¸‹æ¸¸å‡†å¤‡æ¥å—æ°´æµ\n            downstream.begin(offset);\n            //ä¸€ä¸ªä¸ªå…ƒç´ çš„ä¼ é€’ç»™ä¸‹æ¸¸\n            if (!cancellationWasRequested) {\n                for (int i = 0; i &amp;lt; offset; i++)\n                    downstream.accept(array[i]);\n            }\n            else {\n                for (int i = 0; i &amp;lt; offset &amp;amp;&amp;amp; !downstream.cancellationRequested(); i++)\n                    downstream.accept(array[i]);\n            }\n            //å‘Šè¯‰ä¸‹æ¸¸æ°´æµä¼ é€’ç»“æŸ\n            downstream.end();\n            //ç¼“å­˜æ¸…ç©º\n            array = null;\n        }\n\n    \t//ä¸Šæ¸¸è°ƒç”¨accept()æ–¹æ³•ï¼Œå°†æ°´æµå­˜å‚¨åˆ°åˆ°sortçš„ç¼“å­˜æ•°ç»„ä¸­\n        @Override\n        public void accept(T t) {\n            array[offset++] = t;\n        }\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;åˆ›å»ºhead\&#34;&gt;åˆ›å»ºHead&lt;/h2&gt;\n&lt;h3 id=\&#34;ç–‘é—®\&#34;&gt;ç–‘é—®&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;å®˜æ–¹è¯´Streamä¸å­˜å‚¨æ•°æ®ï¼Œé‚£ä¹ˆæ•°æ®ä¿å­˜åœ¨é‚£é‡Œå‘¢ï¼Ÿ&lt;br&gt;\nè§£ç­”åœ¨åé¢ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;ä½¿ç”¨æ–¹å¼\&#34;&gt;ä½¿ç”¨æ–¹å¼&lt;/h3&gt;\n&lt;p&gt;å¯ä»¥ä½¿ç”¨Stream.of()åˆ›å»ºä¸€ä¸ªæµï¼Œä¾‹å¦‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;//åˆ›å»ºæ–¹å¼ of()\nStream&amp;lt;Integer&amp;gt; stream = Stream.of(1, 2, 3);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;æºç åˆ†æ\&#34;&gt;æºç åˆ†æ&lt;/h3&gt;\n&lt;p&gt;of()æ–¹æ³•è°ƒç”¨&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;StreamSupport.stream(Arrays.spliterator(arr, 0, arr.length), false);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;stream()æ–¹æ³•é€»è¾‘ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public static &amp;lt;T&amp;gt; Stream&amp;lt;T&amp;gt; stream(Spliterator&amp;lt;T&amp;gt; spliterator, boolean parallel) {\n    Objects.requireNonNull(spliterator);\n    return new ReferencePipeline.Head&amp;lt;&amp;gt;(spliterator,\n                                        StreamOpFlag.fromCharacteristics(spliterator),\n                                        parallel);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;è°ƒç”¨äº†&lt;code&gt;ReferencePipeline.Head&amp;lt;&amp;gt;&lt;/code&gt;ï¼Œè¿”å›ä¸€ä¸ªHeadå¯¹è±¡ã€‚Headæ˜¯ReferencePipelineçš„å­ç±»ã€‚å¯ä»¥ç†è§£ä¸ºHeadæ˜¯æµæ°´çº¿çš„ç¬¬ä¸€ä¸ªstageã€‚&lt;br&gt;\næ„é€ æ–¹æ³•çš„ä¸»è¦äº†é€»è¾‘è¦ä¸€ç›´super()åˆ°&lt;code&gt;AbstractPipeline&lt;/code&gt;ç±»&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;    /**\n     * The source spliterator. Only valid for the head pipeline.\n     * Before the pipeline is consumed if non-null then {@code sourceSupplier}\n     * must be null. After the pipeline is consumed if non-null then is set to\n     * null.\n     */\n    private Spliterator&amp;lt;?&amp;gt; sourceSpliterator;\n\n    /**\n     * Constructor for the head of a stream pipeline.\n     *\n     * @param source {@code Spliterator} describing the stream source\n     * @param sourceFlags the source flags for the stream source, described in\n     * {@link StreamOpFlag}\n     * @param parallel {@code true} if the pipeline is parallel\n     */\n    AbstractPipeline(Spliterator&amp;lt;?&amp;gt; source,\n                     int sourceFlags, boolean parallel) {\n        this.previousStage = null;\n        //ä½¿ç”¨ä¸€ä¸ªå­—æ®µæŒ‡å‘æ•°æ®é›†åˆçš„Spliterator,åç»­ç»ˆç»“æ“ä½œçš„æ—¶å€™ï¼Œå¼•ç”¨çš„æ–¹å¼æ“ä½œæ•°æ®\n        this.sourceSpliterator = source;\n        this.sourceStage = this;\n        this.sourceOrOpFlags = sourceFlags &amp;amp; StreamOpFlag.STREAM_MASK;\n        // The following is an optimization of:\n        // StreamOpFlag.combineOpFlags(sourceOrOpFlags, StreamOpFlag.INITIAL_OPS_VALUE);\n        this.combinedFlags = (~(sourceOrOpFlags &amp;lt;&amp;lt; 1)) &amp;amp; StreamOpFlag.INITIAL_OPS_VALUE;\n        this.depth = 0;\n        this.parallel = parallel;\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;3\&#34;&gt;&lt;img src=\&#34;https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0e6bb4ba6d9042e3a1f6b4547b68edec~tplv-k3u1fbpfcp-watermark.image\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;ç–‘é—®è§£ç­”\&#34;&gt;ç–‘é—®è§£ç­”&lt;/h3&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;strong&gt;å®˜æ–¹è¯´Streamä¸å­˜å‚¨æ•°æ®ï¼Œé‚£ä¹ˆæ•°æ®ä¿å­˜åœ¨é‚£é‡Œå‘¢ï¼Ÿ&lt;/strong&gt;\n&lt;ul&gt;\n&lt;li&gt;Headä¸­ä¿å­˜æ•°æ®æºçš„Spliteratorå¯¹è±¡ï¼Œåç»­æ“ä½œSpliteratorçš„æ–¹å¼æ“ä½œæ•°æ®&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;å‚è€ƒå¼•ç”¨ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;https://colobu.com/2014/11/18/Java-8-Stream/\&#34;&gt;Java 8 Streamæ¢ç§˜ (colobu.com)&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;\&#34;&gt;åŸæ¥ä½ æ˜¯è¿™æ ·çš„ Streamï¼šæµ…æ Java Stream å®ç°åŸç† (https_toutiao.io)&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&#34;,&#34;fileName&#34;:&#34;1V4Hrg06J&#34;,&#34;abstract&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;äº†è§£Streamä¸­Sinkå’ŒPiplineçš„æ¦‚å¿µï¼Œä»¥åŠå‰–æStreamæ˜¯å¦‚ä½•åˆ›å»ºã€‚&lt;/p&gt;\n&lt;/blockquote&gt;\n&#34;,&#34;title&#34;:&#34;æ·±å…¥è§£æJava Streamæºç ï¼ˆä¸Šï¼‰ï¼šåˆå§‹åŒ– Sink&#34;,&#34;tags&#34;:[],&#34;date&#34;:&#34;2021-07-09 13:09:05&#34;,&#34;dateFormat&#34;:&#34;2021-07-09 01:09:05&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/1V4Hrg06J/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;4 min read&#34;,&#34;time&#34;:238000,&#34;words&#34;:879,&#34;minutes&#34;:4},&#34;description&#34;:&#34;\näº†è§£Streamä¸­Sinkå’ŒPiplineçš„æ¦‚å¿µï¼Œä»¥åŠå‰–æStreamæ˜¯å¦‚ä½•åˆ›å»ºã€‚\n\n\nç±»å›¾\n\næ¦‚å¿µè§£é‡Š\nPiplineå’ŒStage\nPiplineæ˜¯æµæ°´çº¿ï¼Œè¡¨ç¤ºä¸€æ•´ä¸ªæµç¨‹ã€‚Stageè¡¨ç¤ºæµæ°´çº¿çš„å…¶ä¸­ä¸€ä¸ªé˜¶æ®µã€‚æ˜¯ä¸€ä¸ªæ¯”è¾ƒæŠ½è±¡å±‚é¢çš„æè¿°ï¼Œå› ...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%B1%BB%E5%9B%BE\&#34;&gt;ç±»å›¾&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A6%82%E5%BF%B5%E8%A7%A3%E9%87%8A\&#34;&gt;æ¦‚å¿µè§£é‡Š&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#pipline%E5%92%8Cstage\&#34;&gt;Piplineå’ŒStage&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#sink\&#34;&gt;Sink&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%9B%E5%BB%BAhead\&#34;&gt;åˆ›å»ºHead&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%96%91%E9%97%AE\&#34;&gt;ç–‘é—®&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F\&#34;&gt;ä½¿ç”¨æ–¹å¼&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90\&#34;&gt;æºç åˆ†æ&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%96%91%E9%97%AE%E8%A7%A3%E7%AD%94\&#34;&gt;ç–‘é—®è§£ç­”&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;Javaé‡Œæ³›å‹ï¼Œä¸c#æ¯”èµ·æ¥ï¼Œæ›´ç®—æ˜¯ä¸€ç§è¯­æ³•ç³–ã€‚å…³äºè¯­æ³•ç³–ï¼Œæ˜¯ç¼–è¯‘æ—¶çš„ä¸€ç§â€œå°æŠŠæˆâ€ï¼Œç›®çš„æ˜¯è®©ä½¿ç”¨è€…å¯ä»¥æœ‰æ›´å¤šçš„æ‰‹æ®µæ˜¯ç¼–å†™ä»£ç ã€‚&lt;br&gt;\nå¥½å¤„æ˜¯æ•ˆç‡ï¼Œäº†è§£Rustçš„å¯ä»¥æ„Ÿå—åˆ°ï¼Œç¼–å†™Rustçš„ä»£ç æå…¶é«˜æ•ˆçš„ï¼Œä»£ä»·å°±æ˜¯å­¦ä¹ æˆæœ¬éå¸¸é«˜ï¼ŒåŸå› ä¹‹ä¸€å°±æ˜¯å¤§é‡çš„è¯­æ³•ç³–ã€‚&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;p&gt;åœ¨java ä¸­:&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public void foo(Person&amp;lt;String&amp;gt; p){}\n\npublic void foo(Person&amp;lt;Long&amp;gt; p){}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8b95e4b789e245b581f3159d90c25eec~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;æ³›å‹æ“¦é™¤-å­—èŠ‚ç åˆ†æ\&#34;&gt;æ³›å‹æ“¦é™¤-å­—èŠ‚ç åˆ†æ&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public void foo(Person&amp;lt;String&amp;gt; p){}  ==&amp;gt; public void foo(Person&amp;lt;Object&amp;gt; p){}\n\npublic void foo(Person&amp;lt;Long&amp;gt; p){} ==&amp;gt; public void foo(Person&amp;lt;Object&amp;gt; p){}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ä¸‹é¢è¿™ä¸ªç±»&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class Person&amp;lt;T&amp;gt;{\n\n    T name;\n\n    public static void main(String[] args) {\n        Person&amp;lt;String&amp;gt; p = new Person&amp;lt;String&amp;gt;();\n        p.name = &amp;quot;å¼ ä¸‰&amp;quot;;\n        GvmOut.to(p.name);\n    }\n\n    public void foo(T t){}\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/356e67eb94044e85bc0270e8dbd05805~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/498461b0cf404349baaf98ca47e5f2c7~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/p&gt;\n&lt;p&gt;å­—æ®µçš„ç­¾åå’Œæ–¹æ³•çš„ç­¾åéƒ½æ˜¯Objectå¯¹è±¡ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜éœ€è¦èŒƒå‹ï¼Œç›´æ¥ç”¨Objectå£°æ˜ä¸å°±å¥½äº†å—ã€‚ç­”æ¡ˆæ˜¯çº¦æŸï¼Œä½¿ç”¨æ³›å‹å¯ä»¥ä¿è¯ç±»å‹ç¬¦åˆè¦æ±‚ã€‚&lt;/p&gt;\n&lt;p&gt;åœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­ï¼Œä¼šæ·»åŠ checkcastå‘½ä»¤å»æ£€æŸ¥ç±»å‹æ˜¯å¦åŒ¹é…ã€‚&lt;/p&gt;\n&lt;p&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6a2ceac67b4b4b8e98e3725639bbca97~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d997841902ca4fb9b4c1473a45265c7b~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/p&gt;\n&lt;h3 id=\&#34;æ³›å‹ä¸Šä¸‹è¾¹ç•Œ-å­—èŠ‚ç åˆ†æ\&#34;&gt;æ³›å‹ä¸Šä¸‹è¾¹ç•Œ-å­—èŠ‚ç åˆ†æ&lt;/h3&gt;\n&lt;p&gt;æ³›å‹å¸¸è§çš„åœºæ™¯ä¹‹ä¸€æ˜¯ä½¿ç”¨extendsï¼Œå¯ä»¥çº¦æŸå‚æ•°çš„èŒƒå›´ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class Son&amp;lt;T extends Person&amp;gt;{\n\n    T father;\n\n    public static void main(String[] args) {\n        Son&amp;lt;Person&amp;gt; son = new Son&amp;lt;&amp;gt;();\n        son.father = new Person();\n    }\n\n    public T name(T t){\n        return t;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6005fb3ea7494860b1a9669d34bda1c5~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc1e578969da44529d65f459c4baf301~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/h2&gt;\n&lt;p&gt;æœ¬è´¨ä¸Šï¼Œç¼–è¯‘åï¼Œæ³›å‹ä¾ç„¶è¢«æ“¦é™¤äº†ï¼Œä½†æ˜¯ä¸å†æ˜¯Objectç±»ï¼Œè€Œæ˜¯Personç±»ã€‚&lt;/p&gt;\n&lt;h3 id=\&#34;ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ç§æ–¹å¼å®ç°èŒƒå‹\&#34;&gt;ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ç§æ–¹å¼å®ç°èŒƒå‹&lt;/h3&gt;\n&lt;p&gt;å‘ä¸‹å…¼å®¹ã€‚å‘ä¸‹å…¼å®¹ã€‚å‘ä¸‹å…¼å®¹ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;å‚è€ƒ\&#34;&gt;å‚è€ƒï¼š&lt;/h2&gt;\n&lt;p&gt;-ã€Šè™šæ‹Ÿæœºè§„èŒƒ(SE8)ã€‹&lt;br&gt;\n-ã€Šè‡ªå·±åŠ¨æ‰‹äº›è™šæ‹Ÿæœºã€‹&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;nL7teffDj&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;Javaé‡Œæ³›å‹ï¼Œä¸c#æ¯”èµ·æ¥ï¼Œæ›´ç®—æ˜¯ä¸€ç§è¯­æ³•ç³–ã€‚å…³äºè¯­æ³•ç³–ï¼Œæ˜¯ç¼–è¯‘æ—¶çš„ä¸€ç§â€œå°æŠŠæˆâ€ï¼Œç›®çš„æ˜¯è®©ä½¿ç”¨è€…å¯ä»¥æœ‰æ›´å¤šçš„æ‰‹æ®µæ˜¯ç¼–å†™ä»£ç ã€‚&lt;br&gt;\nå¥½å¤„æ˜¯æ•ˆç‡ï¼Œäº†è§£Rustçš„å¯ä»¥æ„Ÿå—åˆ°ï¼Œç¼–å†™Rustçš„ä»£ç æå…¶é«˜æ•ˆçš„ï¼Œä»£ä»·å°±æ˜¯å­¦ä¹ æˆæœ¬éå¸¸é«˜ï¼ŒåŸå› ä¹‹ä¸€å°±æ˜¯å¤§é‡çš„è¯­æ³•ç³–ã€‚&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;ä»å­—èŠ‚ç å‰–ææ³›å‹&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;JVM&#34;,&#34;slug&#34;:&#34;jjLsZt3QW&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/jjLsZt3QW/&#34;},{&#34;name&#34;:&#34;Java&#34;,&#34;slug&#34;:&#34;6j9B3b2nb&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/6j9B3b2nb/&#34;}],&#34;date&#34;:&#34;2021-05-06 16:30:29&#34;,&#34;dateFormat&#34;:&#34;2021-05-06 04:30:29&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/nL7teffDj/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:107000,&#34;words&#34;:418,&#34;minutes&#34;:2},&#34;description&#34;:&#34;Javaé‡Œæ³›å‹ï¼Œä¸c#æ¯”èµ·æ¥ï¼Œæ›´ç®—æ˜¯ä¸€ç§è¯­æ³•ç³–ã€‚å…³äºè¯­æ³•ç³–ï¼Œæ˜¯ç¼–è¯‘æ—¶çš„ä¸€ç§â€œå°æŠŠæˆâ€ï¼Œç›®çš„æ˜¯è®©ä½¿ç”¨è€…å¯ä»¥æœ‰æ›´å¤šçš„æ‰‹æ®µæ˜¯ç¼–å†™ä»£ç ã€‚\nå¥½å¤„æ˜¯æ•ˆç‡ï¼Œäº†è§£Rustçš„å¯ä»¥æ„Ÿå—åˆ°ï¼Œç¼–å†™Rustçš„ä»£ç æå…¶é«˜æ•ˆçš„ï¼Œä»£ä»·å°±æ˜¯å­¦ä¹ æˆæœ¬éå¸¸é«˜ï¼ŒåŸå› ä¹‹ä¸€å°±æ˜¯å¤§é‡çš„...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%B3%9B%E5%9E%8B%E6%93%A6%E9%99%A4-%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90\&#34;&gt;æ³›å‹æ“¦é™¤-å­—èŠ‚ç åˆ†æ&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%B3%9B%E5%9E%8B%E4%B8%8A%E4%B8%8B%E8%BE%B9%E7%95%8C-%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90\&#34;&gt;æ³›å‹ä¸Šä¸‹è¾¹ç•Œ-å­—èŠ‚ç åˆ†æ&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#\&#34;&gt;!!&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9%E8%BF%99%E7%A7%8D%E6%96%B9%E5%BC%8F%E5%AE%9E%E7%8E%B0%E8%8C%83%E5%9E%8B\&#34;&gt;ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ç§æ–¹å¼å®ç°èŒƒå‹&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8F%82%E8%80%83\&#34;&gt;å‚è€ƒï¼š&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;åœ¨jvmä¸­ï¼Œå®šä¹‰äº†æœ‰205æ¡æŒ‡ä»¤ï¼Œä»0x00 -&amp;gt; 0xCA , 0xFE -&amp;gt; 0xFFã€‚æˆ‘ä»¬åœ¨æ–¹æ³•ä¸­å†™çš„æ‰€æœ‰é€»è¾‘ï¼Œæœ€ç»ˆéƒ½ä¼šè½¬æ¢æˆè¿™äº›æŒ‡ä»¤ï¼Œè€Œè™šæ‹Ÿæœºçš„æœ€é‡è¦çš„ä¸€ä¸ªä»»åŠ¡å°±æ˜¯è§£é‡Šæ‰§è¡Œè¿™äº›æŒ‡ä»¤ã€‚&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;jvmæŒ‡ä»¤é›†\&#34;&gt;JVMæŒ‡ä»¤é›†&lt;/h1&gt;\n&lt;p&gt;æŒ‡ä»¤ç±»å‹ç§ç±»å¾ˆå¤š&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ebfd1be8ab947b1b8452e46405b1839~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;æ¯”è¾ƒå¸¸è§çš„ç±»å‹æœ‰ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;load ï¼š æ•°æ®ä»å±€éƒ¨å˜é‡è¡¨ -&amp;gt; æ“ä½œæ•°æ ˆä¸­&lt;/li&gt;\n&lt;li&gt;store ï¼š æ•°æ®ä»æ“ä½œæ•°æ ˆ -&amp;gt; å±€éƒ¨å˜é‡è¡¨ä¸­&lt;/li&gt;\n&lt;/ul&gt;\n&lt;!----&gt;\n&lt;ul&gt;\n&lt;li&gt;references : æ–¹æ³•è°ƒç”¨ã€ç±»å‹å¼ºè½¬ã€monitoré”ç­‰&lt;/li&gt;\n&lt;li&gt;math ï¼šè¿ç®—æ“ä½œç›¸å…³&lt;/li&gt;\n&lt;/ul&gt;\n&lt;!----&gt;\n&lt;ul&gt;\n&lt;li&gt;comparisons : é€»è¾‘æ“ä½œï¼Œifï¼Œwhileï¼Œforï¼Œgotoç­‰&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;æŒ‡ä»¤æ ¼å¼\&#34;&gt;æŒ‡ä»¤æ ¼å¼&lt;/h3&gt;\n&lt;p&gt;æŒ‡ä»¤éƒ½æ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œ&lt;strong&gt;æ“ä½œç &lt;/strong&gt;å’Œ&lt;strong&gt;æ“ä½œæ•°ã€‚&lt;/strong&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;strong&gt;æ“ä½œç ï¼š&lt;/strong&gt; ç”¨äºè¡¨ç¤ºæ˜¯ä»€ä¹ˆæŒ‡ä»¤. 0x1a , 0x45 ,0x57 æ˜¯æ“ä½œç &lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;æ“ä½œæ•°ï¼š&lt;/strong&gt; æœ‰äº›æŒ‡ä»¤éœ€è¦æ“ä½œå±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆï¼Œéœ€è¦çŸ¥é“ç´¢å¼•çš„ä½ç½®.&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-go\&#34;&gt;//åŒ¹é…æŒ‡ä»¤\nswitch opcode {\n    ...\n    case 0x1a:\n\t\treturn iload_0\n    ...\n\tcase 0x45:\n\t\treturn fstore_2\n    ...\n    case 0x57:\n\t\treturn pop\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;è¶…çº§æŒ‡ä»¤\&#34;&gt;è¶…çº§æŒ‡ä»¤&lt;/h3&gt;\n&lt;p&gt;è§£é‡Šçš„é€Ÿåº¦é€šå¸¸æ¯”è¾ƒæ…¢ï¼ŒåŸå› ä¹‹ä¸€æ˜¯è§£é‡Šå™¨åœ¨åˆ¤æ–­æŒ‡ä»¤ç±»å‹çš„æ—¶å€™æ¶‰åŠåˆ°åˆ†æ”¯ï¼Œcpuå±‚é¢åˆ†æ”¯é¢„æµ‹å¤±è´¥å’ŒæŒ‡ä»¤ç¼“å­˜æœªå‘½ä¸­çš„å¼€é”€éƒ½å¾ˆå¤§ã€‚&lt;/p&gt;\n&lt;p&gt;è§£å†³åŠæ³•å¾ˆå®¹æ˜“æƒ³åˆ°ï¼ŒæŠŠä¸¤ä¸ªæˆ–è€…å¤šä¸ªä»£ç åˆå¹¶æˆä¸€ä¸ªä»£ç ï¼Œåœ¨ä¸€è¶Ÿå¤„ç†ä¸­å¯ä»¥ç›´æ¥è·å–ç„¶åæ‰§è¡ŒæŒ‡ä»¤ï¼Œè¿™æ ·å°±å‡å°‘äº†åˆ†æ”¯çš„æ¬¡æ•°ï¼Œè¿™äº›æŒ‡ä»¤ä¾¿ç§°ä¸ºè¶…çº§æŒ‡ä»¤ã€å¿«é€ŸæŒ‡ä»¤ã€è™šæ‹ŸæŒ‡ä»¤ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-go\&#34;&gt;...\ncase 0x59:\n\treturn dup\n...\ncase 0x60:\n\treturn iadd\n...\ncase 0x84:\n\treturn iinc\n...\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ä¾‹å¦‚&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;dup: æŒ‡ä»¤è¡¨ç¤ºå°†æ“ä½œæ•°æ ˆé¡¶çš„å…ƒç´ å¤åˆ¶ä¸€ä»½ã€‚&lt;/li&gt;\n&lt;li&gt;iinc: è¡¨ç¤ºå±€éƒ¨å˜é‡è¡¨+1ï¼Œçœç•¥äº†ç»è¿‡æ“ä½œæ•°æ ˆ+1ï¼Œç„¶åå†ä¿å­˜çš„è¿‡ç¨‹ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;æŒ‡ä»¤æµè·å–\&#34;&gt;æŒ‡ä»¤æµè·å–&lt;/h3&gt;\n&lt;p&gt;åœ¨ç±»åŠ è½½è¿‡ç¨‹-åŠ è½½æ­¥éª¤ã€‚åœ¨å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼ŒæŒ‡ä»¤çš„æ•°æ®ä¿å­˜åœ¨åœ¨methodsçš„çš„å±æ€§è¡¨çš„codeå­—æ®µä¸­ã€‚åœ¨ç±»åŠ è½½é˜¶æ®µï¼Œè¯»å–å­—èŠ‚ç æ–‡ä»¶æ—¶å€™ä¼šç”Ÿæˆä¸€ä»½ç­‰ä»·çš„å¯¹è±¡ï¼Œå¯¹è±¡çš„æ„å»ºå°±æ˜¯ä»å¤´åˆ°å°¾çš„æŠŠæ‰€æœ‰æ•°æ®éƒ½è¿›è¡Œè¯»å–ï¼Œç„¶åè§£æã€‚æ¯ä¸ªä¸åŒç»„ä»¶éƒ½æœ‰ä¸åŒçš„æ–¹æ³•è¯»å–ã€‚&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a5bde907abd949a4a154053757390bf2~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-go\&#34;&gt;// è¯»å–lengthé•¿åº¦çš„æ•°æ®\nfunc parseMethod(count uint16, reader *loader.ClassReader, pool *constant_pool.ConstantPool, k *Klass) Methods {\n\tmethods := make([]*MethodKlass, count)\n\tfor i := range methods {\n\t\tmethod := &amp;amp;MethodKlass{}\n\t\t//è®¾ç½®å¸¸é‡æ± \n\t\tmethod.ConstantPool = pool\n\t\t//è®¾ç½®è®¿é—®æ ‡è®°\n\t\tmethod.accessFlag = reader.ReadUint16()\n\t\t//nameå¸¸é‡æ± ç´¢å¼•\n\t\tmethod.nameIdx = reader.ReadUint16()\n\t\t//æè¿°ç¬¦å¸¸é‡æ± ç´¢å¼•\n\t\tmethod.descriptorIdx = reader.ReadUint16()\n\t\t//å±æ€§è¡¨æ•°é‡\n\t\tmethod.attrCount = reader.ReadUint16()\n\t\t// è§£ææ–¹æ³•è¡¨ä¸­çš„å±æ€§è¡¨å­—æ®µ\n\t\tmethod.AttributesInfo = attribute.ParseAttributes(method.attrCount, reader, pool)\n\t\t// ç»‘å®šklass&amp;amp;method\n\t\tmethod.Klass = k\n\t\t// æœ¬åœ°æ–¹æ³•æ³¨å…¥å­—èŠ‚ç \n\t\tmethod.InjectCodeAttrIfNative()\n\t}\n\treturn methods\n}\n\nfunc (c *AttrCode) parse(reader *loader.ClassReader) {\n\tc.MaxStack = reader.ReadUint16()\n\tc.MaxLocals = reader.ReadUint16()\n\t//codeé•¿åº¦\n\tc.codeLen = reader.ReadUint32()\n\t//è¯»å–lené•¿åº¦çš„å­—èŠ‚\n\tc.code = reader.ReadBytes(c.codeLen)\n\tc.ExceptionTable = parseExceptionTable(reader)\n\tc.attrCount = reader.ReadUint16()\n\tc.AttributesInfo = ParseAttributes(c.attrCount, reader, c.ConstantPool)\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;æŒ‡ä»¤çš„è§£é‡Šè¿‡ç¨‹\&#34;&gt;æŒ‡ä»¤çš„è§£é‡Šè¿‡ç¨‹&lt;/h3&gt;\n&lt;p&gt;æŒ‡ä»¤çš„æ‰§è¡Œæ˜¯ç”±è§£é‡Šå™¨è´Ÿè´£çš„ï¼Œè§£æå™¨çš„æµç¨‹ç®€å•è¯´å°±æ˜¯:&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;3\&#34;&gt;&lt;img src=\&#34;https://tva1.sinaimg.cn/large/e6c9d24egy1h0e47eze27j211s03cq3e.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;æŒ‡ä»¤è§£é‡Šå°±æ˜¯å°†è¿™ä¸‰æ­¥é‡å¤å¾ªç¯ï¼Œå…¶ä¸­è¦æ³¨æ„çš„ç‚¹æ˜¯æ ˆå¸§ä¸­çš„pcå’Œæ•´ä½“pcå¯„å­˜å™¨çš„å€¼è¦ä¿æŒä¸€è‡´ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-go\&#34;&gt;//å¾ªç¯è§£é‡Š\nfunc loop(thread *runtime.Thread) {\n    methodReader := &amp;amp;base.MethodCodeReader{}\n        for {\n        // æ›´æ–°pcå¯„å­˜å™¨\n        updatePC(thread)\n        // æ›´æ–°æ–¹æ³•code\n        updateCodeArrt(thread, methodReader)\n        //æ‰§è¡ŒæŒ‡ä»¤\n        execInst(thread, methodReader)\n        if finished(thread) {\n                break\n        }\n    }\n}\n\n//æ‰§è¡Œ\nfunc execInst(thread *runtime.Thread, reader *base.MethodCodeReader) {\n    curFrame := thread.PeekFrame()\n    //è·å–æ“ä½œç \n    opcode := reader.ReadOpenCdoe()\n    //åˆ›å»ºæŒ‡ä»¤\n    inst := instructions.NewInstruction(opcode)\n    //è·å–æ“ä½œæ•°\n    inst.FetchOperands(reader)\n    curFrame.SetFramePC(reader.MethodReaderPC())\n    //æ‰§è¡ŒæŒ‡ä»¤\n    inst.Execute(curFrame)\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;æŒ‡ä»¤è§£é‡Šæ‰§è¡Œ\&#34;&gt;æŒ‡ä»¤è§£é‡Šæ‰§è¡Œ&lt;/h3&gt;\n&lt;p&gt;è·å–åˆ°æŒ‡ä»¤åï¼Œ&lt;code&gt;inst.Execute(curFrame)&lt;/code&gt; æ‰§è¡ŒæŒ‡ä»¤ã€‚æ¯æ¡æŒ‡ä»¤éƒ½æœ‰å„è‡ªçš„æ‰§è¡Œé€»è¾‘&lt;/p&gt;\n&lt;p&gt;æ¯æ¡æŒ‡ä»¤éƒ½æœ‰ä¸åŒçš„æ‰§è¡Œé€»è¾‘ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-go\&#34;&gt;func iload_0(frame *runtime.Frame) {\n\tval := frame.LocalVars().GetInt(0)\n\tframe.OperandStack().PushInt(val)\n}\n\nfunc iload_1(frame *runtime.Frame) {\n\tval := frame.LocalVars().GetInt(1)\n\tframe.OperandStack().PushInt(val)\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;i-i\&#34;&gt;i++ &amp;amp; ++i&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-go\&#34;&gt;int i = 1;\nprint(i++);  \nprint(++i);  \n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ç¼–è¯‘åå­—èŠ‚ç ä¸¤è€…æ˜¯ä¸åŒçš„ï¼ŒåŸå› ä¸javaç¼–è¯‘å™¨çš„éå†ASTï¼ˆjavacé‡‡ç”¨é€†æ³¢å…°è¡¨è¾¾ç®—æ³•ï¼‰æœ‰å…³ã€‚&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;4\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/268c4ab96e09427194ff1d0ac6ff94d3~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-go\&#34;&gt;func (i *IINC) Execute(frame *runtime.Frame) {\n\tidx := i.Index &amp;gt;&amp;gt; 8         //å±€éƒ¨å˜é‡è¡¨ä¸‹æ ‡\n\ttoAdd := i.Index &amp;amp; 0x0011   //å€¼\n\told := frame.LocalVars().GetInt(uint(idx)) \n\tframe.LocalVars().SetInt(uint(idx), int32(toAdd)+old) //è®¾ç½®æ–°çš„å€¼\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;i++ ï¼šå…ˆæŠŠiä¿å­˜åˆ°äº†æ“ä½œæ•°æ ˆï¼Œç„¶åå†å¯¹å±€éƒ¨å˜é‡è¡¨çš„i+1ã€‚&lt;/p&gt;\n&lt;p&gt;++i ï¼šå…ˆå¯¹å±€éƒ¨å˜é‡è¡¨çš„i+1ï¼Œç„¶åå†æŠŠiä¿å­˜åˆ°äº†æ“ä½œæ•°æ ˆã€‚&lt;/p&gt;\n&lt;h4 id=\&#34;ifelseå…³é”®å­—\&#34;&gt;if..else..å…³é”®å­—&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-go\&#34;&gt;public static void if_test() {\n    int n = 10;\n    GvmOut.to(&amp;quot;testing if&amp;quot;);\n    GvmOut.to(&amp;quot;10 &amp;gt; 9 ?&amp;quot;);\n    if (n &amp;gt; 9) {\n        GvmOut.to(&amp;quot;yes&amp;quot;);\n    } else {\n        GvmOut.to(&amp;quot;no&amp;quot;);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;5\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b5de568db80345d2ba675a334dc78683~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h4 id=\&#34;forå…³é”®å­—\&#34;&gt;for..å…³é”®å­—&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-go\&#34;&gt;public static void for_test() {\n    GvmOut.to(&amp;quot;testing for&amp;quot;);\n    for (int i = 0; i &amp;lt; 5; i++) {\n        GvmOut.to(i);\n\t}\n}\n    \n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;6\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f9b03ddacdcc42b2ac9061589646298b~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-go\&#34;&gt;// Execute to branch if and only if val1 great or equals val2\nfunc (icmp *IfIcmpge) Execute(frame *runtime.Frame) {\n\tval2 := frame.PopInt()      //å¼¹å‡ºæ ˆé¡¶çš„int\n\tval1 := frame.PopInt()      //å¼¹å‡ºæ ˆé¡¶çš„int\n\tgoNext := icmp.Index        //è·å–æŒ‘æˆ˜åœ°å€\n\tif val1 &amp;gt;= val2 {           //æ¯”è¾ƒ\n\t\tbase.Branch(frame, int(goNext))  \n\t}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;while\&#34;&gt;while&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public static void while_test() {\n    GvmOut.to(&amp;quot;testing while&amp;quot;);\n    int x = 100;\n    while (x &amp;lt; 105) {\n        x++;\n        GvmOut.to(x);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;7\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd42f104f9fd43079416b393a2624003~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&#34;,&#34;fileName&#34;:&#34;l7YU2lRvP&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;åœ¨jvmä¸­ï¼Œå®šä¹‰äº†æœ‰205æ¡æŒ‡ä»¤ï¼Œä»0x00 -&amp;gt; 0xCA , 0xFE -&amp;gt; 0xFFã€‚æˆ‘ä»¬åœ¨æ–¹æ³•ä¸­å†™çš„æ‰€æœ‰é€»è¾‘ï¼Œæœ€ç»ˆéƒ½ä¼šè½¬æ¢æˆè¿™äº›æŒ‡ä»¤ï¼Œè€Œè™šæ‹Ÿæœºçš„æœ€é‡è¦çš„ä¸€ä¸ªä»»åŠ¡å°±æ˜¯è§£é‡Šæ‰§è¡Œè¿™äº›æŒ‡ä»¤ã€‚&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;JVM æŒ‡ä»¤è¿è¡Œ è§£æ&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;JVM&#34;,&#34;slug&#34;:&#34;jjLsZt3QW&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/jjLsZt3QW/&#34;}],&#34;date&#34;:&#34;2021-02-17 11:19:49&#34;,&#34;dateFormat&#34;:&#34;2021-02-17 11:19:49&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/l7YU2lRvP/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;6 min read&#34;,&#34;time&#34;:316000,&#34;words&#34;:1218,&#34;minutes&#34;:6},&#34;description&#34;:&#34;åœ¨jvmä¸­ï¼Œå®šä¹‰äº†æœ‰205æ¡æŒ‡ä»¤ï¼Œä»0x00 -&amp;gt; 0xCA , 0xFE -&amp;gt; 0xFFã€‚æˆ‘ä»¬åœ¨æ–¹æ³•ä¸­å†™çš„æ‰€æœ‰é€»è¾‘ï¼Œæœ€ç»ˆéƒ½ä¼šè½¬æ¢æˆè¿™äº›æŒ‡ä»¤ï¼Œè€Œè™šæ‹Ÿæœºçš„æœ€é‡è¦çš„ä¸€ä¸ªä»»åŠ¡å°±æ˜¯è§£é‡Šæ‰§è¡Œè¿™äº›æŒ‡ä»¤ã€‚\n\nJVMæŒ‡ä»¤é›†\næŒ‡ä»¤ç±»å‹ç§ç±»å¾ˆå¤š\n\n...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#jvm%E6%8C%87%E4%BB%A4%E9%9B%86\&#34;&gt;JVMæŒ‡ä»¤é›†&lt;/a&gt;&lt;br&gt;\n*\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F\&#34;&gt;æŒ‡ä»¤æ ¼å¼&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%B6%85%E7%BA%A7%E6%8C%87%E4%BB%A4\&#34;&gt;è¶…çº§æŒ‡ä»¤&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%8C%87%E4%BB%A4%E6%B5%81%E8%8E%B7%E5%8F%96\&#34;&gt;æŒ‡ä»¤æµè·å–&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%8C%87%E4%BB%A4%E7%9A%84%E8%A7%A3%E9%87%8A%E8%BF%87%E7%A8%8B\&#34;&gt;æŒ‡ä»¤çš„è§£é‡Šè¿‡ç¨‹&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%8C%87%E4%BB%A4%E8%A7%A3%E9%87%8A%E6%89%A7%E8%A1%8C\&#34;&gt;æŒ‡ä»¤è§£é‡Šæ‰§è¡Œ&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#i-i\&#34;&gt;i++ &amp;amp; ++i&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#ifelse%E5%85%B3%E9%94%AE%E5%AD%97\&#34;&gt;if..else..å…³é”®å­—&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#for%E5%85%B3%E9%94%AE%E5%AD%97\&#34;&gt;for..å…³é”®å­—&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#while\&#34;&gt;while&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;é¡¹ç›®ä»£ç ï¼š&lt;a href=\&#34;https://github.com/zexho994/gvm\&#34;&gt;https://github.com/zexho994/gvm&lt;/a&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;!-- more --&gt;\n&lt;h2 id=\&#34;è™šæ‹Ÿæœºæ•´ä½“çš„æµç¨‹\&#34;&gt;è™šæ‹Ÿæœºæ•´ä½“çš„æµç¨‹&lt;/h2&gt;\n&lt;h2 id=\&#34;ä¸åŒç±»å‹çš„è™šæ‹Ÿæœº\&#34;&gt;ä¸åŒç±»å‹çš„è™šæ‹Ÿæœº&lt;/h2&gt;\n&lt;p&gt;ä»è§£é‡Šå™¨çš„å®ç°æ–¹å¼ä¸Šæ¥çœ‹ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„è™šæ‹Ÿæœºæ‰§è¡Œæ¶æ„ã€‚&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;åŸºäºæ ˆç»“æ„&lt;/li&gt;\n&lt;li&gt;åŸºäºå¯„å­˜å™¨&lt;br&gt;\njvmå®¶æ—çš„è™šæ‹ŸæœºåŸºæœ¬éƒ½æ˜¯åŸºäºæ ˆçš„ï¼ŒåŸºäºæ ˆçš„å®ç°ç¨å¾®ç®€å•ï¼Œç§»æ¤æ€§é«˜ã€‚åŸºäºå¯„å­˜å™¨çš„è™šæ‹Ÿæœºå’Œcpuçš„æ‰§è¡Œæ–¹å¼ç±»ä¼¼ï¼Œæ€§èƒ½æ›´å¿«ï¼Œä¾‹å¦‚v8ã€‚Luaè™šæ‹Ÿæœºä»5.0ä¹‹å‰æ˜¯æ ˆè™šæ‹Ÿæœºï¼Œ5.0æ—¶è½¬å˜ä¸ºå¯„å­˜å™¨è™šæ‹Ÿæœº&lt;/li&gt;\n&lt;/ol&gt;\n&lt;blockquote&gt;\n&lt;p&gt;Lars Bak æ˜¯v8çš„ä½œè€…ï¼Œä¹Ÿæ˜¯hotspotçš„ä½œè€…ä¹‹ä¸€ï¼Œè¿˜æ˜¯Dartè¯­è¨€çš„ä½œè€…ã€‚&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;æ ˆè™šæ‹Ÿæœº\&#34;&gt;æ ˆè™šæ‹Ÿæœº&lt;/h3&gt;\n&lt;p&gt;ä¸€æ®µjavaä»£ç &lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public void foo(){\n\tint a = 1;  \n    int b = 2;  \n    int c = a*b;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;åœ¨ä¸åŒç±»å‹çš„è™šæ‹Ÿæœºä¸­ï¼Œè¦æ‰§è¡Œè¿™æ®µä»£ç ï¼Œé¦–å…ˆç¼–è¯‘çš„æ–¹å¼ä¹Ÿä¼šæœ‰ä¸åŒ,åœ¨åŸºäºæ ˆçš„è™šæ‹Ÿæœºä¸­ï¼Œç¼–è¯‘åçš„æŒ‡ä»¤ä¸º&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public void fooj();\n    Code:\n       0: iconst_1   //å¸¸é‡1å­˜å…¥åˆ°æ“ä½œæ•°æ ˆ\n       1: istore_1   //æ“ä½œæ•°æ ˆé¡¶popåˆ°å±€éƒ¨å˜é‡è¡¨1\n       2: iconst_2   \n       3: istore_2\n       4: iload_1    //å±€éƒ¨å˜é‡è¡¨ç´¢å¼•1æ•°pushåˆ°æ“ä½œæ•°æ ˆ\n       5: iload_2    \n       6: iadd       //æ“ä½œæ•°æ ˆé¡¶ä¸¤ä¸ªæ•°ç›¸åŠ \n       7: iconst_5\n       8: imul       //æ“ä½œæ•°æ ˆé¡¶ä¸¤ä¸ªæ•°ç›¸ä¹˜\n       9: istore_3\n      10: return  \n          \n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dffe4e0c06c44ec1a3d74146ab023cd1~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;å¯„å­˜å™¨è™šæ‹Ÿæœº\&#34;&gt;å¯„å­˜å™¨è™šæ‹Ÿæœº&lt;/h3&gt;\n&lt;p&gt;å’Œæ±‡ç¼–çš„é£æ ¼ç±»ä¼¼ï¼Œå› ä¸ºcpuæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªåŸºäºå¯„å­˜å™¨çš„è§£é‡Šå™¨ã€‚å¯„å­˜å™¨è™šæ‹Ÿæœºæœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯æ€§èƒ½å¥½ï¼Œæ”¯æŒéšæœºè®¿é—®ï¼Œç›¸æ¯”èµ·æ¥æ ˆè™šæ‹Ÿæœºçš„æŒ‡ä»¤æ‰§è¡Œå°±æ˜¾å¾—ååˆ†éº»çƒ¦çš„ã€‚&lt;/p&gt;\n&lt;p&gt;åœ¨åŸºäºå¯„å­˜å™¨çš„è™šæ‹Ÿæœºä¸­ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;add ax bx\t//å…¶ä¸­AXå¯„å­˜å™¨çš„å€¼ä¸º1,BXå¯„å­˜å™¨çš„å€¼ä¸º2ï¼Œå°†ç»“æœæ”¾å…¥AX\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/63c9bd9e740241a3b9e8154f39a15106~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;è™šæ‹Ÿæœºç±»å‹çš„æŠ‰æ‹©\&#34;&gt;è™šæ‹Ÿæœºç±»å‹çš„æŠ‰æ‹©&lt;/h3&gt;\n&lt;p&gt;ä¸ºä»€ä¹ˆJVMé€‰æ‹©äº†ä½¿ç”¨æ ˆè™šæ‹Ÿæœºçš„æ–¹å¼? åŸå› æœ‰å¾ˆå¤šï¼Œä»å†å²çš„è§’åº¦ä¸Šçœ‹ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;æ ˆè™šæ‹Ÿæœºä¸­ï¼ŒæŒ‡ä»¤çš„å¹³å°æ— å…³æ€§å¥½ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;!----&gt;\n&lt;ul&gt;\n&lt;li&gt;æ ˆè™šæ‹Ÿæœºçš„ä¼˜ç‚¹ä¹‹ä¸€æ˜¯æŒ‡ä»¤æ›´çŸ­ï¼Œåªç”¨1å­—èŠ‚ï¼Œè€ŒåŸºäºå¯„å­˜å™¨çš„éœ€è¦é¢å¤–ä¿å­˜åœ°å€ï¼Œä¸€èˆ¬ä¸º2å­—èŠ‚ã€‚åœ¨å½“æ—¶ï¼Œå†…å­˜æ˜¯æ¯”è¾ƒé‡è¦çš„ã€‚&lt;/li&gt;\n&lt;li&gt;James Gosling å¯¹è¿™ç§æ–¹å¼çš„å®ç°æ¯”è¾ƒç†Ÿæ‚‰ï¼ˆä¹‹å‰ä»–å®ç°äº†PostScriptè™šæ‹Ÿæœºï¼‰ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;å¯¹javaçš„å½±å“\&#34;&gt;å¯¹Javaçš„å½±å“&lt;/h3&gt;\n&lt;p&gt;æŒ‡ä»¤é‡æ’åºä¹‹ä¸€çš„ç¼–è¯‘å™¨é‡æ’åºï¼Œæ˜¯IRä¼˜åŒ–é˜¶æ®µçš„ä¸€ç§æ‰‹æ®µï¼Œå«è¡¨è¾¾å¼æå‡ã€è¡¨è¾¾å¼ä¸‹æ²‰ã€‚&lt;/p&gt;\n&lt;p&gt;ä¼˜åŒ–çš„åŸå› ä¹‹ä¸€å°±æ˜¯è€ƒè™‘æ ˆçš„ç‰¹æ€§ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;a=1;         b=2;\nb=2;         a=1;\nc=a+1;  ==&amp;gt;  c=a+1;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;æ–¹æ³•æ‰§è¡Œ\&#34;&gt;æ–¹æ³•æ‰§è¡Œ&lt;/h2&gt;\n&lt;h3 id=\&#34;æ ˆå¸§\&#34;&gt;æ ˆå¸§&lt;/h3&gt;\n&lt;p&gt;æ ˆå¸§æ˜¯æ–¹æ³•çš„æ‰§è¡Œå•ä½ï¼Œä¸€ä¸ªæ–¹æ³•å¯¹åº”ä¸€ä¸ªæ ˆå¸§ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-go\&#34;&gt;//æ ˆå¸§\ntype Frame struct {\n\tframePC   uint\n\tnextFrame *Frame\n\t*LocalVars\n\t*OperandStack\n\t*klass.MethodKlass\n\t*Thread\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1478dbbbd6704bbe98da7eea1d55b726~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/h3&gt;\n&lt;h3 id=\&#34;è™šæ‹Ÿæœºæ ˆ\&#34;&gt;è™šæ‹Ÿæœºæ ˆ&lt;/h3&gt;\n&lt;p&gt;è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œç”¨äºå­˜æ”¾æ ˆå¸§ã€‚å½“ä¸€ä¸ªæ–¹æ³•å‡†å¤‡æ‰§è¡Œæ—¶å€™ï¼Œæ ˆå¸§pushè¿›è¡Œï¼Œå®Œæˆ&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-go\&#34;&gt;//çº¿ç¨‹æ¨¡å‹\ntype Thread struct {\n    ...\n\t*Stack  //è™šæ‹Ÿæœºæ ˆ,å­˜æ”¾æ ˆå¸§\n    ...\n}\n//è™šæ‹Ÿæœºæ ˆ\ntype Stack struct {\n    ...\n\t// æ ˆæœ€å¤§å¤§å°\n\tmaxSize uint\n\t// å½“å‰æ ˆçš„å¤§å°\n\tsize uint\n\t// é¡¶å±‚å¸§\n\ttop *Frame\n    ...\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;-2\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/edf832f25aed447c87e2fc26fd868add~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/h3&gt;\n&lt;h3 id=\&#34;å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆsize\&#34;&gt;å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆsize&lt;/h3&gt;\n&lt;p&gt;å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆçš„å¤§å°å¦‚ä½•ç¡®å®šï¼Ÿåœ¨codeå±æ€§è¡¨ä¸­ï¼ŒMaxStackè¡¨ç¤ºæ ˆçš„æœ€å¤§æ·±åº¦ï¼ŒMaxLocalsè¡¨ç¤ºå±€éƒ¨å˜é‡è¡¨çš„æœ€å¤§æ·±åº¦ã€‚&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;3\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5dc1b27cd5c64897ba2677d8cdaffe6f~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-go\&#34;&gt;type Attr_Code struct {\n\tNameIdx uint16\n\tname    string\n\tAttrLen uint32\n\tcp      constant_pool.ConstantPool\n\t// æ–¹æ³•çš„æ“ä½œæ•°æ ˆåœ¨ä»»ä½•æ—¶é—´ç‚¹çš„æœ€å¤§æ·±åº¦ï¼Œåœ¨ç¼–è¯‘æœŸå°±å¯ä»¥ç¡®å®š\n\tMaxStack uint16\n\t// å±€éƒ¨å˜é‡è¡¨å¤§å°ï¼ŒåŒ…æ‹¬æ–¹æ³•çš„å‚æ•°\n\tMaxLocals uint16\n\tcodeLen   uint32\n\tcode      []byte\n\t// å¼‚å¸¸è¡¨\n\tExceptionTable []*ExceptionTable\n\t// å±æ€§è¡¨\n\tattrCount uint16\n\tattrInfo  AttributesInfo\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ä¸¤ä¸ªå€¼çš„å¤§å°å·²ç»åœ¨ç¼–è¯‘æœŸé—´ç¡®å®šï¼Œåœ¨å­—èŠ‚ç ä¸­ä¿å­˜ï¼Œæœ€ååœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­ï¼Œè·å–è¿™ä¸¤ä¸ªå­—æ®µã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-go\&#34;&gt;func (c *Attr_Code) parse(reader *classfile.ClassReader) {\n\tc.MaxStack = reader.ReadUint16()\n\tc.MaxLocals = reader.ReadUint16()\n\tc.codeLen = reader.ReadUint32()\n\tc.code = reader.ReadBytes(c.codeLen)\n\tc.ExceptionTable = parseExceptionTable(reader)\n\tc.attrCount = reader.ReadUint16()\n\tc.attrInfo = ParseAttributes(c.attrCount, reader, c.cp)\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;æ–¹æ³•è°ƒç”¨\&#34;&gt;æ–¹æ³•è°ƒç”¨&lt;/h2&gt;\n&lt;h3 id=\&#34;invoke-æŒ‡ä»¤ç°‡\&#34;&gt;Invoke æŒ‡ä»¤ç°‡&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;invokeinterface : è°ƒç”¨æ¥å£æ–¹æ³•&lt;/li&gt;\n&lt;li&gt;invokespecial : è°ƒç”¨å®ä¾‹æ–¹æ³•ï¼Œï¼ˆçˆ¶ç±»æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€å®ä¾‹åˆå§‹åŒ–æ–¹æ³•ï¼‰&lt;/li&gt;\n&lt;/ul&gt;\n&lt;!----&gt;\n&lt;ul&gt;\n&lt;li&gt;invokevirtual : è°ƒç”¨è™šæ–¹æ³•ï¼Œä¼šæ ¹æ®å®ä¾‹çš„ç±»å‹è¿›è¡Œåˆ†æ´¾&lt;/li&gt;\n&lt;li&gt;invokestatic : è°ƒç”¨é™æ€æ–¹æ³•&lt;/li&gt;\n&lt;/ul&gt;\n&lt;!----&gt;\n&lt;ul&gt;\n&lt;li&gt;invokedynamic : è°ƒç”¨åŠ¨æ€æ–¹æ³•(java7æ–°å¢ï¼Œæ”¯æŒåŠ¨æ€è¯­è¨€çš„æ–¹æ³•è°ƒç”¨)&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;è°ƒç”¨æ‰§è¡Œé€»è¾‘\&#34;&gt;è°ƒç”¨æ‰§è¡Œé€»è¾‘&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class Invokevirtual {\n    \n    public static void main(String[] args) {\n        Invokevirtual invokevirtual = new Invokevirtual();\n        int res = invokevirtual.additive(1, 2);\n        GvmOut.to(res);\n    }\n\n    public int additive(int x, int y) {\n        int r = x + y;\n        return r;\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;javaä¸­å‡½æ•°è°ƒç”¨å¦‚ä½•å®ç°ï¼Ÿ&lt;br&gt;\nmainæ–¹æ³•çš„codeæŒ‡ä»¤æµï¼š&lt;br&gt;\n&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a9610b89aa564ef08ab23c577af54559~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/p&gt;\n&lt;p&gt;additiveæ–¹æ³•çš„codeæŒ‡ä»¤æµï¼š&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;4\&#34;&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c31c3e99e2c04fd2b774172edde8fd13~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;5\&#34;&gt;&lt;img src=\&#34;https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/91cbecea94264be485a5a7dc87f010df~tplv-k3u1fbpfcp-watermark.image\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h2 id=\&#34;é™æ€ç»‘å®šä¸åŠ¨æ€ç»‘å®š\&#34;&gt;é™æ€ç»‘å®šä¸åŠ¨æ€ç»‘å®š&lt;/h2&gt;\n&lt;p&gt;ç½‘ä¸Šå¾ˆå¤šæ–‡ç« å¯¹äºè¿™ä¸¤è€…çš„è§£é‡Šä¸ºé‡è½½æ˜¯é™æ€ç»‘å®šï¼ˆç¼–è¯‘æ—¶å¤šæ€ï¼‰ï¼Œé‡å†™æ˜¯åŠ¨æ€ç»‘å®šã€‚å…¶å®ä¸å®Œå…¨æ­£ç¡®ï¼Œé‡è½½ä¹Ÿå¯èƒ½è¢«å­ç±»é‡å†™çš„æƒ…å†µï¼Œä¸€æ ·éœ€è¦åœ¨è¿è¡ŒæœŸé—´åˆ¤æ–­ã€‚&lt;/p&gt;\n&lt;p&gt;å‡†ç¡®åœ°è¯´ï¼ŒJava è™šæ‹Ÿæœºä¸­çš„é™æ€ç»‘å®šæŒ‡çš„æ˜¯åœ¨è§£ææ—¶ä¾¿èƒ½å¤Ÿç›´æ¥è¯†åˆ«ç›®æ ‡æ–¹æ³•çš„æƒ…å†µï¼Œè€ŒåŠ¨æ€ç»‘å®šåˆ™æŒ‡çš„æ˜¯éœ€è¦åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ ¹æ®è°ƒç”¨è€…çš„åŠ¨æ€ç±»å‹æ¥è¯†åˆ«ç›®æ ‡æ–¹æ³•çš„æƒ…å†µã€‚æ¦‚æ‹¬å°±æ˜¯&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;strong&gt;é™æ€ç»‘å®š&lt;/strong&gt;åªåœ¨ç¼–è¯‘æœŸé—´å°±å¯ä»¥çŸ¥é“å…·ä½“è¦è°ƒç”¨çš„æ–¹æ³•ã€‚&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;åŠ¨æ€ç»‘å®š&lt;/strong&gt;æŒ‡è¦åˆ°è¿è¡ŒæœŸé—´æ‰èƒ½çŸ¥é“è¦è°ƒç”¨çš„æ–¹æ³•ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;åœ¨invokeå‘½ä»¤ä¸­ï¼Œinvokestaticå¯¹åº”çš„ä¸ºé™æ€ç»‘å®šï¼ˆä½¿ç”¨staticä¿®é¥°ï¼‰ï¼Œinvokevirtualã€invokeinterfaceä¸ºåŠ¨æ€ç»‘å®šçš„ã€‚&lt;/p&gt;\n&lt;p&gt;ç”¨ä»£ç è¿›è¡Œè¯´æ˜å°±æ˜¯&lt;/p&gt;\n&lt;h4 id=\&#34;invokestaticçš„é€»è¾‘\&#34;&gt;invokestaticçš„é€»è¾‘&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-go\&#34;&gt;func (i *INVOKE_STATIC) Execute(frame *runtime.Frame) {\n\tcp := frame.Method().CP()\n\tcontantMethod := cp.GetConstantInfo(i.Index).(*constant_pool.ConstantMethod)\n\tclassName := contantMethod.ClassName()\n\tperm := jclass.GetPerm()\n\tclass := perm.Space[className]\n\tif class == nil {\n\t\tclass = jclass.ParseInstanceByClassName(className)\n\t}\n\tname, _type := contantMethod.NameAndDescriptor()\n\tmethodInfo, err := class.FindStaticMethod(name, _type)        //è·å–ç›®æ ‡æ–¹æ³•\n\tif err != nil {\n\t\tpanic(&amp;quot;[gvm]&amp;quot; + err.Error())\n\t}\n\tif !jclass.IsStatic(methodInfo.AccessFlag()) {\n\t\tpanic(&amp;quot;[gvm] invoke static error&amp;quot;)\n\t}\n\tmethodInfo.SetJClass(class)\n\tbase.InvokeMethod(frame, methodInfo, true)\n}\n\nfunc (j JClass_Instance) FindStaticMethod(name, descriptor string) (*MethodInfo, error) {       // åœ¨æœ¬ç±»ä¸­è·å–\n\tfor i := range j.Methods {\n\t\tmethodInfo := j.Methods[i]\n\t\tif !IsStatic(methodInfo.accessFlag) {\n\t\t\tcontinue\n\t\t}\n\t\tmName := j.ConstantPool.GetUtf8(methodInfo.nameIdx)\n\t\tmDesc := j.ConstantPool.GetUtf8(methodInfo.descriptorIdx)\n\t\tif name != mName || mDesc != descriptor {\n\t\t\tcontinue\n\t\t}\n\t\treturn j.Methods[i], nil\n\t}\n\treturn nil, exception.GvmError{Msg: &amp;quot;not find static method it name &amp;quot; + name}\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;invokevirtualçš„é€»è¾‘\&#34;&gt;invokevirtualçš„é€»è¾‘&lt;/h4&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-go\&#34;&gt;func (i *INVOKE_VIRTUAL) Execute(frame *runtime.Frame) {\n\tconstantMethod := frame.Method().CP().GetConstantInfo(i.Index).(*constant_pool.ConstantMethod)\n\tmethodNameStr, methodDescStr := constantMethod.NameAndDescriptor()\n\texception.AssertTrue(methodNameStr != &amp;quot;&amp;lt;init&amp;gt;&amp;quot; &amp;amp;&amp;amp; methodNameStr != &amp;quot;&amp;lt;clinit&amp;gt;&amp;quot;, &amp;quot;IncompatibleClassChangeError&amp;quot;)\n\n\tclassNameStr := constantMethod.ClassName()\n\tpermSpace := jclass.GetPerm().Space\n\tjc := permSpace[classNameStr]\n\tif jc == nil {\n\t\tjc = jclass.ParseInstanceByClassName(classNameStr)\n\t}\n\texception.AssertTrue(jc != nil, &amp;quot;NullPointerException&amp;quot;)\n    \n    //*****æŸ¥æ‰¾ç›®æ ‡å®ä¾‹æ–¹æ³•*****\n\tmethodInfo, err, _ := jc.FindMethod(methodNameStr, methodDescStr)     \n\texception.AssertTrue(err == nil, &amp;quot;no find the method of &amp;quot;+methodNameStr)\n\texception.AssertFalse(jclass.IsStatic(methodInfo.AccessFlag()), &amp;quot;IncompatibleClassChangeError&amp;quot;)\n\n\tif jclass.IsProteced(methodInfo.AccessFlag()) {\n\t\t// todo if is proteced , need to judge the relation between caller and called\n\t}\n\n\tbase.InvokeMethod(frame, methodInfo, false)\n}\n\n\nfunc (j *JClass_Instance) FindMethod(name, descriptor string) (*MethodInfo, error, *JClass_Instance) {\n\tfor i := range j.Methods {\n\t\tmethodInfo := j.Methods[i]\n\t\tif IsStatic(methodInfo.accessFlag) {\n\t\t\tcontinue\n\t\t}\n\t\tmName := j.ConstantPool.GetUtf8(methodInfo.nameIdx)\n\t\tmDesc := j.ConstantPool.GetUtf8(methodInfo.descriptorIdx)\n\t\tif mName == name &amp;amp;&amp;amp; mDesc == descriptor {\n\t\t\treturn j.Methods[i], nil, j\n\t\t}\n\t}\n\t// åœ¨çˆ¶ç±»ä¸­éå†æŸ¥æ‰¾\n\tm, err, jc := j.SuperClass.FindMethod(name, descriptor)\n\tif err == nil {\n\t\treturn m, nil, jc\n\t}\n\t// åœ¨æ¥å£ä¸­éå†æŸ¥æ‰¾\n\tfor i := range j.Interfaces {\n\t\tm, err, jc := j.Interfaces[i].FindMethod(name, descriptor)\n\t\tif err == nil {\n\t\t\treturn m, nil, jc\n\t\t}\n\t}\n\treturn nil, exception.GvmError{Msg: &amp;quot;not find method it name &amp;quot; + name}, nil\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;jniæ–¹æ³•ç®€è¿°\&#34;&gt;JNIæ–¹æ³•ç®€è¿°&lt;/h2&gt;\n&lt;p&gt;æœ‰ä¸€äº›åœºæ™¯ä¸­ï¼Œjavaæœ¬èº«æ²¡æœ‰èƒ½åŠ›å»å®Œæˆï¼Œæœ€å¸¸è§çš„å°±æ˜¯å½“è¦ç³»ç»Ÿè°ƒç”¨æ—¶å€™,å°±è¦ä½¿ç”¨JNIï¼ˆJava Native Interfaceï¼‰è¿™ç§æ–¹å¼ã€‚&lt;/p&gt;\n&lt;p&gt;ä¾‹å¦‚nioä¸­çš„Selector&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;private native int poll0(long var1, int var3, long var4);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;unsafe.cas&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public final native boolean compareAndSwapInt(Object var1, long var2, int var4, int var5);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;è¿™ç§æ–¹å¼æœ¬è´¨ä¸Šä¹Ÿæ˜¯è°ƒç”¨å¦ä¸€ä¸ªåœ°æ–¹çš„å‡½æ•°ï¼Œé“¾æ¥çš„å·¥ä½œç”±è™šæ‹Ÿæœºå®Œæˆã€‚GvmOutæ˜¯invokeè°ƒç”¨æ—¶åŸºäºGoçš„Printæ–¹æ³•å®ç°ï¼Œä½¿ç”¨nativeæ–¹æ³•å¯ä»¥è¿›è¡Œéå¸¸å¤šçš„æ‰©å±•æ“ä½œã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class GvmOut{\n    public native static void to(int i);\n    public native static void to(float i);\n    public native static void to(double i);\n    public native static void to(boolean i);\n    public native static void to(long i);\n    public native static void to(String i);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;å‚è€ƒ\&#34;&gt;å‚è€ƒï¼š&lt;/h2&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;https://www.zhihu.com/question/35777031\&#34;&gt;æ ˆå¼è™šæ‹Ÿæœºå’Œå¯„å­˜å™¨å¼è™šæ‹Ÿæœºï¼Ÿ&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;https://www.iteye.com/blog/rednaxelafx-492667\&#34;&gt;è™šæ‹Ÿæœºéšè°ˆï¼ˆä¸€ï¼‰ï¼šè§£é‡Šå™¨ï¼Œæ ‘éå†è§£é‡Šå™¨ï¼ŒåŸºäºæ ˆä¸åŸºäºå¯„å­˜å™¨ï¼Œå¤§æ‚çƒ© - Script Ahead, Code Behind - ITeyeåšå®¢&lt;/a&gt;&lt;br&gt;\n-ã€Šè™šæ‹Ÿæœºè§„èŒƒ(SE8)ã€‹&lt;br&gt;\n-ã€Šè‡ªå·±åŠ¨æ‰‹äº›è™šæ‹Ÿæœºã€‹&lt;/li&gt;\n&lt;/ul&gt;\n&#34;,&#34;fileName&#34;:&#34;65lQ_SxQ1&#34;,&#34;abstract&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;é¡¹ç›®ä»£ç ï¼š&lt;a href=\&#34;https://github.com/zexho994/gvm\&#34;&gt;https://github.com/zexho994/gvm&lt;/a&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n&#34;,&#34;title&#34;:&#34;JVM æ–¹æ³•è°ƒç”¨ä¸æ‰§è¡Œ&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;JVM&#34;,&#34;slug&#34;:&#34;jjLsZt3QW&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/jjLsZt3QW/&#34;}],&#34;date&#34;:&#34;2021-02-02 22:31:28&#34;,&#34;dateFormat&#34;:&#34;2021-02-02 10:31:28&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/65lQ_SxQ1/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;9 min read&#34;,&#34;time&#34;:510000,&#34;words&#34;:1962,&#34;minutes&#34;:9},&#34;description&#34;:&#34;\né¡¹ç›®ä»£ç ï¼šhttps://github.com/zexho994/gvm\n\n\nè™šæ‹Ÿæœºæ•´ä½“çš„æµç¨‹\nä¸åŒç±»å‹çš„è™šæ‹Ÿæœº\nä»è§£é‡Šå™¨çš„å®ç°æ–¹å¼ä¸Šæ¥çœ‹ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„è™šæ‹Ÿæœºæ‰§è¡Œæ¶æ„ã€‚\n\nåŸºäºæ ˆç»“æ„\nåŸºäºå¯„å­˜å™¨\njvmå®¶æ—çš„è™šæ‹ŸæœºåŸºæœ¬éƒ½æ˜¯åŸºäºæ ˆçš„ï¼ŒåŸºäºæ ˆ...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%95%B4%E4%BD%93%E7%9A%84%E6%B5%81%E7%A8%8B\&#34;&gt;è™šæ‹Ÿæœºæ•´ä½“çš„æµç¨‹&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA\&#34;&gt;ä¸åŒç±»å‹çš„è™šæ‹Ÿæœº&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A0%88%E8%99%9A%E6%8B%9F%E6%9C%BA\&#34;&gt;æ ˆè™šæ‹Ÿæœº&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AF%84%E5%AD%98%E5%99%A8%E8%99%9A%E6%8B%9F%E6%9C%BA\&#34;&gt;å¯„å­˜å™¨è™šæ‹Ÿæœº&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%8A%89%E6%8B%A9\&#34;&gt;è™šæ‹Ÿæœºç±»å‹çš„æŠ‰æ‹©&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AF%B9java%E7%9A%84%E5%BD%B1%E5%93%8D\&#34;&gt;å¯¹Javaçš„å½±å“&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C\&#34;&gt;æ–¹æ³•æ‰§è¡Œ&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A0%88%E5%B8%A7\&#34;&gt;æ ˆå¸§&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#\&#34;&gt;!&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88\&#34;&gt;è™šæ‹Ÿæœºæ ˆ&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#-2\&#34;&gt;!&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E8%A1%A8%E5%92%8C%E6%93%8D%E4%BD%9C%E6%95%B0%E6%A0%88size\&#34;&gt;å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆsize&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8\&#34;&gt;æ–¹æ³•è°ƒç”¨&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#invoke-%E6%8C%87%E4%BB%A4%E7%B0%87\&#34;&gt;Invoke æŒ‡ä»¤ç°‡&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%B0%83%E7%94%A8%E6%89%A7%E8%A1%8C%E9%80%BB%E8%BE%91\&#34;&gt;è°ƒç”¨æ‰§è¡Œé€»è¾‘&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%9D%99%E6%80%81%E7%BB%91%E5%AE%9A%E4%B8%8E%E5%8A%A8%E6%80%81%E7%BB%91%E5%AE%9A\&#34;&gt;é™æ€ç»‘å®šä¸åŠ¨æ€ç»‘å®š&lt;/a&gt;&lt;br&gt;\n*\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#invokestatic%E7%9A%84%E9%80%BB%E8%BE%91\&#34;&gt;invokestaticçš„é€»è¾‘&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#invokevirtual%E7%9A%84%E9%80%BB%E8%BE%91\&#34;&gt;invokevirtualçš„é€»è¾‘&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#jni%E6%96%B9%E6%B3%95%E7%AE%80%E8%BF%B0\&#34;&gt;JNIæ–¹æ³•ç®€è¿°&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8F%82%E8%80%83\&#34;&gt;å‚è€ƒï¼š&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;githubåœ°å€ï¼šhttps://github.com/zexho994/IOC-AOP&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;æ ¸å¿ƒå®ç°\&#34;&gt;æ ¸å¿ƒå®ç°&lt;/h1&gt;\n&lt;h3 id=\&#34;æµç¨‹\&#34;&gt;æµç¨‹&lt;/h3&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ba70855125c48d280678e5d1538979d~tplv-k3u1fbpfcp-watermark.image\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;beançš„å£°æ˜\&#34;&gt;Beançš„å£°æ˜&lt;/h3&gt;\n&lt;p&gt;ä»¥æ³¨è§£çš„æ–¹å¼ä¸ºä¾‹ï¼Œåœ¨ç±»ä¸Šæ·»åŠ @Beanæ³¨è§£å³è¡¨ç¤ºè¯¥Classä¸ºä¸€ä¸ªBeanï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Bean\npublic class BeanTest1 implements BeanTest {\n\n    @Override\n    public void print() {\n        System.out.println(&amp;quot;BeanTest1&amp;quot;);\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;åœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™ä¼šæ‰«æç›®å½•ä¸‹æ‰€æœ‰çš„Classï¼Œæµç¨‹å¦‚ä¸‹:&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/585f5fd3ead84ba491753ffa4276d292~tplv-k3u1fbpfcp-watermark.image\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public static List&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt; findAllBean() {\n    ClassLoader contextClassLoader = getDefaultClassLoader();  //è·å–é»˜è®¤ç±»åŠ è½½å™¨\n    List&amp;lt;String&amp;gt; classes = scanClasses(contextClassLoader);    //æ‰«ææ‰€æœ‰Classç±»\n    return filtersAndLoadBeans(classes, contextClassLoader);   //è¿‡æ»¤ï¼Œè·å–æ‰€æœ‰Bean\n}\n\npublic void loadBean() {\n    BeanScanner\n        .findAllBean()\n        .forEach(bean -&amp;gt; AnnotationDefinitionLoaderRegistry.\n                 this.register(bean.getSimpleName(), bean));  //æ³¨å†Œæ‰€æœ‰çš„bean\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å…·ä½“çš„çš„ä»£ç ç»†èŠ‚ä¸è¯¦ç»†å±•å¼€ï¼Œéœ€è¦çš„å¯ä»¥çœ‹æºç ã€‚&lt;/p&gt;\n&lt;p&gt;åˆ°æ­¤ï¼Œæ‰€æœ‰çš„Beanéƒ½å·²ç»ä¿å­˜åˆ°äº†mapç»“æ„ä¸­ï¼Œå½“éœ€è¦ä½¿ç”¨Beançš„æ—¶å€™æ ¹æ®bean nameè¿›è¡Œè·å–å°±å¥½äº†ã€‚&lt;/p&gt;\n&lt;h3 id=\&#34;autowiredå®ç°\&#34;&gt;@Autowiredå®ç°&lt;/h3&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;3\&#34;&gt;&lt;img src=\&#34;https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7d52d41f1d9d4b7fa7da3e63563931e7~tplv-k3u1fbpfcp-watermark.image\&#34; alt=\&#34;image.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Bean\npublic class AutowiredTest {\n\n    @Autowired\n    public BeanTest1 beanTest1;\n    @Autowired\n    public BeanTest2 beanTest2;\n\n    public void print1() {\n        beanTest1.print();\n    }\n\n    public void print2() {\n        beanTest2.print();\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;// åˆå§‹åŒ–bean\nprivate void initBean(BeanDefinition beanDefinition) throws IllegalAccessException {\n    Object instance = beanDefinition.getInstance();\n\n    // åˆå§‹åŒ–Autowired\n    this.initAutowire(instance);\n\n    beanDefinition.setStatusInitialized();\n}\n\n/** \n* è®¾ç½®beané‡Œé¢çš„æ³¨å…¥å­—æ®µ\n*/\nprivate void initAutowire(Object instance) throws IllegalAccessException {\n    // è·å–æ‰€æœ‰å­—æ®µï¼Œå¦‚æœæœ‰Autowiredæ³¨è§£ï¼Œè·å–è¯¥beanï¼Œç„¶åèµ‹å€¼ç»™å­—æ®µ\n    for (Field field : instance.getClass().getFields()) {\n        if (field.getDeclaredAnnotationsByType(Autowired.class).length == 0) {\n            continue;\n        }\n        Class&amp;lt;?&amp;gt; fieldType = field.getType();\n        Object bean = this.getBean(fieldType.getSimpleName());\n        field.set(instance, bean);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;è§£å†³å¾ªç¯ä¾èµ–\&#34;&gt;è§£å†³å¾ªç¯ä¾èµ–&lt;/h1&gt;\n&lt;p&gt;åœ¨springä¸­ä½¿ç”¨â€œ3çº§ç¼“å­˜â€æ¥è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä¸è¦çº ç»“springä¸ºä½•è¦ä½¿ç”¨3ä¸ªmapæ¥å®ç°ï¼ŒæŠ›å¼€å®ç°çš„ç»†èŠ‚ï¼Œä»é—®é¢˜åŸå› ç€æ‰‹ï¼Œè¿™ä¸ªé—®é¢˜å…¶å®ä½¿ç”¨å¾ˆå¥½ç†è§£ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;ä½•ä¸ºå¾ªç¯ä¾èµ–\&#34;&gt;ä½•ä¸ºå¾ªç¯ä¾èµ–ï¼Ÿ&lt;/h2&gt;\n&lt;p&gt;ä¸‹é¢çš„Aå’ŒBå°±äº’ç›¸ä¾èµ–å½¼æ­¤ï¼Œè¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨åˆ›å»ºAçš„æ—¶å€™éœ€è¦åˆ›å»ºBï¼Œä½†æ˜¯åˆ›å»ºBçš„æ—¶å€™åˆéœ€è¦åˆ›å»ºAï¼Œçœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªå…ˆæœ‰é¸¡è¿˜æ˜¯è›‹çš„é—®é¢˜ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;@Bean\npublic class ClassA {\n    @Autowired\n    public ClassB ib;\n\n}\n\n@Bean\npublic class ClassB {\n    @Autowired\n    public ClassA ia;\n    \n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ä½†æ˜¯è¦çŸ¥é“Beançš„åˆ›å»ºå…¶å®æ˜¯åˆ†ä¸ºå¤šä¸ªæ­¥éª¤çš„ï¼Œå°±å¥½ç†è§£äº†ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-mermaid\&#34;&gt;graph LR\nn0(start) --&amp;gt; n1(åˆ›å»ºinstance) --&amp;gt; n2(å¡«å……éœ€è¦æ³¨å…¥çš„fieldså­—æ®µ) --&amp;gt; n3(end)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;åœ¨åˆ›å»ºå®Œinstanceåï¼Œé‡Œé¢çš„å­—æ®µå…¶å®éƒ½è¿˜æ˜¯nullçš„,ä¾‹å¦‚å·²ç»åˆ›å»ºClassAå®ä¾‹aï¼Œå’ŒClassBå®ä¾‹bï¼Œæ­¤æ—¶&lt;code&gt;a.ib = null&lt;/code&gt;å’Œ&lt;code&gt;b.ia = null&lt;/code&gt;. ç„¶åèµ‹å€¼ &lt;code&gt;a.ib = b&lt;/code&gt; å’Œ &lt;code&gt;b.ia = a&lt;/code&gt;ï¼Œè¿™ä¹‹åï¼Œaå’Œbä¸­çš„å­—æ®µéƒ½èµ‹å€¼å®Œäº†ï¼Œä¸”éƒ½æ˜¯å®Œæ•´å¯ç”¨çš„å¯¹è±¡äº†ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public Object getBean(String beanName) {\n    BeanDefinition bean = this.getBeanInstance(beanName);\n    if (!bean.isInit()) {\n        try {\n            this.initBean(bean);\n        } catch (IllegalAccessException e) {\n            e.printStackTrace();\n        }\n    }\n    return bean.getInstance();\n}\n\n// åˆå§‹åŒ–bean\nprivate void initBean(BeanDefinition beanDefinition) throws IllegalAccessException {\n    Object instance = beanDefinition.getInstance(); // è·å–beançš„isntance\n    beanDefinition.setStatusInitialized();  //è®¾ç½®ä¸ºå·²åˆå§‹åŒ–\n    this.initAutowire(instance);\n}\n\n// éå†æ‰€æœ‰å­—æ®µï¼Œä¸ºæœ‰@Authwiredæ³¨è§£çš„å®ç°æ³¨å…¥\nprivate void initAutowire(Object instance) throws IllegalAccessException {\n    Field[] fields = instance.getClass().getFields();\n    for (Field field : fields) {\n        if (field.getDeclaredAnnotationsByType(Autowired.class).length == 0) {\n            continue;\n        }\n        Class&amp;lt;?&amp;gt; fieldType = field.getType();\n        Object bean = this.getBean(fieldType.getSimpleName());\n        field.set(instance, bean);  //fieldèµ‹å€¼\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;æœ‰ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ç±»æ¯”ï¼Œleetcodeçš„ä¸€é“ç®—æ³•é¢˜two sum &lt;a href=\&#34;https://leetcode-cn.com/problems/two-sum/\&#34;&gt;https://leetcode-cn.com/problems/two-sum/&lt;/a&gt;ï¼Œå…¶ä¸­ä¸€ç§é¢˜è§£å°±æ˜¯éå†ä¸€è¾¹ï¼Œå­˜å‚¨æ‰€æœ‰å€¼å’Œç´¢å¼•åˆ°mapä¸­ï¼Œç„¶åéå†ä¸€æ¬¡mapï¼Œæ¯æ¬¡åˆ¤æ–­æ˜¯å¦æœ‰è¦çš„æ•°ã€‚&lt;/p&gt;\n&lt;p&gt;è¿™ä¸ªä¹Ÿæ˜¯ï¼Œå…ˆè®²instanceå­˜åˆ°mapä¸­ï¼Œç„¶åæŠŠmapä¸­instanceçš„fieldséƒ½è¿›è¡Œå¡«å……ï¼Œå°±å¯ä»¥äº†ã€‚&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;ioc_2&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;githubåœ°å€ï¼šhttps://github.com/zexho994/IOC-AOP&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;å‚è€ƒSpringå®ç° IOCï¼ˆä¸‹ï¼‰&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Spring&#34;,&#34;slug&#34;:&#34;P-ZT7Pj1-8&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/P-ZT7Pj1-8/&#34;},{&#34;name&#34;:&#34;é€ è½®å­&#34;,&#34;slug&#34;:&#34;KrLfgh9WlS&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/KrLfgh9WlS/&#34;}],&#34;date&#34;:&#34;2020-10-30 19:36:08&#34;,&#34;dateFormat&#34;:&#34;2020-10-30 07:36:08&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/ioc_2/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;4 min read&#34;,&#34;time&#34;:211000,&#34;words&#34;:795,&#34;minutes&#34;:4},&#34;description&#34;:&#34;githubåœ°å€ï¼šhttps://github.com/zexho994/IOC-AOP\n\næ ¸å¿ƒå®ç°\næµç¨‹\n\nBeançš„å£°æ˜\nä»¥æ³¨è§£çš„æ–¹å¼ä¸ºä¾‹ï¼Œåœ¨ç±»ä¸Šæ·»åŠ @Beanæ³¨è§£å³è¡¨ç¤ºè¯¥Classä¸ºä¸€ä¸ªBeanï¼Œä¾‹å¦‚ï¼š\n@Bean\npublic cl...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A0%B8%E5%BF%83%E5%AE%9E%E7%8E%B0\&#34;&gt;æ ¸å¿ƒå®ç°&lt;/a&gt;&lt;br&gt;\n*\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%B5%81%E7%A8%8B\&#34;&gt;æµç¨‹&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#bean%E7%9A%84%E5%A3%B0%E6%98%8E\&#34;&gt;Beançš„å£°æ˜&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#autowired%E5%AE%9E%E7%8E%B0\&#34;&gt;@Autowiredå®ç°&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%A7%A3%E5%86%B3%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96\&#34;&gt;è§£å†³å¾ªç¯ä¾èµ–&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BD%95%E4%B8%BA%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96\&#34;&gt;ä½•ä¸ºå¾ªç¯ä¾èµ–ï¼Ÿ&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h1 id=\&#34;åŸºæœ¬æ¦‚å¿µ\&#34;&gt;åŸºæœ¬æ¦‚å¿µ&lt;/h1&gt;\n&lt;h3 id=\&#34;æ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥\&#34;&gt;æ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;æ§åˆ¶åè½¬ï¼ˆIOCï¼‰ï¼Œä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;ä»€ä¹ˆæ˜¯æ§åˆ¶åè½¬ï¼Ÿç®€å•çš„è¯´ï¼Œæ§åˆ¶åè½¬å°±æ˜¯ä¸€ç§æ€æƒ³ï¼Œç›®çš„æ˜¯å°†å¯¹è±¡çš„åˆ›å»ºç”±ä¸»åŠ¨å˜æˆè¢«åŠ¨ã€‚&lt;br&gt;\nä¸‹é¢çš„å®ä¾‹å°±æ˜¯ä¸»åŠ¨newäº†ä¸€ä¸ªå¯¹è±¡ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class Service{\n    public DependObject object1 = new DenpendObject();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;é‚£ä¹ˆå¦‚ä½•åšåˆ°ä¸ä½¿ç”¨newå‘¢ï¼Ÿä¾èµ–æ³¨å…¥ä¾¿æ˜¯å…¶ä¸­ä¸€ç§å®ç°æ–¹å¼ã€‚&lt;/p&gt;\n&lt;p&gt;ä¾èµ–æ³¨å…¥çš„æ–¹å¼æœ‰ä¸‰ç§&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;æ„é€ å™¨æ³¨å…¥&lt;/li&gt;\n&lt;li&gt;setteræ³¨å…¥&lt;/li&gt;\n&lt;li&gt;æ¥å£æ³¨å…¥&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class Service{\n    public DependObject object;\n\n    // æ„é€ å™¨æ³¨å…¥\n    public Service (DependObject obj){\n        this.object = obj;\n    }\n\n    // setteræ³¨å…¥\n    public void setDependObject(DependObject obj){\n        this.object = obj;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸å†ç”±Serviceç±»ä¸­ä¸»åŠ¨åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡æ³¨å…¥çš„æ–¹å¼èµ‹å€¼ã€‚&lt;br&gt;\né¡ºä¾¿æ¯”è¾ƒä¸€ä¸‹3ä¸­æ–¹å¼çš„ä¼˜åŠ£ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;strong&gt;æ¥å£æ³¨å…¥ï¼š&lt;/strong&gt; ä»æ³¨å…¥æ–¹å¼çš„ä½¿ç”¨ä¸Šæ¥è¯´ï¼Œæ¥å£æ³¨å…¥æ˜¯ç°åœ¨ä¸ç”šæå€¡çš„ä¸€ç§æ–¹å¼ï¼ŒåŸºæœ¬å¤„äºâ€œé€€ å½¹çŠ¶æ€â€ã€‚å› ä¸ºå®ƒå¼ºåˆ¶è¢«æ³¨å…¥å¯¹è±¡å®ç°ä¸å¿…è¦çš„æ¥å£ï¼Œå¸¦æœ‰ä¾µå…¥æ€§ã€‚è€Œæ„é€ æ–¹æ³•æ³¨å…¥å’Œsetter æ–¹æ³•æ³¨å…¥åˆ™ä¸éœ€è¦å¦‚æ­¤ã€‚&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;æ„é€ æ–¹æ³•æ³¨å…¥ï¼š&lt;/strong&gt; è¿™ç§æ³¨å…¥æ–¹å¼çš„ä¼˜ç‚¹å°±æ˜¯ï¼Œå¯¹è±¡åœ¨æ„é€ å®Œæˆä¹‹åï¼Œå³å·²è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œå¯ä»¥ é©¬ä¸Šä½¿ç”¨ã€‚ç¼ºç‚¹å°±æ˜¯ï¼Œå½“ä¾èµ–å¯¹è±¡æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œæ„é€ æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¼šæ¯”è¾ƒé•¿ã€‚è€Œé€šè¿‡å å°„æ„é€ å¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹ç›¸åŒç±»å‹çš„å‚æ•°çš„å¤„ç†ä¼šæ¯”è¾ƒå›°éš¾ï¼Œç»´æŠ¤å’Œä½¿ç”¨ä¸Šä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚è€Œä¸” åœ¨Javaä¸­ï¼Œæ„é€ æ–¹æ³•æ— æ³•è¢«ç»§æ‰¿ï¼Œæ— æ³•è®¾ç½®é»˜è®¤å€¼ã€‚å¯¹äºéå¿…é¡»çš„ä¾èµ–å¤„ç†ï¼Œå¯èƒ½éœ€è¦å¼•å…¥å¤š ä¸ªæ„é€ æ–¹æ³•ï¼Œè€Œå‚æ•°æ•°é‡çš„å˜åŠ¨å¯èƒ½é€ æˆç»´æŠ¤ä¸Šçš„ä¸ä¾¿ã€‚&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;setteræ–¹æ³•æ³¨å…¥ï¼š&lt;/strong&gt; å› ä¸ºæ–¹æ³•å¯ä»¥å‘½åï¼Œæ‰€ä»¥setteræ–¹æ³•æ³¨å…¥åœ¨æè¿°æ€§ä¸Šè¦æ¯”æ„é€ æ–¹æ³•æ³¨å…¥å¥½ä¸€äº›ã€‚ å¦å¤–ï¼Œ setteræ–¹æ³•å¯ä»¥è¢«ç»§æ‰¿ï¼Œ å…è®¸è®¾ç½®é»˜è®¤å€¼ï¼Œè€Œä¸”æœ‰è‰¯å¥½çš„IDEæ”¯æŒã€‚ç¼ºç‚¹å½“ç„¶å°±æ˜¯å¯¹è±¡æ—  æ³•åœ¨æ„é€ å®Œæˆåé©¬ä¸Šè¿›å…¥å°±ç»ªçŠ¶æ€ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;iocå®¹å™¨\&#34;&gt;IOCå®¹å™¨&lt;/h3&gt;\n&lt;p&gt;ä¸ºäº†æ‰€æœ‰å¯¹è±¡çš„ç»Ÿä¸€ç®¡ç†ï¼Œéœ€è¦æœ‰ä¸€ä¸ªè§’è‰²è´Ÿè´£å°†è¿™äº›ç›¸äº’ä¾èµ–çš„å¯¹è±¡ç»‘å®šåˆ°ä¸€èµ·ï¼ŒIOCå®¹å™¨å°±æ˜¯è¿™æ ·ä¸€ä¸ªè§’è‰²ã€‚å®ƒçš„ä¸»è¦èŒè´£å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªï¼š&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;ä¸šåŠ¡å¯¹è±¡çš„æ„å»ºç®¡ç†ï¼šä¾‹å¦‚å¦‚ä½•åŠ è½½ç±»ï¼Œç®¡ç†ç±»çš„ç”Ÿå‘½å‘¨æœŸç­‰ã€‚&lt;/li&gt;\n&lt;li&gt;ä¸šåŠ¡å¯¹è±¡é—´çš„ä¾èµ–ç»‘å®šï¼šæä¾›æ„å»ºå¥½çš„å¯¹è±¡ç»™ä¸šåŠ¡æ–¹ä½¿ç”¨ã€‚&lt;br&gt;\næ€»ç»“å°±æ˜¯åˆ›å»ºå’Œç»‘å®š&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;IOCå®¹å™¨å¦‚ä½•çŸ¥é“ç®¡ç†å“ªäº›å¯¹è±¡å‘¢ï¼Ÿæœ¬ç³»åˆ—å°†å®ç°ä¸¤ç§æ–¹å¼ï¼š1.ä½¿ç”¨ç¼–ç ç”³æ˜ï¼Œ2. ä½¿ç”¨æ³¨è§£@Beanå£°æ˜ï¼Œç†Ÿæ‚‰Springçš„çŸ¥é“å¸¸ç”¨çš„è¿˜æœ‰XMLçš„æ–¹å¼ï¼Œè¿™ä¸ªå¯ä»¥è‡ªè¡Œå®ç°ã€‚&lt;/p&gt;\n&lt;p&gt;åœ¨Springä¸­ï¼Œä½¿ç”¨Beançš„æ¦‚å¿µè¡¨ç¤ºIOCç®¡ç†çš„å¯¹è±¡ï¼Œåœ¨è¿™é‡Œä¾ç„¶é‡‡ç”¨è¿™ç§å®šä¹‰æ–¹å¼ï¼Œä¸‹ç¯‡æ–‡ç« ä»‹ç»IOCæ¨¡å—çš„ç»“æ„è®¾è®¡ã€‚&lt;/p&gt;\n&lt;h3 id=\&#34;æ‹“å±•é˜…è¯»\&#34;&gt;æ‹“å±•é˜…è¯»&lt;/h3&gt;\n&lt;p&gt;å¯¹IOCçš„åŸºæœ¬æ¦‚å¿µä¸ç†Ÿæ‚‰çš„å¯ä»¥é˜…è¯»ï¼š&lt;br&gt;\nã€Šspringæ­å¯†ã€‹2.1 IOCåŸºæœ¬æ¦‚å¿µ&lt;/p&gt;\n&lt;h1 id=\&#34;é¢„æœŸå®ç°æ•ˆæœ\&#34;&gt;é¢„æœŸå®ç°æ•ˆæœ&lt;/h1&gt;\n&lt;h2 id=\&#34;beançš„å£°æ˜æ–¹å¼\&#34;&gt;Beançš„å£°æ˜æ–¹å¼&lt;/h2&gt;\n&lt;h3 id=\&#34;é€šè¿‡ç¼–ç æ–¹å¼è¿›è¡Œå£°æ˜\&#34;&gt;é€šè¿‡ç¼–ç æ–¹å¼è¿›è¡Œå£°æ˜&lt;/h3&gt;\n&lt;p&gt;ç»§æ‰¿CodeDefinitionLoderRegistryç±»ï¼Œé‡å†™loadBean()æ–¹æ³•&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class MyCodeBeanDefinition extends CodeDefinitionLoaderRegistry {\n\n    @Override\n    public void loadBean() {\n        this.register(&amp;quot;BeanTest1&amp;quot;, BeanTest1.class);\n        this.register(&amp;quot;BeanTest2&amp;quot;, BeanTest2.class);\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ç„¶åç¼–ç ä½¿ç”¨register(beançš„åç§°ï¼Œbeanæ‰€å¯¹åº”ç±»)è¿›è¡Œæ³¨å†Œï¼Œå’ŒXMLçš„å£°æ˜æ–¹å¼æ˜¯ç±»ä¼¼çš„ã€‚&lt;/p&gt;\n&lt;h3 id=\&#34;é€šè¿‡æ³¨è§£beançš„æ–¹å¼å£°æ˜\&#34;&gt;é€šè¿‡æ³¨è§£@Beançš„æ–¹å¼å£°æ˜&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Bean\npublic class BeanTest1 implements BeanTest {\n\n    @Override\n    public void print() {\n        System.out.println(&amp;quot;BeanTest1&amp;quot;);\n    }\n\n}\n\n@Bean\npublic class BeanTest2 implements BeanTest {\n\n    @Override\n    public void print() {\n        System.out.println(&amp;quot;BeanTest2&amp;quot;);\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;è·å–bean\&#34;&gt;è·å–Bean&lt;/h2&gt;\n&lt;h3 id=\&#34;ä»å·¥å‚ä¸­è·å–bean\&#34;&gt;ä»å·¥å‚ä¸­è·å–Bean&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public static void foo() {\n\n    // ç¬¬ä¸€æ­¥ï¼šcæ ¹æ®å£°æ˜çš„æ–¹å¼é€‰æ‹© 1 or 2\n    // æ–¹å¼ä¸€ï¼š åˆ›å»ºæ³¨å†Œç±»,æ³¨å†Œç±»ä¸­ä½¿ç”¨ç¼–ç å®ç°æ³¨å†Œé€»è¾‘\n    AbstractDefinitionLoaderRegistry registry = new MyCodeBeanDefinition();\n    // æ–¹å¼äºŒï¼š åˆ›å»ºæ³¨å†Œç±»,Beané€šè¿‡æ³¨è§£çš„æ–¹å¼è‡ªåŠ¨æ³¨å…¥\n    AbstractDefinitionLoaderRegistry registry = new AnnotationDefinitionLoaderRegistry();\n    \n    // ç¬¬äºŒæ­¥ï¼šæ³¨å†Œç±»æ·»åŠ åˆ°å·¥å‚ä¸­\n    ApplicationContext factory = new ApplicationContext(registry);\n\n    // ç¬¬ä¸‰æ­¥ï¼šè·å–Bean\n    BeanTest obj1 = factory.getBeanInstance(&amp;quot;BeanTest1&amp;quot;, BeanTest1.class);\n    BeanTest obj2 = factory.getBeanInstance(&amp;quot;BeanTest2&amp;quot;, BeanTest2.class);\n    \n    obj1.print();\n    obj2.print();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;é€šè¿‡æ³¨è§£è‡ªåŠ¨æ³¨å…¥bean\&#34;&gt;é€šè¿‡æ³¨è§£è‡ªåŠ¨æ³¨å…¥Bean&lt;/h3&gt;\n&lt;p&gt;ä½¿ç”¨@Autowiredè‡ªåŠ¨æ³¨å…¥&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;@Bean\npublic class AutowiredTest {\n\n    @Autowired\n    public BeanTest1 beanTest1;\n    @Autowired\n    public BeanTest2 beanTest2;\n\n    public void print1() {\n        beanTest1.print();\n    }\n\n    public void print2() {\n        beanTest2.print();\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;é¡¹ç›®ç»„ç»‡ç»“æ„\&#34;&gt;é¡¹ç›®ç»„ç»‡ç»“æ„&lt;/h1&gt;\n&lt;h2 id=\&#34;springä¸­çš„iocè®¾è®¡\&#34;&gt;Springä¸­çš„IOCè®¾è®¡&lt;/h2&gt;\n&lt;p&gt;springä¸­iocæ¨¡å—å¯ä»¥åˆ†ä¸º3ä¸­è§’è‰²ï¼Œåˆ†åˆ«å¯¹åº”3ä¸ªæœ€é¡¶å±‚æ¥å£ï¼š&lt;br&gt;\n&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b1c03834b5a348a18794a7ee8aed7546~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/p&gt;\n&lt;p&gt;é€šä¿—çš„ç†è§£ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;BeanDefinition: å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„Beanï¼Œç†è§£ä¸ºå›¾ä¹¦ã€‚&lt;/li&gt;\n&lt;li&gt;BeanDefinitionRegistry: ä¹¦æ¶ï¼Œå­˜æ”¾ä¹¦çš„åœ°æ–¹ã€‚&lt;/li&gt;\n&lt;li&gt;BeanFactory: å›¾ä¹¦é¦†ï¼Œå€Ÿä¹¦çš„åœ°æ–¹ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;åœ¨æˆ‘ä»¬çš„å®ç°ä¸­ï¼ŒåŒæ ·ä½¿ç”¨äº†è¿™3ä¸ªæ¦‚å¿µï¼Œçœ‹ä¸‹3ä¸ªæ¥å£éƒ½æœ‰å“ªäº›æ–¹æ³•ï¼š&lt;/p&gt;\n&lt;h3 id=\&#34;beandefinition\&#34;&gt;BeanDefinition&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public interface BeanDefinition {\n    // 0è¡¨ç¤ºæœªåˆå§‹åŒ–\n    int STATUS_UNINITIALIZED = 0;\n    // 1è¡¨ç¤ºå·²åˆå§‹åŒ–\n    int STATUS_INITIALIZED = 1;\n\n    /**\n     * Sets name.\n     *\n     * @param beanClassName the bean class name\n     */\n    void setName(String beanClassName);\n\n    /**\n     * Gets name.\n     *\n     * @return the name\n     */\n    String getName();\n\n    /**\n     * Sets instance.\n     *\n     * @param instance the instance\n     */\n    void setInstance(Object instance);\n\n    /**\n     * Gets instance.\n     *\n     * @return the instance\n     */\n    Object getInstance();\n\n    /**\n     * Gets bean class.\n     *\n     * @return bean class\n     */\n    Class&amp;lt;?&amp;gt; getBeanClass();\n\n    /**\n     * åˆ¤æ–­beanæ˜¯å¦æœ‰åˆå§‹åŒ–\n     *\n     * @return status == {@link #STATUS_INITIALIZED} ?\n     */\n    Boolean isInit();\n\n    /**\n     * set status to {@link #STATUS_INITIALIZED}\n     */\n    void setStatusInitialized();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;beandefinitionregistry\&#34;&gt;BeanDefinitionRegistry&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public interface BeanDefinitionRegistry {\n\n    /**\n     * æ³¨å†Œä¸€ä¸ªæ–°çš„Bean\n     *\n     * @param beanName       beançš„æ³¨å†Œä½¿ç”¨åç§°\n     * @param beanDefinition beançš„ç±»å‹\n     */\n    void registerBean(String beanName, BeanDefinition beanDefinition);\n\n    /**\n     * ç§»é™¤ä¸€ä¸ªBean\n     *\n     * @param beanName è¦ç§»é™¤çš„Beançš„åç§°\n     */\n    void removeBean(String beanName);\n\n    /**\n     * æ ¹æ®åç§°è·å–Bean\n     *\n     * @param beanName beanåç§°\n     * @return å·²æ³¨å†Œçš„ {@link BeanDefinition} å¯¹è±¡\n     */\n    BeanDefinition getBean(String beanName);\n\n    /**\n     * è·å–Bean\n     * {@link BeanDefinition}\n     *\n     * @param beanName     beanåç§°\n     * @param requiredType beanç±»å‹ï¼Œä¼šè¿›è¡Œæ ¡éªŒ\n     * @return å·²æ³¨å†Œçš„ {@link BeanDefinition} å¯¹è±¡\n     */\n    &amp;lt;T&amp;gt; BeanDefinition getBean(String beanName, Class&amp;lt;T&amp;gt; requiredType);\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;beanfactory\&#34;&gt;BeanFactory&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public interface BeanFactory {\n\n    /**\n     * æ ¹æ®åç§°è·å–bean\n     *\n     * @param beanName beanåç§°\n     * @return beanåç§°å¯¹åº”çš„Bean\n     */\n    BeanDefinition getBeanInstance(String beanName);\n\n    /**\n     * æ ¹æ®åç§°è·å–ä¸€ä¸ªbean\n     *\n     * @param beanName     beançš„åç§°\n     * @param requiredType beanç±»å‹\n     * @return beanåç§°å¯¹åº”çš„Bean\n     */\n    &amp;lt;T&amp;gt; T getBeanInstance(String beanName, Class&amp;lt;T&amp;gt; requiredType);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;æˆ‘ä»¬çš„iocç±»å›¾\&#34;&gt;æˆ‘ä»¬çš„IOCç±»å›¾&lt;/h3&gt;\n&lt;p&gt;&lt;img src=\&#34;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3a49e7bfb13849aeb2e2c96eccd438cb~tplv-k3u1fbpfcp-zoom-1.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\nå¯¹3ä¸ªé¡¶å±‚æ¥å£éƒ½æ·»åŠ äº†é»˜è®¤å®ç°ç±»ï¼Œå…¶ä¸­æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªç‚¹ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;BeanDefinitionRegistry ä½¿ç”¨Mapè¿›è¡ŒBeançš„å­˜å‚¨ï¼ŒKeyä¸ºBeançš„åç§°ï¼ŒValä¸ºBeanDefinition&lt;/li&gt;\n&lt;li&gt;BeanDefinitionä¸­æœ‰3ä¸ªå­—æ®µ&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;private String beanName;  //beanåç§°\nprivate T beanInstance = null; // beançš„å®ä¾‹\nprivate final Class&amp;lt;T&amp;gt; beanClass; //beanå¯¹åº”çš„class\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;BeanFactoryä¸­å­˜å‚¨BeanDefinitionRegistryç±»ï¼Œå°è£…è·å–beançš„æ¥å£ï¼Œå·¥å‚å¯¹å¤–æä¾›&lt;/li&gt;\n&lt;/ul&gt;\n&#34;,&#34;fileName&#34;:&#34;ioc_1&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;å‚è€ƒSpringå®ç° IOCï¼ˆä¸Šï¼‰&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Spring&#34;,&#34;slug&#34;:&#34;P-ZT7Pj1-8&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/P-ZT7Pj1-8/&#34;},{&#34;name&#34;:&#34;é€ è½®å­&#34;,&#34;slug&#34;:&#34;KrLfgh9WlS&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/KrLfgh9WlS/&#34;}],&#34;date&#34;:&#34;2020-10-17 15:29:12&#34;,&#34;dateFormat&#34;:&#34;2020-10-17 03:29:12&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/ioc_1/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;7 min read&#34;,&#34;time&#34;:379000,&#34;words&#34;:1553,&#34;minutes&#34;:7},&#34;description&#34;:&#34;åŸºæœ¬æ¦‚å¿µ\næ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥\n\næ§åˆ¶åè½¬ï¼ˆIOCï¼‰ï¼Œä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰\n\nä»€ä¹ˆæ˜¯æ§åˆ¶åè½¬ï¼Ÿç®€å•çš„è¯´ï¼Œæ§åˆ¶åè½¬å°±æ˜¯ä¸€ç§æ€æƒ³ï¼Œç›®çš„æ˜¯å°†å¯¹è±¡çš„åˆ›å»ºç”±ä¸»åŠ¨å˜æˆè¢«åŠ¨ã€‚\nä¸‹é¢çš„å®ä¾‹å°±æ˜¯ä¸»åŠ¨newäº†ä¸€ä¸ªå¯¹è±¡ã€‚\npublic class Service{\n ...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5\&#34;&gt;åŸºæœ¬æ¦‚å¿µ&lt;/a&gt;&lt;br&gt;\n*\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC%E5%92%8C%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5\&#34;&gt;æ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#ioc%E5%AE%B9%E5%99%A8\&#34;&gt;IOCå®¹å™¨&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%8B%93%E5%B1%95%E9%98%85%E8%AF%BB\&#34;&gt;æ‹“å±•é˜…è¯»&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%A2%84%E6%9C%9F%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C\&#34;&gt;é¢„æœŸå®ç°æ•ˆæœ&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#bean%E7%9A%84%E5%A3%B0%E6%98%8E%E6%96%B9%E5%BC%8F\&#34;&gt;Beançš„å£°æ˜æ–¹å¼&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%80%9A%E8%BF%87%E7%BC%96%E7%A0%81%E6%96%B9%E5%BC%8F%E8%BF%9B%E8%A1%8C%E5%A3%B0%E6%98%8E\&#34;&gt;é€šè¿‡ç¼–ç æ–¹å¼è¿›è¡Œå£°æ˜&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%80%9A%E8%BF%87%E6%B3%A8%E8%A7%A3bean%E7%9A%84%E6%96%B9%E5%BC%8F%E5%A3%B0%E6%98%8E\&#34;&gt;é€šè¿‡æ³¨è§£@Beançš„æ–¹å¼å£°æ˜&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%8E%B7%E5%8F%96bean\&#34;&gt;è·å–Bean&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BB%8E%E5%B7%A5%E5%8E%82%E4%B8%AD%E8%8E%B7%E5%8F%96bean\&#34;&gt;ä»å·¥å‚ä¸­è·å–Bean&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%80%9A%E8%BF%87%E6%B3%A8%E8%A7%A3%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%85%A5bean\&#34;&gt;é€šè¿‡æ³¨è§£è‡ªåŠ¨æ³¨å…¥Bean&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%A1%B9%E7%9B%AE%E7%BB%84%E7%BB%87%E7%BB%93%E6%9E%84\&#34;&gt;é¡¹ç›®ç»„ç»‡ç»“æ„&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#spring%E4%B8%AD%E7%9A%84ioc%E8%AE%BE%E8%AE%A1\&#34;&gt;Springä¸­çš„IOCè®¾è®¡&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#beandefinition\&#34;&gt;BeanDefinition&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#beandefinitionregistry\&#34;&gt;BeanDefinitionRegistry&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#beanfactory\&#34;&gt;BeanFactory&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%88%91%E4%BB%AC%E7%9A%84ioc%E7%B1%BB%E5%9B%BE\&#34;&gt;æˆ‘ä»¬çš„IOCç±»å›¾&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;ol&gt;\n&lt;li&gt;æ‰¾åˆ°License.class&lt;br&gt;\nåœ¨wordsçš„jaråŒ…ä¸­æ‰¾åˆ°Licenseç±».éªŒè¯æ–¹æ³•å…¥å£åœ¨è¿™é‡Œ&lt;br&gt;\nè™½ç„¶æœ‰ä¸¤ä¸ªsetLicenseï¼ˆï¼‰æ–¹æ³•ï¼Œç»†å¿ƒç‚¹çœ‹ï¼Œæœ€åè°ƒç”¨çš„éƒ½æ˜¯zzVæ–¹æ³•ï¼Œåªæ˜¯ä¸åŒçš„é‡è½½ã€‚&lt;/li&gt;\n&lt;/ol&gt;\n&lt;!-- more --&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public class License {\n    private zz2B zzYIM = zz2B.zzoF();\n\n    public License() {\n    }\n\n    public void setLicense(String licenseName) throws Exception {\n        if (licenseName == null) {\n            throw new NullPointerException(this.zzYIM.zzZu(new byte[]{108, 105, 99, 101, 110, 115, 101, 78, 97, 109, 101}));\n        } else {\n            (new zzZJ5()).zzV(licenseName, zzZY2.zzkc());\n        }\n    }\n\n    public void setLicense(InputStream stream) throws Exception {\n        if (stream == null) {\n            throw new NullPointerException(this.zzYIM.zzZu(new byte[]{115, 116, 114, 101, 97, 109}));\n        } else {\n            (new zzZJ5()).zzV(stream);\n        }\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;è¿›å…¥zzV()æ–¹æ³•&lt;br&gt;\nåœ¨zzV()æ–¹æ³•ä¸‹é¢æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œç±»ä¼¼äºä¸‹é¢è¿™æ ·ã€‚&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;zzZaQå°±æ˜¯è¦ä¿®æ”¹çš„æ–¹æ³•ã€‚è®©ä»–å§‹ç»ˆè¿”å›1å°±å¥½äº†&lt;/strong&gt;ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;static int zzZaQ() {\n        boolean var0 = zzYIF == null || zzYIF.zzYIH == 0 || (new Date()).after(zzYIF.zzYII) || zzYNP.zzYlS() == 4096;\n        boolean var1 = zzZE1.zzYZQ() == 0;\n        int var2 = var0 &amp;amp;&amp;amp; var1 ? 0 : 1;\n        return var2; // update , return 1\n    }\n\n    static int zzZaP() {\n        boolean var0 = zzYIF == null || zzYIF.zzYIH == 0 || (new Date()).after(zzYIF.zzYII) || zzYNP.zzYlS() == 4096;\n        boolean var1 = zzZE1.zzYZQ() == 0;\n        int var2 = var0 &amp;amp;&amp;amp; var1 ? 0 : 1;\n        return var2;\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;2-åˆ©ç”¨javassistä¿®æ”¹å­—èŠ‚ç \&#34;&gt;2. åˆ©ç”¨Javassistä¿®æ”¹å­—èŠ‚ç &lt;/h2&gt;\n&lt;h3 id=\&#34;mavenæ·»åŠ ä¾èµ–\&#34;&gt;Mavenæ·»åŠ ä¾èµ–&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;org.javassist&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;javassist&amp;lt;/artifactId&amp;gt;\n    &amp;lt;version&amp;gt;${javaassist.version}&amp;lt;/version&amp;gt;\n&amp;lt;/dependency&amp;gt;\n \n&amp;lt;properties&amp;gt;\n    &amp;lt;javaassist.version&amp;gt;3.21.0-GA&amp;lt;/javaassist.version&amp;gt;\n&amp;lt;/properties&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;ç¼–å†™æ–¹æ³•\&#34;&gt;ç¼–å†™æ–¹æ³•&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public void removeWatermark() throws NotFoundException, CannotCompileException, IOException {\n        ClassPool.getDefault().insertClassPath(&amp;quot;xxxx&amp;quot;); // jaråŒ…çš„ç»å¯¹è·¯å¾„\n        CtClass targetClass = ClassPool.getDefault().getCtClass(&amp;quot;com.aspose.words.zzZJ5&amp;quot;); //ç±»è·¯å¾„\n        CtMethod targetMethod = targetClass.getDeclaredMethod(&amp;quot;zzZaQ&amp;quot;); //æ–¹æ³•è·¯å¾„\n        targetMethod.setBody(&amp;quot;{return 1;}&amp;quot;); //ä¿®æ”¹æ–¹æ³•ä½“ï¼Œå§‹ç»ˆè¿”å›1\n        targetClass.writeFile(&amp;quot;/Users/zexho/Documents/&amp;quot;); //ä¿å­˜ä¿®æ”¹ï¼Œå†…å®¹ä¸ºä¿å­˜çš„è·¯å¾„ã€‚\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;3-æ›´æ–°jaråŒ…\&#34;&gt;3. æ›´æ–°JaråŒ…&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;å°†.jaråŒ…ååç¼€æ”¹ä¸ºå…¶ä»–å‹ç¼©æ ¼å¼ã€‚macçš„æ”¹ä¸ºtarï¼Œwinå¯ä»¥æ”¹ä¸ºzip&lt;/li&gt;\n&lt;li&gt;è§£å‹tar,å°†æ–°ç”Ÿæˆclassæ–‡ä»¶æ›¿æ¢æ—§çš„&lt;/li&gt;\n&lt;li&gt;åˆ é™¤META-INFæ–‡ä»¶ä¸­çš„RSAå’ŒSFæ–‡ä»¶&lt;/li&gt;\n&lt;li&gt;ç¡®ä¿å½“å‰ä½ç½®åœ¨ä¸€çº§ç›®å½•ä¸­ï¼Œçœ‹åˆ°è¿™ä¸¤ä¸ªæ–‡ä»¶çš„ä½ç½®ã€‚&lt;br&gt;\n&lt;img src=\&#34;https://tva1.sinaimg.cn/large/007S8ZIlgy1gi3x36zscbj306403zdfo.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/li&gt;\n&lt;li&gt;é‡æ–°æ‰“åŒ…Jar &lt;code&gt;jar cvf [æ–°æ–‡ä»¶çš„åå­—.jar] .&lt;/code&gt;ä¾‹å¦‚&lt;code&gt;jar cvf aspose-slides-20.5-jdk16.jar .&lt;/code&gt;&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h2 id=\&#34;4-mavené‡æ–°å¯¼å…¥jaråŒ…\&#34;&gt;4. Mavené‡æ–°å¯¼å…¥JaråŒ…&lt;/h2&gt;\n&lt;p&gt;åœ¨mavenä¸­å¯¼å…¥è¯¥jaråŒ…ã€‚ç„¶ååˆ·æ–°å°±å¯ä»¥ç”¨äº†ã€‚&lt;br&gt;\n&lt;img src=\&#34;https://tva1.sinaimg.cn/large/007S8ZIlgy1gi3x5s3oxsj307n04bjre.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;åªèƒ½ä¸ªäººä½¿ç”¨ï¼Œä¸å¯å•†ç”¨&lt;/p&gt;\n&lt;/blockquote&gt;\n&#34;,&#34;fileName&#34;:&#34;u5bZtrIU8&#34;,&#34;abstract&#34;:&#34;&lt;ol&gt;\n&lt;li&gt;æ‰¾åˆ°License.class&lt;br&gt;\nåœ¨wordsçš„jaråŒ…ä¸­æ‰¾åˆ°Licenseç±».éªŒè¯æ–¹æ³•å…¥å£åœ¨è¿™é‡Œ&lt;br&gt;\nè™½ç„¶æœ‰ä¸¤ä¸ªsetLicenseï¼ˆï¼‰æ–¹æ³•ï¼Œç»†å¿ƒç‚¹çœ‹ï¼Œæœ€åè°ƒç”¨çš„éƒ½æ˜¯zzVæ–¹æ³•ï¼Œåªæ˜¯ä¸åŒçš„é‡è½½ã€‚&lt;/li&gt;\n&lt;/ol&gt;\n&#34;,&#34;title&#34;:&#34;åç¼–è¯‘+å­—èŠ‚ç æ³¨å…¥ç ´è§£ Aspose Words 20.6&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;çŸ¥è¯†åˆ†äº«&#34;,&#34;slug&#34;:&#34;Yh19JUBym&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/Yh19JUBym/&#34;}],&#34;date&#34;:&#34;2020-08-13 11:06:19&#34;,&#34;dateFormat&#34;:&#34;2020-08-13 11:06:19&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/u5bZtrIU8/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;3 min read&#34;,&#34;time&#34;:150000,&#34;words&#34;:513,&#34;minutes&#34;:3},&#34;description&#34;:&#34;\næ‰¾åˆ°License.class\nåœ¨wordsçš„jaråŒ…ä¸­æ‰¾åˆ°Licenseç±».éªŒè¯æ–¹æ³•å…¥å£åœ¨è¿™é‡Œ\nè™½ç„¶æœ‰ä¸¤ä¸ªsetLicenseï¼ˆï¼‰æ–¹æ³•ï¼Œç»†å¿ƒç‚¹çœ‹ï¼Œæœ€åè°ƒç”¨çš„éƒ½æ˜¯zzVæ–¹æ³•ï¼Œåªæ˜¯ä¸åŒçš„é‡è½½ã€‚\n\n\npublic class License ...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E5%88%A9%E7%94%A8javassist%E4%BF%AE%E6%94%B9%E5%AD%97%E8%8A%82%E7%A0%81\&#34;&gt;2. åˆ©ç”¨Javassistä¿®æ”¹å­—èŠ‚ç &lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#maven%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96\&#34;&gt;Mavenæ·»åŠ ä¾èµ–&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%BC%96%E5%86%99%E6%96%B9%E6%B3%95\&#34;&gt;ç¼–å†™æ–¹æ³•&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E6%9B%B4%E6%96%B0jar%E5%8C%85\&#34;&gt;3. æ›´æ–°JaråŒ…&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4-maven%E9%87%8D%E6%96%B0%E5%AF%BC%E5%85%A5jar%E5%8C%85\&#34;&gt;4. Mavené‡æ–°å¯¼å…¥JaråŒ…&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;javaè´Ÿæ•°çš„è®¡ç®—è¿‡ç¨‹\&#34;&gt;Javaè´Ÿæ•°çš„è®¡ç®—è¿‡ç¨‹&lt;/h2&gt;\n&lt;p&gt;javaä¸­æœ€é«˜ä½è¡¨ç¤ºç¬¦å·ä½,0è¡¨ç¤ºæ­£æ•°ï¼Œ1è¡¨ç¤ºè´Ÿæ•°&lt;/p&gt;\n&lt;h3 id=\&#34;æ ¹æ®åè¿›åˆ¶æ¨ç®—äºŒè¿›åˆ¶\&#34;&gt;æ ¹æ®åè¿›åˆ¶æ¨ç®—äºŒè¿›åˆ¶&lt;/h3&gt;\n&lt;p&gt;ä»¥-5ä¸ºä¾‹å­&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;-5çš„åŸç ï¼š&lt;code&gt;1000 0101&lt;/code&gt;&lt;/li&gt;\n&lt;li&gt;æ±‚åç  : &lt;code&gt;1111 1010&lt;/code&gt; ï¼Œç¬¦å·ä½ä¸è¿›è¡Œå–å&lt;/li&gt;\n&lt;li&gt;æ±‚è¡¥ç ï¼ˆ+1ï¼‰ï¼š&lt;code&gt;1111 1011&lt;/code&gt;&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;æ‰€ä»¥-5ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºä¸º&lt;code&gt;1111 1011&lt;/code&gt;&lt;/p&gt;\n&lt;h3 id=\&#34;æ ¹æ®äºŒè¿›åˆ¶é€†æ¨åè¿›åˆ¶\&#34;&gt;æ ¹æ®äºŒè¿›åˆ¶é€†æ¨åè¿›åˆ¶&lt;/h3&gt;\n&lt;p&gt;ä»¥&lt;code&gt;10001010&lt;/code&gt;ä¸ºä¾‹å­&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;\n&lt;p&gt;è·å–è¡¥ç ,ï¼ˆ-1æ“ä½œï¼‰&lt;/p&gt;\n&lt;p&gt;&lt;code&gt;10001010 - 1 = 10001001&lt;/code&gt;&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;è·å–åç &lt;/p&gt;\n&lt;p&gt;&lt;code&gt;10001001&lt;/code&gt; çš„åç  &lt;code&gt;11110110&lt;/code&gt;&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;ä¸çœ‹ç¬¦å·ä½ï¼Œç®—å‡ºå¤§å°&lt;/p&gt;\n&lt;p&gt;&lt;code&gt;1110110&lt;/code&gt;  å¯¹åº”çš„å€¼ä¸º &lt;code&gt;118&lt;/code&gt;ï¼Œæ‰€ä»¥10001010çš„å€¼å°±æ˜¯-118&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;å¯ä»¥çœ‹å‡ºæ¥ï¼Œå¯¹äºè´Ÿæ•°è€Œè¨€ï¼Œå› ä¸º&lt;code&gt;1000 0000&lt;/code&gt; åä¸ƒä½å› ä¸ºè¦å–åï¼Œæ‰€ä»¥åä¸ƒä½è¶Šå¤§åè€Œç»å¯¹å€¼è¶Šå°ï¼Œä¾‹å¦‚&lt;code&gt;1111 1111&lt;/code&gt; ç­‰äº-1ï¼Œè€Œ&lt;code&gt;1111 1110&lt;/code&gt; ç­‰äº-2&lt;/p&gt;\n&lt;p&gt;é‚£ä¹ˆå¯¹äºè´Ÿæ•°è€Œè¨€ &lt;code&gt;1000 0000&lt;/code&gt; å°±æ˜¯ç»å¯¹å€¼æœ€å¤§ï¼Œç›¸å¯¹å€¼æœ€å°çš„äº†ï¼Œç­‰äº-128&lt;/p&gt;\n&lt;h2 id=\&#34;ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡\&#34;&gt;ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡&lt;/h2&gt;\n&lt;p&gt;é¦–å…ˆåœ¨è®¡ç®—æœºä¸­å‡æ³•å®é™…ä¸Šæ˜¯åŠ æ³•ï¼Œ2-1 == 2 + (-1)ï¼Œé‚£ä¹ˆè¿›è¡Œæ¨ç†ä¸€ä¸‹&lt;/p&gt;\n&lt;h3 id=\&#34;å¦‚æœéƒ½ç”¨åŸç \&#34;&gt;å¦‚æœéƒ½ç”¨åŸç &lt;/h3&gt;\n&lt;p&gt;&lt;code&gt;2&lt;/code&gt; çš„åŸç ï¼š&lt;code&gt;0000 0010&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;&lt;code&gt;-1&lt;/code&gt; çš„åŸç : &lt;code&gt;1000 0001&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;&lt;code&gt;2 + (-1)&lt;/code&gt;= &lt;code&gt;10000 0011&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;ç­”æ¡ˆæ˜¯æ˜¯ -3ï¼Œç­”æ¡ˆé”™è¯¯&lt;/p&gt;\n&lt;h3 id=\&#34;å¦‚æœæ­£æ•°ç”¨åŸç è´Ÿæ•°ç”¨è¡¥ç \&#34;&gt;å¦‚æœæ­£æ•°ç”¨åŸç ï¼Œè´Ÿæ•°ç”¨è¡¥ç &lt;/h3&gt;\n&lt;p&gt;äº‹ä¾‹1&lt;/p&gt;\n&lt;p&gt;&lt;code&gt;2&lt;/code&gt;åŸç :&lt;code&gt;0000 0010&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;&lt;code&gt;-1&lt;/code&gt;è¡¥ç : &lt;code&gt;1111 1111&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;ç›¸åŠ  =&lt;code&gt;0000 0001&lt;/code&gt; ï¼Œå°±ç­‰äº1&lt;/p&gt;\n&lt;p&gt;äº‹ä¾‹2&lt;/p&gt;\n&lt;p&gt;&lt;code&gt;10&lt;/code&gt;åŸç :&lt;code&gt;0000 1010&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;&lt;code&gt;-20&lt;/code&gt;è¡¥ç : &lt;code&gt;1110 1100&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;&lt;code&gt;10 + (-20)&lt;/code&gt; =  &lt;code&gt;1111 0110&lt;/code&gt; ç­‰äº-10&lt;/p&gt;\n&lt;h3 id=\&#34;ä¸ºä»€ä¹ˆè¦ç”¨è¡¥ç è¡¨ç¤ºè´Ÿæ•°è€Œä¸æ˜¯åç \&#34;&gt;ä¸ºä»€ä¹ˆè¦ç”¨è¡¥ç è¡¨ç¤ºè´Ÿæ•°ï¼Œè€Œä¸æ˜¯åç &lt;/h3&gt;\n&lt;p&gt;æˆ–è€…æ¢ä¸ªè¯´æ³•ï¼Œä¸ºä»€ä¹ˆè¦è¿›è¡Œ+1æ“ä½œ&lt;/p&gt;\n&lt;p&gt;å¦‚æœä¸ç”¨è¡¥ç ,è€Œç”¨åç &lt;/p&gt;\n&lt;p&gt;1çš„åŸç : &lt;code&gt;0000 0001&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;-1çš„åç :&lt;code&gt;1111 1110&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;1 + (-1) = &lt;code&gt;1111 1111&lt;/code&gt; = -128&lt;/p&gt;\n&lt;p&gt;å¾ˆæ˜æ˜¾ç­”æ¡ˆé”™è¯¯&lt;/p&gt;\n&lt;p&gt;é‚£ä¹ˆä¸ºä»€ä¹ˆè¦è¿›è¡Œ+1æ“ä½œï¼Œå¦‚æœä½ å¯¹&lt;code&gt;1111 11111&lt;/code&gt; +1å¯ä»¥å‘ç° = &lt;code&gt;0001 0000 0000&lt;/code&gt;ï¼Œè€Œå› ä¸ºbyteçš„å¤§å°åªæœ‰8ä½ï¼Œç¬¬9ä½è¦èˆå¼ƒä¹Ÿå°±æ˜¯&lt;code&gt;0000 0000&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;å› ä¸ºè´Ÿæ•°æœ€é«˜ä½å­˜åœ¨ä¸€ä¸ª1ï¼Œä¹Ÿå°±æ˜¯è¯´è´Ÿæ•°å¤©ç„¶è¦æ¯”æ­£æ•°å¤šä¸€ä¸ª1ï¼Œå¯¹äºæ­£æ•°è€Œè¨€ï¼Œä½ å°±å¾—é¢å¤–+1æ‰èƒ½ä¿è¯æ­£æ•°å’Œè´Ÿæ•°æ˜¯ä¸€æ ·å¤§çš„ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;å…³äºbyteå–å€¼èŒƒå›´\&#34;&gt;å…³äºbyteå–å€¼èŒƒå›´&lt;/h2&gt;\n&lt;p&gt;byteçš„å–å€¼èŒƒå›´ä¸º&lt;code&gt;-128 ~ 127&lt;/code&gt;&lt;/p&gt;\n&lt;p&gt;ä¸ºä»€ä¹ˆè´Ÿå€¼è¦å¤§äºæ­£å€¼ï¼Ÿ&lt;/p&gt;\n&lt;p&gt;å¯¹äºæœ€å¤§å€¼å¾ˆå®¹æ˜“å¾—å‡ºï¼š&lt;code&gt;0111 1111&lt;/code&gt; å°±ç­‰äº127&lt;/p&gt;\n&lt;p&gt;ä½†æ˜¯è´Ÿæ•°ä¸åŒï¼Œåœ¨&lt;code&gt;1000 0000&lt;/code&gt;è¿™ä¸ªç‰¹æ®Šæƒ…å†µä¸‹ç¬¦å·ä½æ˜¯å‚ä¸è¿ç®—çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ&lt;code&gt;1000 0000&lt;/code&gt; æ˜¯æœ€å°å€¼ï¼Œè½¬åŒ–æˆåè¿›åˆ¶å°±æ˜¯-128äº†&lt;/p&gt;\n&lt;h2 id=\&#34;javaä»£ç æµ‹è¯•\&#34;&gt;Javaä»£ç æµ‹è¯•&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;public static void main(String[] args) {\n        byte x1 = (byte)0b00000010;\n        byte x2 = (byte)0b11111111;\n\n        System.out.println(&amp;quot;x1 = &amp;quot; + x1);\n        System.out.println(&amp;quot;x2 = &amp;quot; + x2);\n        System.out.println(&amp;quot;x1 + x2 = &amp;quot; +  (x1 + x2));\n\n        byte x3 = (byte)0b11111110;\n        System.out.println(&amp;quot;x3 = &amp;quot; + x3);\n\n        byte negative20 = (byte)0b11101100;\n        System.out.println(&amp;quot;negative20 : &amp;quot; + negative20);\n\n        byte negative10 = (byte)0b11110110;\n        System.out.println(&amp;quot;negative10:&amp;quot;+negative10);\n\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;g8YKXeC-j&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;Javaä¸­äºŒè¿›åˆ¶çš„è¡¥ç ï¼Œåç ï¼Œæ­£è´Ÿæ•°&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Java&#34;,&#34;slug&#34;:&#34;6j9B3b2nb&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/6j9B3b2nb/&#34;}],&#34;date&#34;:&#34;2020-08-08 21:00:26&#34;,&#34;dateFormat&#34;:&#34;2020-08-08 09:00:26&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/g8YKXeC-j/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;3 min read&#34;,&#34;time&#34;:163000,&#34;words&#34;:659,&#34;minutes&#34;:3},&#34;description&#34;:&#34;Javaè´Ÿæ•°çš„è®¡ç®—è¿‡ç¨‹\njavaä¸­æœ€é«˜ä½è¡¨ç¤ºç¬¦å·ä½,0è¡¨ç¤ºæ­£æ•°ï¼Œ1è¡¨ç¤ºè´Ÿæ•°\næ ¹æ®åè¿›åˆ¶æ¨ç®—äºŒè¿›åˆ¶\nä»¥-5ä¸ºä¾‹å­\n\n-5çš„åŸç ï¼š1000 0101\næ±‚åç  : 1111 1010 ï¼Œç¬¦å·ä½ä¸è¿›è¡Œå–å\næ±‚è¡¥ç ï¼ˆ+1ï¼‰ï¼š1111 1011\n\næ‰€ä»¥...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#java%E8%B4%9F%E6%95%B0%E7%9A%84%E8%AE%A1%E7%AE%97%E8%BF%87%E7%A8%8B\&#34;&gt;Javaè´Ÿæ•°çš„è®¡ç®—è¿‡ç¨‹&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A0%B9%E6%8D%AE%E5%8D%81%E8%BF%9B%E5%88%B6%E6%8E%A8%E7%AE%97%E4%BA%8C%E8%BF%9B%E5%88%B6\&#34;&gt;æ ¹æ®åè¿›åˆ¶æ¨ç®—äºŒè¿›åˆ¶&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A0%B9%E6%8D%AE%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%80%86%E6%8E%A8%E5%8D%81%E8%BF%9B%E5%88%B6\&#34;&gt;æ ¹æ®äºŒè¿›åˆ¶é€†æ¨åè¿›åˆ¶&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%BF%99%E6%A0%B7%E8%AE%BE%E8%AE%A1\&#34;&gt;ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%A6%82%E6%9E%9C%E9%83%BD%E7%94%A8%E5%8E%9F%E7%A0%81\&#34;&gt;å¦‚æœéƒ½ç”¨åŸç &lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%A6%82%E6%9E%9C%E6%AD%A3%E6%95%B0%E7%94%A8%E5%8E%9F%E7%A0%81%E8%B4%9F%E6%95%B0%E7%94%A8%E8%A1%A5%E7%A0%81\&#34;&gt;å¦‚æœæ­£æ•°ç”¨åŸç ï¼Œè´Ÿæ•°ç”¨è¡¥ç &lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8%E8%A1%A5%E7%A0%81%E8%A1%A8%E7%A4%BA%E8%B4%9F%E6%95%B0%E8%80%8C%E4%B8%8D%E6%98%AF%E5%8F%8D%E7%A0%81\&#34;&gt;ä¸ºä»€ä¹ˆè¦ç”¨è¡¥ç è¡¨ç¤ºè´Ÿæ•°ï¼Œè€Œä¸æ˜¯åç &lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%B3%E4%BA%8Ebyte%E5%8F%96%E5%80%BC%E8%8C%83%E5%9B%B4\&#34;&gt;å…³äºbyteå–å€¼èŒƒå›´&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#java%E4%BB%A3%E7%A0%81%E6%B5%8B%E8%AF%95\&#34;&gt;Javaä»£ç æµ‹è¯•&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;1-åœ¨-docker-hub-ä¸‹æŸ¥çœ‹-neo4j-é•œåƒ\&#34;&gt;1. åœ¨ docker hub ä¸‹æŸ¥çœ‹ neo4j é•œåƒ&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-shell\&#34;&gt;docker search neo4j\n&lt;/code&gt;&lt;/pre&gt;\n&lt;!-- more --&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/15/170480cf6017aa71~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;image-20200215164627841\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h2 id=\&#34;2-æ‹‰å–-neo4j-é•œåƒ\&#34;&gt;2. æ‹‰å– neo4j é•œåƒ&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-shell\&#34;&gt;docker pull neo4j\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;æ‹‰å–å®Œæˆåè¾“å…¥å‘½ä»¤å¯ä»¥çœ‹åˆ°é•œåƒå·²ç»å­˜åœ¨&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-shell\&#34;&gt;docker images\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/15/170480cf6284ad96~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;image-20200215164707134\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h2 id=\&#34;3-å¯åŠ¨-neo4j-é•œåƒ\&#34;&gt;3. å¯åŠ¨ neo4j é•œåƒ&lt;/h2&gt;\n&lt;p&gt;æ‰§è¡Œå‘½ä»¤&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-docker\&#34;&gt;docker run \\\n    --publish=7474:7474 --publish=7687:7687 \\\n    --volume=$HOME/neo4j/data:/data \\\n    --rm -d neo4j\n&lt;/code&gt;&lt;/pre&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;3\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/15/170480f43959d204~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;image-20200215164756361\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;â€‹\t&lt;em&gt;å‚æ•°è¯´æ˜ï¼š&lt;/em&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;p&gt;&lt;strong&gt;publish&lt;/strong&gt;: é…ç½®æœ¬æœºä¸å®¹å™¨ä¹‹é—´çš„æ˜ å°„ç«¯å£,&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;&lt;strong&gt;volume&lt;/strong&gt;:é…ç½®å…±äº«çš„å®—å·ï¼Œç”¨äºæ•°æ®æŒä¹…åŒ–&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;4-å¯åŠ¨-neo4j-è‡ªå¸¦çš„å‰ç«¯é¡µé¢\&#34;&gt;4. å¯åŠ¨ neo4j è‡ªå¸¦çš„å‰ç«¯é¡µé¢&lt;/h2&gt;\n&lt;p&gt;åœ¨æµè§ˆå™¨ä¸­è¾“å…¥&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-txt\&#34;&gt;http://localhost:7474/browser\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å¯ä»¥çœ‹åˆ°,è¿™é‡Œçš„ç«¯å£æ˜¯7474,æ˜¯æˆ‘ä»¬ run å‘½ä»¤é‡Œé¢è®¾ç½®çš„.è¿˜æœ‰ä¸€ä¸ªç«¯å£7687ç”¨æ¥è¿æ¥æ•°æ®åº“&lt;/p&gt;\n&lt;h2 id=\&#34;5-è¿æ¥neo4j\&#34;&gt;5. è¿æ¥neo4j&lt;/h2&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;4\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/2/15/170480cf628a5e65~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;image-20200215165022204\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;è´¦å·å¯†ç é»˜è®¤éƒ½æ˜¯ neo4j&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;è‡³æ­¤å°±è¿æ¥ä¸Šäº†neo4j&lt;/strong&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;docker_1&#34;,&#34;abstract&#34;:&#34;&lt;h2 id=\&#34;1-åœ¨-docker-hub-ä¸‹æŸ¥çœ‹-neo4j-é•œåƒ\&#34;&gt;1. åœ¨ docker hub ä¸‹æŸ¥çœ‹ neo4j é•œåƒ&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-shell\&#34;&gt;docker search neo4j\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;title&#34;:&#34;Docker ä¸­æ­å»º Neo4j å›¾æ•°æ®åº“ &#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;docker&#34;,&#34;slug&#34;:&#34;docker&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/docker/&#34;},{&#34;name&#34;:&#34;å›¾æ•°æ®åº“&#34;,&#34;slug&#34;:&#34;tu-shu-ju-ku&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/tu-shu-ju-ku/&#34;}],&#34;date&#34;:&#34;2020-02-15 16:43:43&#34;,&#34;dateFormat&#34;:&#34;2020-02-15 04:43:43&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/docker_1/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:44000,&#34;words&#34;:182,&#34;minutes&#34;:1},&#34;description&#34;:&#34;1. åœ¨ docker hub ä¸‹æŸ¥çœ‹ neo4j é•œåƒ\ndocker search neo4j\n\n\n\n2. æ‹‰å– neo4j é•œåƒ\ndocker pull neo4j\n\næ‹‰å–å®Œæˆåè¾“å…¥å‘½ä»¤å¯ä»¥çœ‹åˆ°é•œåƒå·²ç»å­˜åœ¨\ndocker images\n...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E5%9C%A8-docker-hub-%E4%B8%8B%E6%9F%A5%E7%9C%8B-neo4j-%E9%95%9C%E5%83%8F\&#34;&gt;1. åœ¨ docker hub ä¸‹æŸ¥çœ‹ neo4j é•œåƒ&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E6%8B%89%E5%8F%96-neo4j-%E9%95%9C%E5%83%8F\&#34;&gt;2. æ‹‰å– neo4j é•œåƒ&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E5%90%AF%E5%8A%A8-neo4j-%E9%95%9C%E5%83%8F\&#34;&gt;3. å¯åŠ¨ neo4j é•œåƒ&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4-%E5%90%AF%E5%8A%A8-neo4j-%E8%87%AA%E5%B8%A6%E7%9A%84%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2\&#34;&gt;4. å¯åŠ¨ neo4j è‡ªå¸¦çš„å‰ç«¯é¡µé¢&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#5-%E8%BF%9E%E6%8E%A5neo4j\&#34;&gt;5. è¿æ¥neo4j&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;åœ¨åˆšå¼€å§‹å­¦ä¹ gitçš„æ—¶å€™ï¼Œæˆ‘å¾ˆç–‘æƒ‘gitå¯ä»¥åŒæ—¶ç®¡ç†è¿™ä¹ˆå¤šåˆ†æ”¯ï¼Œè€Œä¸”åˆ‡æ¢åˆ†æ”¯éƒ½æ˜¯ç¬é—´å®Œæˆã€‚å°½ç®¡Gitå®˜æ–¹æ¨èæˆ‘ä»¬å¤šä½¿ç”¨åˆ†æ”¯å»å¼€å‘ï¼Œä½†æ˜¯å¤©çœŸçš„æˆ‘å¾ˆæ‹…å¿ƒåˆ†æ”¯å¤ªå¤šï¼Œå¯¼è‡´æ–‡ä»¶æ•°é‡ä¼šå‰§å¢ï¼Œæ‰€ä»¥ä¸€ç›´ä¸æ•¢ä½¿ç”¨å¤ªå¤šåˆ†æ”¯ã€‚&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;p&gt;ç›´åˆ°æœ‰ä¸€å¤©æƒ³è¦å»æ­å¼€å¿ƒä¸­çš„ç–‘æƒ‘ï¼Œgitæ˜¯æ€ä¹ˆæ ·ç®¡ç†è¿™äº›ä¸åŒåˆ†æ”¯çš„ï¼Œæœ€åå‘ç°å’Œgité‡Œé¢çš„3ä¸ªå¯¹è±¡æœ‰å…³ï¼Œææ‡‚3ä¸ªå¯¹è±¡çš„å…³ç³»ï¼Œç›¸ä¿¡åœ¨ä»¥åä½¿ç”¨gitå‘½ä»¤çš„æ—¶å€™ï¼Œå¤´è„‘é‡Œä¼šè‡ªç„¶è€Œç„¶çš„æµ®ç°è¿™äº›å¯¹è±¡çš„å…³ç³»ç½‘å›¾&lt;/p&gt;\n&lt;p&gt;åœ¨å‘½ä»¤è¡Œä¸­ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;git cat-file -p &amp;lt;object id&amp;gt;&lt;/code&gt;å»æŸ¥çœ‹æ¯ä¸ªå¯¹è±¡é‡Œé¢çš„å†…å®¹&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;p&gt;Commitå¯¹è±¡&lt;/p&gt;\n&lt;p&gt;ç”±3éƒ¨åˆ†ç»„æˆï¼Œparentå­˜å‚¨çˆ¶commitå¯¹è±¡çš„IDï¼Œæ¯ä¸€ä¸ªcommitå¯¹è±¡éƒ½ä¸€ä¸ªIDï¼Œä½¿ç”¨&lt;code&gt;git log&lt;/code&gt;å¯ä»¥æŸ¥çœ‹ã€‚Treeéƒ¨åˆ†å­˜å‚¨ä¸€ä¸ªTreeå¯¹è±¡çš„IDï¼Œä¸‹é¢éƒ¨åˆ†å­˜å‚¨çš„å°±æ˜¯&lt;code&gt;git commit -m &amp;quot;xxx&amp;quot;&lt;/code&gt;é‡Œé¢çš„æ³¨é‡Šå†…å®¹äº†ã€‚&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h6 id=\&#34;img-srchttpsp1-jjbyteimgcomtos-cn-i-t2oaga2asxgold-user-assets202011216f9a15b6f68a02e~tplv-t2oaga2asx-imageimage-altimage-20200112200749581-stylezoom50\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/12/16f9a15b6f68a02e~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;image-20200112200749581\&#34; style=\&#34;zoom:50%;\&#34; /&gt;&lt;/h6&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;p&gt;&lt;mark&gt;Tree å¯¹è±¡&lt;/mark&gt;&lt;/p&gt;\n&lt;p&gt;å¯ä»¥æŠŠTreeå¯¹è±¡ç†è§£ä¸ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ¯ä¸€ä¸ªcommitå¯¹è±¡å¯¹åº”ä¸€ä¸ªTreeï¼Œå¯ä»¥æŠŠè¿™ä¸ªTreeå½“ä½œæ ¹ç›®å½•ã€‚è¿™ä¸ªTreeé‡Œé¢å­˜å‚¨äº†æ ¹ç›®å½•ä¸‹çš„å­Treeçš„IDï¼Œä»¥åŠBlobIdã€‚&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;&lt;mark&gt;Blob å¯¹è±¡&lt;/mark&gt;&lt;/p&gt;\n&lt;p&gt;ä¸€ä¸ªTreeå¯¹åº”ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ŒBlobå¯¹åº”çš„æ˜¯æ–‡ä»¶ï¼ŒBlogé‡Œé¢å­˜å‚¨çš„ä¹ŸçœŸçš„æ˜¯æ–‡ä»¶çš„å†…å®¹ã€‚&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h4 id=\&#34;ä¸¾ä¸ª\&#34;&gt;ä¸¾ä¸ªğŸŒ°&lt;/h4&gt;\n&lt;h6 id=\&#34;img-srchttpsp1-jjbyteimgcomtos-cn-i-t2oaga2asxgold-user-assets202011216f9a15b7661d997~tplv-t2oaga2asx-imageimage-altimage-20200112202046245-stylezoom50\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/12/16f9a15b7661d997~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;image-20200112202046245\&#34; style=\&#34;zoom:50%;\&#34; /&gt;&lt;/h6&gt;\n&lt;p&gt;gitçš„æ ¹ç›®å½•æ˜¯Javaï¼ŒJavaæ–‡ä»¶å¤¹é‡Œæœ‰ä¸€ä¸ªtest.classæ–‡ä»¶å’Œä¸€ä¸ªJDKæ–‡ä»¶å¤¹ï¼ŒJDKæ–‡ä»¶å¤¹ä¸‹é¢è¿˜æœ‰ä¸€ä¸ªjava8.classæ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç¬¬ä¸€æ¬¡&lt;code&gt;git commit&lt;/code&gt;åçš„å…³ç³»å›¾å°±æ˜¯è¿™æ ·&lt;/p&gt;\n&lt;h6 id=\&#34;img-srchttpsp1-jjbyteimgcomtos-cn-i-t2oaga2asxgold-user-assets202011216f9a15b78581bba~tplv-t2oaga2asx-imageimage-altimage-20200112202700139-stylezoom-25\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/12/16f9a15b78581bba~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;image-20200112202700139\&#34; style=\&#34;zoom: 25%;\&#34; /&gt;&lt;/h6&gt;\n&lt;p&gt;æ­¤æ—¶æˆ‘ä»¬ä¿®æ”¹äº†test.classæ–‡ä»¶çš„å†…å®¹åï¼Œé‡æ–°&lt;code&gt;git add test.class&lt;/code&gt;å†&lt;code&gt;git commit -m&#39;update&#39;&lt;/code&gt;ï¼Œè¿™æ—¶å€™å°±ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„commitå¯¹è±¡ï¼Œç»“æ„å°±åƒè¿™æ ·:&lt;/p&gt;\n&lt;h6 id=\&#34;img-srchttpsp1-jjbyteimgcomtos-cn-i-t2oaga2asxgold-user-assets202011216f9a15b7b5e4a69~tplv-t2oaga2asx-imageimage-altimage-20200112203735217-stylezoom25\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/12/16f9a15b7b5e4a69~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;image-20200112203735217\&#34; style=\&#34;zoom:25%;\&#34; /&gt;&lt;/h6&gt;\n&lt;p&gt;å‘ç°åªæ˜¯ä¿å­˜äº†ä¸€ä¸ªæ–°çš„test.classçš„å¿«ç…§ï¼Œjava8.classæ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œå°±æ²¡æœ‰ç”Ÿæˆç”Ÿæˆæ–°çš„å¿«ç…§ã€‚è¿™æ ·çœ‹æ¥ï¼ŒçœŸçš„æ˜¯å¾ˆèŠ‚çœç£ç›˜äº†ã€‚&lt;/p&gt;\n&lt;p&gt;gitè¿˜æœ‰è®¸è®¸å¤šå¤šçš„ä½¿ç”¨åœºæ™¯ï¼Œå¦‚æœä½ èƒ½ç†è§£ä»¥ä¸Šçš„å…³ç³»ï¼Œé‚£ä¹ˆå…¶ä»–çš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸å¦¨è‡ªå·±å»å‘½ä»¤è¡Œ &lt;code&gt;git cat-file -p &amp;lt;object id&amp;gt;&lt;/code&gt; éªŒè¯éªŒè¯å§ï½&lt;/p&gt;\n&lt;h3 id=\&#34;img-srchttpsp1-jjbyteimgcomtos-cn-i-t2oaga2asxgold-user-assets202011216f9a15b80651833~tplv-t2oaga2asx-imageimage-altç›®å½•-stylezoom65-æ¨èé˜…è¯»\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/12/16f9a15b80651833~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;ç›®å½•\&#34; style=\&#34;zoom:65%;\&#34; /&gt;æ¨èé˜…è¯»&lt;/h3&gt;\n&lt;p&gt;&lt;a href=\&#34;https://ruby-china.org/topics/20723\&#34;&gt;ç†è§£gitå¯¹è±¡&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;git_1&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;åœ¨åˆšå¼€å§‹å­¦ä¹ gitçš„æ—¶å€™ï¼Œæˆ‘å¾ˆç–‘æƒ‘gitå¯ä»¥åŒæ—¶ç®¡ç†è¿™ä¹ˆå¤šåˆ†æ”¯ï¼Œè€Œä¸”åˆ‡æ¢åˆ†æ”¯éƒ½æ˜¯ç¬é—´å®Œæˆã€‚å°½ç®¡Gitå®˜æ–¹æ¨èæˆ‘ä»¬å¤šä½¿ç”¨åˆ†æ”¯å»å¼€å‘ï¼Œä½†æ˜¯å¤©çœŸçš„æˆ‘å¾ˆæ‹…å¿ƒåˆ†æ”¯å¤ªå¤šï¼Œå¯¼è‡´æ–‡ä»¶æ•°é‡ä¼šå‰§å¢ï¼Œæ‰€ä»¥ä¸€ç›´ä¸æ•¢ä½¿ç”¨å¤ªå¤šåˆ†æ”¯ã€‚&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;Git ä¸­æŒ‡é’ˆä¸æ ‘çš„å®ç°&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Git&#34;,&#34;slug&#34;:&#34;THZXOECNJ&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/THZXOECNJ/&#34;}],&#34;date&#34;:&#34;2019-07-05 20:38:30&#34;,&#34;dateFormat&#34;:&#34;2019-07-05 08:38:30&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/git_1/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;3 min read&#34;,&#34;time&#34;:127000,&#34;words&#34;:575,&#34;minutes&#34;:3},&#34;description&#34;:&#34;åœ¨åˆšå¼€å§‹å­¦ä¹ gitçš„æ—¶å€™ï¼Œæˆ‘å¾ˆç–‘æƒ‘gitå¯ä»¥åŒæ—¶ç®¡ç†è¿™ä¹ˆå¤šåˆ†æ”¯ï¼Œè€Œä¸”åˆ‡æ¢åˆ†æ”¯éƒ½æ˜¯ç¬é—´å®Œæˆã€‚å°½ç®¡Gitå®˜æ–¹æ¨èæˆ‘ä»¬å¤šä½¿ç”¨åˆ†æ”¯å»å¼€å‘ï¼Œä½†æ˜¯å¤©çœŸçš„æˆ‘å¾ˆæ‹…å¿ƒåˆ†æ”¯å¤ªå¤šï¼Œå¯¼è‡´æ–‡ä»¶æ•°é‡ä¼šå‰§å¢ï¼Œæ‰€ä»¥ä¸€ç›´ä¸æ•¢ä½¿ç”¨å¤ªå¤šåˆ†æ”¯ã€‚\n\nç›´åˆ°æœ‰ä¸€å¤©æƒ³è¦å»æ­å¼€å¿ƒä¸­çš„ç–‘æƒ‘ï¼Œ...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#img-srchttpsp1-jjbyteimgcomtos-cn-i-t2oaga2asxgold-user-assets202011216f9a15b6f68a02e~tplv-t2oaga2asx-imageimage-altimage-20200112200749581-stylezoom50\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/12/16f9a15b6f68a02e~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;image-20200112200749581\&#34; style=\&#34;zoom:50%;\&#34; /&gt;&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%B8%BE%E4%B8%AA\&#34;&gt;ä¸¾ä¸ªğŸŒ°&lt;/a&gt;&lt;br&gt;\n*\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#img-srchttpsp1-jjbyteimgcomtos-cn-i-t2oaga2asxgold-user-assets202011216f9a15b7661d997~tplv-t2oaga2asx-imageimage-altimage-20200112202046245-stylezoom50\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/12/16f9a15b7661d997~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;image-20200112202046245\&#34; style=\&#34;zoom:50%;\&#34; /&gt;&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#img-srchttpsp1-jjbyteimgcomtos-cn-i-t2oaga2asxgold-user-assets202011216f9a15b78581bba~tplv-t2oaga2asx-imageimage-altimage-20200112202700139-stylezoom-25\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/12/16f9a15b78581bba~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;image-20200112202700139\&#34; style=\&#34;zoom: 25%;\&#34; /&gt;&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#img-srchttpsp1-jjbyteimgcomtos-cn-i-t2oaga2asxgold-user-assets202011216f9a15b7b5e4a69~tplv-t2oaga2asx-imageimage-altimage-20200112203735217-stylezoom25\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/12/16f9a15b7b5e4a69~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;image-20200112203735217\&#34; style=\&#34;zoom:25%;\&#34; /&gt;&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#img-srchttpsp1-jjbyteimgcomtos-cn-i-t2oaga2asxgold-user-assets202011216f9a15b80651833~tplv-t2oaga2asx-imageimage-alt%E7%9B%AE%E5%BD%95-stylezoom65-%E6%8E%A8%E8%8D%90%E9%98%85%E8%AF%BB\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/12/16f9a15b80651833~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;ç›®å½•\&#34; style=\&#34;zoom:65%;\&#34; /&gt;æ¨èé˜…è¯»&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;ä»Šå¤©çœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œè§‰å¾—ä¸é”™ã€‚&lt;br&gt;\nåŸæ–‡é“¾æ¥ï¼šhttps://medium.com/@adamhooper/in-mysql-never-use-utf8-use-utf8mb4-11761243e434&lt;br&gt;\nè¯‘æ–‡ï¼šhttps://www.jianshu.com/p/ab9aa8d4df7d&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;\&#34;&gt;&lt;/h1&gt;\n&lt;p&gt;æœ€è¿‘æˆ‘é‡åˆ°äº†ä¸€ä¸ªbugï¼Œæˆ‘è¯•ç€é€šè¿‡Railsåœ¨ä»¥â€œutf8â€ç¼–ç çš„MariaDBä¸­ä¿å­˜ä¸€ä¸ªUTF-8å­—ç¬¦ä¸²ï¼Œç„¶åå‡ºç°äº†ä¸€ä¸ªç¦»å¥‡çš„é”™è¯¯ï¼š&lt;/p&gt;\n&lt;p&gt;Incorrect string value:â€˜Ã°ÂŸÂ˜Âƒ&amp;lt;â€¦â€™for column â€˜summaryâ€™ at row 1&lt;br&gt;\næˆ‘ç”¨çš„æ˜¯UTF-8ç¼–ç çš„å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨ä¹Ÿæ˜¯UTF-8ç¼–ç çš„ï¼Œæ•°æ®åº“ä¹Ÿæ˜¯ï¼Œå°±è¿è¦ä¿å­˜çš„è¿™ä¸ªå­—ç¬¦ä¸²â€œ???? &amp;lt;â€¦â€ä¹Ÿæ˜¯åˆæ³•çš„UTF-8ã€‚&lt;/p&gt;\n&lt;p&gt;é—®é¢˜çš„ç—‡ç»“åœ¨äºï¼ŒMySQLçš„â€œutf8â€å®é™…ä¸Šä¸æ˜¯çœŸæ­£çš„UTF-8ã€‚&lt;/p&gt;\n&lt;p&gt;â€œutf8â€åªæ”¯æŒæ¯ä¸ªå­—ç¬¦æœ€å¤šä¸‰ä¸ªå­—èŠ‚ï¼Œè€ŒçœŸæ­£çš„UTF-8æ˜¯æ¯ä¸ªå­—ç¬¦æœ€å¤šå››ä¸ªå­—èŠ‚ã€‚&lt;/p&gt;\n&lt;p&gt;MySQLä¸€ç›´æ²¡æœ‰ä¿®å¤è¿™ä¸ªbugï¼Œä»–ä»¬åœ¨2010å¹´å‘å¸ƒäº†ä¸€ä¸ªå«ä½œâ€œutf8mb4â€çš„å­—ç¬¦é›†ï¼Œç»•è¿‡äº†è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;\n&lt;p&gt;å½“ç„¶ï¼Œä»–ä»¬å¹¶æ²¡æœ‰å¯¹æ–°çš„å­—ç¬¦é›†å¹¿è€Œå‘Šä¹‹ï¼ˆå¯èƒ½æ˜¯å› ä¸ºè¿™ä¸ªbugè®©ä»–ä»¬è§‰å¾—å¾ˆå°´å°¬ï¼‰ï¼Œä»¥è‡´äºç°åœ¨ç½‘ç»œä¸Šä»ç„¶åœ¨å»ºè®®å¼€å‘è€…ä½¿ç”¨â€œutf8â€ï¼Œä½†è¿™äº›å»ºè®®éƒ½æ˜¯é”™è¯¯çš„ã€‚&lt;/p&gt;\n&lt;p&gt;ç®€å•æ¦‚æ‹¬å¦‚ä¸‹ï¼š&lt;/p&gt;\n&lt;p&gt;1.MySQLçš„â€œutf8mb4â€æ˜¯çœŸæ­£çš„â€œUTF-8â€ã€‚&lt;/p&gt;\n&lt;p&gt;2.MySQLçš„â€œutf8â€æ˜¯ä¸€ç§â€œä¸“å±çš„ç¼–ç â€ï¼Œå®ƒèƒ½å¤Ÿç¼–ç çš„Unicodeå­—ç¬¦å¹¶ä¸å¤šã€‚&lt;/p&gt;\n&lt;p&gt;æˆ‘è¦åœ¨è¿™é‡Œæ¾„æ¸…ä¸€ä¸‹ï¼šæ‰€æœ‰åœ¨ä½¿ç”¨â€œutf8â€çš„MySQLå’ŒMariaDBç”¨æˆ·éƒ½åº”è¯¥æ”¹ç”¨â€œutf8mb4â€ï¼Œæ°¸è¿œéƒ½ä¸è¦å†ä½¿ç”¨â€œutf8â€ã€‚&lt;/p&gt;\n&lt;p&gt;é‚£ä¹ˆä»€ä¹ˆæ˜¯ç¼–ç ï¼Ÿä»€ä¹ˆæ˜¯UTF-8ï¼Ÿ&lt;/p&gt;\n&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œè®¡ç®—æœºä½¿ç”¨0å’Œ1æ¥å­˜å‚¨æ–‡æœ¬ã€‚æ¯”å¦‚å­—ç¬¦â€œCâ€è¢«å­˜æˆâ€œ01000011â€ï¼Œé‚£ä¹ˆè®¡ç®—æœºåœ¨æ˜¾ç¤ºè¿™ä¸ªå­—ç¬¦æ—¶éœ€è¦ç»è¿‡ä¸¤ä¸ªæ­¥éª¤ï¼š&lt;/p&gt;\n&lt;p&gt;1ã€è®¡ç®—æœºè¯»å–â€œ01000011â€ï¼Œå¾—åˆ°æ•°å­—67ï¼Œå› ä¸º67è¢«ç¼–ç æˆâ€œ01000011â€ã€‚&lt;/p&gt;\n&lt;p&gt;2ã€è®¡ç®—æœºåœ¨Unicodeå­—ç¬¦é›†ä¸­æŸ¥æ‰¾67ï¼Œæ‰¾åˆ°äº†â€œCâ€ã€‚&lt;/p&gt;\n&lt;p&gt;åŒæ ·çš„ï¼š&lt;/p&gt;\n&lt;p&gt;1ã€æˆ‘çš„ç”µè„‘å°†â€œCâ€æ˜ å°„æˆUnicodeå­—ç¬¦é›†ä¸­çš„67ã€‚&lt;/p&gt;\n&lt;p&gt;2ã€æˆ‘çš„ç”µè„‘å°†67ç¼–ç æˆâ€œ01000011â€ï¼Œå¹¶å‘é€ç»™WebæœåŠ¡å™¨ã€‚&lt;/p&gt;\n&lt;p&gt;å‡ ä¹æ‰€æœ‰çš„ç½‘ç»œåº”ç”¨éƒ½ä½¿ç”¨äº†Unicodeå­—ç¬¦é›†ï¼Œå› ä¸ºæ²¡æœ‰ç†ç”±ä½¿ç”¨å…¶ä»–å­—ç¬¦é›†ã€‚&lt;/p&gt;\n&lt;p&gt;Unicodeå­—ç¬¦é›†åŒ…å«äº†ä¸Šç™¾ä¸‡ä¸ªå­—ç¬¦ã€‚æœ€ç®€å•çš„ç¼–ç æ˜¯UTF-32ï¼Œæ¯ä¸ªå­—ç¬¦ä½¿ç”¨32ä½ã€‚è¿™æ ·åšæœ€ç®€å•ï¼Œå› ä¸ºä¸€ç›´ä»¥æ¥ï¼Œè®¡ç®—æœºå°†32ä½è§†ä¸ºæ•°å­—ï¼Œè€Œè®¡ç®—æœºæœ€åœ¨è¡Œçš„å°±æ˜¯å¤„ç†æ•°å­—ã€‚ä½†é—®é¢˜æ˜¯ï¼Œè¿™æ ·å¤ªæµªè´¹ç©ºé—´äº†ã€‚&lt;/p&gt;\n&lt;p&gt;UTF-8å¯ä»¥èŠ‚çœç©ºé—´ï¼Œåœ¨UTF-8ä¸­ï¼Œå­—ç¬¦â€œCâ€åªéœ€è¦8ä½ï¼Œä¸€äº›ä¸å¸¸ç”¨çš„å­—ç¬¦ï¼Œæ¯”å¦‚â€œâ€éœ€è¦32ä½ã€‚å…¶ä»–çš„å­—ç¬¦å¯èƒ½ä½¿ç”¨16ä½æˆ–24ä½ã€‚ä¸€ç¯‡ç±»ä¼¼æœ¬æ–‡è¿™æ ·çš„æ–‡ç« ï¼Œå¦‚æœä½¿ç”¨UTF-8ç¼–ç ï¼Œå ç”¨çš„ç©ºé—´åªæœ‰UTF-32çš„å››åˆ†ä¹‹ä¸€å·¦å³ã€‚&lt;/p&gt;\n&lt;p&gt;MySQLçš„â€œutf8â€å­—ç¬¦é›†ä¸å…¶ä»–ç¨‹åºä¸å…¼å®¹ï¼Œå®ƒæ‰€è°“çš„â€œâ€ï¼Œå¯èƒ½çœŸçš„æ˜¯ä¸€å¨â€¦â€¦&lt;br&gt;\nMySQLç®€å²&lt;/p&gt;\n&lt;p&gt;ä¸ºä»€ä¹ˆMySQLå¼€å‘è€…ä¼šè®©â€œutf8â€å¤±æ•ˆï¼Ÿæˆ‘ä»¬æˆ–è®¸å¯ä»¥ä»æäº¤æ—¥å¿—ä¸­å¯»æ‰¾ç­”æ¡ˆã€‚&lt;br&gt;\nMySQLä»4.1ç‰ˆæœ¬å¼€å§‹æ”¯æŒUTF-8ï¼Œä¹Ÿå°±æ˜¯2003å¹´ï¼Œè€Œä»Šå¤©ä½¿ç”¨çš„UTF-8æ ‡å‡†ï¼ˆRFC3629ï¼‰æ˜¯éšåæ‰å‡ºç°çš„ã€‚&lt;/p&gt;\n&lt;p&gt;æ—§ç‰ˆçš„UTF-8æ ‡å‡†ï¼ˆRFC2279ï¼‰æœ€å¤šæ”¯æŒæ¯ä¸ªå­—ç¬¦6ä¸ªå­—èŠ‚ã€‚2002å¹´3æœˆ28æ—¥ï¼ŒMySQLå¼€å‘è€…åœ¨ç¬¬ä¸€ä¸ªMySQL4.1é¢„è§ˆç‰ˆä¸­ä½¿ç”¨äº†RFC2279ã€‚&lt;/p&gt;\n&lt;p&gt;åŒå¹´9æœˆï¼Œä»–ä»¬å¯¹MySQLæºä»£ç è¿›è¡Œäº†ä¸€æ¬¡è°ƒæ•´ï¼šâ€œUTF8ç°åœ¨æœ€å¤šåªæ”¯æŒ3ä¸ªå­—èŠ‚çš„åºåˆ—â€ã€‚&lt;br&gt;\næ˜¯è°æäº¤äº†è¿™äº›ä»£ç ï¼Ÿä»–ä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿè¿™ä¸ªé—®é¢˜ä¸å¾—è€ŒçŸ¥ã€‚åœ¨è¿ç§»åˆ°Gitåï¼ˆMySQLæœ€å¼€å§‹ä½¿ç”¨çš„æ˜¯BitKeeperï¼‰ï¼ŒMySQLä»£ç åº“ä¸­çš„å¾ˆå¤šæäº¤è€…çš„åå­—éƒ½ä¸¢å¤±äº†ã€‚2003å¹´9æœˆçš„é‚®ä»¶åˆ—è¡¨ä¸­ä¹Ÿæ‰¾ä¸åˆ°å¯ä»¥è§£é‡Šè¿™ä¸€å˜æ›´çš„çº¿ç´¢ã€‚&lt;/p&gt;\n&lt;p&gt;ä¸è¿‡æˆ‘å¯ä»¥è¯•ç€çŒœæµ‹ä¸€ä¸‹ã€‚&lt;/p&gt;\n&lt;p&gt;2002å¹´ï¼ŒMySQLåšå‡ºäº†ä¸€ä¸ªå†³å®šï¼šå¦‚æœç”¨æˆ·å¯ä»¥ä¿è¯æ•°æ®è¡¨çš„æ¯ä¸€è¡Œéƒ½ä½¿ç”¨ç›¸åŒçš„å­—èŠ‚æ•°ï¼Œé‚£ä¹ˆMySQLå°±å¯ä»¥åœ¨æ€§èƒ½æ–¹é¢æ¥ä¸€ä¸ªå¤§æå‡ã€‚ä¸ºæ­¤ï¼Œç”¨æˆ·éœ€è¦å°†æ–‡æœ¬åˆ—å®šä¹‰ä¸ºâ€œCHARâ€ï¼Œæ¯ä¸ªâ€œCHARâ€åˆ—æ€»æ˜¯æ‹¥æœ‰ç›¸åŒæ•°é‡çš„å­—ç¬¦ã€‚å¦‚æœæ’å…¥çš„å­—ç¬¦å°‘äºå®šä¹‰çš„æ•°é‡ï¼ŒMySQLå°±ä¼šåœ¨åé¢å¡«å……ç©ºæ ¼ï¼Œå¦‚æœæ’å…¥çš„å­—ç¬¦è¶…è¿‡äº†å®šä¹‰çš„æ•°é‡ï¼Œåé¢è¶…å‡ºéƒ¨åˆ†ä¼šè¢«æˆªæ–­ã€‚&lt;/p&gt;\n&lt;p&gt;MySQLå¼€å‘è€…åœ¨æœ€å¼€å§‹å°è¯•UTF-8æ—¶ä½¿ç”¨äº†æ¯ä¸ªå­—ç¬¦6ä¸ªå­—èŠ‚ï¼ŒCHAR(1)ä½¿ç”¨6ä¸ªå­—èŠ‚ï¼ŒCHAR(2)ä½¿ç”¨12ä¸ªå­—èŠ‚ï¼Œå¹¶ä»¥æ­¤ç±»æ¨ã€‚&lt;/p&gt;\n&lt;p&gt;åº”è¯¥è¯´ï¼Œä»–ä»¬æœ€åˆçš„è¡Œä¸ºæ‰æ˜¯æ­£ç¡®çš„ï¼Œå¯æƒœè¿™ä¸€ç‰ˆæœ¬ä¸€ç›´æ²¡æœ‰å‘å¸ƒã€‚ä½†æ˜¯æ–‡æ¡£ä¸Šå´è¿™ä¹ˆå†™äº†ï¼Œè€Œä¸”å¹¿ä¸ºæµä¼ ï¼Œæ‰€æœ‰äº†è§£UTF-8çš„äººéƒ½è®¤åŒæ–‡æ¡£é‡Œå†™çš„ä¸œè¥¿ã€‚&lt;/p&gt;\n&lt;p&gt;ä¸è¿‡å¾ˆæ˜¾ç„¶ï¼ŒMySQLå¼€å‘è€…æˆ–å‚å•†æ‹…å¿ƒä¼šæœ‰ç”¨æˆ·åšè¿™ä¸¤ä»¶äº‹ï¼š&lt;/p&gt;\n&lt;p&gt;1ã€ä½¿ç”¨CHARå®šä¹‰åˆ—ï¼ˆåœ¨ç°åœ¨çœ‹æ¥ï¼ŒCHARå·²ç»æ˜¯è€å¤è‘£äº†ï¼Œä½†åœ¨é‚£æ—¶ï¼Œåœ¨MySQLä¸­ä½¿ç”¨CHARä¼šæ›´å¿«ï¼Œä¸è¿‡ä»2005å¹´ä»¥åå°±ä¸æ˜¯è¿™æ ·å­äº†ï¼‰ã€‚&lt;/p&gt;\n&lt;p&gt;2ã€å°†CHARåˆ—çš„ç¼–ç è®¾ç½®ä¸ºâ€œutf8â€ã€‚&lt;/p&gt;\n&lt;p&gt;æˆ‘çš„çŒœæµ‹æ˜¯MySQLå¼€å‘è€…æœ¬æ¥æƒ³å¸®åŠ©é‚£äº›å¸Œæœ›åœ¨ç©ºé—´å’Œé€Ÿåº¦ä¸ŠåŒèµ¢çš„ç”¨æˆ·ï¼Œä½†ä»–ä»¬æç ¸äº†â€œutf8â€ç¼–ç ã€‚&lt;/p&gt;\n&lt;p&gt;æ‰€ä»¥ç»“æœå°±æ˜¯æ²¡æœ‰èµ¢å®¶ã€‚é‚£äº›å¸Œæœ›åœ¨ç©ºé—´å’Œé€Ÿåº¦ä¸ŠåŒèµ¢çš„ç”¨æˆ·ï¼Œå½“ä»–ä»¬åœ¨ä½¿ç”¨â€œutf8â€çš„CHARåˆ—æ—¶ï¼Œå®é™…ä¸Šä½¿ç”¨çš„ç©ºé—´æ¯”é¢„æœŸçš„æ›´å¤§ï¼Œé€Ÿåº¦ä¹Ÿæ¯”é¢„æœŸçš„æ…¢ã€‚è€Œæƒ³è¦æ­£ç¡®æ€§çš„ç”¨æˆ·ï¼Œå½“ä»–ä»¬ä½¿ç”¨â€œutf8â€ç¼–ç æ—¶ï¼Œå´æ— æ³•ä¿å­˜åƒâ€œâ€è¿™æ ·çš„å­—ç¬¦ã€‚&lt;/p&gt;\n&lt;p&gt;åœ¨è¿™ä¸ªä¸åˆæ³•çš„å­—ç¬¦é›†å‘å¸ƒäº†ä¹‹åï¼ŒMySQLå°±æ— æ³•ä¿®å¤å®ƒï¼Œå› ä¸ºè¿™æ ·éœ€è¦è¦æ±‚æ‰€æœ‰ç”¨æˆ·é‡æ–°æ„å»ºä»–ä»¬çš„æ•°æ®åº“ã€‚æœ€ç»ˆï¼ŒMySQLåœ¨2010å¹´é‡æ–°å‘å¸ƒäº†â€œutf8mb4â€æ¥æ”¯æŒçœŸæ­£çš„UTF-8ã€‚&lt;/p&gt;\n&lt;p&gt;ä¸ºä»€ä¹ˆè¿™ä»¶äº‹æƒ…ä¼šè®©äººå¦‚æ­¤æŠ“ç‹‚ï¼Ÿ&lt;/p&gt;\n&lt;p&gt;å› ä¸ºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æ•´æ•´æŠ“ç‹‚äº†ä¸€ä¸ªç¤¼æ‹œã€‚æˆ‘è¢«â€œutf8â€æ„šå¼„äº†ï¼ŒèŠ±äº†å¾ˆå¤šæ—¶é—´æ‰æ‰¾åˆ°è¿™ä¸ªbugã€‚ä½†æˆ‘ä¸€å®šä¸æ˜¯å”¯ä¸€çš„ä¸€ä¸ªï¼Œç½‘ç»œä¸Šå‡ ä¹æ‰€æœ‰çš„æ–‡ç« éƒ½æŠŠâ€œutf8â€å½“æˆæ˜¯çœŸæ­£çš„UTF-8ã€‚&lt;br&gt;\nâ€œutf8â€åªèƒ½ç®—æ˜¯ä¸ªä¸“æœ‰çš„å­—ç¬¦é›†ï¼Œå®ƒç»™æˆ‘ä»¬å¸¦æ¥äº†æ–°é—®é¢˜ï¼Œå´ä¸€ç›´æ²¡æœ‰å¾—åˆ°è§£å†³ã€‚&lt;/p&gt;\n&lt;p&gt;æ€»ç»“&lt;/p&gt;\n&lt;p&gt;å¦‚æœä½ åœ¨ä½¿ç”¨MySQLæˆ–MariaDBï¼Œä¸è¦ç”¨â€œutf8â€ç¼–ç ï¼Œæ”¹ç”¨â€œutf8mb4â€ã€‚è¿™é‡Œï¼ˆhttps://mathiasbynens.be/notes/mysql-utf8mb4#utf8-to-utf8mb4ï¼‰æä¾›äº†ä¸€ä¸ªæŒ‡å—ç”¨äºå°†ç°æœ‰æ•°æ®åº“çš„å­—ç¬¦ç¼–ç ä»â€œutf8â€è½¬æˆâ€œutf8mb4â€ã€‚&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;p&gt;ç¼–å·3722ï¼Œè¾“å…¥ç¼–å·ç›´è¾¾æœ¬æ–‡&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;è¾“å…¥mè·å–æ–‡ç« ç›®å½•&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;ä¸ªäººæ€»ç»“\&#34;&gt;ä¸ªäººæ€»ç»“&lt;/h2&gt;\n&lt;p&gt;å¯¹äºä½œè€…è¯´çš„ä¸è¦å†ä½¿ç”¨utf-8ï¼Œæœ¬äººä¸å®Œå…¨è®¤åŒï¼Œå®Œå…¨å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™æ‰ä½¿ç”¨utf8mb4ï¼ˆæ¯•ç«Ÿutf-8æ›´çœç©ºé—´ï¼‰åƒå¾®ä¿¡å°ç¨‹åºï¼Œç¼–ç çš„å‘å¤§å®¶åº”è¯¥éƒ½è¸©è¿‡ï¼Œå¯æ˜¯é™¤äº†è¿™ä¸ªå¤–ï¼Œä¼¼ä¹ä¹Ÿæ²¡é‡åˆ°è¿‡ä»€ä¹ˆé—®é¢˜ã€‚æ‰€ä»¥äº†è§£è¿™ä¹ˆä¸€ä¸ªé—®é¢˜åï¼Œä»¥åå®Œå…¨å¯ä»¥æŒ‰éœ€è¦æ¥ç¡®å®šä½¿ç”¨ä½•ç§ç¼–ç ã€‚&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;Uh0rKjiE0&#34;,&#34;abstract&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;ä»Šå¤©çœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œè§‰å¾—ä¸é”™ã€‚&lt;br&gt;\nåŸæ–‡é“¾æ¥ï¼šhttps://medium.com/@adamhooper/in-mysql-never-use-utf8-use-utf8mb4-11761243e434&lt;br&gt;\nè¯‘æ–‡ï¼šhttps://www.jianshu.com/p/ab9aa8d4df7d&lt;/p&gt;\n&lt;/blockquote&gt;\n&#34;,&#34;title&#34;:&#34;Mysql UTF-8 ç¼–ç æ³¨æ„äº‹é¡¹&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;çŸ¥è¯†åˆ†äº«&#34;,&#34;slug&#34;:&#34;Yh19JUBym&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/Yh19JUBym/&#34;}],&#34;date&#34;:&#34;2019-06-14 15:50:24&#34;,&#34;dateFormat&#34;:&#34;2019-06-14 03:50:24&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/Uh0rKjiE0/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;7 min read&#34;,&#34;time&#34;:379000,&#34;words&#34;:1731,&#34;minutes&#34;:7},&#34;description&#34;:&#34;\nä»Šå¤©çœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œè§‰å¾—ä¸é”™ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://medium.com/@adamhooper/in-mysql-never-use-utf8-use-utf8mb4-11761243e434\nè¯‘æ–‡ï¼šhttps://www.jian...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93\&#34;&gt;ä¸ªäººæ€»ç»“&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;æœ‰ä¸€æ¬¡æˆ‘çš„é¡¹ç›®ä¸­é‡‡ç”¨äº†å‰åç«¯åˆ†ç¦»çš„æ¨¡å¼ï¼Œå¼•èµ·äº†è·¨åŸŸé—®é¢˜ï¼Œæœ¬æ–‡å°†ä»‹ç»æˆ‘æ‰€é‡‡ç”¨çš„è·¨åŸŸè§£å†³æ–¹æ³•ã€‚&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;é¦–å…ˆè¦äº†è§£äº§ç”Ÿè·¨åŸŸçš„æœ¬è´¨ï¼Œä¹Ÿå°±æ˜¯åŒæºç­–ç•¥çš„é™åˆ¶ï¼Œæºæ˜¯æŒ‡åŸŸåã€ç«¯å£å·ã€åè®®ï¼Œæœ‰ä¸€è€…ä¸ç›¸åŒå°†è¢«æµè§ˆå™¨æ‹’ç»æ¥å—å“åº”ä¿¡æ¯ï¼Œï¼ˆè¯·æ±‚å¯ä»¥å‘é€å‡ºå»ï¼Œä½†æ˜¯æµè§ˆå™¨ä¸æ¥å—å“åº”ï¼‰ã€‚&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h2 id=\&#34;è§£å†³æ–¹æ³•\&#34;&gt;è§£å†³æ–¹æ³•ï¼š&lt;/h2&gt;\n&lt;h3 id=\&#34;1-jsonp\&#34;&gt;1. jsonp&lt;/h3&gt;\n&lt;p&gt;jsonpçš„åŸç†çš„ src=&amp;quot;&amp;quot; å±æ€§ä¸å—åŒæºç­–ç•¥çš„é™åˆ¶ï¼ŒåŠ¨æ€åˆ›å»ºä¸€ä¸ªcallbackå›è°ƒå‡½æ•°ï¼ŒæœåŠ¡å™¨è°ƒç”¨å›è°ƒå‡½æ•°æŠŠæ•°æ®æ”¾è¿›å»ï¼Œå…·ä½“çš„ç»†èŠ‚æ‰“ç®—ä»¥ååšä¸€ä¸ªä¸“é—¨è®²è§£ã€‚&lt;/p&gt;\n&lt;p&gt;è¿™é‡Œç»™ä¸€ä¸ªæ¨¡ç‰ˆ:&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-js\&#34;&gt;            $.ajax({\n             type: &amp;quot;get&amp;quot;,               //jsonpåªèƒ½ä½¿ç”¨get\n             async: false,\n             url: &amp;quot;&amp;quot;\n             dataType: &amp;quot;jsonp&amp;quot;,\n             jsonp: &amp;quot;callback&amp;quot;,        \n             jsonpCallback:&amp;quot;message&amp;quot;,       //æ³¨æ„è¿™é‡Œç»™å›è°ƒå‡½æ•°èµ·çš„åå­—\n                 success: function(json){\n                 \n                }\n            })\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å¦‚æœè¿™é‡Œä½ çš„å›è°ƒå‡½æ•°èµ·åä¸ºmessageï¼Œé‚£ä¹ˆä½ åœ¨åç«¯è¿”å›jsonçš„æ—¶å€™ï¼Œä¹Ÿè¦æ³¨æ„åœ¨æœ€å¤–é¢åŒ…ä¸€å±‚message{}ã€‚&lt;/p&gt;\n&lt;p&gt;è¿™é‡Œjsonpçš„ç¼ºç‚¹ä¹Ÿå¯ä»¥æ˜æ˜¾çš„çœ‹å‡ºï¼Œåªæ”¯æŒgetè¯·æ±‚ï¼ŒåŸå› å°±æ˜¯å› ä¸ºé€šè¿‡src=â€œâ€å‘é€è¯·æ±‚ï¼Œæ‰€ä»¥å¯ä»¥çŸ¥é“æ˜¯urlä¼ å‚ã€‚&lt;/p&gt;\n&lt;p&gt;é‚£ä¹ˆjsonpçš„å¥½å¤„æ˜¯ä»€ä¹ˆå‘¢ï¼Œå…¼å®¹æ€§ï¼Œå‡ ä¹æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒï¼ˆåŒ…æ‹¬ä¸€äº›ç‰ˆæœ¬æ¯”è¾ƒè€çš„ï¼‰ï¼Œä¸éœ€è¦XMLHttpRequestæˆ–ActiveXçš„æ”¯æŒã€‚&lt;/p&gt;\n&lt;h3 id=\&#34;2-cors\&#34;&gt;2. cors&lt;/h3&gt;\n&lt;p&gt;åˆç§°è·¨åŸŸè®¿é—®ï¼Œæµè§ˆå™¨å°†corsè¯·æ±‚åˆ†ä¸ºç®€å•è¯·æ±‚å’Œéç®€å•è¯·æ±‚ï¼Œå› ä¸ºæœ¬æ–‡ä¸»è¦è®²è§£å…·ä½“çš„æ–¹æ³•ï¼Œæ‰€ä»¥å…³äºç»†èŠ‚éƒ¨åˆ†æœ‰å…´è¶£å¯ä»¥å»çœ‹å…¶ä»–åšå®¢æˆ–è€…æˆ‘ä»¥åå†åšä¸€ç¯‡å…·ä½“çš„è®²è§£ï¼ˆå’Œjsonpä¸€èµ·ï¼‰ã€‚åœ¨springbootä¸­ï¼Œå®˜æ–¹å·²ç»æä¾›äº†æ”¯æŒã€‚ç›´æ¥è´´ä»£ç ï¼š&lt;/p&gt;\n&lt;h3 id=\&#34;æ–¹å¼ä¸€å…¨å±€å®šä¹‰\&#34;&gt;æ–¹å¼ä¸€ï¼šå…¨å±€å®šä¹‰&lt;/h3&gt;\n&lt;p&gt;æ³¨æ„@Orderè¿™ä¸ªæ³¨è§£ï¼Œä¸åŠ çš„è¯å¾ˆå¤§å¯èƒ½å¯¼è‡´é…ç½®å¤±æ•ˆ&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;    @Component\n    @Order(Ordered.HIGHEST_PRECEDENCE)\n    public class CorsFilter implements Filter {\n        @Override\n        public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) throws IOException, ServletException {\n            HttpServletResponse response = (HttpServletResponse) res;\n            HttpServletRequest request = (HttpServletRequest) req;\n            response.setHeader(&amp;quot;Access-Control-Allow-Origin&amp;quot;, &amp;quot;*&amp;quot;);\n            response.setHeader(&amp;quot;Access-Control-Allow-Credentials&amp;quot;, &amp;quot;true&amp;quot;);\n            response.setHeader(&amp;quot;Access-Control-Allow-Methods&amp;quot;,\n                    &amp;quot;ACL, CANCELUPLOAD, CHECKIN, CHECKOUT, COPY, DELETE, GET, HEAD, LOCK, MKCALENDAR, MKCOL, MOVE, OPTIONS, POST, PROPFIND, PROPPATCH, PUT, REPORT, SEARCH, UNCHECKOUT, UNLOCK, UPDATE, VERSION-CONTROL&amp;quot;);\n            response.setHeader(&amp;quot;Access-Control-Max-Age&amp;quot;, &amp;quot;3600&amp;quot;);\n            response.setHeader(&amp;quot;Access-Control-Allow-Headers&amp;quot;,\n                    &amp;quot;Origin, X-Requested-With, Content-Type, Accept, x-userId&amp;quot;);\n\n            if (&amp;quot;OPTIONS&amp;quot;.equalsIgnoreCase(request.getMethod())) {\n                response.setStatus(HttpServletResponse.SC_OK);\n            } else {\n                chain.doFilter(req, res);\n            }\n        }\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;æ–¹å¼äºŒå±€éƒ¨å®šä¹‰\&#34;&gt;æ–¹å¼äºŒï¼šå±€éƒ¨å®šä¹‰&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;        @CrossOrigin(origins = &amp;quot;*&amp;quot;,allowCredentials=&amp;quot;true&amp;quot;,allowedHeaders = &amp;quot;&amp;quot;,methods = {})\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ç›´æ¥åœ¨éœ€è¦è·¨åŸŸçš„æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£,ååˆ†æ–¹ä¾¿ã€‚ä¹Ÿå¯ä»¥åœ¨ç±»ä¸Šä½¿ç”¨è¯¥æ³¨è§£.&lt;/p&gt;\n&lt;h2 id=\&#34;æ€»ç»“\&#34;&gt;æ€»ç»“ï¼š&lt;/h2&gt;\n&lt;p&gt;ä¸ªäººæ¨èä½¿ç”¨corsï¼Œå¦‚æœå› ä¸ºå…¼å®¹æ€§é—®é¢˜ä¸å¾—ä¸ä½¿ç”¨jsonpé‚£ä¹Ÿæ²¡åŠæ³•ã€‚ç„¶åå¦‚æœæ˜¯å‰åç«¯åˆ†ç¦»çš„æ¨¡å¼ä¸‹ï¼Œå¯¹äºç”¨æˆ·æƒé™éªŒè¯è¿™ä¸€å—ä¹Ÿæ˜¯ä¸€ä¸ªéœ€è¦æ³¨æ„ç‚¹ï¼Œå¦‚æœä½¿ç”¨cookie-sessionï¼Œè·¨åŸŸä¼šå¯¼è‡´åå°è·å–ä¸åˆ°sessionï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨tokençš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æ‰“ç®—ä»¥åä»‹ç»ä¸€ä¸‹jwtï¼ˆJson web Tokenï¼‰æ¥å®ç°ç”¨æˆ·è®¤è¯ã€‚&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;wNJouB2lg&#34;,&#34;abstract&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;æœ‰ä¸€æ¬¡æˆ‘çš„é¡¹ç›®ä¸­é‡‡ç”¨äº†å‰åç«¯åˆ†ç¦»çš„æ¨¡å¼ï¼Œå¼•èµ·äº†è·¨åŸŸé—®é¢˜ï¼Œæœ¬æ–‡å°†ä»‹ç»æˆ‘æ‰€é‡‡ç”¨çš„è·¨åŸŸè§£å†³æ–¹æ³•ã€‚&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;é¦–å…ˆè¦äº†è§£äº§ç”Ÿè·¨åŸŸçš„æœ¬è´¨ï¼Œä¹Ÿå°±æ˜¯åŒæºç­–ç•¥çš„é™åˆ¶ï¼Œæºæ˜¯æŒ‡åŸŸåã€ç«¯å£å·ã€åè®®ï¼Œæœ‰ä¸€è€…ä¸ç›¸åŒå°†è¢«æµè§ˆå™¨æ‹’ç»æ¥å—å“åº”ä¿¡æ¯ï¼Œï¼ˆè¯·æ±‚å¯ä»¥å‘é€å‡ºå»ï¼Œä½†æ˜¯æµè§ˆå™¨ä¸æ¥å—å“åº”ï¼‰ã€‚&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;SpringBoot è·¨åŸŸ Jsonp å’Œ Cors&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Spring&#34;,&#34;slug&#34;:&#34;P-ZT7Pj1-8&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/P-ZT7Pj1-8/&#34;}],&#34;date&#34;:&#34;2019-06-07 11:53:26&#34;,&#34;dateFormat&#34;:&#34;2019-06-07 11:53:26&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/wNJouB2lg/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;4 min read&#34;,&#34;time&#34;:189000,&#34;words&#34;:770,&#34;minutes&#34;:4},&#34;description&#34;:&#34;\næœ‰ä¸€æ¬¡æˆ‘çš„é¡¹ç›®ä¸­é‡‡ç”¨äº†å‰åç«¯åˆ†ç¦»çš„æ¨¡å¼ï¼Œå¼•èµ·äº†è·¨åŸŸé—®é¢˜ï¼Œæœ¬æ–‡å°†ä»‹ç»æˆ‘æ‰€é‡‡ç”¨çš„è·¨åŸŸè§£å†³æ–¹æ³•ã€‚\n\né¦–å…ˆè¦äº†è§£äº§ç”Ÿè·¨åŸŸçš„æœ¬è´¨ï¼Œä¹Ÿå°±æ˜¯åŒæºç­–ç•¥çš„é™åˆ¶ï¼Œæºæ˜¯æŒ‡åŸŸåã€ç«¯å£å·ã€åè®®ï¼Œæœ‰ä¸€è€…ä¸ç›¸åŒå°†è¢«æµè§ˆå™¨æ‹’ç»æ¥å—å“åº”ä¿¡æ¯ï¼Œï¼ˆè¯·æ±‚å¯ä»¥å‘é€å‡ºå»ï¼Œä½†æ˜¯æµè§ˆå™¨...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95\&#34;&gt;è§£å†³æ–¹æ³•ï¼š&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-jsonp\&#34;&gt;1. jsonp&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-cors\&#34;&gt;2. cors&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%96%B9%E5%BC%8F%E4%B8%80%E5%85%A8%E5%B1%80%E5%AE%9A%E4%B9%89\&#34;&gt;æ–¹å¼ä¸€ï¼šå…¨å±€å®šä¹‰&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%96%B9%E5%BC%8F%E4%BA%8C%E5%B1%80%E9%83%A8%E5%AE%9A%E4%B9%89\&#34;&gt;æ–¹å¼äºŒï¼šå±€éƒ¨å®šä¹‰&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%80%BB%E7%BB%93\&#34;&gt;æ€»ç»“ï¼š&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;å‰ä¸€é˜µå­è¦ç»™å®éªŒå®¤çš„å­¦å¼Ÿä»¬æŠ€æœ¯åˆ†äº«ï¼Œå½“æ—¶æ”¶åˆ°å»ºè®®ç»™ä»–ä»¬æ™®åŠä¸€äº›è®¡ç®—æœºç½‘ç»œçš„çŸ¥è¯†ï¼Œå¯æ˜¯å…³&lt;br&gt;\næœ‰ç†è®ºçŸ¥è¯†è®²è¯¾è‚¯å®šä¸å¤Ÿå¸å¼•äººï¼Œäºæ˜¯ä¾¿ä¸€è¾¹å­¦ä¹ Wiresharkä¸€è¾¹åšPPTä¸€è¾¹å†™è®²ç¨¿ã€‚å¿™ç¢Œäº†ä¸¤ä¸ªæ˜ŸæœŸåï¼Œåˆ†äº«ä¼šåè¿˜æ˜¯å¾—åˆ°äº†ä¸é”™çš„çš„è¯„ä»·ğŸ˜ï¼Œæˆ‘ä¹Ÿåœ¨åšå®¢ä¸­æ€»ç»“ä¸‹ä¸€äº›ä½¿ç”¨æŠ€å·§ï¼Œå†…å®¹ä¸»è¦é¢å‘æ–°æ‰‹&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;!-- more --&gt;\n&lt;h2 id=\&#34;1-wiresharkçš„ç”¨é€”\&#34;&gt;1. WireSharkçš„ç”¨é€”&lt;/h2&gt;\n&lt;h3 id=\&#34;ç”¨é€”ä¸€-å­¦ä¹ ç½‘ç»œçŸ¥è¯†æä¾›å®é™…æ“ä½œ\&#34;&gt;ç”¨é€”ä¸€ï¼š å­¦ä¹ ç½‘ç»œçŸ¥è¯†ï¼Œæä¾›å®é™…æ“ä½œ&lt;/h3&gt;\n&lt;p&gt;åœ¨æˆ‘å¤§äºŒå­¦ä¹ è®¡ç®—æœºç½‘ç»œçš„æ—¶å€™ï¼Œè€å¸ˆä¸Šè¯¾åªè´Ÿè´£ä¹¦æœ¬çš„è®²è§£ï¼Œå¯¼è‡´æˆ‘äº§ç”Ÿäº†è®¡ç®—æœºç½‘ç»œå¾ˆæ— èŠçš„é”™è§‰ï¼Œæ‰€ä»¥é‚£æ—¶å€™ä¹Ÿæ²¡å¤ªè®¤çœŸçš„å­¦ä¹ è¿™é—¨è¯¾ç¨‹ã€‚ä½†æ˜¯åæ¥å½“æˆ‘è‡ªå·±è¾¹æŠ“åŒ…è¾¹æ¸©ä¹ è®¡ç½‘çŸ¥è¯†çš„æ—¶å€™ï¼Œæ‰å‘ç°æ˜¯å¦‚æ­¤çš„æœ‰è¶£ã€‚è€Œåœ¨æŠ“åŒ…å·¥å…·ä¸­ï¼Œæˆ‘ä½¿ç”¨è¿‡å°èŠ±ç“¶ï¼ˆcharlesï¼‰å’Œå°é²¨é±¼ï¼ˆwiresharkï¼‰ï¼Œæˆ‘æ¨èå°é²¨é±¼ã€‚&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;è¿˜æœ‰ä¸€æ¬¾æ¯”è¾ƒæµè¡Œï¼Œå«fiddlerï¼Œå› ä¸ºæœ¬äººä½¿ç”¨macï¼Œfiddleræœªæ¨å‡ºmacç‰ˆï¼Œæ‰€ä»¥æœªæ¥è§¦è¿‡å®ƒ&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;ç”¨é€”äºŒ-è·å–ç½‘ç»œèµ„æºä¿¡æ¯\&#34;&gt;ç”¨é€”äºŒï¼š è·å–ç½‘ç»œèµ„æºä¿¡æ¯&lt;/h3&gt;\n&lt;p&gt;é€šä¿—ç‚¹è®²å°±æ˜¯æŠ“åŒ…ï¼Œwiresharkå¯ä»¥æŠ“çš„è¯·æ±‚ç±»å‹éå¸¸å¤šï¼Œæ–°æ‰‹å¸¸è§çš„åƒhttpã€httpsï¼ˆéœ€è¦ä¸‹è½½è¡¥ä¸ï¼‰ã€tcpã€udpã€arpç­‰ç­‰éƒ½å¯ä»¥ã€‚&lt;/p&gt;\n&lt;h3 id=\&#34;ç”¨é€”ä¸‰è¿›è¡Œç½‘ç»œçŠ¶å†µåˆ†æ\&#34;&gt;ç”¨é€”ä¸‰ï¼šè¿›è¡Œç½‘ç»œçŠ¶å†µåˆ†æ&lt;/h3&gt;\n&lt;p&gt;æ¯”å¦‚ç½‘ç»œæ•…éšœæ’æŸ¥ï¼Œå› ä¸ºæœ¬äººä¹Ÿæ²¡åˆ©ç”¨wiresharkåˆ†æè¿‡ï¼Œæ‰€ä»¥å°±ä¸è¯¯å¯¼å¤§å®¶äº†ï¼Œä¸è¿‡æˆ‘æ¨èä¸€æœ¬ä¹¦ï¼Œä¹Ÿæ˜¯æˆ‘å­¦ä¹ wiresharkçš„ä¸€æœ¬ä¹¦ã€‚&lt;br&gt;\n&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b034e550e178ea~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\nä½œè€…çš„é£æ ¼çœŸçš„å¾ˆé£è¶£ï¼Œè¯»èµ·æ¥å°±åƒå°è¯´ä¸€æ ·ï¼ŒæŒ‡ä¸å®šå“ªä¸ªåœ°æ–¹å°±ä¼šå·å·å†’å‡ºä¸€æ®µç¬‘è¯ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;2-æŠ“åŒ…å‰çš„å‡†å¤‡å·¥ä½œ\&#34;&gt;2. æŠ“åŒ…å‰çš„å‡†å¤‡å·¥ä½œ&lt;/h2&gt;\n&lt;h3 id=\&#34;1-ä¿®æ”¹ç€è‰²è§„åˆ™\&#34;&gt;1. ä¿®æ”¹ç€è‰²è§„åˆ™&lt;/h3&gt;\n&lt;p&gt;æˆ‘ä»¬ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„é€‚åˆï¼Œæ˜¾ç¤ºçš„ç•Œé¢å¯èƒ½åƒè¿™æ ·&lt;br&gt;\n&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/14/16f04764d3d10a9f~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\nä¸€ç‰‡ç™½çš„ï¼Œå¯¹äºæˆ‘ä»¬å¿«é€Ÿåˆ†è¾¨ä¸åŒè¯·æ±‚ç±»å‹æ˜¯æœ‰å¦¨ç¢çš„ï¼Œæ‰€ä»¥ç®€å•æ“ä½œä¸‹ï¼š&lt;/p&gt;\n&lt;h4 id=\&#34;1-æ‰“å¼€è§†å›¾é€‰é¡¹æ‰¾åˆ°ç€è‰²è§„åˆ™å°±åƒ\&#34;&gt;1ï¼‰ï¼š æ‰“å¼€è§†å›¾é€‰é¡¹ï¼Œæ‰¾åˆ°ç€è‰²è§„åˆ™ï¼Œå°±åƒ&lt;/h4&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b03844f45a802a~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h4 id=\&#34;2-ä¿®æ”¹èƒŒæ™¯é…è‰²\&#34;&gt;2ï¼‰ï¼š ä¿®æ”¹èƒŒæ™¯é…è‰²&lt;/h4&gt;\n&lt;p&gt;æˆ‘ä»¬æ ¹æ®è‡ªå·±çš„é¢œè‰²åå¥½ï¼Œè®¾ç½®ä¸åŒçš„é…è‰²ï¼ˆæƒ³è¦æ­é…å‡ºä¸€å¥—å…»çœ¼çš„é…è‰²çœŸçš„æ˜¯ä¸€ä»¶è´¹åŠ›çš„äº‹ï¼‰ï¼Œæˆ‘è¿™é‡Œä¸»è¦ä¿®æ”¹&lt;strong&gt;SYNæŠ¥æ–‡&lt;/strong&gt;ï¼ˆ&lt;strong&gt;ç»¿è‰²&lt;/strong&gt;ï¼‰å’Œ&lt;strong&gt;FINæŠ¥æ–‡&lt;/strong&gt;ï¼ˆ&lt;strong&gt;ç°è‰²&lt;/strong&gt;ï¼‰ï¼Œé…å®Œåï¼Œå°±å¯ä»¥å‘ç°ç•Œé¢äººæ€§åŒ–è®¸å¤šï¼Œè¿™ä¸‹ä¸€çœ¼å°±å¯ä»¥çŸ¥é“tcpæ¡æ‰‹å’ŒæŒ¥æ‰‹çš„è¯·æ±‚å•¦ï½&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b03873fb04efdf~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;2-åªæŠ“åŒ…å¤´\&#34;&gt;2. åªæŠ“åŒ…å¤´&lt;/h3&gt;\n&lt;p&gt;ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸€ä¸ªæ•°æ®å¸§æ˜¯ç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆï¼Œå¯¹äºæˆ‘ä»¬æ‰€è¦è·å–çš„æ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿåªè¦å‰é¢éƒ¨åˆ†å³å¯ã€‚å•å‡»èœå•æ ä¸Šçš„Capture--&amp;gt;Optionsï¼Œç„¶ååœ¨å¼¹å‡ºçš„çª—å£ä¸Šå®šä¹‰â€œLimit each packet toâ€çš„å€¼å³å¯ã€‚ä¸€èˆ¬å¯ä»¥è®¾ç½®ä¸€ä¸ªåå¤§ä¸€ç‚¹çš„æ•°å­—ï¼š80å­—èŠ‚ï¼Œè¿™æ ·å°±å¯ä»¥åªæŠ“å‰80å­—èŠ‚äº†ã€‚è¿™æ ·çš„è¯ï¼ŒTCPå±‚ã€ç½‘ç»œå±‚å’Œæ•°æ®é“¾è·¯å±‚çš„ä¿¡æ¯éƒ½å¯ä»¥åŒ…æ‹¬åœ¨å†…äº†ã€‚æˆ‘æ¨èè®¾ç½®200å­—èŠ‚ï¼Œè¿™æ ·å¯ä»¥è·å–åˆ°httpã€tcpã€ç½‘ç»œå±‚åè®®çš„æ•°æ®äº†ã€‚&lt;/p&gt;\n&lt;!--![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b038b192f25302~tplv-t2oaga2asx-image.image)--&gt;\n&lt;h3 id=\&#34;3-è®¤è¯†ä¸‹åˆ†å±‚\&#34;&gt;3. è®¤è¯†ä¸‹åˆ†å±‚&lt;/h3&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;3\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/14/16f047976a357b7f~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;æ³¨æ„ï¼šåœ¨è¿™é‡Œç½‘ç»œå±‚å¯¹åº”Ipv4ï¼Œä¼ è¾“å±‚å¯¹åº”tcpï¼Œåº”ç”¨å±‚å¯¹åº”httpã€‚å¦‚æœæ˜¯udpï¼Œé•¿è¿™æ ·â¬‡&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;4\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b0397dc455cff5~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;4-æ•°æ®è¿‡æ»¤æŠ€å·§\&#34;&gt;4. æ•°æ®è¿‡æ»¤æŠ€å·§&lt;/h3&gt;\n&lt;p&gt;è¿™ä¹Ÿæ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªå°æŠ€å·§ï¼Œä¼šä½¿ç”¨è¿‡æ»¤å™¨çš„è¯å¯¹äºå¿«é€Ÿå®šä½è¿˜æ˜¯æœ‰å¾ˆå¤§å¸®åŠ©çš„ï¼Œæˆ‘è¿™é‡Œåˆ—å‡ºä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„æŠ€å·§ï¼Œä¸€é€šåˆ™ç™¾é€šã€‚&lt;/p&gt;\n&lt;h4 id=\&#34;1åè®®è¿‡æ»¤\&#34;&gt;1ï¼‰åè®®è¿‡æ»¤&lt;/h4&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;5\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039b2a5642e35~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;6\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039b40ea70225~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;7\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039b515b268f2~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h4 id=\&#34;2-ç«¯å£è¿‡æ»¤\&#34;&gt;2ï¼‰ ç«¯å£è¿‡æ»¤&lt;/h4&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;8\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039b9b618a472~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;9\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039bab4fddc54~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;10\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039bbc3d5152a~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h4 id=\&#34;3ipè¿‡æ»¤\&#34;&gt;3ï¼‰Ipè¿‡æ»¤&lt;/h4&gt;\n&lt;p&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039c72b129565~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\n&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039c8a6e3c3ec~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\n&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039c9eb316c96~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\n&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039d555376068~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/p&gt;\n&lt;h4 id=\&#34;4æ ‡è¯†ç¬¦è¿‡æ»¤\&#34;&gt;4ï¼‰æ ‡è¯†ç¬¦è¿‡æ»¤&lt;/h4&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;11\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039db9dd136f4~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h4 id=\&#34;5é•¿åº¦è¿‡æ»¤\&#34;&gt;5ï¼‰é•¿åº¦è¿‡æ»¤&lt;/h4&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;12\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/29/16b039df7abb24f7~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;å…ˆåˆ†äº«åˆ°è¿™é‡Œï¼Œè¿™å‡ å¤©åœ¨å¿™ç€å†™å¾®ä¿¡å°ç¨‹åºï¼Œè¿‡å‡ å¤©é€šè¿‡wiresharkåˆ†æä¸‹tcp3æ¬¡æ¡æ‰‹å’Œ4æ¬¡æŒ¥æ‰‹æ¥å®æˆ˜æ“ä½œä¸‹ï½ å¦‚æœå“ªé‡Œæœ‰é”™è¯¯ï¼Œè¿˜æ³è¯·å¤§å®¶æŒ‡å‡ºã€‚&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;gei-xue-di-men-fen-xi-wireshark&#34;,&#34;abstract&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;å‰ä¸€é˜µå­è¦ç»™å®éªŒå®¤çš„å­¦å¼Ÿä»¬æŠ€æœ¯åˆ†äº«ï¼Œå½“æ—¶æ”¶åˆ°å»ºè®®ç»™ä»–ä»¬æ™®åŠä¸€äº›è®¡ç®—æœºç½‘ç»œçš„çŸ¥è¯†ï¼Œå¯æ˜¯å…³&lt;br&gt;\næœ‰ç†è®ºçŸ¥è¯†è®²è¯¾è‚¯å®šä¸å¤Ÿå¸å¼•äººï¼Œäºæ˜¯ä¾¿ä¸€è¾¹å­¦ä¹ Wiresharkä¸€è¾¹åšPPTä¸€è¾¹å†™è®²ç¨¿ã€‚å¿™ç¢Œäº†ä¸¤ä¸ªæ˜ŸæœŸåï¼Œåˆ†äº«ä¼šåè¿˜æ˜¯å¾—åˆ°äº†ä¸é”™çš„çš„è¯„ä»·ğŸ˜ï¼Œæˆ‘ä¹Ÿåœ¨åšå®¢ä¸­æ€»ç»“ä¸‹ä¸€äº›ä½¿ç”¨æŠ€å·§ï¼Œå†…å®¹ä¸»è¦é¢å‘æ–°æ‰‹&lt;/p&gt;\n&lt;/blockquote&gt;\n&#34;,&#34;title&#34;:&#34;ç»™å­¦å¼Ÿä»¬åˆ†æ WireShark&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;çŸ¥è¯†åˆ†äº«&#34;,&#34;slug&#34;:&#34;Yh19JUBym&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/Yh19JUBym/&#34;}],&#34;date&#34;:&#34;2019-05-11 17:59:02&#34;,&#34;dateFormat&#34;:&#34;2019-05-11 05:59:02&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/gei-xue-di-men-fen-xi-wireshark/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;4 min read&#34;,&#34;time&#34;:196000,&#34;words&#34;:939,&#34;minutes&#34;:4},&#34;description&#34;:&#34;\nå‰ä¸€é˜µå­è¦ç»™å®éªŒå®¤çš„å­¦å¼Ÿä»¬æŠ€æœ¯åˆ†äº«ï¼Œå½“æ—¶æ”¶åˆ°å»ºè®®ç»™ä»–ä»¬æ™®åŠä¸€äº›è®¡ç®—æœºç½‘ç»œçš„çŸ¥è¯†ï¼Œå¯æ˜¯å…³\næœ‰ç†è®ºçŸ¥è¯†è®²è¯¾è‚¯å®šä¸å¤Ÿå¸å¼•äººï¼Œäºæ˜¯ä¾¿ä¸€è¾¹å­¦ä¹ Wiresharkä¸€è¾¹åšPPTä¸€è¾¹å†™è®²ç¨¿ã€‚å¿™ç¢Œäº†ä¸¤ä¸ªæ˜ŸæœŸåï¼Œåˆ†äº«ä¼šåè¿˜æ˜¯å¾—åˆ°äº†ä¸é”™çš„çš„è¯„ä»·ğŸ˜ï¼Œæˆ‘ä¹Ÿåœ¨åšå®¢...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-wireshark%E7%9A%84%E7%94%A8%E9%80%94\&#34;&gt;1. WireSharkçš„ç”¨é€”&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%94%A8%E9%80%94%E4%B8%80-%E5%AD%A6%E4%B9%A0%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86%E6%8F%90%E4%BE%9B%E5%AE%9E%E9%99%85%E6%93%8D%E4%BD%9C\&#34;&gt;ç”¨é€”ä¸€ï¼š å­¦ä¹ ç½‘ç»œçŸ¥è¯†ï¼Œæä¾›å®é™…æ“ä½œ&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%94%A8%E9%80%94%E4%BA%8C-%E8%8E%B7%E5%8F%96%E7%BD%91%E7%BB%9C%E8%B5%84%E6%BA%90%E4%BF%A1%E6%81%AF\&#34;&gt;ç”¨é€”äºŒï¼š è·å–ç½‘ç»œèµ„æºä¿¡æ¯&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%94%A8%E9%80%94%E4%B8%89%E8%BF%9B%E8%A1%8C%E7%BD%91%E7%BB%9C%E7%8A%B6%E5%86%B5%E5%88%86%E6%9E%90\&#34;&gt;ç”¨é€”ä¸‰ï¼šè¿›è¡Œç½‘ç»œçŠ¶å†µåˆ†æ&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E6%8A%93%E5%8C%85%E5%89%8D%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C\&#34;&gt;2. æŠ“åŒ…å‰çš„å‡†å¤‡å·¥ä½œ&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E4%BF%AE%E6%94%B9%E7%9D%80%E8%89%B2%E8%A7%84%E5%88%99\&#34;&gt;1. ä¿®æ”¹ç€è‰²è§„åˆ™&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1-%E6%89%93%E5%BC%80%E8%A7%86%E5%9B%BE%E9%80%89%E9%A1%B9%E6%89%BE%E5%88%B0%E7%9D%80%E8%89%B2%E8%A7%84%E5%88%99%E5%B0%B1%E5%83%8F\&#34;&gt;1ï¼‰ï¼š æ‰“å¼€è§†å›¾é€‰é¡¹ï¼Œæ‰¾åˆ°ç€è‰²è§„åˆ™ï¼Œå°±åƒ&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E4%BF%AE%E6%94%B9%E8%83%8C%E6%99%AF%E9%85%8D%E8%89%B2\&#34;&gt;2ï¼‰ï¼š ä¿®æ”¹èƒŒæ™¯é…è‰²&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E5%8F%AA%E6%8A%93%E5%8C%85%E5%A4%B4\&#34;&gt;2. åªæŠ“åŒ…å¤´&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3-%E8%AE%A4%E8%AF%86%E4%B8%8B%E5%88%86%E5%B1%82\&#34;&gt;3. è®¤è¯†ä¸‹åˆ†å±‚&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4-%E6%95%B0%E6%8D%AE%E8%BF%87%E6%BB%A4%E6%8A%80%E5%B7%A7\&#34;&gt;4. æ•°æ®è¿‡æ»¤æŠ€å·§&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1%E5%8D%8F%E8%AE%AE%E8%BF%87%E6%BB%A4\&#34;&gt;1ï¼‰åè®®è¿‡æ»¤&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#2-%E7%AB%AF%E5%8F%A3%E8%BF%87%E6%BB%A4\&#34;&gt;2ï¼‰ ç«¯å£è¿‡æ»¤&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#3ip%E8%BF%87%E6%BB%A4\&#34;&gt;3ï¼‰Ipè¿‡æ»¤&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#4%E6%A0%87%E8%AF%86%E7%AC%A6%E8%BF%87%E6%BB%A4\&#34;&gt;4ï¼‰æ ‡è¯†ç¬¦è¿‡æ»¤&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#5%E9%95%BF%E5%BA%A6%E8%BF%87%E6%BB%A4\&#34;&gt;5ï¼‰é•¿åº¦è¿‡æ»¤&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;æˆ‘ä»¬åœ¨å†™å°ç¨‹åºçš„æ—¶å€™ï¼Œæ‰‹æœºç«¯é¢„è§ˆå‘ç°è·å–ä¸åˆ°åå°æ•°æ®ï¼Œåªèƒ½ç”¨çœŸæœºè°ƒè¯•æ‰å¯ä»¥ï¼Œå¯æ˜¯macç«¯çš„å¼€å‘è€…å·¥å…·å¯¹äºçœŸæœºè°ƒè¯•çš„ä½“éªŒè‹¦ä¸å ªè¨€ï¼Œå„ç§bugï¼ˆå®˜æ–¹bugï¼‰ã€‚æ‰€ä»¥æˆ‘æƒ³æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•ç›´æ¥ä½¿ç”¨é¢„è§ˆä¹Ÿå¯ä»¥ä¸€æ ·è·å–åˆ°æ•°æ®å‘¢ã€‚èŠ±äº†ä¸€å¤©çš„æ—¶é—´ï¼Œç»ˆäºæ˜¯æˆåŠŸäº†ã€‚psï¼šæˆ‘å®¤å‹é¢„è§ˆçš„æ—¶å€™ä¸€æ ·å¯ä¹Ÿä»¥æœ‰æ•°æ®ã€‚&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h2 id=\&#34;å…³é”®ç‚¹\&#34;&gt;å…³é”®ç‚¹ï¼š&lt;/h2&gt;\n&lt;p&gt;&lt;strong&gt;æ‰‹æœºï¼ŒæœåŠ¡å™¨ï¼Œä¿æŒåŒä¸€å±€åŸŸç½‘ã€‚&lt;/strong&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;ç¬¬ä¸€æ­¥å¼€å¯å±€åŸŸç½‘\&#34;&gt;ç¬¬ä¸€æ­¥ï¼šå¼€å¯å±€åŸŸç½‘&lt;/h2&gt;\n&lt;h3 id=\&#34;æ–¹æ³•1ä½¿ç”¨ç”µè„‘å¼€å¯å…±äº«wifiæ‰‹æœºè¿æ¥æ­¤wifi-ä¸è¿‡è¿™é‡Œå› ä¸ºæˆ‘ä»¬å­¦æ ¡å†…éƒ¨ç½‘éœ€è¦è´¦å·ç™»é™†æ‰€ä»¥æˆ‘æ²¡é‡‡ç”¨è¿™ç§æ–¹æ³•ä¸è¿‡è¿™ç§æ–¹æ³•çš„åç»­æµç¨‹å’Œç¬¬äºŒç§æ–¹æ³•å·®ä¸å¤š\&#34;&gt;æ–¹æ³•1ï¼‰&lt;strong&gt;ä½¿ç”¨ç”µè„‘å¼€å¯å…±äº«wifiï¼Œæ‰‹æœºè¿æ¥æ­¤wifi&lt;/strong&gt;ã€‚ä¸è¿‡è¿™é‡Œå› ä¸ºæˆ‘ä»¬å­¦æ ¡å†…éƒ¨ç½‘éœ€è¦è´¦å·ç™»é™†ï¼Œæ‰€ä»¥æˆ‘æ²¡é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œä¸è¿‡è¿™ç§æ–¹æ³•çš„åç»­æµç¨‹å’Œç¬¬äºŒç§æ–¹æ³•å·®ä¸å¤šã€‚&lt;/h3&gt;\n&lt;h3 id=\&#34;æ–¹æ³•2æ‰‹æœºå¼€å¯çƒ­ç‚¹ç”µè„‘è¿æ¥æ­¤çƒ­ç‚¹\&#34;&gt;æ–¹æ³•2ï¼‰&lt;strong&gt;æ‰‹æœºå¼€å¯çƒ­ç‚¹ï¼Œç”µè„‘è¿æ¥æ­¤çƒ­ç‚¹&lt;/strong&gt;ã€‚&lt;/h3&gt;\n&lt;h4 id=\&#34;1è¿æ¥åé¦–å…ˆæ‰¾åˆ°åˆ†é…ç»™ç”µè„‘çš„ip-macè·å–ipåœ¨è®¾ç½®-ç½‘ç»œé‡Œé¢å°±å¯ä»¥çœ‹åˆ°\&#34;&gt;1ï¼‰è¿æ¥åï¼Œé¦–å…ˆæ‰¾åˆ°åˆ†é…ç»™ç”µè„‘çš„IPã€‚macè·å–IPåœ¨è®¾ç½®-&amp;gt;ç½‘ç»œï¼Œé‡Œé¢å°±å¯ä»¥çœ‹åˆ°ã€‚&lt;/h4&gt;\n&lt;p&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b071a3d75c0c24~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\næˆ–è€…åœ¨ç»ˆç«¯è¾“å…¥&lt;strong&gt;ifconfig&lt;/strong&gt;ï¼Œå¯ä»¥æ‰¾åˆ°&lt;br&gt;\n&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b071e4ad724f4e~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;ç¬¬äºŒæ­¥ä¿®æ”¹æœåŠ¡å™¨åœ°å€\&#34;&gt;ç¬¬äºŒæ­¥ï¼šä¿®æ”¹æœåŠ¡å™¨åœ°å€&lt;/h2&gt;\n&lt;p&gt;æˆ‘åå°ä½¿ç”¨çš„SpringBootï¼Œåœ¨propertiesé‡Œé¢ç›´æ¥ä¿®æ”¹&lt;br&gt;\n&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0720284e518d4~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;ç¬¬ä¸‰æ­¥ä¿®æ”¹urlåœ°å€\&#34;&gt;ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹urlåœ°å€ï¼š&lt;/h2&gt;\n&lt;p&gt;ä¹‹å‰ä½¿ç”¨çš„urlåœ°å€ç±»ä¼¼äºï¼š&lt;strong&gt;http://localhost:8080/user/login/&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;ä¿®æ”¹åæœåŠ¡å™¨åœ°å€ååŒä¸€ä¿®æ”¹ä¸ºï¼š&lt;strong&gt;http://172.20.10.2:8080/user/login/&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;é‡å¯åå°ï¼Œç„¶ååœ¨postmanæµ‹è¯•ä¸€ä¸‹ï¼š&lt;br&gt;\n&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b07252a4316a41~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\nokï¼Œå¯ä»¥è·å–åˆ°æ•°æ®ã€‚&lt;br&gt;\nç„¶åæˆ‘ä»¬æŠŠå°ç¨‹åºé‡Œçš„requesté‡Œçš„urlå…¨éƒ¨ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚&lt;/p&gt;\n&lt;p&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b072a3158b4750~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\né‡æ–°ç¼–è¯‘åï¼Œæµ‹è¯•ä¸€ä¸‹å¯ä¸å¯ä»¥è·å–åˆ°æ•°æ®ï¼Œå¦‚æœä¹‹å‰æ­¥éª¤æ²¡é”™ï¼Œè‚¯å®šæ²¡é—®é¢˜çš„ã€‚&lt;br&gt;\næˆ‘ä»¬ç›´æ¥ä½¿ç”¨é¢„è§ˆï¼Œä¹Ÿæ˜¯ä¸€æ ·å¯ä»¥è·å–åˆ°æ•°æ®çš„ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;æ³¨æ„ç‚¹\&#34;&gt;æ³¨æ„ç‚¹ï¼š&lt;/h2&gt;\n&lt;p&gt;1ï¼‰ åœ¨åå°ä¿®æ”¹äº†åœ°å€åï¼Œä»¥åå¿…é¡»åœ¨çƒ­ç‚¹ç¯å¢ƒä¸‹è¿è¡Œé¡¹ç›®ï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚ï¼ˆæˆ‘å°±æ˜¯æœ‰ä¸€æ¬¡å¿˜è®°è¿çƒ­ç‚¹ï¼Œç»“æœä¸€ç›´å¯åŠ¨å¤±è´¥ï¼Œæˆ‘è¿˜ä»¥ä¸ºæ˜¯8080ç«¯å£å ç”¨é—®é¢˜ï¼‰&lt;/p&gt;\n&lt;p&gt;2ï¼‰å¦‚æœè¦åˆ«äººé¢„è§ˆä½ çš„å°ç¨‹åºï¼Œå¾—å…ˆè¿æ¥ä½ çš„çƒ­ç‚¹ï¼Œæ‰èƒ½è·å–åˆ°æ•°æ®ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;æ€»ç»“\&#34;&gt;æ€»ç»“ï¼š&lt;/h2&gt;\n&lt;p&gt;å¯¹äº†ï¼Œå¦‚æœä½ è¿˜æœ‰äº†ç½‘é¡µï¼Œé‚£ä¹ˆä¸€æ ·å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•åœ¨æ‰‹æœºä¸Šè®¿é—®ä½ çš„ç•Œé¢çš„ã€‚&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;å°ç¨‹åºæˆªå›¾ï¼š&lt;/strong&gt;&lt;br&gt;\n&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b0739305696dd0~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;ç½‘é¡µæ‰‹æœºæˆªå›¾ï¼š&lt;/strong&gt;&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/30/16b073aa9f2958a9~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&#34;,&#34;fileName&#34;:&#34;hwe1uEAHe&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;æˆ‘ä»¬åœ¨å†™å°ç¨‹åºçš„æ—¶å€™ï¼Œæ‰‹æœºç«¯é¢„è§ˆå‘ç°è·å–ä¸åˆ°åå°æ•°æ®ï¼Œåªèƒ½ç”¨çœŸæœºè°ƒè¯•æ‰å¯ä»¥ï¼Œå¯æ˜¯macç«¯çš„å¼€å‘è€…å·¥å…·å¯¹äºçœŸæœºè°ƒè¯•çš„ä½“éªŒè‹¦ä¸å ªè¨€ï¼Œå„ç§bugï¼ˆå®˜æ–¹bugï¼‰ã€‚æ‰€ä»¥æˆ‘æƒ³æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•ç›´æ¥ä½¿ç”¨é¢„è§ˆä¹Ÿå¯ä»¥ä¸€æ ·è·å–åˆ°æ•°æ®å‘¢ã€‚èŠ±äº†ä¸€å¤©çš„æ—¶é—´ï¼Œç»ˆäºæ˜¯æˆåŠŸäº†ã€‚psï¼šæˆ‘å®¤å‹é¢„è§ˆçš„æ—¶å€™ä¸€æ ·å¯ä¹Ÿä»¥æœ‰æ•°æ®ã€‚&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;å¾®ä¿¡å°ç¨‹åºï¼šé¢„è§ˆé¡µå®ç°ä¸åå°é€šä¿¡&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;å¾®ä¿¡å°ç¨‹åº&#34;,&#34;slug&#34;:&#34;59D97ArOs&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/59D97ArOs/&#34;}],&#34;date&#34;:&#34;2019-04-19 12:47:17&#34;,&#34;dateFormat&#34;:&#34;2019-04-19 12:47:17&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/hwe1uEAHe/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;3 min read&#34;,&#34;time&#34;:120000,&#34;words&#34;:572,&#34;minutes&#34;:3},&#34;description&#34;:&#34;æˆ‘ä»¬åœ¨å†™å°ç¨‹åºçš„æ—¶å€™ï¼Œæ‰‹æœºç«¯é¢„è§ˆå‘ç°è·å–ä¸åˆ°åå°æ•°æ®ï¼Œåªèƒ½ç”¨çœŸæœºè°ƒè¯•æ‰å¯ä»¥ï¼Œå¯æ˜¯macç«¯çš„å¼€å‘è€…å·¥å…·å¯¹äºçœŸæœºè°ƒè¯•çš„ä½“éªŒè‹¦ä¸å ªè¨€ï¼Œå„ç§bugï¼ˆå®˜æ–¹bugï¼‰ã€‚æ‰€ä»¥æˆ‘æƒ³æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•ç›´æ¥ä½¿ç”¨é¢„è§ˆä¹Ÿå¯ä»¥ä¸€æ ·è·å–åˆ°æ•°æ®å‘¢ã€‚èŠ±äº†ä¸€å¤©çš„æ—¶é—´ï¼Œç»ˆäºæ˜¯æˆåŠŸäº†...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%B3%E9%94%AE%E7%82%B9\&#34;&gt;å…³é”®ç‚¹ï¼š&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%AC%AC%E4%B8%80%E6%AD%A5%E5%BC%80%E5%90%AF%E5%B1%80%E5%9F%9F%E7%BD%91\&#34;&gt;ç¬¬ä¸€æ­¥ï¼šå¼€å¯å±€åŸŸç½‘&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%96%B9%E6%B3%951%E4%BD%BF%E7%94%A8%E7%94%B5%E8%84%91%E5%BC%80%E5%90%AF%E5%85%B1%E4%BA%ABwifi%E6%89%8B%E6%9C%BA%E8%BF%9E%E6%8E%A5%E6%AD%A4wifi-%E4%B8%8D%E8%BF%87%E8%BF%99%E9%87%8C%E5%9B%A0%E4%B8%BA%E6%88%91%E4%BB%AC%E5%AD%A6%E6%A0%A1%E5%86%85%E9%83%A8%E7%BD%91%E9%9C%80%E8%A6%81%E8%B4%A6%E5%8F%B7%E7%99%BB%E9%99%86%E6%89%80%E4%BB%A5%E6%88%91%E6%B2%A1%E9%87%87%E7%94%A8%E8%BF%99%E7%A7%8D%E6%96%B9%E6%B3%95%E4%B8%8D%E8%BF%87%E8%BF%99%E7%A7%8D%E6%96%B9%E6%B3%95%E7%9A%84%E5%90%8E%E7%BB%AD%E6%B5%81%E7%A8%8B%E5%92%8C%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E6%B3%95%E5%B7%AE%E4%B8%8D%E5%A4%9A\&#34;&gt;æ–¹æ³•1ï¼‰&lt;strong&gt;ä½¿ç”¨ç”µè„‘å¼€å¯å…±äº«wifiï¼Œæ‰‹æœºè¿æ¥æ­¤wifi&lt;/strong&gt;ã€‚ä¸è¿‡è¿™é‡Œå› ä¸ºæˆ‘ä»¬å­¦æ ¡å†…éƒ¨ç½‘éœ€è¦è´¦å·ç™»é™†ï¼Œæ‰€ä»¥æˆ‘æ²¡é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œä¸è¿‡è¿™ç§æ–¹æ³•çš„åç»­æµç¨‹å’Œç¬¬äºŒç§æ–¹æ³•å·®ä¸å¤šã€‚&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%96%B9%E6%B3%952%E6%89%8B%E6%9C%BA%E5%BC%80%E5%90%AF%E7%83%AD%E7%82%B9%E7%94%B5%E8%84%91%E8%BF%9E%E6%8E%A5%E6%AD%A4%E7%83%AD%E7%82%B9\&#34;&gt;æ–¹æ³•2ï¼‰&lt;strong&gt;æ‰‹æœºå¼€å¯çƒ­ç‚¹ï¼Œç”µè„‘è¿æ¥æ­¤çƒ­ç‚¹&lt;/strong&gt;ã€‚&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#1%E8%BF%9E%E6%8E%A5%E5%90%8E%E9%A6%96%E5%85%88%E6%89%BE%E5%88%B0%E5%88%86%E9%85%8D%E7%BB%99%E7%94%B5%E8%84%91%E7%9A%84ip-mac%E8%8E%B7%E5%8F%96ip%E5%9C%A8%E8%AE%BE%E7%BD%AE-%E7%BD%91%E7%BB%9C%E9%87%8C%E9%9D%A2%E5%B0%B1%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0\&#34;&gt;1ï¼‰è¿æ¥åï¼Œé¦–å…ˆæ‰¾åˆ°åˆ†é…ç»™ç”µè„‘çš„IPã€‚macè·å–IPåœ¨è®¾ç½®-&amp;gt;ç½‘ç»œï¼Œé‡Œé¢å°±å¯ä»¥çœ‹åˆ°ã€‚&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E4%BF%AE%E6%94%B9%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9C%B0%E5%9D%80\&#34;&gt;ç¬¬äºŒæ­¥ï¼šä¿®æ”¹æœåŠ¡å™¨åœ°å€&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%AC%AC%E4%B8%89%E6%AD%A5%E4%BF%AE%E6%94%B9url%E5%9C%B0%E5%9D%80\&#34;&gt;ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹urlåœ°å€ï¼š&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%B3%A8%E6%84%8F%E7%82%B9\&#34;&gt;æ³¨æ„ç‚¹ï¼š&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%80%BB%E7%BB%93\&#34;&gt;æ€»ç»“ï¼š&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;æœ€è¿‘åœ¨å­¦ä¹ å¾®ä¿¡å°ç¨‹åºï¼Œé‡åˆ°äº†ä¸€äº›å‘ï¼Œæœ‰äº›é—®é¢˜æˆ‘çœ‹å®˜ç½‘æˆ–è€…å…¶ä»–åšå®¢ï¼Œå¯èƒ½è®²çš„ä¸æ˜¯é‚£ä¹ˆæ˜“æ‡‚ï¼Œæ‰€ä»¥è‡ªå·±æ‰¾åˆ°è§£å†³æ–¹æ³•åï¼Œå†™ä¸‹æ¥ä¾›å¤§å®¶å‚è€ƒï¼Œå¦‚æœ‰ä¸å¯¹æŒ‡å‡ºï¼Œè¿˜æ³è¯·å¤§å®¶æŒ‡å‡ºï½&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;!-- more --&gt;\n&lt;p&gt;æ¯”å¦‚åœ¨å®ç°è´­ç‰©è½¦æ‰¹é‡è´­ä¹°çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å‘åå°è¯·æ±‚ä¸€ä¸ªlistï¼ŒåŒ…å«æ‰€æœ‰å‹¾é€‰çš„ç‰©å“ä¿¡æ¯ï¼Œåœ¨å¾®ä¿¡å°ç¨‹åºé‡Œï¼Œpageé‡Œçš„dataæ˜¯è¿™æ ·å®šä¹‰&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;        data {  \n            ordersï¼š[]  \n        }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;åœ¨æˆ‘ä»¬ç»™å®ƒèµ‹å€¼åï¼Œæ•°æ®ç±»ä¼¼äº&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/28/16afc450f3dd4a23~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;å¦‚æœæˆ‘ä»¬åˆ©ç”¨wx.requestæŠŠè¿™ä¸ªlistå‘é€çš„æ—¶å€™ï¼Œæ ¹æ®å¾®ä¿¡å®˜æ–¹æ–‡æ¡£çš„è§£é‡Šï¼š&lt;/p&gt;\n&lt;!--![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/28/16afc476b45019b8~tplv-t2oaga2asx-image.image)--&gt;\n&lt;p&gt;&lt;strong&gt;data å‚æ•°è¯´æ˜&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;æœ€ç»ˆå‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®æ˜¯ String ç±»å‹ï¼Œå¦‚æœä¼ å…¥çš„ data ä¸æ˜¯ String ç±»å‹ï¼Œä¼šè¢«è½¬æ¢æˆ String ã€‚è½¬æ¢è§„åˆ™å¦‚ä¸‹ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;å¯¹äº GET æ–¹æ³•çš„æ•°æ®ï¼Œä¼šå°†æ•°æ®è½¬æ¢æˆ query stringï¼ˆencodeURIComponent(k)=encodeURIComponent(v)&amp;amp;encodeURIComponent(k)=encodeURIComponent(v)...ï¼‰&lt;/li&gt;\n&lt;li&gt;å¯¹äº POST æ–¹æ³•ä¸” header[&#39;content-type&#39;] ä¸º application/json çš„æ•°æ®ï¼Œä¼šå¯¹æ•°æ®è¿›è¡Œ JSON åºåˆ—åŒ–&lt;/li&gt;\n&lt;li&gt;å¯¹äº POST æ–¹æ³•ä¸” header[&#39;content-type&#39;] ä¸º application/x-www-form-urlencoded çš„æ•°æ®ï¼Œä¼šå°†æ•°æ®è½¬æ¢æˆ query string ï¼ˆencodeURIComponent(k)=encodeURIComponent(v)&amp;amp;encodeURIComponent(k)=encodeURIComponent(v)...ï¼‰&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;&lt;a href=\&#34;https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html\&#34;&gt;å¾®ä¿¡å¯¹äºè¯¥éƒ¨ä½è§£é‡Šå®˜ç½‘æ–‡æ¡£åœ°å€&lt;/a&gt;&lt;/p&gt;\n&lt;p&gt;æ„æ€å°±æ˜¯æ‰€æœ‰çš„dataæ•°æ®éƒ½ä¼šä»¥Stringç±»å‹å‘é€ã€‚æ‰€ä»¥å¾ˆå¤šæœ‹å‹å¯èƒ½åˆšå¼€å§‹å’Œæˆ‘ä¸€æ ·ï¼Œè¯·æ±‚æ€»æ˜¯é”™è¯¯ï¼Œæˆ–è€…åå°æ¥æ”¶äº†è¯·æ±‚ï¼Œå¯æ˜¯å€¼å´æ˜¯nullã€‚è®¸å¤šåšå®¢ç»™çš„æ–¹æ³•æ¯”å¦‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-js\&#34;&gt;        header: {\n        &#39;content-type&#39;: &#39;application/json&#39;\n      },\n      æ”¹ä¸º\n      header: {\n          &#39;content-type&#39;: &#39;application/x-www-form-urlencoded&#39;\n        },\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;æˆ‘å°è¯•ä¹‹åå‘ç°è¯·æ±‚è¿˜æ˜¯æŠ¥é”™ï¼Œä¸‹é¢ç»™å‡ºæˆ‘çš„è§£å†³æ–¹æ³•ï¼š&lt;/p&gt;\n&lt;h2 id=\&#34;å¾®ä¿¡å°ç¨‹åº\&#34;&gt;å¾®ä¿¡å°ç¨‹åºï¼š&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-js\&#34;&gt;        wx.request({\n          url: &#39;http://172.20.10.2:8080/order/wx/buy&#39;,\n          header: {\n               &#39;content-type&#39;: &#39;application/json&#39;\n            },\n          method: &amp;quot;POST&amp;quot;,\n          data:{\n            buyGoodsDTOS:this.data.orders,\n            user_id:this.data.user_info.user_id\n        },\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;dataé‡Œé¢æœ‰åˆ—è¡¨ç±»å‹çš„ordersï¼Œä»¥åŠä¸€ä¸ªç”¨æˆ·IDï¼Œ&lt;br&gt;\næˆ‘ä»¬å°±è¿™ç›´æ¥è¿™æ ·å‘èµ·è¯·æ±‚ï¼Œorderså’Œuser_idéƒ½ä¼šè¢«åºåˆ—åŒ–ä¸ºjson&lt;/p&gt;\n&lt;h2 id=\&#34;åå°æ¥æ”¶\&#34;&gt;åå°æ¥æ”¶&lt;/h2&gt;\n&lt;p&gt;åˆ©ç”¨é˜¿é‡Œçš„&lt;strong&gt;fastjson&lt;/strong&gt;ï¼Œæˆ‘ä½¿ç”¨çš„&lt;strong&gt;SpringBoot&lt;/strong&gt;&lt;/p&gt;\n&lt;h3 id=\&#34;pomxmlé‡Œæ·»åŠ \&#34;&gt;pom.xmlé‡Œæ·»åŠ ï¼š&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-xml\&#34;&gt;        &amp;lt;dependency&amp;gt;\n            &amp;lt;groupId&amp;gt;com.alibaba&amp;lt;/groupId&amp;gt;\n            &amp;lt;artifactId&amp;gt;fastjson&amp;lt;/artifactId&amp;gt;\n            &amp;lt;version&amp;gt;1.2.46&amp;lt;/version&amp;gt;\n        &amp;lt;/dependency&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;controlleré‡Œé¢\&#34;&gt;Controlleré‡Œé¢ï¼š&lt;/h3&gt;\n&lt;p&gt;åˆ©ç”¨&lt;strong&gt;fastjson&lt;/strong&gt;çš„&lt;strong&gt;JSONObject&lt;/strong&gt;æ¥æ”¶wxåºåˆ—åŒ–åçš„jsonæ•°æ®&lt;/p&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/28/16afc9d899d22dda~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;p&gt;é€šè¿‡JSONObjectç±»çš„æºç ï¼Œå¯ä»¥å‘ç°ä»–å®ç°ç±»Mapæ¥å£&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;        public class JSONObject extends JSON implements Map&amp;lt;String, Object&amp;gt;,ã€‚ã€‚ã€‚\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å¯ä»¥çŸ¥é“ï¼Œå®ƒæ˜¯åˆ©ç”¨é”®å€¼å¯¹å­˜å‚¨å¾®ä¿¡å°ç¨‹åºå‘é€çš„jsonæ•°æ®ï¼Œå­˜å‚¨æ–¹å¼ç±»ä¼¼äº&lt;/p&gt;\n&lt;p&gt;&lt;img src=\&#34;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/28/16afc685bf16f9d4~tplv-t2oaga2asx-image.image\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\nä¸‹åˆ’çº¿éƒ¨åˆ†ä¸ºkeyï¼Œåç§°ç›¸åŒï¼Œvalueå°±æ˜¯ä¼ è¿‡æ¥çš„æ•°æ®ã€‚&lt;br&gt;\nå¯¹äºé‡Œé¢jsonDataé‡Œé¢ordersæ•°æ®ï¼ˆlistï¼‰çš„è·å–ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-java\&#34;&gt;        JSONArray jsonArray = jsonData.getJSONArray(&amp;quot;buyGoodsDTOS&amp;quot;);    //æ ¹æ®keyåè·å–\n        List&amp;lt;BuyGoodsDTO&amp;gt; list = jsonArray.toJavaList(BuyGoodsDTO.class); //å°†æ•°ç»„å¯¹è±¡è½¬åŒ–ä¸ºlistï¼ŒBuyGoodsDTOæ˜¯ä¸ordersé‡Œé¢å¯¹è±¡è¦å¯¹åº”\n        \n        String user_id = jsonData.get(&amp;quot;user_id&amp;quot;).toString();    //è·å–user_id\n        Integer id = Integer.parseInt(user_id);         //è½¬åŒ–ç±»å‹\n```j\nè¿™æ ·æ‰€æœ‰çš„æ•°æ®éƒ½è·å–åˆ°å•¦ï½\n\n\n\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;dU5Kti6_I&#34;,&#34;abstract&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;æœ€è¿‘åœ¨å­¦ä¹ å¾®ä¿¡å°ç¨‹åºï¼Œé‡åˆ°äº†ä¸€äº›å‘ï¼Œæœ‰äº›é—®é¢˜æˆ‘çœ‹å®˜ç½‘æˆ–è€…å…¶ä»–åšå®¢ï¼Œå¯èƒ½è®²çš„ä¸æ˜¯é‚£ä¹ˆæ˜“æ‡‚ï¼Œæ‰€ä»¥è‡ªå·±æ‰¾åˆ°è§£å†³æ–¹æ³•åï¼Œå†™ä¸‹æ¥ä¾›å¤§å®¶å‚è€ƒï¼Œå¦‚æœ‰ä¸å¯¹æŒ‡å‡ºï¼Œè¿˜æ³è¯·å¤§å®¶æŒ‡å‡ºï½&lt;/p&gt;\n&lt;/blockquote&gt;\n&#34;,&#34;title&#34;:&#34;å¾®ä¿¡å°ç¨‹åºï¼šPOST ä¼ è¾“ List æ•°æ®&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;æºç &#34;,&#34;slug&#34;:&#34;yuan-ma&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/yuan-ma/&#34;},{&#34;name&#34;:&#34;Java&#34;,&#34;slug&#34;:&#34;6j9B3b2nb&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/6j9B3b2nb/&#34;},{&#34;name&#34;:&#34;å¾®ä¿¡å°ç¨‹åº&#34;,&#34;slug&#34;:&#34;59D97ArOs&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/tag/59D97ArOs/&#34;}],&#34;date&#34;:&#34;2019-03-15 13:09:09&#34;,&#34;dateFormat&#34;:&#34;2019-03-15 01:09:09&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://zexho994.github.io/blog.zexho.life/post/dU5Kti6_I/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;3 min read&#34;,&#34;time&#34;:176000,&#34;words&#34;:719,&#34;minutes&#34;:3},&#34;description&#34;:&#34;\næœ€è¿‘åœ¨å­¦ä¹ å¾®ä¿¡å°ç¨‹åºï¼Œé‡åˆ°äº†ä¸€äº›å‘ï¼Œæœ‰äº›é—®é¢˜æˆ‘çœ‹å®˜ç½‘æˆ–è€…å…¶ä»–åšå®¢ï¼Œå¯èƒ½è®²çš„ä¸æ˜¯é‚£ä¹ˆæ˜“æ‡‚ï¼Œæ‰€ä»¥è‡ªå·±æ‰¾åˆ°è§£å†³æ–¹æ³•åï¼Œå†™ä¸‹æ¥ä¾›å¤§å®¶å‚è€ƒï¼Œå¦‚æœ‰ä¸å¯¹æŒ‡å‡ºï¼Œè¿˜æ³è¯·å¤§å®¶æŒ‡å‡ºï½\n\n\næ¯”å¦‚åœ¨å®ç°è´­ç‰©è½¦æ‰¹é‡è´­ä¹°çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å‘åå°è¯·æ±‚ä¸€ä¸ªlistï¼ŒåŒ…å«æ‰€æœ‰...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F\&#34;&gt;å¾®ä¿¡å°ç¨‹åºï¼š&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%90%8E%E5%8F%B0%E6%8E%A5%E6%94%B6\&#34;&gt;åå°æ¥æ”¶&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#pomxml%E9%87%8C%E6%B7%BB%E5%8A%A0\&#34;&gt;pom.xmlé‡Œæ·»åŠ ï¼š&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#controller%E9%87%8C%E9%9D%A2\&#34;&gt;Controlleré‡Œé¢ï¼š&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;}]";
  // var json = escape.substr(1, escape.length - 2);
  // var datas = json.split(',');
  // for (let i=0; i < datas.length; i++) {
  //   let item = datas[i];
  //   let attrs = item.split('34;:&#34')
  //   debugger
  //   console.log(datas[i])
  // }
  let escapeMap = new Map();
  escapeMap.set('&#34;', '"');
  escapeMap.set('&gt;', '>');
  escapeMap.set('&#39;', "'");
  escapeMap.set('&lt;', '<');
  escapeMap.set('&quot;', '"');
  escapeMap.set('&amp;', '&');
</script> -->

<script src="/media/js/mouse/love.js"></script>


<script src=" /media/js/cool.js"></script>

</html>